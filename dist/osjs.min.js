/**!
 * OS.js - JavaScript Cloud/Web Desktop Platform
 *
 * Copyright (c) 2011-2017, Anders Evenrud <andersevenrud@gmail.com>
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met: 
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author  Anders Evenrud <andersevenrud@gmail.com>
 * @licence Simplified BSD License
 */
window.OSjs=window.OSjs||{},function(){"use strict";!function(){window.console=window.console||{},console.log=console.log||function(){},console.debug=console.debug||console.log,console.error=console.error||console.log,console.warn=console.warn||console.log,console.group=console.group||console.log,console.groupEnd=console.groupEnd||console.log}(),["forEach","every","map"].forEach(function(e){["HTMLCollection","NodeList","FileList"].forEach(function(t){window[t]&&(window[t].prototype[e]=Array.prototype[e])})}),function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:window.undefined};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}window.navigator.userAgent.match(/MSIE|Edge|Trident/)&&(e.prototype=window.Event.prototype,window.CustomEvent=e)}(),function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1};var n=document.createEvent("MouseEvent");return n.initMouseEvent(e,t.bubbles,t.cancelable,window,0,0,0,0,0,!1,!1,!1,!1,0,t.relatedTarget),n}try{return void new window.MouseEvent("test")}catch(e){}e.prototype=Event.prototype,window.MouseEvent=e}()}(),function(){"use strict";function e(e){return!1}function t(){if(OSjs.API.getConfig("Watermark.enabled")){var e=OSjs.API.getConfig("Version","unknown version"),t=OSjs.API.getConfig("Watermark.lines")||[],n=document.createElement("div");n.id="DebugNotice",n.setAttribute("aria-hidden","true"),n.innerHTML=t.join("<br />").replace(/%VERSION%/,e),document.body.appendChild(n)}document.getElementById("LoadingScreen").style.display="none"}function n(e,t){var n=OSjs.API.getConfig("Connection"),i="standalone"===n.Type?"http":n.Type,o=new OSjs.Connections[i],r=new OSjs.Auth[n.Authenticator],a=new OSjs.Storage[n.Storage];OSjs.API.setLocale(OSjs.API.getConfig("Locale")),o.init(function(e){e?t(e):a.init(function(){r.init(function(e){e||(p=!0),t(e)})})})}function i(){document.body.addEventListener("contextmenu",v.body_contextmenu,!1),document.body.addEventListener("click",v.body_click,!1),document.addEventListener("keydown",v.keydown,!0),document.addEventListener("keypress",v.keypress,!0),document.addEventListener("keyup",v.keyup,!0),window.addEventListener("orientationchange",v.orientationchange,!1),window.addEventListener("hashchange",v.hashchange,!1),window.addEventListener("resize",v.resize,!1),window.addEventListener("scroll",v.scroll,!1),window.addEventListener("fullscreenchange",v.fullscreen,!1),window.addEventListener("mozfullscreenchange",v.fullscreen,!1),window.addEventListener("webkitfullscreenchange",v.fullscreen,!1),window.addEventListener("msfullscreenchange",v.fullscreen,!1),window.addEventListener("message",v.message,!1),window.onbeforeunload=v.beforeunload,v.orientationchange(),window.onerror=function(e,t,n,i,o){return"string"==typeof o&&(o=null),OSjs.API.error(OSjs.API._("ERR_JAVASCRIPT_EXCEPTION"),OSjs.API._("ERR_JAVACSRIPT_EXCEPTION_DESC"),OSjs.API._("BUGREPORT_MSG"),o||{name:"window::onerror()",fileName:t,lineNumber:n+":"+i,message:e},!0),!1}}function o(e,t){var n=[];!function e(t){t.forEach(function(t){t instanceof Array?e(t):n.push(t)})}(e.Preloads),OSjs.Utils.preload(n,function(e,n){n.length,setTimeout(function(){t()},0)})}function r(e,t){if(m.mocha)return void t();OSjs.API.getConfig("Broadway.enabled")&&(OSjs.API.addHook("onSessionLoaded",function(){OSjs.Broadway.Connection.init()}),OSjs.API.addHook("onLogout",function(){OSjs.Broadway.Connection.disconnect()}),OSjs.API.addHook("onBlurMenu",function(){OSjs.Broadway.GTK.inject(null,"blur")}));var n=Object.keys(OSjs.Extensions),i=OSjs.Core.getMetadata();OSjs.Utils.asyncs(n,function(e,t,n){try{var o=i[e];OSjs.Extensions[e].init(o,function(){n()})}catch(e){e.stack,n()}},function(){t()})}function a(e,t){var n=e.SettingsManager||{},i=OSjs.Core.getSettingsManager();Object.keys(n).forEach(function(e){i.instance(e,n[e]||{})}),t()}function s(e,t){OSjs.Core.getPackageManager().load(function(e,n,i){if(n)return void t(n,e);var o=OSjs.API.getConfig("PreloadOnBoot",[]);OSjs.Utils.asyncs(o,function(e,t,n){var o=i.getPackage(e);o&&o.preload?OSjs.Utils.preload(o.preload,n):n()},function(){setTimeout(function(){t(!1,!0)},0)})})}function u(e,t){OSjs.Core.getMountManager().init(t)}function c(e,t){OSjs.Core.getSearchEngine().init(t)}function l(e,t){if(!e.WM||!e.WM.exec)return void t(OSjs.API._("ERR_CORE_INIT_NO_WM"));OSjs.API.launch(e.WM.exec,e.WM.args||{},function(e){e.setup(t)},function(e,n,i,o){t(OSjs.API._("ERR_CORE_INIT_WM_FAILED_FMT",e),o)})}function d(e,t){OSjs.API.playSound("LOGIN");var n=[];try{n=e.AutoStart}catch(e){e.stack}var i={},o=[];n.forEach(function(e,t){"string"==typeof e&&(e=n[t]={name:e}),-1===o.indexOf(e.name)&&(i[e.name]||(i[e.name]=t,o.push(e.name)))}),OSjs.Core.getStorage().getLastSession(function(e,o){e||o.forEach(function(e){if(void 0===i[e.name])n.push(e);else if(e.args){var t=i[e.name],o=n[t];o.args||(o.args={}),o.args=OSjs.Utils.mergeObject(o.args,e.args)}}),OSjs.API.launchList(n,null,null,t)})}function f(e){function f(){_=_.destroy(),v=v.style.display="none",OSjs.Core.getWindowManager()._fullyLoaded=!0,OSjs.API.triggerHook("onWMInited");try{m.onInited()}catch(e){}}function p(e){OSjs.API.error(OSjs.API._("ERR_CORE_INIT_FAILED"),OSjs.API._("ERR_CORE_INIT_FAILED_DESC"),e,null,!0)}function h(){OSjs.API.triggerHook("onInited");try{m.onInit()}catch(e){}_.update(S.length,S.length),y.forEach(function(e){"object"==typeof OSjs[e]&&Object.freeze(OSjs[e])}),m.mocha?f():l(g,function(e){if(e)return void p(e);i(),f(),d(g,function(){OSjs.API.triggerHook("onSessionLoaded")})})}try{e=e||{},m=OSjs.Utils.argumentDefaults(e,{mocha:!1,onInit:function(){},onInited:function(){}})}catch(e){}var g=OSjs.Core.getConfig(),v=document.getElementById("LoadingScreen"),_=OSjs.API.createSplash("OS.js",null,null,v),y=["Bootstrap","API","Core","Dialogs","Extensions","GUI","Helpers","Locales","Utils","VFS"],S=[o,n,u,a,s,r,c,function(e,t){OSjs.Core.getMountManager().restore(t)},function(e,t){return OSjs.GUI.DialogScheme.init(t)}];v.style.display="block",t(),OSjs.Utils.asyncs(S,function(e,t,n){t<1&&OSjs.API.triggerHook("onInitialize"),_.update(t,S.length),e(g,function(e){if(e)return void p(e);n()})},h)}["Bootstrap","Utils","API","GUI","Core","Dialogs","Helpers","Applications","Locales","VFS","Extensions","Auth","Storage","Connections","Broadway"].forEach(function(e){OSjs[e]=OSjs[e]||{}}),["Helpers"].forEach(function(e){OSjs.GUI[e]=OSjs.GUI[e]||{}}),["Helpers","Transports"].forEach(function(e){OSjs.VFS[e]=OSjs.VFS[e]||{}});var p=!1,h=!1,g=!1,m={},v={body_contextmenu:function(e){e.stopPropagation();var t=OSjs.Core.getWindowManager();return t&&t.onContextMenu(e),!!OSjs.Utils.$isFormElement(e)||(e.preventDefault(),!1)},body_click:function(e){var t=e.target,n=["GUI-MENU-BAR-ENTRY","GUI-MENU-ENTRY"];t&&-1!==n.indexOf(t.tagName)||OSjs.API.blurMenu();var i=OSjs.Core.getWindowManager();if(t===document.body){var o=i?i.getCurrentWindow():null;o&&o._blur()}i&&i.onGlobalClick(e)},message:function(e){if(e&&e.data&&void 0!==e.data.message&&"number"==typeof e.data.pid){e.data;var t=OSjs.API.getProcess(e.data.pid);if(t&&("function"==typeof t.onPostMessage&&t.onPostMessage(e.data.message,e),"function"==typeof t._getWindow)){var n=t._getWindow(e.data.wid,"wid");n&&n.onPostMessage(e.data.message,e)}}},fullscreen:function(e){try{var t=OSjs.Core.getWindowManager().getNotificationIcon("_FullscreenNotification");t&&(document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?(t.opts._isFullscreen=!0,t.setImage(OSjs.API.getIcon("actions/view-restore.png","16x16"))):(t.opts._isFullscreen=!1,t.setImage(OSjs.API.getIcon("actions/view-fullscreen.png","16x16"))))}catch(e){e.stack}},keydown:function(t){var n=OSjs.Core.getWindowManager(),i=n?n.getCurrentWindow():null,o=[122,123],r=function(){var e=null;return n&&(e=n.onKeyDown(t,i),i&&!e&&i._onKeyEvent(t,"keydown")),e}();return(function(){var n=t.srcElement||t.target,r="BODY"===n.tagName;return t.keyCode!==OSjs.Utils.Keys.BACKSPACE||OSjs.Utils.$isFormElement(t)?t.keyCode===OSjs.Utils.Keys.TAB&&OSjs.Utils.$isFormElement(t)?r=!0:-1!==o.indexOf(t.keyCode)?r=!1:e(t)&&(r=!0):r=!0,!(!r||i&&i._properties.key_capture)}()||r)&&t.preventDefault(),!0},keypress:function(t){var n=OSjs.Core.getWindowManager();if(e(t)&&t.preventDefault(),n){var i=n.getCurrentWindow();if(i)return i._onKeyEvent(t,"keypress")}return!0},keyup:function(e){var t=OSjs.Core.getWindowManager();if(t){t.onKeyUp(e,t.getCurrentWindow());var n=t.getCurrentWindow();if(n)return n._onKeyEvent(e,"keyup")}return!0},beforeunload:function(e){if(!g)try{if(OSjs.API.getConfig("ShowQuitWarning"))return OSjs.API._("MSG_SESSION_WARNING")}catch(e){}return null},resize:function(){function e(e,t){var n=OSjs.Core.getWindowManager();n&&n.resize(e,n.getWindowSpace(),t)}var t;return function(n,i){t=clearTimeout(t),t=setTimeout(function(){e(n,i)},100)}}(),scroll:function(e){return e.target===document||e.target===document.body?(e.preventDefault(),e.stopPropagation(),!1):(document.body.scrollTop=0,document.body.scrollLeft=0,!0)},hashchange:function(e){var t=window.location.hash.substr(1),n=t.split(/^([\w\.\-_]+)\:(.*)/);if(4===n.length){var i=n[1],o=function(e){var t={};return e.split("&").forEach(function(e){var n=e.split("="),i=decodeURIComponent(n[0]);t[i]=decodeURIComponent(n[1]||"")}),t}(n[2]);i&&OSjs.API.getProcess(i).forEach(function(e){e._onMessage("hashchange",{hash:t,args:o},{source:null})})}},orientationchange:function(e){var t="landscape";window.screen&&window.screen.orientation&&-1!==window.screen.orientation.type.indexOf("portrait")&&(t="portrait");var n=OSjs.Core.getWindowManager();n&&n.onOrientationChange(e,t),document.body.setAttribute("data-orientation",t)}};OSjs.Bootstrap={restart:function(e){if(h){var t=OSjs.Core.getAuthenticator(),n=OSjs.Core.getStorage();(e&&n?function(e){n.saveSession(function(){t.logout(e)})}:function(e){t.logout(e)})(function(){console.clear(),OSjs.Bootstrap.stop(!0),OSjs.Bootstrap.run()})}},run:function(e){h||(h=!0,f(e))},stop:function(e){if(p&&h&&!g){g=!0,document.body.removeEventListener("contextmenu",v.body_contextmenu,!1),document.body.removeEventListener("click",v.body_click,!1),document.removeEventListener("keydown",v.keydown,!0),document.removeEventListener("keypress",v.keypress,!0),document.removeEventListener("keyup",v.keyup,!0),window.removeEventListener("orientationchange",v.orientationchange,!1),window.removeEventListener("hashchange",v.hashchange,!1),window.removeEventListener("resize",v.resize,!1),window.removeEventListener("scroll",v.scroll,!1),window.removeEventListener("fullscreenchange",v.fullscreen,!1),window.removeEventListener("mozfullscreenchange",v.fullscreen,!1),window.removeEventListener("webkitfullscreenchange",v.fullscreen,!1),window.removeEventListener("msfullscreenchange",v.fullscreen,!1),window.removeEventListener("message",v.message,!1),window.onerror=null,window.onbeforeunload=null,OSjs.API.toggleFullscreen(),OSjs.API.blurMenu(),OSjs.API.killAll(),OSjs.GUI.DialogScheme.destroy();var t=OSjs.API.getServiceNotificationIcon();t&&t.destroy(),OSjs.Core.getSearchEngine().destroy(),OSjs.Core.getPackageManager().destroy(),OSjs.Core.getAuthenticator().destroy(),OSjs.Core.getStorage().destroy(),OSjs.Core.getConnection().destroy(),OSjs.Utils._clearPreloadCache(),e?(Object.keys(OSjs.Applications).forEach(function(e){try{delete OSjs.Applications[e]}catch(e){}}),Object.keys(OSjs.Extensions).forEach(function(e){try{delete OSjs.Extensions[e]}catch(e){}})):(OSjs.API.triggerHook("onShutdown"),!0===OSjs.API.getConfig("ReloadOnShutdown")&&window.location.reload(),Object.keys(OSjs).forEach(function(e){try{delete OSjs[e]}catch(e){}})),h=!1,p=!1,g=!1}},isShuttingDown:function(){return g}}}(),function(e,t){"use strict";function n(){this.entries={},this.size=0,this.notif=null,this.init()}var i,o="en_EN",r=[],a={onInitialize:[],onInited:[],onWMInited:[],onSessionLoaded:[],onShutdown:[],onApplicationPreload:[],onApplicationLaunch:[],onApplicationLaunched:[],onBlurMenu:[]};n.prototype.init=function(){function e(e){return i.displayMenu(e),!1}var n=OSjs.Core.getWindowManager(),i=this;n&&(this.notif=n.createNotificationIcon("ServiceNotificationIcon",{image:t.getIcon("status/dialog-password.png"),onContextMenu:e,onClick:e,onInited:function(e,t){i._updateIcon()}}),this._updateIcon())},n.prototype.destroy=function(){var e=OSjs.Core.getWindowManager();e&&e.removeNotificationIcon("ServiceNotificationIcon"),this.size=0,this.entries={},this.notif=null},n.prototype._updateIcon=function(){this.notif&&(this.notif.$container&&(this.notif.$container.style.display=this.size?"inline-block":"none"),this.notif.setTitle(t._("SERVICENOTIFICATION_TOOLTIP",this.size.toString())))},n.prototype.displayMenu=function(e){var n=[],i=this.entries;Object.keys(i).forEach(function(e){n.push({title:e,menu:i[e]})}),t.createMenu(n,e)},n.prototype.add=function(e,t){this.entries[e]||(this.entries[e]=t,this.size++,this._updateIcon())},n.prototype.remove=function(e){this.entries[e]&&(delete this.entries[e],this.size--,this._updateIcon())},t._=function(){var t=arguments[0],n=arguments;try{var i=OSjs.Locales[o];return i&&i[t]?n[0]=i[t]:n[0]=OSjs.Locales.en_EN[t]||t,n.length>1?e.format.apply(null,n):n[0]}catch(e){e.stack}return t},t.__=function(){var n=arguments[0],i=arguments[1],r=Array.prototype.slice.call(arguments,1);return n[o]&&n[o][i]?r[0]=n[o][i]:(r[0]=n.en_EN?n.en_EN[i]||i:i,r[0]&&r[0]===i&&(r[0]=t._.apply(null,r))),r.length>1?e.format.apply(null,r):r[0]},t.getLocale=function(){return o},t.setLocale=function(e){var n=t.getConfig("LocaleOptions.RTL",[]);o=OSjs.Locales[e]?e:"en_EN";var i=o.split("_")[0],r=document.querySelector("html");r&&(r.setAttribute("lang",e),r.setAttribute("dir",-1!==n.indexOf(i)?"rtl":"ltr"))},t.curl=function(e,n){e=e||{},n=n||{};var i=e.body;"object"==typeof i||(i=e),t.call("curl",i,n,e.options)};var s=1;t.call=function(e,n,i,o){n=n||{},o=o||{};var r="APICall_"+s;if("function"!=typeof i)throw new TypeError("call() expects a function as callback");if(o&&"object"!=typeof o)throw new TypeError("call() expects an object as options");return!1!==o.indicator&&t.createLoading(r,{className:"BusyNotification",tooltip:"API Call"}),void 0!==o.indicator&&delete o.indicator,s++,OSjs.Core.getConnection().request(e,n,function(e){t.destroyLoading(r),e=e||{},i(e.error||!1,e.result)},function(e){t.destroyLoading(r),i(e)},o)},t.open=function(n,i){function o(e,t,n){n=n||function(){},u.set("DefaultApplication",e,t),u.save("DefaultApplication",n)}function r(e){e&&t.launch(e,l,i.onFinished,i.onError,i.onConstructed)}function a(e,n){t.launch(e,n)}function s(e){e.length,e.length?1===e.length?r(e[0]):c?t.createDialog("ApplicationChooser",{file:n,list:e},function(e,t,i){"ok"===t&&(r(i.name),o(n.mime,i.useDefault?i.name:null))}):t.error(t._("ERR_FILE_OPEN"),t._("ERR_FILE_OPEN_FMT",n.path),t._("ERR_NO_WM_RUNNING")):t.error(t._("ERR_FILE_OPEN"),t._("ERR_FILE_OPEN_FMT",n.path),t._("ERR_APP_MIME_NOT_FOUND_FMT",n.mime))}if(i=i||{},!n.path)throw new Error("Cannot API::open() without a path");var u=OSjs.Core.getSettingsManager(),c=OSjs.Core.getWindowManager(),l={file:n};if("osjs/application"===n.mime)a(e.filename(n.path),i);else if("dir"===n.type){var d=u.instance("DefaultApplication").get("dir","ApplicationFileManager");a(d,{path:n.path})}else i.args&&Object.keys(i.args).forEach(function(e){l[e]=i.args[e]}),function(e,t,n){if(!(e instanceof OSjs.VFS.File))throw new Error("This function excepts a OSjs.VFS.File object");var i=OSjs.Core.getPackageManager(),o=u.get("DefaultApplication",e.mime);if(!t&&o&&i.getPackage(o))return void n([o]);n(i.getPackagesByMime(e.mime))}(n,i.forceList,s)},t.relaunch=function(e){function n(n){var i=null,o={};n instanceof OSjs.Core.Application&&(i=n._getSessionData());try{e=n.__pname,n.destroy()}catch(e){e.stack}null!==i&&(o=i.args,o.__resume__=!0,o.__windows__=i.windows||[]),o.__preload__={force:!0},setTimeout(function(){t.launch(e,o)},500)}var i=t.getProcess(e);i instanceof Array||(i=[i]),i.forEach(n)},t.launch=function(n,i,o,s,u){function c(){t.createLoading(n,{className:"StartupNotification",tooltip:t._("LBL_STARTING")+" "+n}),OSjs.Applications[n]||!1!==w.splash&&(m=t.createSplash(w.name,w.icon))}function l(){O>=0&&r.splice(O,1),t.destroyLoading(n),m&&(m.destroy(),m=null)}function d(e,o){l(),t.error(t._("ERR_APP_LAUNCH_FAILED"),t._("ERR_APP_LAUNCH_FAILED_FMT",n),e,o,!0),(s||function(){})(e,n,i,o)}function f(e){l(),(o||function(){})(v,w)}function p(i){e.preload(E,function(e,o,r,a){o.length?i(t._("ERR_APP_PRELOAD_FAILED_FMT",n,o.join(","))):i(!1,a)},function(e,t,n,i,o,r){m&&m.update(r,t)},_)}function h(e,o){function r(){if(v)try{v.destroy(),v=null}catch(e){e.stack}}if(void 0===OSjs.Applications[n])throw new Error(t._("ERR_APP_RESOURCES_MISSING_FMT",n));if("function"==typeof OSjs.Applications[n])return OSjs.Applications[n](),void o(!1,!0);var a=null;e&&e.forEach(function(e){a||"scheme"!==e.item.type||(a=e.data)}),function(e){try{"simple"===w.classType?(v=new OSjs.Core.Application(n,i,w),OSjs.Applications[n].run(v)):v=new OSjs.Applications[n].Class(i,w),(u||function(){})(v,w)}catch(e){return e.stack,r(),o(t._("ERR_APP_CONSTRUCT_FAILED_FMT",n,e),e),!1}try{var a=OSjs.Core.getSettingsManager().get(v.__pname)||{};v.init(a,w,e),t.triggerHook("onApplicationLaunched",[{application:v,name:n,args:i,settings:a,metadata:w}])}catch(e){return e.stack,r(),o(t._("ERR_APP_INIT_FAILED_FMT",n,e.toString()),e),!1}return!0}(a)&&o(!1,!0)}if(i=i||{},-1===r.indexOf(n)){var g,m=null,v=null,_={},y=OSjs.Core.getPackageManager(),S=e.getCompability(),w=y.getPackage(n),b=t.getProcess(n,!0),O=-1,E=function(){function e(e){e&&e.preload&&e.preload.forEach(function(e){i.push(e)})}var t=(w.preload||[]).slice(0),i=[];w.depends instanceof Array&&w.depends.forEach(function(t){OSjs.Applications[t]||e(y.getPackage(t))});var o=y.getPackages(!1);return Object.keys(o).forEach(function(t){var i=o[t];"extension"===i.type&&i.uses===n&&e(i)}),t=i.concat(t),i=[],"user"===w.scope&&(t=t.map(function(e){return"/"===e.src.substr(0,1)||e.src.match(/^(https?|ftp)/)||OSjs.VFS.url(e.src,function(t,n){t||(e.src=n)}),e})),t}();if(!n)throw g="Cannot API::launch() witout a application name",d(g),new Error(g);if(!w)throw g=t._("ERR_APP_LAUNCH_MANIFEST_FAILED_FMT",n),d(g),new Error(g);i.__preload__&&(_=i.__preload__,delete i.__preload__),_.max=function(e){return!0===e&&(e=t.getConfig("Connection.PreloadParallel")),e}(w.preloadParallel);try{!function(o){var s=function(){var e=(w.compability||[]).filter(function(e){return void 0!==S[e]&&!S[e]});return!e.length||t._("ERR_APP_LAUNCH_COMPABILITY_FAILED_FMT",n,e.join(", "))}();if(!0!==s)throw new Error(s);if(!0===w.singular&&(O=r.push(n)-1,b)){if(b instanceof OSjs.Core.Application)return b._onMessage("attention",i),void f(!0);throw new Error(t._("ERR_APP_LAUNCH_ALREADY_RUNNING_FMT",n))}e.asyncs(a.onApplicationPreload,function(e,t,o){e(n,i,E,function(e){e&&e instanceof Array&&(E=e),o()})},function(){c(),o()}),t.triggerHook("onApplicationLaunch",[n,i])}(function(){p(function(e,t){if(e)d(e,t);else try{h(t,function(e,t){if(e)d(e,t);else try{f(t)}catch(e){d(e.toString(),e)}})}catch(e){d(e.toString(),e)}})})}catch(e){d(e.toString())}}},t.launchList=function(n,i,o,r){n=n||[],i=i||function(){},o=o||function(){},r=r||function(){},e.asyncs(n,function(e,n,r){if("string"==typeof e){var a={},s=e.split("@"),u=s[0];if(void 0!==s[1])try{a=JSON.parse(s[1])}catch(e){}e={name:u,args:a}}var c=e.name,l=void 0===e.args?{}:e.args||{};if(!c)return void r();t.launch(c,l,function(e,t){i(e,t,c,l),r()},function(e,t,n){o(e,t,n),r()})},r)},t.getApplicationResource=function(e,n,i){function o(){var t=null;return e instanceof OSjs.Core.Process?t=e.__pname:"string"==typeof e&&(t=e),t}function r(e,n){return i&&(e=n?e.substr(t.getConfig("Connection.FSURI").length):"osjs:///"+e),e}return n.match(/^(https?:)?\//)?n:(n=n.replace(/^\.\//,""),function(){var e=OSjs.Core.getPackageManager(),t=o(),i=e.getPackage(t),a="";return i&&(a="user"===i.scope?"/user-package/"+OSjs.Utils.filename(i.path)+"/"+n.replace(/^\//,""):"packages/"+i.path+"/"+n),r(a,"user"===i.scope)}())},t.getThemeCSS=function(e){var n=t.getConfig("Connection.RootURI","/");return null===e?n+"blank.css":(n=t.getConfig("Connection.ThemeURI"))+"/"+e+".min.css"},t.getFileIcon=function(n,i,o){if(o=o||"mimetypes/text-x-preview.png","object"!=typeof n||n instanceof OSjs.VFS.File||(n=new OSjs.VFS.File(n)),!n.filename)throw new Error("Filename is required for getFileIcon()");var r=[{match:"application/pdf",icon:"mimetypes/x-office-document.png"},{match:"application/zip",icon:"mimetypes/package-x-generic.png"},{match:"application/x-python",icon:"mimetypes/text-x-script.png"},{match:"application/x-lua",icon:"mimetypes/text-x-script.png"},{match:"application/javascript",icon:"mimetypes/text-x-script.png"},{match:"text/html",icon:"mimetypes/text-html.png"},{match:"text/xml",icon:"mimetypes/text-html.png"},{match:"text/css",icon:"mimetypes/text-x-script.png"},{match:"osjs/document",icon:"mimetypes/x-office-document.png"},{match:"osjs/draw",icon:"mimetypes/image-x-generic.png"},{match:/^text\//,icon:"mimetypes/text-x-generic.png"},{match:/^audio\//,icon:"mimetypes/audio-x-generic.png"},{match:/^video\//,icon:"mimetypes/video-x-generic.png"},{match:/^image\//,icon:"mimetypes/image-x-generic.png"},{match:/^application\//,icon:"mimetypes/application-x-executable.png"}];if("dir"===n.type)o="places/folder.png";else if("trash"===n.type)o="places/user-trash.png";else if("application"===n.type){var a=OSjs.Core.getPackageManager(),s=e.filename(n.path),u=a.getPackage(s);if(u)return t.getIcon(u.icon,i,s)}else{var c=n.mime||"application/octet-stream";r.every(function(e){return!("string"==typeof e.match?c===e.match:c.match(e.match))||(o=e.icon,!1)})}return t.getIcon(o,i)},t.getThemeResource=function(e,n){e=e||null,n=n||null;var i=t.getConfig("Connection.ThemeURI");if(e){var o=OSjs.Core.getWindowManager(),r=(o?o.getSetting("theme"):"default")||"default";e=function(e,t){return e.match(/^\//)||(e="base"===n||null===n?i+"/"+t+"/"+e:i+"/"+t+"/"+n+"/"+e),e}(e,r)}return e},t.getSound=function(n){if(n=n||null){var i=OSjs.Core.getWindowManager(),o=i?i.getSoundTheme():"default",r=t.getConfig("Connection.SoundURI"),a=e.getCompability();if(!n.match(/^\//)){var s="oga";a.audioTypes.ogg||(s="mp3"),n=r+"/"+o+"/"+n+"."+s}}return n},t.getIcon=function(e,n,i){e=e||null,n=n||"16x16",i=i||null;var o=t.getConfig("Connection.IconURI"),r=OSjs.Core.getWindowManager(),a=r?r.getIconTheme():"default";if(e&&!e.match(/^(http|\/\/)/)){var s=function(){if(e.match(/^\.\//)){if(e=e.replace(/^\.\//,""),i instanceof OSjs.Core.Application||"string"==typeof i)return t.getApplicationResource(i,e);if(null!==i&&"object"==typeof i)return t.getApplicationResource(i.className,e);if("string"==typeof i)return t.getApplicationResource(i,e)}else e.match(/^\//)||(e=o+"/"+a+"/"+n+"/"+e);return null}();if(null!==s)return s}return e},t.getConfig=function(t,n){var i=OSjs.Core.getConfig();if("string"==typeof t){var o=i[t];if(-1!==t.indexOf(".")){var r=t.split(/\./),a=i;r.forEach(function(e,t){t>=r.length-1?a&&(o=a[e]):a=a[e]})}return void 0===o&&void 0!==n?n:"object"==typeof o?e.cloneObject(o):o}return i},t.getDefaultPath=function(e){return e&&e.match(/^\//)&&(e=null),t.getConfig("VFS.Home")||e||"osjs:///"},t.createNotification=function(e){return OSjs.Core.getWindowManager().notification(e)},t.createDialog=function(e,t,n,i){function o(){if(r){if(a&&r._destroyed)return;if(s&&r.__destroyed)return}i.modal&&a&&r._toggleDisabled(!1),n.apply(null,arguments)}n=n||function(){},i=i||{};var r=i,a=r instanceof OSjs.Core.Window,s=r instanceof OSjs.Core.Process;!r||a&&s||(r=i.parent,a=r instanceof OSjs.Core.Window,s=r instanceof OSjs.Core.Process);var u="string"==typeof e?new OSjs.Dialogs[e](t,o):e(t,o);if(r)r instanceof OSjs.Core.Window?(u._on("destroy",function(){r&&r._focus()}),r._addChild(u,!0)):r instanceof OSjs.Core.Application&&r._addWindow(u);else{OSjs.Core.getWindowManager().addWindow(u,!0)}return i.modal&&a&&r._toggleDisabled(!0),setTimeout(function(){u._focus()},10),u},t.createLoading=function(e,t,n){try{var i=OSjs.Core.getWindowManager();if(i&&i.createNotificationIcon(e,t,n))return e}catch(e){e.stack}return!1},t.destroyLoading=function(e,t){try{var n=OSjs.Core.getWindowManager();if(n&&n.removeNotificationIcon(e,t))return!0}catch(e){e.stack}return!1},t.checkPermission=function(e){var t=OSjs.Core.getAuthenticator().getUser(),n=t.groups||[];e instanceof Array||(e=[e]);var i=!0;return n.indexOf("admin")<0&&e.every(function(e){return n.indexOf(e)<0&&(i=!1),i}),i},t.createSplash=function(n,i,o,r){o=o||t._("LBL_STARTING"),r=r||document.body;var a=document.createElement("application-splash");a.setAttribute("role","dialog");var s;i&&(s=document.createElement("img"),s.alt=n,s.src=t.getIcon(i));var u=document.createElement("b");u.appendChild(document.createTextNode(n));var c=document.createElement("span");c.appendChild(document.createTextNode(o+" ")),c.appendChild(u),c.appendChild(document.createTextNode("..."));var l;s&&a.appendChild(s),a.appendChild(c);try{l=OSjs.GUI.Element.create("gui-progress-bar"),a.appendChild(l.$element)}catch(e){e.stack}return r.appendChild(a),{destroy:function(){a=e.$remove(a),s=null,c=null,u=null,l=null},update:function(e,t){if(a&&l){var n=t?0:100;t&&(n=e/t*100),l.set("value",n)}}}},t.error=function(e,n,i,o,r){if(r=function(){return!!t.getConfig("BugReporting.enabled")&&(void 0!==r&&!!r)}(),t.blurMenu(),o&&o.message.match(/^Script Error/i)&&String(o.lineNumber).match(/^0/))return void console.error("VENDOR ERROR",{title:e,message:n,error:i,exception:o});if(t.getConfig("MOCHAMODE"))console.error(e,n,i,o);else{if(function(){var a=OSjs.Core.getWindowManager();if(a&&a._fullyLoaded)try{return t.createDialog("Error",{title:e,message:n,error:i,exception:o,bugreport:r}),!0}catch(e){e.stack}return!1}())return;window.alert(e+"\n\n"+n+"\n\n"+i)}},t.playSound=function(n,i){var o=e.getCompability(),r=OSjs.Core.getWindowManager(),a=r?r.getSoundFilename(n):null;if(!(r&&o.audio&&r.getSetting("enableSounds")&&a))return!1;void 0===i&&(i=1);var s=t.getSound(a),u=new Audio(s);return u.volume=i,u.play(),u},t.setClipboard=function(e){i=e},t.getClipboard=function(){return i},t.getServiceNotificationIcon=function(){var e;return function(){return e||(e=new n),e}}(),t.toggleFullscreen=function(){function e(e,t){e&&(t?function(){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT)}():function(){e.webkitCancelFullScreen?e.webkitCancelFullScreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.exitFullscreen&&e.exitFullscreen()}())}var t;return function(n,i){"boolean"==typeof i?e(n,i):(t&&t!==n&&e(t,!1),e(n,t!==n)),t=n}}(),t.isStandalone=function(){return"standalone"===t.getConfig("Connection.Type")||"file:"===window.location.protocol},t.getBrowserPath=function(e){var n=t.getConfig("Connection.RootURI");return"string"==typeof e&&(n=n.replace(/\/?$/,e.replace(/^\/?/,"/"))),n},t.signOut=function(){function e(e){t.playSound("LOGOUT"),e?i.saveSession(function(){n.logout(function(){t.shutdown()})}):n.logout(function(){t.shutdown()})}var n=OSjs.Core.getAuthenticator(),i=OSjs.Core.getStorage();if(OSjs.Core.getWindowManager()){var o=n.getUser()||{name:t._("LBL_UNKNOWN")};t.createDialog("Confirm",{title:t._("DIALOG_LOGOUT_TITLE"),message:t._("DIALOG_LOGOUT_MSG_FMT",o.name)},function(t,n){"yes"===n?e(!0):"no"===n&&e(!1)})}else e(!0)},t.triggerHook=function(e,t,n){n=n||OSjs,t=t||[],a[e]&&a[e].forEach(function(e){if("function"==typeof e)try{e.apply(n,t)}catch(e){e.stack}})},t.addHook=function(e,t){return void 0!==a[e]?a[e].push(t)-1:-1},t.removeHook=function(e,t){return!(void 0===a[e]||!a[e][t])&&(a[e][t]=null,!0)},t.shutdown=function(){return OSjs.Bootstrap.stop()},t.isShuttingDown=function(){return OSjs.Bootstrap.isShuttingDown.apply(null,arguments)},t.createMenu=function(){return OSjs.GUI.Helpers.createMenu.apply(null,arguments)},t.blurMenu=function(){return OSjs.GUI.Helpers.blurMenu.apply(null,arguments)},OSjs.Core.getConfig=OSjs.Core.getConfig||function(){return{}},OSjs.Core.getMetadata=OSjs.Core.getMetadata||function(){return{}}}(OSjs.Utils,OSjs.API),function(e,t){"use strict";function n(e,t){t=t||{};var n=t.onprogress||function(){},i=["onsuccess","onerror","onprogress","oncanceled"];return Object.keys(t).forEach(function(n){-1===i.indexOf(n)&&(e[n]=t[n])}),e.onprogress=function(e){e.lengthComputable?n(e,e.loaded/e.total):n(e,-1)},e}function i(){this.index=0,this.offline=!1,this._evHandler=new OSjs.Helpers.EventHandler(name,[]),o=this}var o;i.prototype.init=function(e){var n=this;void 0!==navigator.onLine&&(t.$bind(window,"offline",function(e){n.onOffline()}),t.$bind(window,"online",function(e){n.onOnline()})),e()},i.prototype.destroy=function(){t.$unbind(window,"offline"),t.$unbind(window,"online"),this._evHandler&&(this._evHandler=this._evHandler.destroy())},i.prototype.getVFSPath=function(t,n){n=n||{};var i=e.getConfig("Connection.RootURI","/");if("file:"===window.location.protocol)return i+t.path.replace(/^osjs:\/\/\//,"");var o=e.getConfig("Connection.FSURI","/");if(t?(o+="/read",n.path=t.path):o+="/upload",n){var r=Object.keys(n).map(function(e){return e+"="+encodeURIComponent(n[e])});r.length&&(o+="?"+r.join("&"))}return o},i.prototype.isOnline=function(){return!this.offline},i.prototype.isOffline=function(){return this.offline},i.prototype.onVFSRequest=function(e,t,n,i){i()},i.prototype.onVFSRequestCompleted=function(e,t,n,i,o,r){r()},i.prototype.onOnline=function(){this.offline=!1;var t=OSjs.Core.getWindowManager();t&&t.notification({title:e._("LBL_INFO"),message:e._("CONNECTION_RESTORED")}),this._evHandler&&this._evHandler.emit("online")},i.prototype.onOffline=function(t){!this.offline&&this._evHandler&&this._evHandler.emit("offline"),this.offline=!0;var n=OSjs.Core.getWindowManager();n&&n.notification({title:e._("LBL_WARNING"),message:e._(t?"CONNECTION_RESTORE_FAILED":"CONNECTION_LOST")})},i.prototype.request=function(t,n,i,o,r){return n=n||{},i=i||function(){},o=o||function(){},this.offline?(o("You are currently off-line and cannot perform this operation!"),!1):"standalone"===e.getConfig("Connection.Type")?(o("You are currently running locally and cannot perform this operation!"),!1):t.match(/^FS:/)?this.requestVFS(t.replace(/^FS:/,""),n,r,i,o):this.requestAPI(t,n,r,i,o)},i.prototype.requestAPI=function(e,t,n,i,o){return!1},i.prototype.requestVFS=function(e,t,n,i,o){return"get"===e?this._requestGET(t,n,i,o):"upload"===e&&this._requestPOST(t,n,i,o)},i.prototype._requestPOST=function(e,i,o,r){return r=r||function(){},t.ajax(n({url:OSjs.VFS.Transports.OSjs.path(),method:"POST",body:e,onsuccess:function(e){o(!1,e)},onerror:function(e){r("error",null,e)},oncanceled:function(e){r("canceled",null,e)}},i)),!0},i.prototype._requestGET=function(e,i,o,r){r=r||function(){};var a=this;return t.ajax(n({url:e.url||OSjs.VFS.Transports.OSjs.path(e.path),method:e.method||"GET",responseType:"arraybuffer",onsuccess:function(e,t){if(!t||404===t.status||500===t.status)return void o({error:t.statusText||e,result:null});o({error:!1,result:e})},onerror:function(){r.apply(a,arguments)}},i)),!0},i.prototype._requestXHR=function(e,i,o,r,a){a=a||function(){};var s=this;return t.ajax(n({url:e,method:"POST",json:!0,body:i,onsuccess:function(){r.apply(s,arguments)},onerror:function(){a.apply(s,arguments)}},o)),!0},i.prototype.subscribe=function(e,t){return this._evHandler.on(e,t,this)},i.prototype.unsubscribe=function(e,t){return this._evHandler.off(e,t)},OSjs.Core.Connection=i,OSjs.Core.getConnection=function(){return o}}(OSjs.API,OSjs.Utils),function(e,t){"use strict";function n(){this.userData={id:0,username:"root",name:"root user",groups:["admin"]},this.loggedIn=!1,i=this}var i;n.prototype.init=function(e){this.onCreateUI(e)},n.prototype.destroy=function(){},n.prototype.getUser=function(){return t.cloneObject(this.userData||{},!0)},n.prototype.isLoggedIn=function(){return this.isLoggedIn},
n.prototype.login=function(t,n){e.call("login",t,function(t,i){i?n(!1,i):(t=t||e._("ERR_LOGIN_INVALID"),n(e._("ERR_LOGIN_FMT",t),!1))})},n.prototype.logout=function(t){var n={};e.call("logout",n,function(e,n){n?t(!1,!0):t("An error occured: "+(e||"Unknown error"))})},n.prototype.onLoginRequest=function(e,t){var n=this;this.login(e,function(e,i){e?t(e):n.onLogin(i,t)})},n.prototype.onLogin=function(n,i){var o=n.userSettings;(!o||o instanceof Array)&&(o={}),this.userData=n.userData,document.getElementById("LoadingScreen").style.display="block",e.setLocale(function(){var n=e.getConfig("Locale"),i=t.getUserLocale();e.getConfig("LocaleOptions.AutoDetect",!0)&&i&&(n=i);var r=OSjs.Core.getSettingsManager().get("CoreWM");if(!r)try{r=o.CoreWM}catch(e){}return r?r.language||n:n}()),OSjs.Core.getSettingsManager().init(o),n.blacklistedPackages&&OSjs.Core.getPackageManager().setBlacklist(n.blacklistedPackages),this.loggedIn=!0,i(null,!0)},n.prototype.onCreateUI=function(e){function t(){u.removeAttribute("disabled"),a.removeAttribute("disabled"),s.removeAttribute("disabled")}function n(){u.setAttribute("disabled","disabled"),a.setAttribute("disabled","disabled"),s.setAttribute("disabled","disabled")}var i=this,o=document.getElementById("Login"),r=document.getElementById("LoginForm"),a=document.getElementById("LoginUsername"),s=document.getElementById("LoginPassword"),u=document.getElementById("LoginSubmit");if(!o)throw new Error("Could not find Login Form Container");r.onsubmit=function(r){n(),r&&r.preventDefault(),i.onLoginRequest({username:a.value,password:s.value},function(n){n?(alert(n),t()):(o.parentNode.removeChild(o),e())})},o.style.display="block",t()},OSjs.Core.Authenticator=n,OSjs.Core.getAuthenticator=function(){return i}}(OSjs.API,OSjs.Utils),function(e,t){"use strict";function n(){this.saveTimeout=null,i=this}var i;n.prototype.init=function(e){e(null,!0)},n.prototype.destroy=function(){},n.prototype._settings=function(n,i,o){e.call("settings",{pool:n,settings:t.cloneObject(i)},o)},n.prototype.saveSettings=function(e,t,n){var i=this;clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(function(){i._settings(e,t,n),clearTimeout(i.saveTimeout)},250)},n.prototype.saveSession=function(t){var n=[];e.getProcesses().forEach(function(e,t){e&&e instanceof OSjs.Core.Application&&n.push(e._getSessionData())}),OSjs.Core.getSettingsManager().set("UserSession",null,n,t)},n.prototype.getLastSession=function(e){e=e||function(){};var t=OSjs.Core.getSettingsManager().get("UserSession"),n=[];(t||[]).forEach(function(e,t){var i=e.args;i.__resume__=!0,i.__windows__=e.windows||[],n.push({name:e.name,args:i})}),e(!1,n)},n.prototype.loadSession=function(t){t=t||function(){},this.getLastSession(function(n,i){n?t():e.launchList(i,null,null,t)})},OSjs.Core.Storage=n,OSjs.Core.getStorage=function(){return i}}(OSjs.API,OSjs.Utils),function(e,t){"use strict";function n(e){if(e>=0&&c[e]){var t=c[e].destroy();if(!1!==t)return c[e]=null,!0}return!1}function i(e){if(e){var t;return e instanceof RegExp&&c?t=function(t){return t.__pname&&t.__pname.match(e)}:"string"==typeof e&&(t=function(t){return t.__pname===e}),void(t&&c.forEach(function(e){e&&t(e)&&n(e.__pid)}))}c.forEach(function(e,t){e&&e.destroy(!0),c[t]=null}),c=[]}function o(e){return n(e)}function r(e,t,n){n=n||{};var i=n.filter||function(){return!0};if("string"==typeof i){var o=i;i=function(e){return e.__pname===o}}c.forEach(function(o,r){o&&(o instanceof OSjs.Core.Application||o instanceof OSjs.Core.Process)&&i(o)&&o._onMessage(e,t,n)})}function a(e,t){var n=t?null:[];return"number"==typeof e?c[e]:(c.every(function(i,o){if(i&&i.__pname===e){if(t)return n=i,!1;n.push(i)}return!0}),n)}function s(){return c}function u(e,t,n){c.length,this.__pid=c.push(this)-1,this.__pname=e,this.__args=t||{},this.__metadata=n||{},this.__started=new Date,this.__destroyed=!1,this.__evHandler=new OSjs.Helpers.EventHandler(e,["message","attention","hashchange","api","destroy","destroyWindow","vfs","vfs:mount","vfs:unmount","vfs:mkdir","vfs:write","vfs:move","vfs:copy","vfs:delete","vfs:upload","vfs:update"]),this.__label=this.__metadata.name,this.__path=this.__metadata.path,this.__scope=this.__metadata.scope||"system",this.__iter=this.__metadata.className}var c=[];u.prototype.destroy=function(){return!this.__destroyed&&(this.__destroyed=!0,this.__pid,this.__pname,this._emit("destroy",[]),this.__evHandler&&(this.__evHandler=this.__evHandler.destroy()),this.__pid>=0&&(c[this.__pid]=null),!0)},u.prototype._onMessage=function(e,t,n){n=n||{};var i=n.source;i instanceof u?i=i.__pid:i instanceof OSjs.Core.Window&&(i=i._app?i._app.__pid:-1),this.__evHandler&&i!==this.__pid&&(this.__pid,this.__pname,this.__evHandler.emit("message",[e,t,n]),"vfs"===e.substr(0,3)&&this.__evHandler.emit("vfs",[e,t,n]),this.__evHandler.emit(e,[t,n,e]))},u.prototype._emit=function(e,t){return this.__evHandler?this.__evHandler.emit(e,t):null},u.prototype._on=function(e,t){return this.__evHandler?this.__evHandler.on(e,t,this):null},u.prototype._off=function(e,t){this.__evHandler&&this.__evHandler.off(e,t)},u.prototype._api=function(e,t,n,i){function o(e,t){r.__destroyed||n(e,t)}var r=this;return"boolean"==typeof i?i={indicator:i}:"object"!=typeof i&&(i={}),this._emit("api",[e]),OSjs.API.call("application",{application:this.__iter,path:this.__path,method:e,args:t},o,i)},u.prototype._getArgument=function(e){return void 0===this.__args[e]?null:this.__args[e]},u.prototype._getArguments=function(){return this.__args},u.prototype._getResource=function(e,n){return t.getApplicationResource(this,e,n)},u.prototype._setArgument=function(e,t){this.__args[e]=t},OSjs.Core.Process=Object.seal(u),OSjs.API.killAll=i,OSjs.API.kill=o,OSjs.API.message=r,OSjs.API.getProcess=a,OSjs.API.getProcesses=s}(OSjs.Utils,OSjs.API),function(e,t,n){"use strict";function i(e,t,i,o){this.__inited=!1,this.__mainwindow=null,this.__scheme=null,this.__windows=[],this.__settings={},this.__destroying=!1;try{this.__settings=OSjs.Core.getSettingsManager().instance(e,o||{})}catch(t){t.stack,this.__settings=OSjs.Core.getSettingsManager().instance(e,{})}n.apply(this,arguments)}i.prototype=Object.create(n.prototype),i.constructor=n,i.prototype.init=function(e,t,n){var i=OSjs.Core.getWindowManager(),o=this;this.__inited||(this.__pname,n&&this._setScheme(n),this.__settings.set(null,e),this.__inited=!0,this.__evHandler.emit("init",[e,t,n]),function(){var e;i&&o.__windows.forEach(function(t,n){t&&(i.addWindow(t),e=t)}),e&&e._focus()}())},i.prototype.destroy=function(e){return!(!this.__destroying&&!this.__destroyed)||(this.__destroying=!0,this.__pname,this.__windows.forEach(function(t){try{t&&t._wid!==e&&t.destroy()}catch(e){e.stack}}),this.__mainwindow=null,this.__settings={},this.__windows=[],this.__scheme&&"function"==typeof this.__scheme.destroy&&this.__scheme.destroy(),this.__scheme=null,n.prototype.destroy.apply(this,arguments))},i.prototype._onMessage=function(e,t,i){return!this.__destroying&&!this.__destroyed&&("destroyWindow"===e?t._name===this.__mainwindow?this.destroy(t._wid):this._removeWindow(t):"attention"===e&&this.__windows.length&&this.__windows[0]&&this.__windows[0]._focus(),n.prototype._onMessage.apply(this,arguments))},i.prototype._loadScheme=function(e,t){var n=OSjs.GUI.createScheme(this._getResource(e));n.load(function(e,i){e&&console.error("Application::_loadScheme()",e),t(n)}),this._setScheme(n)},i.prototype._addWindow=function(e,t,n){if(!(e instanceof OSjs.Core.Window))throw new TypeError("Application::_addWindow() expects Core.Window");this.__windows.push(e),(n||1===this.__windows.length)&&(this.__mainwindow=e._name);var i=OSjs.Core.getWindowManager();return this.__inited&&(i&&i.addWindow(e),e._properties.start_focused&&setTimeout(function(){e._focus()},5)),(t||function(){})(e,i),e},i.prototype._removeWindow=function(e){if(!(e instanceof OSjs.Core.Window))throw new TypeError("Application::_removeWindow() expects Core.Window");var t=this;return this.__windows.some(function(n,i){return!n||n._wid!==e._wid||(e._wid,n.destroy(),t.__windows.splice(i,1),!0)})},i.prototype._getWindow=function(e,t){t=t||"name",null===e&&(e=this.__mainwindow);var n="tag"===t?[]:null;return this.__windows.every(function(i,o){if(i&&i["_"+t]===e){if("tag"!==t)return n=i,!1;n.push(i)}return!0}),n},i.prototype._getWindowByName=function(e){return this._getWindow(e)},i.prototype._getWindowsByTag=function(e){return this._getWindow(e,"tag")},i.prototype._getWindows=function(){return this.__windows},i.prototype._getMainWindow=function(){return this._getWindow(this.__mainwindow,"name")},i.prototype._getSetting=function(e){return this.__settings.get(e)},i.prototype._getSessionData=function(){var e=this.__args,t=this.__windows,n={name:this.__pname,args:e,windows:[]};return t.forEach(function(e,t){e&&e._properties.allow_session&&n.windows.push({name:e._name,dimension:e._dimension,position:e._position,state:e._state})}),n},i.prototype._getScheme=function(){return this.__scheme},i.prototype._setSetting=function(e,t,n){void 0===n&&(n=!0),4===arguments.length&&"function"==typeof arguments[3]&&(n=arguments[3]),this.__settings.set(e,t,n)},i.prototype._setScheme=function(e){this.__scheme=e},OSjs.Core.Application=Object.seal(i)}(OSjs.Utils,OSjs.API,OSjs.Core.Process),function(e,t,n){"use strict";function i(e,t,i){n.apply(this,arguments)}i.prototype=Object.create(n.prototype),i.constructor=n,i.prototype.init=function(){},OSjs.Core.Service=Object.seal(i)}(OSjs.Utils,OSjs.API,OSjs.Core.Process),function(e,t,n,i){"use strict";function o(e){return OSjs.API.blurMenu(),e.preventDefault(),e.stopPropagation(),!1}function r(e){return e.replace(/_([a-z])/g,function(e){return e[1].toUpperCase()})}function a(){var t=OSjs.Core.getWindowManager();return t?t.getWindowSpace():e.getRect()}function s(e,t){var n=OSjs.Core.getWindowManager();!!n&&n.getSetting("animations")?e._animationCallback=t:t()}function u(e){var t=OSjs.Core.getWindowManager();if(e._$element&&t){var n,i="",o=e._properties.media_queries||{},r=e._$element.offsetWidth,a=e._$element.offsetHeight;for(n in o)if(o.hasOwnProperty(n)&&o[n](r,a,e)){i=n;break}e._$element.setAttribute("data-media",i)}}var c=function(){var e=1,t=1e5;return function(n){return void 0!==n&&!0===n?t+=2:e+=2}}(),l=function(){function e(){var e={},t=OSjs.Core.getWindowManager();if(t){var n=t.getDefaultSetting("mediaQueries")||{};Object.keys(n).forEach(function(t){n[t]&&(e[t]=function(e,i,o){return e<=n[t]})})}return e}var t;return function(){return t||(t=e()),t}}(),d=function(){var n=0,i=[];return function(o,s,u,c){var d=this;if(i.indexOf(o)>=0)throw new Error(t._("ERR_WIN_DUPLICATE_FMT",o));if(u&&!(u instanceof OSjs.Core.Application))throw new TypeError("appRef given was not instance of Core.Application");if(c&&!(c instanceof OSjs.GUI.Scheme))throw new TypeError("schemeRef given was not instance of GUI.Scheme");s=e.argumentDefaults(s,{icon:t.getThemeResource("wm.png","wm"),width:200,height:200,title:o,tag:o}),this._$element=null,this._$root=null,this._$top=null,this._$winicon=null,this._$loading=null,this._$disabled=null,this._$resize=null,this._$warning=null,this._opts=s,this._app=u||null,this._scheme=c||null,this._destroyed=!1,this._restored=!1,this._loaded=!1,this._initialized=!1,this._disabled=!0,this._loading=!1,this._wid=n,this._icon=s.icon,this._name=o,this._title=s.title,this._tag=s.tag,this._position={x:s.x,y:s.y},this._dimension={w:s.width,h:s.height},this._children=[],this._parent=null,this._origtitle=this._title,this._lastDimension=this._dimension,this._lastPosition=this._position,this._sound=null,this._soundVolume=1,this._properties={gravity:null,allow_move:!0,allow_resize:!0,allow_minimize:!0,allow_maximize:!0,allow_close:!0,allow_windowlist:!0,allow_drop:!1,allow_iconmenu:!0,allow_ontop:!0,allow_hotkeys:!0,allow_session:!0,key_capture:!1,start_focused:!0,min_width:150,min_height:150,max_width:null,max_height:null,media_queries:l()},this._state={focused:!1,modal:!1,minimized:!1,maximized:!1,ontop:!1,onbottom:!1},this._translator=null,this._animationCallback=null,this._queryTimer=null,this._evHandler=new OSjs.Helpers.EventHandler(o,["focus","blur","destroy","maximize","minimize","restore","move","moved","resize","resized","keydown","keyup","keypress","drop","drop:upload","drop:file"]),Object.keys(s).forEach(function(e){void 0!==d._properties[e]?d._properties[e]=s[e]:void 0!==d._state[e]&&"focused"!==e?d._state[e]=s[e]:-1!=="sound_volume".indexOf(e)&&(d["_"+r(e)]=s[e])}),function(e,t){if(!e.gravity&&void 0===t.x||void 0===t.y){var n=OSjs.Core.getWindowManager(),i=n?n.getWindowPosition():{x:0,y:0};t.x=i.x,t.y=i.y}}(this._properties,this._position),function(e,t){e.min_height&&t.h<e.min_height&&(t.h=e.min_height),e.max_width&&t.w<e.max_width&&(t.w=e.max_width),e.max_height&&t.h>e.max_height&&(t.h=e.max_height),e.max_width&&t.w>e.max_width&&(t.w=e.max_width)}(this._properties,this._dimension),function(e,t){u&&u.__args&&u.__args.__windows__&&u.__args.__windows__.forEach(function(n){!d._restored&&n.name&&n.name===d._name&&(e.x=n.position.x,e.y=n.position.y,d._properties.allow_resize&&(t.w=n.dimension.w,t.h=n.dimension.h),d._restored=!0)})}(this._position,this._dimension),function(e,t,n,i){var o=e.gravity;if(o&&!i)if("center"===o)t.y=window.innerHeight/2-d._dimension.h/2,t.x=window.innerWidth/2-d._dimension.w/2;else{var r=a();o.match(/^south/)?t.y=r.height-n.h:t.y=r.top,o.match(/west$/)?t.x=r.left:t.x=r.width-n.w}}(this._properties,this._position,this._dimension,this._restored),this._state,this._properties,this._position,this._dimension,n++}}();d.prototype.init=function(n,i,r){function a(e){"function"==typeof s._animationCallback&&(clearTimeout(l),l=setTimeout(function(){s._animationCallback(e),s._animationCallback=!1,l=clearTimeout(l)},10))}var s=this;if(this._initialized||this._loaded)return this._$root;this._$element=e.$create("application-window",{className:function(t,n){var i=["Window",e.$safeName(t)];return n&&t!==n&&i.push(e.$safeName(n)),i}(this._name,this._tag).join(" "),style:{width:this._dimension.w+"px",height:this._dimension.h+"px",top:this._position.y+"px",left:this._position.x+"px",zIndex:c(this._state.ontop)},data:{window_id:this._wid,allow_resize:this._properties.allow_resize,allow_minimize:this._properties.allow_minimize,allow_maximize:this._properties.allow_maximize,allow_close:this._properties.allow_close},aria:{role:"application",live:"polite",hidden:"false"}}),this._$root=document.createElement("application-window-content"),this._$resize=document.createElement("application-window-resize"),["nw","n","ne","e","se","s","sw","w"].forEach(function(e){var t=document.createElement("application-window-resize-handle");t.setAttribute("data-direction",e),s._$resize.appendChild(t),t=null}),this._$loading=document.createElement("application-window-loading"),this._$disabled=document.createElement("application-window-disabled"),this._$top=document.createElement("application-window-top"),this._$winicon=document.createElement("application-window-icon"),this._$winicon.setAttribute("role","button"),this._$winicon.setAttribute("aria-haspopup","true"),this._$winicon.setAttribute("aria-label","Window Menu");var u=document.createElement("application-window-title");u.setAttribute("role","heading"),e.$bind(this._$loading,"mousedown",o),e.$bind(this._$disabled,"mousedown",o);var l;return e.$bind(this._$element,"transitionend",a),e.$bind(this._$element,"animationend",a),e.$bind(this._$element,"mousedown",function(e){s._focus()}),e.$bind(this._$element,"contextmenu",function(t){var n=e.$isFormElement(t);return n||(t.preventDefault(),t.stopPropagation()),OSjs.API.blurMenu(),!!n}),e.$bind(this._$top,"click",function(e){var t=e.isTrusted?e.target:e.relatedTarget||e.target;e.preventDefault(),t&&(t.tagName.match(/^APPLICATION\-WINDOW\-BUTTON/)?s._onWindowButtonClick(e,t,t.getAttribute("data-action")):"APPLICATION-WINDOW-ICON"===t.tagName&&(e.stopPropagation(),s._onWindowIconClick(e,t)))},!0),e.$bind(u,"mousedown",o),e.$bind(u,"dblclick",function(){s._maximize()}),function(e,t,n){if(e.allow_drop&&n.dnd){document.createElement("div").className="WindowDropRect",OSjs.GUI.Helpers.createDroppable(t,{onOver:function(e,n,i){t.setAttribute("data-dnd-state","true")},onLeave:function(){t.setAttribute("data-dnd-state","false")},onDrop:function(){t.setAttribute("data-dnd-state","false")},onItemDropped:function(e,n,i,o){return t.setAttribute("data-dnd-state","false"),s._onDndEvent(e,"itemDrop",i,o,n)},onFilesDropped:function(e,n,i,o){return t.setAttribute("data-dnd-state","false"),s._onDndEvent(e,"filesDrop",i,o,n)}})}}(this._properties,this._$element,e.getCompability()),u.appendChild(document.createTextNode(this._title)),this._$top.appendChild(this._$winicon),this._$top.appendChild(u),this._$top.appendChild(e.$create("application-window-button-minimize",{className:"application-window-button-entry",data:{action:"minimize"},aria:{role:"button",label:"Minimize Window"}})),this._$top.appendChild(e.$create("application-window-button-maximize",{className:"application-window-button-entry",data:{action:"maximize"},aria:{role:"button",label:"Maximize Window"}})),this._$top.appendChild(e.$create("application-window-button-close",{className:"application-window-button-entry",data:{action:"close"},aria:{role:"button",label:"Close Window"}})),this._$loading.appendChild(document.createElement("application-window-loading-indicator")),this._$element.appendChild(this._$top),this._$element.appendChild(this._$root),this._$element.appendChild(this._$resize),this._$element.appendChild(this._$disabled),document.body.appendChild(this._$element),this._onChange("create"),this._toggleLoading(!1),this._toggleDisabled(!1),this._setIcon(t.getIcon(this._icon,null,this._app)),this._updateMarkup(),this._sound&&t.playSound(this._sound,this._soundVolume),this._initialized=!0,this._emit("init",[this._$root,r]),this._$root},d.prototype._inited=function(){if(!this._loaded){this._loaded=!0,this._onResize(),this._restored||(this._state.maximized?this._maximize(!0):this._state.minimized&&this._minimize(!0));var e=this,t=setTimeout(function(){e._emit("inited",[e._scheme]),t=clearTimeout(t)},10);this._app&&this._app._emit("initedWindow",[this]),this._name}},d.prototype.destroy=function(n){function i(){o._setWarning(null),o._$root=null,o._$top=null,o._$winicon=null,o._$loading=null,o._$disabled=null,o._$resize=null,o._$warning=null,o._$element=e.$remove(o._$element)}var o=this;if(this._destroyed)return!1;this._emit("destroy"),this._destroyed=!0;var r=OSjs.Core.getWindowManager();return this._onChange("close"),function(e){if(t.isShuttingDown())e();else if(o._$element){var n=!!r&&r.getSetting("animations");if(n){o._$element.setAttribute("data-hint","closing"),o._animationCallback=e;var i=setTimeout(function(){o._animationCallback&&o._animationCallback(),i=clearTimeout(i)},1e3)}else o._$element.style.display="none",e()}}(function(){i()}),function(){o._$element&&o._$element.querySelectorAll("*").forEach(function(t){t&&e.$unbind(t)}),o._parent&&o._parent._removeChild(o),o._parent=null,o._removeChildren()}(),function(){r&&r.removeWindow(o);var e=r?r.getCurrentWindow():null;e&&e._wid===o._wid&&r.setCurrentWindow(null);var t=r?r.getLastWindow():null;t&&t._wid===o._wid&&r.setLastWindow(null)}(),this._app&&this._app._onMessage("destroyWindow",this,{}),this._evHandler&&this._evHandler.destroy(),this._scheme=null,this._app=null,this._evHandler=null,this._args={},this._queryTimer=clearTimeout(this._queryTimer),!0},d.prototype._find=function(e,t){var n='[data-id="'+e+'"]';return this._findByQuery(n,t)},d.prototype._render=function(e,t,n,i){t=t||this._scheme,n=n||this._getRoot(),i=i||{},this._translator&&(i._=this._translator),t.render(this,e,n,null,null,i)},d.prototype._findDOM=function(e,t){t=t||this._getRoot();var n='[data-id="'+e+'"]';return t.querySelector(n)},d.prototype._create=function(e,t,i,o){return i=i||this._getRoot(),n.Element.createInto(e,t,i,o,this)},d.prototype._findByQuery=function(e,t,i){if(!((t=t||this._getRoot())instanceof window.Node))return i?[]:null;if(i)return t.querySelectorAll(e).map(function(t){return n.Element.createFromNode(t,e)});var o=t.querySelector(e);return n.Element.createFromNode(o,e)},d.prototype._emit=function(e,t){return!(this._destroyed||!this._evHandler)&&this._evHandler.emit(e,t)},d.prototype._on=function(e,t){return!!this._evHandler&&this._evHandler.on(e,t,this)},d.prototype._off=function(e,t){return!!this._evHandler&&this._evHandler.off(e,t)},d.prototype._addChild=function(e,t,n){e._parent=this;var i=OSjs.Core.getWindowManager();return t&&i&&i.addWindow(e,n),this._children.push(e),e},d.prototype._removeChild=function(e){var t=this,n=!1;return this._children.forEach(function(i,o){i&&i._wid===e._wid&&(i.destroy(),t._children[o]=null,n=!0)}),n},d.prototype._getChild=function(e,t){t=t||"wid";var n="tag"===t?[]:null;return this._children.every(function(i,o){if(i)if("tag"===t)n.push(i);else if(i["_"+t]===e)return n=i,!1;return!0}),n},d.prototype._getChildById=function(e){return this._getChild(e,"wid")},d.prototype._getChildByName=function(e){return this._getChild(e,"name")},d.prototype._getChildrenByTag=function(e){return this._getChild(e,"tag")},d.prototype._getChildren=function(){return this._children},d.prototype._removeChildren=function(){this._children&&this._children.length&&this._children.forEach(function(e,t){e&&e.destroy()}),this._children=[]},d.prototype._close=function(){return!this._disabled&&!this._destroyed&&(this._blur(),this.destroy(),!0)},d.prototype._minimize=function(e){var t=this;if(!this._properties.allow_minimize||this._destroyed)return!1;if(!e&&this._state.minimized)return this._restore(!1,!0),!0;this._name,this._blur(),this._state.minimized=!0,this._$element.setAttribute("data-minimized","true"),s(this,function(){t._$element.style.display="none",t._emit("minimize")}),this._onChange("minimize");var n=OSjs.Core.getWindowManager(),i=n?n.getCurrentWindow():null;return i&&i._wid===this._wid&&n.setCurrentWindow(null),this._updateMarkup(),!0},d.prototype._maximize=function(e){var t=this;if(!this._properties.allow_maximize||this._destroyed||!this._$element)return!1;if(!e&&this._state.maximized)return this._restore(!0,!1),!0;this._name,this._lastPosition={x:this._position.x,y:this._position.y},this._lastDimension={w:this._dimension.w,h:this._dimension.h},this._state.maximized=!0;var n=this._getMaximizedSize();return this._$element.style.zIndex=c(this._state.ontop),this._$element.style.top=n.top+"px",this._$element.style.left=n.left+"px",this._$element.style.width=n.width+"px",this._$element.style.height=n.height+"px",this._$element.setAttribute("data-maximized","true"),this._dimension.w=n.width,this._dimension.h=n.height,this._position.x=n.left,this._position.y=n.top,this._focus(),s(this,function(){t._emit("maximize")}),this._onChange("maximize"),this._onResize(),this._updateMarkup(),!0},d.prototype._restore=function(e,t){var n=this;this._$element&&!this._destroyed&&(this._name,e=void 0===e||!0===e,t=void 0===t||!0===t,function(){e&&n._state.maximized&&(n._move(n._lastPosition.x,n._lastPosition.y),n._resize(n._lastDimension.w,n._lastDimension.h),n._state.maximized=!1,n._$element.setAttribute("data-maximized","false"))}(),function(){t&&n._state.minimized&&(n._$element.style.display="block",n._$element.setAttribute("data-minimized","false"),n._state.minimized=!1)}(),s(this,function(){n._emit("restore")}),this._onChange("restore"),this._onResize(),this._focus(),this._updateMarkup())},d.prototype._focus=function(e){if(!this._$element||this._destroyed)return!1;this._toggleAttentionBlink(!1),this._$element.style.zIndex=c(this._state.ontop),this._$element.setAttribute("data-focused","true");var t=OSjs.Core.getWindowManager(),n=t?t.getCurrentWindow():null;return n&&n._wid!==this._wid&&n._blur(),t&&(t.setCurrentWindow(this),t.setLastWindow(this)),this._state.focused&&!e||(this._name,this._onChange("focus"),this._emit("focus")),this._state.focused=!0,this._updateMarkup(),!0},d.prototype._blur=function(e){if(!this._$element||this._destroyed||!e&&!this._state.focused)return!1;this._name,this._$element.setAttribute("data-focused","false"),this._state.focused=!1,this._onChange("blur"),this._emit("blur"),this._blurGUI();var t=OSjs.Core.getWindowManager(),n=t?t.getCurrentWindow():null;return n&&n._wid===this._wid&&t.setCurrentWindow(null),this._updateMarkup(),!0},d.prototype._blurGUI=function(){this._$root.querySelectorAll("input, textarea, select, iframe, button").forEach(function(e){e.blur()})},d.prototype._resizeTo=function(t,n,i,o,r,a){var s=this;if(!(!this._$element||t<=0||n<=0)){i=void 0===i||!0===i;var u=0,c=0;if(r){var l=e.$position(r,this._$root);u=parseInt(l.left,10),c=parseInt(l.top,10)}var d=this._getMaximizedSize(),f=this._position.x+u,p=this._position.y+c,h=t,g=n,m=null,v=null;i&&function(){f+h>d.width?o?(h=d.width,m=d.left):h=d.width-f+u:h+=u,p+g>d.height?o?(g=d.height,v=d.top):g=d.height-p+s._$top.offsetHeight+c:g+=c}(),this._resize(h,g,a),function(){null!==m&&s._move(m,s._position.y),null!==v&&s._move(s._position.x,v)}(),function(){var e=OSjs.Core.getWindowManager();e&&e.getSetting("animations")?s._animationCallback=function(){s._emit("resized")}:s._emit("resized")}()}},d.prototype._resize=function(e,t,n){if(!this._$element||this._destroyed)return!1;var i=this._properties;if(!n){if(!i.allow_resize)return!1;!function(){!isNaN(e)&&e&&(e<i.min_width&&(e=i.min_width),null!==i.max_width&&e>i.max_width&&(e=i.max_width))}(),function(){!isNaN(t)&&t&&(t<i.min_height&&(t=i.min_height),null!==i.max_height&&t>i.max_height&&(t=i.max_height))}()}return!isNaN(e)&&e&&(this._$element.style.width=e+"px",this._dimension.w=e),!isNaN(t)&&t&&(this._$element.style.height=t+"px",this._dimension.h=t),this._onResize(),!0},d.prototype._moveTo=function(e){var t=OSjs.Core.getWindowManager();if(t){var n=t.getWindowSpace(),i=this._position.x,o=this._position.y;"left"===e?this._move(n.left,o):"right"===e?this._move(n.width-this._dimension.w,o):"top"===e?this._move(i,n.top):"bottom"===e&&this._move(i,n.height-this._dimension.h)}},d.prototype._move=function(e,t){return!(!this._$element||this._destroyed||!this._properties.allow_move)&&(void 0!==e&&void 0!==t&&(this._$element.style.top=t+"px",this._$element.style.left=e+"px",this._position.x=e,this._position.y=t,!0))},d.prototype._toggleDisabled=function(e){this._name,this._$disabled&&(this._$disabled.style.display=e?"block":"none"),this._disabled=!!e,this._updateMarkup()},d.prototype._toggleLoading=function(e){this._name,this._$loading&&(this._$loading.style.display=e?"block":"none"),this._loading=!!e,this._updateMarkup()},d.prototype._updateMarkup=function(e){if(this._$element){var t=this._loading||this._disabled,n=this._disabled,i=this._state.minimized,o=!this._state.focused;if(this._$element.setAttribute("aria-busy",String(t)),this._$element.setAttribute("aria-hidden",String(i)),this._$element.setAttribute("aria-disabled",String(n)),this._$root.setAttribute("aria-hidden",String(o)),e){var r=!0===this._properties.allow_maximize?"inline-block":"none",a=!0===this._properties.allow_minimize?"inline-block":"none",s=!0===this._properties.allow_close?"inline-block":"none";this._$top.querySelector("application-window-button-maximize").style.display=r,this._$top.querySelector("application-window-button-minimize").style.display=a,this._$top.querySelector("application-window-button-close").style.display=s;var u=!0===this._properties.allow_resize;this._$element.setAttribute("data-allow-resize",String(u))}}},d.prototype._toggleAttentionBlink=function(t){if(!this._$element||this._destroyed||this._state.focused)return!1;var n=this._$element,i=this;return function(t){n&&(t?e.$addClass(n,"WindowAttentionBlink"):e.$removeClass(n,"WindowAttentionBlink")),i._onChange(t?"attention_on":"attention_off")}(t),!0},d.prototype._nextTabIndex=function(t){var n=OSjs.GUI.Helpers.getNextElement(t.shiftKey,document.activeElement,this._$root);if(n)if(e.$hasClass(n,"gui-data-view"))OSjs.GUI.Element.createFromNode(n).focus();else try{n.focus()}catch(e){}},d.prototype._onDndEvent=function(e,t,n,i,o){return!this._disabled&&!this._destroyed&&(this._emit("drop",[e,t,n,i,o]),n&&("filesDrop"===t?this._emit("drop:upload",[e,n,i,o]):"itemDrop"===t&&"file"===n.type&&n.data&&this._emit("drop:file",[e,new OSjs.VFS.File(n.data||{}),i,o])),!0)},d.prototype._onKeyEvent=function(t,n){return!(this._destroyed||!this._state.focused)&&("keydown"===n&&t.keyCode===e.Keys.TAB&&this._nextTabIndex(t),this._emit(n,[t,t.keyCode,t.shiftKey,t.ctrlKey,t.altKey]),!0)},d.prototype._onResize=function(){clearTimeout(this._queryTimer);var e=this;this._queryTimer=setTimeout(function(){u(e),e._queryTimer=clearTimeout(e._queryTimer)},20)},d.prototype._onWindowIconClick=function(e,n){if(this._properties.allow_iconmenu&&!this._destroyed){this._name;var i=this,o=[[this._properties.allow_minimize,function(){return{title:t._("WINDOW_MINIMIZE"),icon:t.getIcon("actions/go-up.png"),onClick:function(e,t){i._minimize()}}}],[this._properties.allow_maximize,function(){return{title:t._("WINDOW_MAXIMIZE"),icon:t.getIcon("actions/view-fullscreen.png"),onClick:function(e,t){i._maximize(),i._focus()}}}],[this._state.maximized,function(){return{title:t._("WINDOW_RESTORE"),icon:t.getIcon("actions/view-restore.png"),onClick:function(e,t){i._restore(),i._focus()}}}],[this._properties.allow_ontop,function(){return i._state.ontop?{title:t._("WINDOW_ONTOP_OFF"),icon:t.getIcon("actions/window-new.png"),onClick:function(e,t){i._state.ontop=!1,i._$element&&(i._$element.style.zIndex=c(!1)),i._focus()}}:{title:t._("WINDOW_ONTOP_ON"),icon:t.getIcon("actions/window-new.png"),onClick:function(e,t){i._state.ontop=!0,i._$element&&(i._$element.style.zIndex=c(!0)),i._focus()}}}],[this._properties.allow_close,function(){return{title:t._("WINDOW_CLOSE"),icon:t.getIcon("actions/window-close.png"),onClick:function(e,t){i._close()}}}]],r=[];o.forEach(function(e){e[0]&&r.push(e[1]())}),OSjs.API.createMenu(r,e)}},d.prototype._onWindowButtonClick=function(e,t,n){this._name,this._blurGUI(),"close"===n?this._close():"minimize"===n?this._minimize():"maximize"===n&&this._maximize()},d.prototype._onChange=function(e,t){if(e=e||""){this._name;var n=OSjs.Core.getWindowManager();n&&n.eventWindow(e,this)}},d.prototype._getMaximizedSize=function(){var e=a();if(!this._$element||this._destroyed)return e;var t=23,n=0,i=OSjs.Core.getWindowManager();if(i){var o=i.getStyleTheme(!0,!0);o&&o.style&&o.style.window&&(t=o.style.window.margin,n=o.style.window.border)}return e.left+=n,e.top+=n,e.width-=2*n,e.height-=t+2*n,Object.freeze(e)},d.prototype._getViewRect=function(){return this._$element?Object.freeze(e.$position(this._$element)):null},d.prototype._getRoot=function(){return this._$root},d.prototype._getZindex=function(){return this._$element?parseInt(this._$element.style.zIndex,10):-1},d.prototype._setTitle=function(t,n,i){if(this._$element&&!this._destroyed){i=i||"-";var o=this._$element.getElementsByTagName("application-window-title")[0],r=[];r=n?[this._origtitle,i,t]:[t||this._origtitle],this._title=r.join(" ")||this._origtitle,o&&(e.$empty(o),o.appendChild(document.createTextNode(this._title))),this._onChange("title"),this._updateMarkup()}},d.prototype._setIcon=function(e){this._$winicon&&(this._$winicon.title=this._title,this._$winicon.style.backgroundImage="url("+e+")"),this._icon=e,this._onChange("icon")},d.prototype._setWarning=function(t){var n=this;if(this._$warning=e.$remove(this._$warning),!this._destroyed&&null!==t){t=t||"";var i=document.createElement("application-window-warning"),o=document.createElement("div");o.innerHTML="X",e.$bind(o,"click",function(){n._setWarning(null)});var r=document.createElement("div");r.appendChild(document.createTextNode(t)),i.appendChild(o),i.appendChild(r),this._$warning=i,this._$root.appendChild(this._$warning)}},d.prototype._setProperty=function(e,t){""!==t&&null!==t&&this._$element&&void 0!==this._properties[e]&&(this._properties[e]="true"===String(t),this._updateMarkup(!0))},OSjs.Core.Window=Object.seal(d)
}(OSjs.Utils,OSjs.API,OSjs.GUI,OSjs.Core.Process),function(e,t,n){"use strict";function i(e,t,i,o){var r=this;if(t=t||{},i=i||{},"function"!=typeof(o=o||function(){}))throw new TypeError("DialogWindow expects a callback Function, gave: "+typeof o);n.apply(this,[e,t]),this._properties.gravity="center",this._properties.allow_resize=!1,this._properties.allow_minimize=!1,this._properties.allow_maximize=!1,this._properties.allow_windowlist=!1,this._properties.allow_session=!1,this._state.ontop=!0,this._tag="DialogWindow",i.scheme&&i.scheme instanceof OSjs.GUI.Scheme?(this.scheme=i.scheme,delete i.scheme):this.scheme=OSjs.GUI.DialogScheme.get(),this.args=i,this.className=e,this.buttonClicked=!1,this.closeCallback=function(e,t,n){r._destroyed||(r.buttonClicked=!0,o.apply(r,arguments),r._close())}}i.prototype=Object.create(n.prototype),i.constructor=n,i.prototype.init=function(){var i=this,o=n.prototype.init.apply(this,arguments);if(o.setAttribute("role","dialog"),this.scheme){this.scheme.render(this,this.className.replace(/Dialog$/,""),o,"application-dialog",function(n){n.querySelectorAll("gui-label").forEach(function(n){if(n.childNodes.length&&3===n.childNodes[0].nodeType&&n.childNodes[0].nodeValue){var i=n.childNodes[0].nodeValue;e.$empty(n),n.appendChild(document.createTextNode(t._(i)))}})});var r={ButtonOK:"ok",ButtonCancel:"cancel",ButtonYes:"yes",ButtonNo:"no"},a=["ButtonCancel","ButtonNo"];Object.keys(r).forEach(function(e){if(i._findDOM(e)){var t=i._find(e);t.on("click",function(t){i.onClose(t,r[e])}),a.indexOf(e)>=0&&t.focus()}})}return e.$addClass(o,"DialogWindow"),o},i.prototype.onClose=function(e,t){this.closeCallback(e,t,null)},i.prototype._close=function(){return this.buttonClicked||this.onClose(null,"cancel",null),n.prototype._close.apply(this,arguments)},i.prototype._onKeyEvent=function(t){n.prototype._onKeyEvent.apply(this,arguments),t.keyCode===e.Keys.ESC&&this.onClose(t,"cancel")},i.parseMessage=function(t){t=e.$escape(t||"").replace(/\*\*(.*)\*\*/g,"<span>$1</span>");var n=document.createElement("div");n.innerHTML=t;for(var i=document.createDocumentFragment(),o=0;o<n.childNodes.length;o++)i.appendChild(n.childNodes[o].cloneNode(!0));return n=null,i},OSjs.Core.DialogWindow=Object.seal(i)}(OSjs.Utils,OSjs.API,OSjs.Core.Window),function(e,t,n,i){"use strict";function o(t,n,i){var o=this;this.win=t,this.$element=t._$element,this.$top=t._$top,this.$handle=t._$resize,this.rectWorkspace=s.getWindowSpace(!0),this.rectWindow={x:t._position.x,y:t._position.y,w:t._dimension.w,h:t._dimension.h,r:t._dimension.w+t._position.x,b:t._dimension.h+t._position.y};var r=e.cloneObject(s.getStyleTheme(!0,!0));r.style||(r.style={window:{margin:0,border:0}}),this.theme={topMargin:r.style.window.margin||0,borderSize:r.style.window.border||0},this.snapping={cornerSize:s.getSetting("windowCornerSnap")||0,windowSize:s.getSetting("windowSnap")||0},this.action=n,this.moved=!1,this.direction=null,this.startX=i.x,this.startY=i.y,this.minWidth=t._properties.min_width,this.minHeight=t._properties.min_height;var a=[];s.getWindows().forEach(function(e){if(e&&e._wid!==t._wid){var n=e._position,i=e._dimension,r={left:n.x-o.theme.borderSize,top:n.y-o.theme.borderSize,width:i.w+2*o.theme.borderSize,height:i.h+2*o.theme.borderSize+o.theme.topMargin};r.right=r.left+r.width,r.bottom=n.y+i.h+o.theme.topMargin+o.theme.borderSize,a.push(r)}}),this.snapRects=a}function r(t,n){function i(e,t,n,i){if(!l||!l.direction)return!1;var o,r,a,s;return function(){-1!==l.direction.indexOf("s")?(r=l.rectWindow.h+i,d.height=Math.max(l.minHeight,r)):-1!==l.direction.indexOf("n")&&(r=l.rectWindow.h-i,s=l.rectWindow.y+i,s<l.rectWorkspace.top?(s=l.rectWorkspace.top,r=d.height):r<l.minHeight&&(s=l.rectWindow.b-l.minHeight),d.height=Math.max(l.minHeight,r),d.top=s)}(),function(){-1!==l.direction.indexOf("e")?(o=l.rectWindow.w+n,d.width=Math.max(l.minWidth,o)):-1!==l.direction.indexOf("w")&&(o=l.rectWindow.w-n,a=l.rectWindow.x+n,o<l.minWidth&&(a=l.rectWindow.r-l.minWidth),d.width=Math.max(l.minWidth,o),d.left=a)}(),d}function r(e,t,n,i){var o=l.rectWindow.x+n,r=l.rectWindow.y+i,a=l.theme.borderSize,s=l.theme.topMargin,u=l.snapping.cornerSize,c=l.snapping.windowSize;r<l.rectWorkspace.top&&(r=l.rectWorkspace.top);var d=o+l.rectWindow.w+2*a,f=r+l.rectWindow.h+s+a;return u>0&&(o-a<=u&&o-a>=-u?o=a:d>=l.rectWorkspace.width-u&&d<=l.rectWorkspace.width+u&&(o=l.rectWorkspace.width-l.rectWindow.w-a),r<=l.rectWorkspace.top+u&&r>=l.rectWorkspace.top-u?r=l.rectWorkspace.top+a:f>=l.rectWorkspace.height+l.rectWorkspace.top-u&&f<=l.rectWorkspace.height+l.rectWorkspace.top+u&&(r=l.rectWorkspace.height+l.rectWorkspace.top-l.rectWindow.h-s-a)),c>0&&l.snapRects.every(function(e){return d>=e.left-c&&d<=e.left+c?(o=e.left-(l.rectWindow.w+2*a),!1):o-a<=e.right+c&&o-a>=e.right-c?(o=e.right+2*a,!1):f>=e.top-c&&f<=e.top+c?(r=e.top-(l.rectWindow.h+2*a+s),!1):!(r<=e.bottom+c&&r>=e.bottom-c)||(r=e.bottom+2*a,!1)}),{left:o,top:r,width:null,height:null}}function a(e,t,n,i){l&&(l.moved&&("move"===t?(n._onChange("move",!0),n._emit("moved",[n._position.x,n._position.y])):"resize"===t&&(n._onChange("resize",!0),n._emit("resized",[n._dimension.w,n._dimension.h]))),l.$element.setAttribute("data-hint",""),n._emit("postop"),l=null)}function u(e,t,n,o){if(s.getMouseLocked()&&t&&l){e.preventDefault();var a,u=o.x-l.startX,c=o.y-l.startY;a="move"===t?r(e,o,u,c):i(e,o,u,c),a&&(null!==a.left&&null!==a.top&&(n._move(a.left,a.top),n._emit("move",[a.left,a.top])),null!==a.width&&null!==a.height&&(n._resize(a.width,a.height,!0),n._emit("resize",[a.width,a.height]))),l.moved=!0}}function c(t,i,r,s){function c(e,t){n._mouselock&&u(e,i,r,t)}function f(t,n){a(t,i,r,n),e.$unbind(document,"mousemove:movewindow"),e.$unbind(document,"mouseup:movewindowstop")}OSjs.API.blurMenu(),t.preventDefault(),r._state.maximized||(l=new o(r,i,s),d={},r._focus(),"move"===i?l.$element.setAttribute("data-hint","moving"):(l.calculateDirection(),l.$element.setAttribute("data-hint","resizing"),d=l.getRect()),r._emit("preop"),e.$bind(document,"mousemove:movewindow",c,!1),e.$bind(document,"mouseup:movewindowstop",f,!1))}var l=null,d={};t._properties.allow_move&&e.$bind(t._$top,"mousedown",function(e,n){c(e,"move",t,n)},!0),t._properties.allow_resize&&e.$bind(t._$resize,"mousedown",function(e,n){c(e,"resize",t,n)})}function a(e,t,i,o,r){this._$notifications=null,this._windows=[],this._settings=OSjs.Core.getSettingsManager().instance(e,r),this._currentWin=null,this._lastWin=null,this._mouselock=!0,this._stylesheet=null,this._sessionLoaded=!1,this._fullyLoaded=!1,this._isResponsive=!1,this._responsiveRes=800,this._scheme=null,this.__name=e||"WindowManager",this.__path=o.path,this.__iter=o.iter,n.apply(this,[this.__name,i,o]),s=t||this}var s;o.prototype.getRect=function(){var e=this.win;return{left:e._position.x,top:e._position.y,width:e._dimension.w,height:e._dimension.h}},o.prototype.calculateDirection=function(){var t=e.$position(this.$handle),n=this.startX-t.left,i=this.startY-t.top,o="s",r={nw:n<=20&&i<=20,n:n>20&&i<=20,w:n<=20&&i>=20,ne:n>=t.width-20&&i<=20,e:n>=t.width-20&&i>20,se:n>=t.width-20&&i>=t.height-20,sw:n<=20&&i>=t.height-20};Object.keys(r).forEach(function(e){r[e]&&(o=e)}),this.direction=o},a.prototype=Object.create(n.prototype),a.prototype.destroy=function(){var t=this;return this.destroyStylesheet(),e.$unbind(document,"mouseout:windowmanager"),e.$unbind(document,"mouseenter:windowmanager"),this._windows.forEach(function(e,n){e&&(e.destroy(!0),t._windows[n]=null)}),this._scheme&&this._scheme.destroy(),this._windows=[],this._currentWin=null,this._lastWin=null,this._scheme=null,s=null,n.prototype.destroy.apply(this,[])},a.prototype.init=function(t,n,i){this._scheme=i;var o=this;e.$bind(document,"mouseout:windowmanager",function(e){o._onMouseLeave(e)}),e.$bind(document,"mouseenter:windowmanager",function(e){o._onMouseLeave(e)});var r=this.getDefaultSetting("mediaQueries")||{},a=0;Object.keys(r).forEach(function(e){a=Math.max(a,r[e])}),this._responsiveRes=a||800,this.resize()},a.prototype.setup=function(e){},a.prototype.getWindow=function(e){var t=null;return this._windows.every(function(n){return n&&n._name===e&&(t=n),!t}),t},a.prototype.addWindow=function(e,t){if(!(e instanceof i))throw new TypeError("given argument was not instance of Core.Window");try{e.init(this,e._app,e._scheme)}catch(e){console.error("WindowManager::addWindow()","=>","Window::init()",e,e.stack)}return r(e,this),this._windows.push(e),e._inited(),(!0===t||e instanceof OSjs.Core.DialogWindow)&&setTimeout(function(){e._focus()},10),e},a.prototype.removeWindow=function(e){var t=this;if(!(e instanceof i))throw new TypeError("given argument was not instance of Core.Window");e._wid;var n=!1;return this._windows.every(function(i,o){return i&&i._wid===e._wid&&(t._windows[o]=null,n=!0),!n}),n},a.prototype.applySettings=function(t,n,i,o){t=t||{};var r=n?t:e.mergeObject(this._settings.get(),t);return this._settings.set(null,r,i,o),!0},a.prototype.createStylesheet=function(t,n){this.destroyStylesheet();var i=[];Object.keys(t).forEach(function(n){var o=[];Object.keys(t[n]).forEach(function(i){o.push(e.format("    {0}: {1};",i,t[n][i]))}),o=o.join("\n"),i.push(e.format("{0} {\n{1}\n}",n,o))}),i=i.join("\n"),n&&(i+="\n"+n);var o=document.createElement("style");o.type="text/css",o.id="WMGeneratedStyles",o.innerHTML=i,document.getElementsByTagName("head")[0].appendChild(o),this._stylesheet=o},a.prototype.destroyStylesheet=function(){this._stylesheet&&this._stylesheet.parentNode&&this._stylesheet.parentNode.removeChild(this._stylesheet),this._stylesheet=null},a.prototype.onKeyDown=function(e,t){},a.prototype.onOrientationChange=function(e,t){this._onDisplayChange()},a.prototype.onResize=function(e){this._onDisplayChange()},a.prototype.onSessionLoaded=function(){return!this._sessionLoaded&&(this._sessionLoaded=!0,!0)},a.prototype.resize=function(e,t){this._isResponsive=window.innerWidth<=1024,this.onResize(e)},a.prototype.notification=function(){},a.prototype.createNotificationIcon=function(){return null},a.prototype.removeNotificationIcon=function(){return!1},a.prototype.eventWindow=function(e,t){return!1},a.prototype.showSettings=function(){},a.prototype._onMouseEnter=function(e){this._mouselock=!0},a.prototype._onMouseLeave=function(e){var t=e.relatedTarget||e.toElement;t&&"HTML"!==t.nodeName?this._mouselock=!0:this._mouselock=!1},a.prototype._onDisplayChange=function(){var e;return function(){var t=this;e=clearTimeout(e),e=setTimeout(function(){s&&t._windows.filter(function(e){return!!e}).forEach(function(e){e._onResize(),e._emit("resize")})},100),document.body.setAttribute("data-responsive",String(t._isResponsive))}}(),a.prototype.getDefaultSetting=function(){return null},a.prototype.getPanel=function(){return null},a.prototype.getPanels=function(){return[]},a.prototype.getStyleTheme=function(e){return e?{}:"default"},a.prototype.getSoundTheme=function(){return"default"},a.prototype.getSoundFilename=function(e){return null},a.prototype.getIconTheme=function(){return"default"},a.prototype.getStyleThemes=function(){return t.getConfig("Styles",[])},a.prototype.getSoundThemes=function(){return t.getConfig("Sounds",[])},a.prototype.getIconThemes=function(){return t.getConfig("Icons",[])},a.prototype.setSetting=function(e,t){return this._settings.set(e,t)},a.prototype.getWindowSpace=function(){return e.getRect()},a.prototype.getWindowPosition=function(){var e=this._windows.reduce(function(e,t){return null===t?e:e+1},0);return{x:10*e,y:10*e}},a.prototype.getSetting=function(e){return this._settings.get(e)},a.prototype.getSettings=function(){return this._settings.get()},a.prototype.getWindows=function(){return this._windows},a.prototype.getCurrentWindow=function(){return this._currentWin},a.prototype.setCurrentWindow=function(e){this._currentWin=e||null},a.prototype.getLastWindow=function(){return this._lastWin},a.prototype.setLastWindow=function(e){this._lastWin=e||null},a.prototype.getMouseLocked=function(){return this._mouselock},OSjs.Core.WindowManager=Object.seal(a),OSjs.Core.getWindowManager=function(){return s}}(OSjs.Utils,OSjs.API,OSjs.Core.Process,OSjs.Core.Window),function(e,t,n){"use strict";var i=function(){var t=[],o={};return Object.seal({destroy:function(){t=[],o={}},load:function(e){var t=this;e=e||{},function(r){t._loadMetadata(function(t){if(t)return void e(t,!1,i);Object.keys(o).length?r():e(!1,n._("ERR_PACKAGE_ENUM_FAILED"),i)})}(function(){t._loadExtensions(function(){e(!0,!1,i)})})},_loadExtensions:function(t){var n=[];Object.keys(o).forEach(function(e){var t=o[e];"extension"===t.type&&t.preload&&(n=n.concat(t.preload))}),n.length?e.preload(n,function(e,n){t()}):t()},_loadMetadata:function(t){function i(t,n,i){return n=e.cloneObject(n),n.type=n.type||"application",i&&(n.scope=i),n.preload&&n.preload.forEach(function(i){i.src&&!i.src.match(/^(\/)|(http)|(ftp)/)&&("user"===n.scope?i.src=e.pathJoin(n.path,i.src):i.src=e.pathJoin(a,t,i.src))}),n}var r=n.getConfig("Connection.PackageURI").replace(/\/?$/,"/"),a=n.getBrowserPath().replace(/\/$/,r);if(n.isStandalone()){var s=n.getConfig("Connection.MetadataURI");return void e.preload([s],function(e,r){if(r.length)return void t(n._("ERR_PACKAGE_MANIFEST"),r);o={};var a=OSjs.Core.getMetadata();Object.keys(a).forEach(function(e){var t=a[e];o[t.className]=i(e,t)}),t()})}var u=OSjs.Core.getSettingsManager().instance("PackageManager").get("PackagePaths",[]);n.call("packages",{command:"list",args:{paths:u}},function(e,n){n&&(o={},Object.keys(n).forEach(function(e){var t=n[e];t&&!o[t.className]&&(o[t.className]=i(e,t))})),t(e)})},generateUserMetadata:function(e){var t=this,i=OSjs.Core.getSettingsManager().instance("PackageManager").get("PackagePaths",[]);n.call("packages",{command:"cache",args:{action:"generate",scope:"user",paths:i}},function(){t._loadMetadata(e)})},_addPackages:function(t,i){var r=Object.keys(t);if(r.length){var a=n.getLocale();r.forEach(function(n){var r=e.cloneObject(t[n]);"object"==typeof r&&(void 0!==r.names&&r.names[a]&&(r.name=r.names[a]),void 0!==r.descriptions&&r.descriptions[a]&&(r.description=r.descriptions[a]),r.description||(r.description=r.name),r.scope=i||"system",r.type=r.type||"application",o[n]=r)})}},install:function(t,i,o){var r=this,a=OSjs.Core.getSettingsManager().instance("PackageManager").get("PackagePaths",[]);"string"!=typeof i&&(i=a[0]);var s=e.pathJoin(i,t.filename.replace(/\.zip$/i,""));n.call("packages",{command:"install",args:{zip:t.path,dest:s,paths:a}},function(e,t){e?o(e):r.generateUserMetadata(o)})},uninstall:function(e,t){var i=this;n.call("packages",{command:"uninstall",args:{path:e.path}},function(e,n){e?t(e):i.generateUserMetadata(t)})},setBlacklist:function(e){t=e||[]},getStorePackages:function(t,i){var o=OSjs.Core.getSettingsManager(),r=o.instance("PackageManager").get("Repositories",[]),a=[];e.asyncs(r,function(e,t,i){n.curl({url:e,method:"GET"},function(t,n){if(!t&&n.body){var o=[];if("string"==typeof n.body)try{o=JSON.parse(n.body)}catch(e){}a=a.concat(o.map(function(t){return t._repository=e,t}))}i()})},function(){i(!1,a)})},getPackage:function(t){return void 0!==o[t]&&Object.freeze(e.cloneObject(o)[t])},getPackages:function(i){function r(e,i){return!(t.indexOf(e)>=0)&&!(i&&i.groups instanceof Array&&!n.checkPermission(i.groups))}var a=OSjs.Core.getSettingsManager().instance("PackageManager").get("Hidden",[]),s=e.cloneObject(o);if(void 0===i||!0===i){var u={};return Object.keys(s).forEach(function(e){var t=s[e];r(e,t)&&t&&a.indexOf(e)<0&&(u[e]=t)}),Object.freeze(u)}return Object.freeze(s)},getPackagesByMime:function(n){var i=[],r=e.cloneObject(o);return Object.keys(r).forEach(function(o){if(t.indexOf(o)<0){var a=r[o];a&&a.mime&&e.checkAcceptMime(n,a.mime)&&i.push(o)}}),i},addDummyPackage:function(e,t,n,i){if(o[e]||OSjs.Applications[e])throw new Error("A package already exists with this name!");if("function"!=typeof i)throw new TypeError("You need to specify a function/callback!");o[e]=Object.seal({_dummy:!0,type:"application",className:e,description:t,name:t,icon:n,cateogry:"other",scope:"system"}),OSjs.Applications[e]=i}})}();OSjs.Core.getPackageManager=function(){return i}}(OSjs.Utils,OSjs.VFS,OSjs.API),function(e,t,n){"use strict";var i={storage:{},defaults:{},watches:[]};i.init=function(e){this.storage=e||{}},i.get=function(e,t){try{return this.storage[e]&&Object.keys(this.storage[e]).length?t?this.storage[e][t]:this.storage[e]:t?this.defaults[e][t]:this.defaults[e]}catch(e){e.stack}return!1},i.set=function(e,t,n,i,o){try{t?(void 0===this.storage[e]&&(this.storage[e]={}),["number","string"].indexOf(typeof t)>=0&&(this.storage[e][t]=n)):this.storage[e]=n}catch(e){e.stack}return i&&this.save(e,i),void 0!==o&&!0!==o||this.changed(e),!0},i.save=function(e,t){this.storage,"function"!=typeof t&&(t=function(){}),OSjs.Core.getStorage().saveSettings(e,this.storage,t)},i.defaults=function(e,t){this.defaults[e]=t},i.instance=function(e,t){(!this.storage[e]||this.storage[e]instanceof Array)&&(this.storage[e]={});var n=new OSjs.Helpers.SettingsFragment(this.storage[e],e);return arguments.length>1&&(i.defaults(e,t),n.mergeDefaults(t)),n},i.unwatch=function(e){void 0!==this.watches[e]&&delete this.watches[e]},i.watch=function(e,t){return!!this.storage[e]&&this.watches.push({pool:e,callback:t})-1},i.changed=function(e){var t=this;return this.watches.forEach(function(n){n&&n.pool===e&&n.callback(t.storage[e])}),this},i.clear=function(e,t){return t=void 0===t||!0===t,this.set(e,null,{},t),this},Object.seal(i),OSjs.Core.getSettingsManager=function(){return i}}(OSjs.Utils,OSjs.VFS,OSjs.API),function(e,t,n){"use strict";var i=function(){function o(e,t,n){if(t.readOnly){var o=["upload","unlink","write","mkdir","move","trash","untrash","emptyTrash"];if("copy"===e){return i.getModuleFromPath(n[1].path,!1,!0).internal!==t.internal}if(-1!==o.indexOf(e))return!0}return!1}function r(o,r,a){null===o&&(o=r.name);var s=o.replace(/\s/g,"-").toLowerCase();if(u[o])throw new Error(n._("ERR_VFSMODULE_ALREADY_MOUNTED_FMT",o));var c=new RegExp("^"+(s+"://").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")),l=e.argumentDefaults(e.cloneObject(r,!0),{searchable:!0,readOnly:!1,visible:!0,dynamic:!0===a,options:{},transport:"OSjs",root:s+":///",name:o,description:o,icon:"devices/drive-harddisk.png",request:function(e,t,n,o){i._request(l,e,t,n,o)},unmount:function(e){(e||function(){})(n._("ERR_VFS_UNAVAILABLE"),!1)},mounted:function(){return!0},enabled:function(){return!0}},!0);l.match=r.match||c;var d=["OSjs"];void 0===l.internal&&(l.internal=-1!==d.indexOf(l.transport)),"owndrive"===l.transport.toLowerCase()&&(l.transport="WebDAV");var f=t.Transports[l.transport];if(f&&"function"==typeof f.defaults&&f.defaults(l),a){var p=function(){return Object.keys(t.Transports).indexOf(l.transport)<0?"No such transport '"+l.transport+"'":!("WebDAV"===l.transport&&!l.options.username)||"Connection requires username (authorization)"}();if(!0!==p)throw new Error(n._("ERR_VFSMODULE_INVALID_CONFIG_FMT",p))}return Object.freeze(l)}var a=[],s=!1,u={};return Object.seal({_add:function(e,t){s?(u[e.name]=Object.seal(e),t&&n.message("vfs:mount",e.name,{source:null})):a.push(arguments)},init:function(e){if(s)return void e();s=!0;var t=n.getConfig("VFS.Mountpoints",{});a.forEach(function(e){var t=r(null,e[0]);i._add(t,e[1])}),Object.keys(t).forEach(function(e){var n=t[e];if(!1!==n.enabled){n.name=e,delete n.enabled;var o=r(null,n);i._add(o,!1)}}),a=[],e()},_request:function(e,i,r,a,s){a=a||function(){};var u=t.Transports[e.transport];if(!u)return void a(n._("ERR_VFSMODULE_INVALID_TYPE_FMT",e.transport));if(o(i,e,r))return void a(n._("ERR_VFSMODULE_READONLY"));var c=function(){var t={};return Object.keys(e).forEach(function(n){"function"!=typeof e[n]&&(t[n]=e[n])}),Object.freeze(t)}(),l=u.module||{};if(l[i]){var d=r||[];d.push(a),d.push(s),d.push(c),l[i].apply(l,d)}else a(n._("ERR_VFS_UNAVAILABLE"))},restore:function(t){var n=OSjs.Core.getSettingsManager();e.asyncs(n.instance("VFS").get("mounts",[]),function(e,t,n){try{i.add(e,n)}catch(e){e.stack,n()}},function(){t()})},add:function(t,o){var a=function(){var i=!0;return e.argumentDefaults(e.cloneObject(t,!0),{icon:"places/network-server.png",searchable:!1,unmount:function(e){i=!1,n.message("vfs:unmount",t.name,{source:null}),(e||function(){})(!1,!0)},mounted:function(){return i}})}(),s=r(null,a,!0);i._add(s,!0),(o||function(){})(!1,!0)},remove:function(e,t){if(!u[e])throw new Error(n._("ERR_VFSMODULE_NOT_MOUNTED_FMT",e));u[e].unmount(function(){delete u[e],t.apply(i,arguments)})},isInternal:function(e){e=e||"";var t=u,n=null;return null!==e&&Object.keys(t).forEach(function(i){if(!0!==n){var o=t[i];!0===o.internal&&o.match&&e.match(o.match)&&(n=!0)}}),n},getModules:function(t){t=e.argumentDefaults(t,{visible:!0,special:!1});var n=u,i=[];return Object.keys(n).forEach(function(e){var o=n[e];!o.enabled()||!t.special&&o.special||t.visible&&o.visible===t.visible&&i.push({name:e,module:o})}),i},getModule:function(e){return u[e]},getModuleFromPath:function(e,t,n){t=void 0===t||!0===t;var i=null;"string"==typeof e&&Object.keys(u).forEach(function(t){if(null===i){var n=u[t];!0===n.enabled()&&n.match instanceof RegExp&&e.match(n.match)&&(i=t)}});var o=i||(t?"home":null);return n?u[o]:o},getRootFromPath:function(e){return i.getModuleFromPath(e,!1,!0).root},getModuleProperty:function(e,t){return"string"==typeof e&&(e=u[e]),e[t]}})}();OSjs.Core.getMountManager=function(){return i}}(OSjs.Utils,OSjs.VFS,OSjs.API),function(e,t,n){"use strict";function i(e,t){var n=[];return e.forEach(function(e){var i=!1;e.fields.forEach(function(o){if(!i){var r=String(t).toLowerCase();-1!==String(o).toLowerCase().indexOf(r)&&(n.push(e.value),i=!0)}})}),n}function o(e){var t=this;Object.keys(e).forEach(function(n){t[n]=e[n]})}var r=function(){function e(){var e=OSjs.Core.getPackageManager().getPackages();return Object.keys(e).map(function(i){var r=e[i];return new o({value:{title:r.name,description:r.description,icon:n.getFileIcon(new t.File("applications:///"+r.className,"application"),"16x16"),launch:{application:i,args:{}}},fields:[r.className,r.name,r.description]})})}return{search:function(t,n,o,r){if(o.applications){var a=i(e(),t);n.limit&&a.length>n.dlimit&&(a=a.splice(0,n.dlimit)),r(!1,a)}else r(!1,[])},reindex:function(e,t){t(!1,!0)},destroy:function(){}}}(),a={search:function(i,o,r,a){if(!r.files||!r.paths)return void a(!1,[]);var s=[];e.asyncs(r.paths,function(e,r,a){t.find(e,{query:i,limit:o.limit?o.dlimit:0,recursive:o.recursive},function(e,i){if(i){var o=i.map(function(e){return{title:e.filename,description:e.path,icon:n.getFileIcon(new t.File(e)),launch:{application:"",args:"",file:e}}});s=s.concat(o)}a()})},function(){a(!1,s)})},reindex:function(e,t){t(!1,!0)},destroy:function(){}},s=function(){var t=[r,a],n={},i=!1;return Object.seal({init:function(e){if(!i){var t=OSjs.Core.getSettingsManager();n=t.get("SearchEngine")||{},i=!0,e()}},destroy:function(){t.forEach(function(e){e.destroy()}),t=[],n={},i=!1},search:function(i,o,r){var a=[],s=[];o=e.argumentDefaults(o,{recursive:!1,limit:0,dlimit:0}),o.limit&&(o.dlimit=o.limit),e.asyncs(t,function(e,t,u){!o.limit||o.dlimit>0?e.search(i,o,n,function(e,t){e?s.push(e):(o.dlimit-=t.length,a=a.concat(t)),u()}):r(s,a)},function(){r(s,a)})},reindex:function(n,i){var o=[];e.asyncs(t,function(e,t,i){e.reindex(n,function(e,t){e&&o.push(e),i()})},function(){i(o,!0)})},configure:function(e,t){}})}();OSjs.Core.getSearchEngine=function(){return s}}(OSjs.Utils,OSjs.VFS,OSjs.API),function(e,t,n,i){"use strict";function o(){i.apply(this,arguments)}o.prototype=Object.create(i.prototype),o.constructor=i,o.prototype.request=function(e,n,o,r,a){var s=i.prototype.request.apply(this,arguments);if(!1===s){var u=function(){return e.match(/^FS:/)?t.getConfig("Connection.FSURI")+"/"+e.replace(/^FS\:/,""):t.getConfig("Connection.APIURI")+"/"+e}();return this._requestXHR(u,n,a,o,r)}return s},o.prototype.onVFSRequestCompleted=function(t,n,i,o,r,a,s){if(!o&&-1!==["write","mkdir","copy","move","unlink"].indexOf(n)){var u="move"===n?{source:i[0]instanceof e.File?i[0]:null,destination:i[1]instanceof e.File?i[1]:null}:i["copy"===n?1:0];e.Helpers.triggerWatch(n,u,s)}a()},OSjs.Connections=OSjs.Connections||{},OSjs.Connections.http=o}(OSjs.VFS,OSjs.API,OSjs.Utils,OSjs.Core.Connection),function(e,t,n,i){"use strict";function o(){i.apply(this,arguments);var t=e.getConfig("Connection.WSPort"),n=e.getConfig("Connection.WSPath")||"",o=window.location.protocol.replace("http","ws")+"//"+window.location.host;"upgrade"!==t&&(o.match(/:\d+$/)&&(o=o.replace(/:\d+$/,"")),o+=":"+t),o+=n,this.ws=null,this.wsurl=o,this.wsqueue={},this.destroying=!1}o.prototype=Object.create(i.prototype),o.constructor=i,o.prototype.destroy=function(){return this.destroying=!0,this.ws&&this.ws.close(),this.ws=null,this.wsqueue={},i.prototype.destroy.apply(this,arguments)},o.prototype.init=function(e){this.destroying=!1,this._connect(!1,e)},o.prototype._connect=function(t,n){if(!(this.destroying||this.ws&&!t)){this.wsurl;var i=this,o=!1;this.ws=new WebSocket(this.wsurl),this.ws.onopen=function(){o=!0,setTimeout(function(){n()},0)},this.ws.onmessage=function(e){var t=JSON.parse(e.data),n=t._index;i._onmessage(n,t)},this.ws.onclose=function(t){if(!o&&3001!==t.code)return void n(e._("CONNECTION_ERROR"));i._onclose()}}},o.prototype._onmessage=function(e,t){void 0===e?this.message(t):this.wsqueue[e]&&(delete t._index,this.wsqueue[e](t),delete this.wsqueue[e])},o.prototype._onclose=function(e){var t=this;this.destroying||(this.onOffline(e),this.ws=null,setTimeout(function(){t._connect(!0,function(n){n?t._onclose((e||0)+1):t.onOnline()})},e?1e4:1e3))},o.prototype.message=function(e){"vfs:watch"===e.action&&t.Helpers.triggerWatch(e.args.event,t.file(e.args.file)),this._evHandler&&this._evHandler.emit(e.action,e.args)},o.prototype.request=function(e,t,n,o,r){o=o||function(){};var a=i.prototype.request.apply(this,arguments);if(!1!==a)return a;if(!this.ws)return!1;var s=this.index++,u=e.match(/^FS:/)?"/FS/":"/API/";try{return this.ws.send(JSON.stringify({_index:s,path:u+e.replace(/^FS:/,""),args:t})),this.wsqueue[s]=n||function(){},!0}catch(e){e.stack,o(e)}return!1},OSjs.Connections=OSjs.Connections||{},OSjs.Connections.ws=o}(OSjs.API,OSjs.VFS,OSjs.Utils,OSjs.Core.Connection),function(e,t,n){"use strict";function i(){n.apply(this,arguments)}i.prototype=Object.create(n.prototype),i.constructor=n,i.prototype.login=function(t,i){for(var o,r={},a=0;a<localStorage.length;a++)if(o=localStorage.key(a),o.match(/^OSjs\//))try{r[o.replace(/^OSjs\//,"")]=JSON.parse(localStorage.getItem(o))}catch(e){e.stack}return e.isStandalone()?i(!1,{userData:{id:0,username:"demo",name:"Demo User",groups:["admin"]},userSettings:r,blacklistedPackages:[]}):n.prototype.login.call(this,t,function(e,t){e?i(e):(t.userSettings=r,i(null,t))})},i.prototype.onCreateUI=function(e){this.onLoginRequest({username:"demo",password:"demo"},e)},OSjs.Auth=OSjs.Auth||{},OSjs.Auth.demo=i}(OSjs.API,OSjs.Utils,OSjs.Core.Authenticator),function(e,t,n){"use strict";function i(){n.apply(this,arguments)}i.prototype=Object.create(n.prototype),i.constructor=n,OSjs.Auth.database=i}(OSjs.API,OSjs.Utils,OSjs.Core.Authenticator),function(e,t,n){"use strict";function i(){n.apply(this,arguments)}i.prototype=Object.create(n.prototype),i.constructor=n,OSjs.Auth.pam=i}(OSjs.API,OSjs.Utils,OSjs.Core.Authenticator),function(e,t,n){"use strict";function i(){n.apply(this,arguments)}i.prototype=Object.create(n.prototype),i.constructor=n,i.prototype.init=function(t){var n=e.getConfig("Version");n!==localStorage.getItem("__version__")&&localStorage.clear(),localStorage.setItem("__version__",String(n)),t(null,!0)},i.prototype.saveSettings=function(e,t,n){Object.keys(t).forEach(function(n){if(!e||n===e)try{localStorage.setItem("OSjs/"+n,JSON.stringify(t[n]))}catch(e){e.stack}}),n()},OSjs.Storage=OSjs.Storage||{},OSjs.Storage.demo=i}(OSjs.API,OSjs.Utils,OSjs.Core.Storage),function(e,t,n){"use strict";function i(){n.apply(this,arguments)}i.prototype=Object.create(n.prototype),i.constructor=n,OSjs.Storage=OSjs.Storage||{},OSjs.Storage.database=i}(OSjs.API,OSjs.Utils,OSjs.Core.Storage),function(e,t,n){"use strict";function i(){n.apply(this,arguments)}i.prototype=Object.create(n.prototype),i.constructor=n,OSjs.Storage=OSjs.Storage||{},OSjs.Storage.system=i}(OSjs.API,OSjs.Utils,OSjs.Core.Storage),function(){"use strict";OSjs.Utils.getCompability=function(){function e(e,t,n){var i={};return Object.keys(t).forEach(function(e){var o=t[e],r=!1;o instanceof Array?o.forEach(function(e){return!(r=n(e))}):r=n(o),i[e]=r}),i}function t(){return document.createElement("canvas").getContext?document.createElement("canvas"):null}function n(){return document.createElement("video").canPlayType?document.createElement("video"):null}function i(t,n){return e(t,n,function(e){try{return!!t.canPlayType(e)}catch(e){}return!1})}function o(){return document.createElement("audio").canPlayType?document.createElement("audio"):null}function r(e){var t=!1,n="Webkit Moz ms O".split(" "),i=document.createElement("div"),o=null;if(e=e.toLowerCase(),i.style[e]&&(t=!0),!1===t){o=e.charAt(0).toUpperCase()+e.substr(1);for(var r=0;r<n.length;r++)if(void 0!==i.style[n[r]+o]){t=!0;break}}return t}var a=function(){var e=[];return function(){if(!e.length){var n=t();if(n){["2d","webgl","experimental-webgl","webkit-3d","moz-webgl"].forEach(function(t,i){try{n.getContext(t)&&e.push(t)}catch(e){}})}}return e}}(),s={indexedDB:"indexedDB",localStorage:"localStorage",sessionStorage:"sessionStorage",globalStorage:"globalStorage",openDatabase:"openDatabase",socket:"WebSocket",worker:"Worker",file:"File",blob:"Blob",orientation:"onorientationchange"},u={touch:function(){try{if(navigator.userAgent.match(/Windows NT 6\.(2|3)/))return!1}catch(e){}try{if(navigator.userAgent.match(/iOS|Android|BlackBerry|IEMobile|iPad|iPhone|iPad/i))return!0}catch(e){}return!1}(),upload:function(){try{var e=new XMLHttpRequest;return!!(e&&"upload"in e&&"onprogress"in e.upload)}catch(e){}return!1}(),getUserMedia:function(){var e=!1;return window.navigator&&(e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),!!e}(),fileSystem:function(){return"requestFileSystem"in window||"webkitRequestFileSystem"in window}(),localStorage:!1,sessionStorage:!1,globalStorage:!1,openDatabase:!1,socket:!1,worker:!1,file:!1,blob:!1,orientation:!1,dnd:function(){return!!("draggable"in document.createElement("span"))}(),css:{transition:r("transition"),animation:r("animation")},canvas:!!t(),canvasContext:a(),webgl:function(){var e=!1,t=a();try{e=t.length>1,e||"WebGLRenderingContext"in window&&(e=!0)}catch(e){}return e}(),audioContext:function(){return!(!window.hasOwnProperty("AudioContext")&&!window.hasOwnProperty("webkitAudioContext"))}(),svg:function(){return!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect}(),video:!!n(),videoTypes:function(){return i(n(),{webm:'video/webm; codecs="vp8.0, vorbis"',ogg:'video/ogg; codecs="theora"',h264:['video/mp4; codecs="avc1.42E01E"','video/mp4; codecs="avc1.42E01E, mp4a.40.2"'],mpeg:'video/mp4; codecs="mp4v.20.8"',mkv:'video/x-matroska; codecs="theora, vorbis"'})}(),audio:!!o(),audioTypes:function(){return i(o(),{ogg:'audio/ogg; codecs="vorbis',mp3:"audio/mpeg",wav:'audio/wav; codecs="1"'})}(),richtext:function(){try{return!!document.createElement("textarea").contentEditable}catch(e){}return!1}()};return Object.keys(s).forEach(function(e){u[e]=s[e]in window&&null!==window[s[e]]}),function(){return u}}(),OSjs.Utils.isIE=function(){return parseInt(document.documentMode,10)<=11||!!navigator.userAgent.match(/(MSIE|Edge)/)},OSjs.Utils.getUserLocale=function(){var e=(window.navigator.userLanguage||window.navigator.language||"en-EN").replace("-","_"),t={nb:"no_NO",es:"es_ES",ru:"ru_RU",en:"en_EN"},n=e.split("_")[0]||"en",i=e.split("_")[1]||n.toUpperCase();return t[n]?t[n]:n+"_"+i},OSjs.Utils.getRect=function(){
var e=document.body||{};return{top:0,left:0,width:e.offsetWidth||0,height:e.offsetHeight||0}}}(),function(){"use strict";function e(e){var t=e;if("mousewheel"!==e&&e.match(/^mouse/))if(window.PointerEvent)t=e.replace(/^mouse/,"pointer");else if(window.MSPointerEvent){var n=e.replace(/^mouse/,"");t="MSPointer"+n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}return t}function t(e){return e.replace(/\s/g,"").split(",")}OSjs.Utils.Keys=function(){for(var e={F1:112,F2:113,F3:114,F4:115,F6:118,F7:119,F8:120,F9:121,F10:122,F11:123,F12:124,TILDE:220,GRAVE:192,CMD:17,LSUPER:91,RSUPER:92,DELETE:46,INSERT:45,HOME:36,END:35,PGDOWN:34,PGUP:33,PAUSE:19,BREAK:19,CAPS_LOCK:20,SCROLL_LOCK:186,BACKSPACE:8,SPACE:32,TAB:9,ENTER:13,ESC:27,LEFT:37,RIGHT:39,UP:38,DOWN:40},t=33;t<=126;t++)e[String.fromCharCode(t)]=t;return Object.freeze(e)}(),OSjs.Utils.mousePosition=function(e){if(e.detail&&void 0!==e.detail.x&&void 0!==e.detail.y)return{x:e.detail.x,y:e.detail.y};var t=e.touches||e.changedTouches;return t&&t[0]?{x:t[0].clientX,y:t[0].clientY}:{x:e.clientX,y:e.clientY}},OSjs.Utils.mouseButton=function(e){return void 0!==e.button?0===e.button?"left":1===e.button?"middle":"right":2===e.which||4===e.which?"middle":1===e.which?"left":"right"},OSjs.Utils.keyCombination=function(){function e(e){var t=!1;return Object.keys(OSjs.Utils.Keys).forEach(function(n){t||e!==OSjs.Utils.Keys[n]||(t=n)}),t}var t={CTRL:function(e){return e.ctrlKey},SHIFT:function(e){return e.shiftKey},ALT:function(e){return e.altKey},META:function(e){return e.metaKey}};return function(n,i){var o=i.toUpperCase().split("+"),r={CTRL:!1,SHIFT:!1,ALT:!1},a=[];return o.forEach(function(e){t[e]?r[e]=!0:a.push(e)}),Object.keys(r).every(function(e){var i=!!t[e](n);return r[e]===i})&&a.every(function(t){return e(n.keyCode)===t})}}(),OSjs.Utils.$bind=function(){function n(e,t,n,i,o,r,a){var s=[n,o,r];e.addEventListener.apply(e,s),e._boundEvents[t].push({realType:a,args:s,callback:i})}function i(e,t,i,o,r){function a(e){var t=OSjs.Utils.mousePosition(e),n=e.detail<0||e.wheelDelta>0?1:-1;return t.z=n,o(e,t)}n(e,t,"mousewheel",o,a,r,"mousewheel"),n(e,t,"DOMMouseScroll",o,a,r,"DOMMouseScroll")}function o(e,t,i,o,l){function d(){v=clearTimeout(v),m=null,y=!1,e.removeEventListener("touchend",p,!1),e.removeEventListener("touchmove",h,!1),e.removeEventListener("touchcancel",g,!1)}function f(t){t.target===document.body&&t.preventDefault(),v=clearTimeout(v),m=new Date,y=!1,"contextmenu"===i?v=setTimeout(function(){r(t,i,{button:2,which:3,buttons:2}),d()},a):"dblclick"===i&&(0===S?(_=clearTimeout(_),_=setTimeout(function(){S=0},c),S++):(y||r(t,i),S=0)),e.addEventListener("touchend",p,!1),e.addEventListener("touchmove",h,!1),e.addEventListener("touchcancel",g,!1)}function p(e){if(v=clearTimeout(v),!m)return d();OSjs.Utils.$isFormElement(e)||e.preventDefault();var t=new Date,n=t-m;return y||"click"!==i||n>s&&n<u&&(e.stopPropagation(),r(e,i)),d()}function h(e){e.target!==document.body&&y||e.preventDefault(),m&&(v=clearTimeout(v),_=clearTimeout(_),S=0,y=!0)}function g(e){_=clearTimeout(_),S=0,d()}var m,v,_,y=!1,S=0;n(e,t,"touchstart",o,f,!1,"touchstart")}function r(e,t,n){if(e.target===document.body&&e.preventDefault(),!(!e.currentTarget||e.changedTouches.length>1||"touchend"===e.type&&e.changedTouches>0)){var i=["ctrlKey","altKey","shiftKey","metaKey","screenX","screenY"],o=e.changedTouches[0],r={clientX:o.clientX,clientY:o.clientY,relatedTarget:e.target};i.forEach(function(t){r[t]=e[t]}),n&&Object.keys(n).forEach(function(e){r[e]=n[e]}),e.currentTarget.dispatchEvent(new MouseEvent(t,r))}}var a=1e3,s=30,u=1e3,c=400,l={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove",mousewheel:i,contextmenu:o,click:o,dblclick:o};return function(i,o,a,s,u){function c(t,o){o=e(o),n(i,t,o,a,function(e){return OSjs&&OSjs.Utils?u?a(e,OSjs.Utils.mousePosition(e)):a.call(i,e,OSjs.Utils.mousePosition(e)):null},s),l[o]&&("function"==typeof l[o]?l[o](i,t,o,a,s):n(i,t,l[o],a,function(e){r(e,o)},s,l[o]))}function d(e){return i._boundEvents||(i._boundEvents={}),i._boundEvents[e]||(i._boundEvents[e]=[]),0===i._boundEvents[e].filter(function(e){return e.callback===a}).length}if(s=!0===s,arguments.length<3)throw new Error("$bind expects 3 or more arguments");if("string"!=typeof o)throw new Error("Given event type was not a string");if("function"!=typeof a)throw new Error("Given callback was not a function");t(o).forEach(function(e){var t=e.split(":")[0];d(e)&&c(e,t)})}}(),OSjs.Utils.$unbind=function(e,n,i,o){function r(t){if(e._boundEvents){var n=e._boundEvents||{};if(n[t])for(var o=0;o<n[t].length;o++){var r=n[t][o];i&&r.callback!==i||(e.removeEventListener.apply(e,r.args),n[t].splice(o,1),o--)}}}e&&(n?t(n).forEach(function(e){r(e)}):function(){e._boundEvents&&(Object.keys(e._boundEvents).forEach(function(e){r(e)}),delete e._boundEvents)}())}}(),function(){"use strict";OSjs.Utils.getCookie=function(e){var t={};return document.cookie.split(/;\s+?/g).forEach(function(e){var n=e.indexOf("=");t[e.substr(e,n)]=e.substr(n+1)}),e?t[e]:t},OSjs.Utils.format=function(e){function t(e,t){return t in n?n[t]:e}var n=Array.prototype.slice.call(arguments,1),i=/\{(\d+)\}/g;return e.replace(i,t)},OSjs.Utils.cleanHTML=function(e){return e.replace(/\n/g,"").replace(/[\t ]+</g,"<").replace(/\>[\t ]+</g,"><").replace(/\>[\t ]+$/g,">")},OSjs.Utils.parseurl=function(e,t){t=t||{},e.match(/^(\w+\:)\/\//)||(e="//"+e);var n=e.split(/^(\w+\:)?\/\//),i=function(){var e=n[2].replace(/^\/\//,"").split("/");return{proto:(t.protocol||n[1]||window.location.protocol||"").replace(/\:$/,""),host:t.host||e.shift(),path:t.path||"/"+e.join("/")}}();return{protocol:i.proto,host:i.host,path:i.path,url:function(){var e=[i.proto,"://"];if(t.username){var n=String(t.username)+":"+String(t.password);e.push(n),e.push("@")}return e.push(i.host),e.push(i.path),e.join("")}()}},OSjs.Utils.argumentDefaults=function(e,t,n){return e=e||{},Object.keys(t).forEach(function(n){"boolean"==typeof t[n]||"number"==typeof t[n]?void 0!==e[n]&&null!==e[n]||(e[n]=t[n]):e[n]=e[n]||t[n]}),e},OSjs.Utils.mergeObject=function(e,t,n){n=n||{};for(var i in t)if(t.hasOwnProperty(i))try{if(!1===n.overwrite&&e.hasOwnProperty(i))continue;t[i].constructor===Object?e[i]=OSjs.Utils.mergeObject(e[i],t[i]):e[i]=t[i]}catch(n){e[i]=t[i]}return e},OSjs.Utils.cloneObject=function(e,t){function n(e){if("object"!=typeof e||null===e)return e;if(e instanceof Array)return e.map(n);var t={};return Object.keys(e).forEach(function(i){t[i]=n(e[i])}),t}return t?n(e):JSON.parse(JSON.stringify(e,function(e,t){return t&&"object"==typeof t&&t.tagName?window.undefined:t}))},OSjs.Utils.extend=function(e,t){e&&t&&Object.keys(t).forEach(function(n){e[n]=t[n]})},OSjs.Utils.inherit=function(e,t,n){return t=t||function(){e.apply(this,arguments)},t.prototype=Object.create(e.prototype),t.constructor=e,n&&OSjs.Utils.extend(t.prototype,n),t},OSjs.Utils.convertToRGB=function(e){var t=parseInt(e.replace("#",""),16),n={};return n.r=(t&255<<16)>>16,n.g=(65280&t)>>8,n.b=255&t,n},OSjs.Utils.convertToHEX=function(e,t,n){if("object"==typeof e&&(t=e.g,n=e.b,e=e.r),void 0===e||void 0===t||void 0===n)throw new Error("Invalid RGB supplied to convertToHEX()");var i=[parseInt(e,10).toString(16),parseInt(t,10).toString(16),parseInt(n,10).toString(16)];return Object.keys(i).forEach(function(e){1===i[e].length&&(i[e]="0"+i[e])}),"#"+i.join("").toUpperCase()},OSjs.Utils.invertHEX=function(e){var t=parseInt(e.replace("#",""),16);return t^=16777215,t=t.toString(16),"#"+(t=("000000"+t).slice(-6))},OSjs.Utils.asyncs=function(e,t,n){t=t||function(e,t,n){return n()},n=n||function(){};var i=[],o=!1;!function r(a){if(!o&&-1===i.indexOf(a)){if(i.push(a),a>=e.length)return o=!0,void n();try{t(e[a],a,function(){r(a+1)})}catch(e){e.stack,r(a+1)}}}(0)},OSjs.Utils.asyncp=function(e,t,n,i){function o(t,i){function o(){r--,i()}if(-1===u.indexOf(t)){u.push(t),r++;try{n(e[t],t,o)}catch(e){e.stack,o()}}}t=t||{};var r=0,a=t.max||3,s=Object.keys(e),u=[],c=!1;!function e(){if(!s.length){if(r||c)return;return c=!0,void i()}for(var t=Math.min(s.length,a-r),n=0;n<t;n++)o(s.shift(),e)}()}}(),function(){"use strict";OSjs.Utils.$=function(e){return document.getElementById(e)},OSjs.Utils.$safeName=function(e){return(e||"").replace(/[^a-zA-Z0-9]/g,"_")},OSjs.Utils.$remove=function(e){e&&e.parentNode&&e.parentNode.removeChild(e)},OSjs.Utils.$empty=function(e,t){if(e)for(t&&(t="string"==typeof t?t:"*",e.querySelectorAll(t).forEach(function(e){OSjs.Utils.$unbind(e)}));e.firstChild;)e.removeChild(e.firstChild)},OSjs.Utils.$getStyle=function(e,t){var n="";return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,"").getPropertyValue(t):e.currentStyle&&(t=t.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),n=e.currentStyle[t]),n},OSjs.Utils.$position=function(e,t){if(e){if(t){for(var n={left:0,top:0,width:e.offsetWidth,height:e.offsetHeight};;){if(n.left+=e.offsetLeft,n.top+=e.offsetTop,e.offsetParent===t||null===e.offsetParent)break;e=e.offsetParent}return n}return e.getBoundingClientRect()}return null},OSjs.Utils.$parent=function(e,t){var n=null;if(e&&t)for(var i=e;i.parentNode;){if(t(i)){n=i;break}i=i.parentNode}return n},OSjs.Utils.$index=function(e,t){if(e&&(t=t||e.parentNode)){return Array.prototype.slice.call(t.children).indexOf(e,t)}return-1},OSjs.Utils.$selectRange=function(e,t,n){if(!e)throw new Error("Cannot select range: missing element");if(void 0===t||void 0===n)throw new Error("Cannot select range: mising start/end");if(e.createTextRange){var i=e.createTextRange();i.collapse(!0),i.moveStart("character",t),i.moveEnd("character",n),i.select(),e.focus()}else e.setSelectionRange?(e.focus(),e.setSelectionRange(t,n)):void 0!==e.selectionStart&&(e.selectionStart=t,e.selectionEnd=n,e.focus())},OSjs.Utils.$addClass=function(e,t){e&&t.split(" ").forEach(function(t){e.classList.add(t)})},OSjs.Utils.$removeClass=function(e,t){e&&t.split(" ").forEach(function(t){e.classList.remove(t)})},OSjs.Utils.$hasClass=function(e,t){return!(!e||!t)&&t.split(" ").every(function(t){return e.classList.contains(t)})},OSjs.Utils.$escape=function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML},OSjs.Utils.$create=function(e,t){function n(e,t){e=e||{},Object.keys(e).forEach(function(n){t(n.replace(/_/g,"-"),String(e[n]))})}var i=document.createElement(e);return n(t.style,function(e,t){i.style[e]=t}),n(t.aria,function(e,t){-1!==["role"].indexOf(e)&&(e="aria-"+e),i.setAttribute(e,t)}),n(t.data,function(e,t){i.setAttribute("data-"+e,t)}),n(t,function(e,t){-1===["style","aria","data"].indexOf(e)&&(i[e]=t)}),i},OSjs.Utils.$createCSS=function(e,t,n){var i=document.createElement("link");return i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.onload=t||function(){},i.onerror=n||function(){},i.setAttribute("href",e),document.getElementsByTagName("head")[0].appendChild(i),i},OSjs.Utils.$createJS=function(e,t,n,i,o){var r=document.createElement("script");return r.onreadystatechange=t||function(){},r.onerror=i||function(){},r.onload=n||function(){},o=OSjs.Utils.mergeObject({type:"text/javascript",charset:"utf-8",src:e},o||{}),Object.keys(o).forEach(function(e){r[e]=String(o[e])}),document.getElementsByTagName("head")[0].appendChild(r),r},OSjs.Utils.$isFormElement=function(e,t){return t=t||["TEXTAREA","INPUT","SELECT"],e instanceof window.Event&&(e=e.srcElement||e.target),e instanceof window.Element&&t.indexOf(e.tagName.toUpperCase())>=0&&!e.readOnly&&!e.disabled},OSjs.Utils.$css=function(e,t,n){function i(e){return e.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()})}var o={};if(2===arguments.length){if("string"==typeof t)return e.parentNode?OSjs.Utils.$getStyle(e,t):e.style[i(t)];o=t}else 3===arguments.length&&(o[t]=n);Object.keys(o).forEach(function(t){e.style[i(t)]=String(o[t])})},OSjs.Utils.$path=function(e){function t(e){if(e===document.body)return e.tagName;if(e===window)return"WINDOW";if(e===document)return"DOCUMENT";if(""!==e.id)return'id("'+e.id+'")';for(var n=0,i=e.parentNode?e.parentNode.childNodes:[],o=0;o<i.length;o++){var r=i[o];if(r===e)return t(e.parentNode)+"/"+e.tagName+"["+(n+1)+"]";1===r.nodeType&&r.tagName===e.tagName&&n++}return null}return t(e)},OSjs.Utils.$fromPath=function(e,t){return t=t||document,(new XPathEvaluator).evaluate(e,t.documentElement,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}}(),function(){"use strict";OSjs.Utils.ajax=function(e){function t(){function t(t){t=OSjs.API._("ERR_UTILS_XHR_FMT",t),e.onerror(t,n,this,e.url)}var n;if(4===this.readyState){n=this.responseText;try{var i=this.getResponseHeader("content-type")||"";e.json&&i.match(/^application\/json/)&&(n=JSON.parse(this.responseText))}catch(e){return void t.call(this,e.toString())}200===this.status||201===this.status?e.onsuccess(n,this,e.url):t.call(this,String(this.status))}}function n(){i.upload?i.upload.removeEventListener("progress",e.onprogress,!1):i.removeEventListener("progress",e.onprogress,!1),i.removeEventListener("error",e.onfailed,!1),i.removeEventListener("abort",e.oncanceled,!1),i.onerror=null,i.onload=null,i.onreadystatechange=null,i.ontimeut=null,i=null,e=null}var i;return e=OSjs.Utils.argumentDefaults(e,{onerror:function(){},onsuccess:function(){},onprogress:function(){},oncreated:function(){},onfailed:function(){},oncanceled:function(){},ontimeout:function(){},acceptcodes:[200,201,304],method:"GET",responseType:null,requestHeaders:{},body:null,timeout:0,json:!1,url:"",jsonp:!1}),"standalone"===OSjs.API.getConfig("Connection.Type")?(e.onerror("You are currently running locally and cannot perform this operation!",null,i,e.url),!1):(!e.json||"string"==typeof e.body||e.body instanceof FormData||(e.body=JSON.stringify(e.body),void 0===e.requestHeaders["Content-Type"]&&(e.requestHeaders["Content-Type"]="application/json")),e.jsonp?function(){var t=!1;OSjs.Utils.$createJS(e.url,function(){"complete"!==this.readyState&&"loaded"!==this.readyState||t||(t=!0,e.onsuccess())},function(){t||(t=!0,e.onsuccess())},function(){t||(t=!0,e.onerror())})}():function(){i=new XMLHttpRequest;try{i.timeout=e.timeout}catch(e){}i.upload?i.upload.addEventListener("progress",e.onprogress,!1):i.addEventListener("progress",e.onprogress,!1),i.ontimeout=function(t){e.ontimeout(t)},"arraybuffer"===e.responseType?(i.onerror=function(t){var o=i.response||OSjs.API._("ERR_UTILS_XHR_FATAL");e.onerror(o,t,i,e.url),n()},i.onload=function(t){if(!(e.acceptcodes.indexOf(i.status)>=0))return void OSjs.VFS.Helpers.abToText(i.response,"text/plain",function(o,r){var a=r||o||OSjs.API._("ERR_UTILS_XHR_FATAL");e.onerror(a,t,i,e.url),n()});e.onsuccess(i.response,i,e.url),n()}):(i.addEventListener("error",e.onfailed,!1),i.addEventListener("abort",e.oncanceled,!1),i.onreadystatechange=t),i.open(e.method,e.url,!0),Object.keys(e.requestHeaders).forEach(function(t){i.setRequestHeader(t,e.requestHeaders[t])}),i.responseType=e.responseType||"",e.oncreated(i),i.send(e.body)}())},function(){var e={},t={};OSjs.Utils.preload=function(){function n(t,n){return!(!t||!0!==e[t.src]||!0===t.force||!0===n.force)}function i(e){return e.match(/\.js$/i)?"javascript":e.match(/\.css$/i)?"stylesheet":"unknown"}function o(e){return{script:"javascript",js:"javascript",style:"stylesheet",css:"stylesheet"}[e]||e}function r(e,t,r,s){s=s||{},t=t||function(){},r=r||function(){};var u=[],c=[],l=e.length,d=0;e=(e||[]).map(function(e){"string"==typeof e&&(e={src:e});var t=e.src;return t.match(/^(\/|file|https?)/)||(t=OSjs.API.getBrowserPath(e.src)),e._src=t,e.src=t,e.type=e.type?o(e.type):i(e.src),e});var f=[];OSjs.Utils.asyncp(e,{max:s.max||1},function(e,t,i){function o(n,o,a){d++,(n?u:c).push(o),r(t,l,o,u,c,d),a&&f.push({item:e,data:a}),i()}if(e){if(n(e,s))return o(!0,e.src);if(a[e.type])return a[e.type](e,o,s);c.push(e.src)}return i()},function(){t(l,c,u,f)})}var a={stylesheet:function(t,n){function i(t){o=clearTimeout(o),a||(e[r]=!0,a=!0,n(t,r))}var o,r=t.src,a=!1;if(OSjs.Utils.$createCSS(r,function(){i(!0)},function(){i(!1)}),void 0===document.styleSheet||!a&&function(e){var t=!1;return(document.styleSheet||[]).forEach(function(n,i){return-1===n.href.indexOf(e)||(t=!0,!1)}),t}(r))return void i(!0);o=setTimeout(function(){i(!1)},3e4)},javascript:function(t,n){function i(t){r||(e[o]=!0,r=!0,n(t,o))}var o=t.src,r=!1;OSjs.Utils.$createJS(o,function(){"complete"!==this.readyState&&"loaded"!==this.readyState||i(!0)},function(){i(!0)},function(){i(!1)},{async:!1})},scheme:function(e,n,i){function o(n,i){!n&&i&&(t[e.src]=i)}function r(){s=null,n.apply(null,arguments)}var s;t[e.src]&&!0!==e.force&&!0!==i.force?(s=new OSjs.GUI.Scheme,s.loadString(t[e.src]),r(!0,e.src,s)):OSjs.API.isStandalone()?(s=new OSjs.GUI.Scheme,a.javascript({src:OSjs.Utils.pathJoin(OSjs.Utils.dirname(e.src),"_scheme.js"),type:"javascript"},function(){var t=e.src.replace(OSjs.API.getBrowserPath(),"/").replace(/^\/?packages/,""),n=OSjs.STANDALONE.SCHEMES[t];s.loadString(n),o(!1,n),r(!0,e.src,s)})):(s=new OSjs.GUI.Scheme(e.src),s.load(function(t,n){r(!t,e.src,s)},function(e,t){o(e,t)}))}};return r}(),OSjs.Utils._clearPreloadCache=function(){e={},t={}}}()}(),function(){"use strict";OSjs.Utils.getPathFromVirtual=function(e){return e=e||"",(e.split(/([A-z0-9\-_]+)\:\/\/(.*)/)[2]||"").replace(/^\/?/,"/")},OSjs.Utils.getPathProtocol=function(e){var t=document.createElement("a");return t.href=e,t.protocol.replace(/:$/,"")},OSjs.Utils.filext=function(e){var t=OSjs.Utils.filename(e).split(".").pop();return t?t.toLowerCase():null},OSjs.Utils.dirname=function(e){return e.match(/^((.*)\:\/\/)?\/$/)?e:function(e){var t=e.split(/^(.*)\:\/\/(.*)/).filter(function(e){return""!==e}),n=t.pop(),i=t.pop(),o="",r=n.split("/").filter(function(e){return""!==e});return r.length&&r.pop(),o=r.join("/"),o.match(/^\//)||(o="/"+o),i&&(o=i+"://"+o),o}(e.replace(/\/$/,""))},OSjs.Utils.filename=function(e){return(e||"").replace(/\/$/,"").split("/").pop()},OSjs.Utils.humanFileSize=function(e,t){var n=t?1e3:1024;if(e<n)return e+" B";var i=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],o=-1;do{e/=n,++o}while(e>=n);return e.toFixed(1)+" "+i[o]},OSjs.Utils.escapeFilename=function(e){return(e||"").replace(/[\|&;\$%@"<>\(\)\+,\*\/]/g,"").trim()},OSjs.Utils.replaceFileExtension=function(e,t){var n=e.split(".");return n.pop(),n.push(t),n.join(".")},OSjs.Utils.replaceFilename=function(e,t){var n=e.split("/");return n.pop(),n.push(t),n.join("/")},OSjs.Utils.pathJoin=function(){for(var e=[],t="",n=0;n<arguments.length;n++){var i=function(e){if(e.match(/^([A-z0-9\-_]+)\:\//)){var n=e.split(":/");t||(t=n[0]+"://"),e=n[1]||""}return e=e.replace(/^\/+/,"").replace(/\/+$/,""),e.split("/").filter(function(e){return-1===["",".",".."].indexOf(e)}).join("/")}(String(arguments[n]));i&&e.push(i)}return t+e.join("/").replace(/^\/?/,"/")},OSjs.Utils.getFilenameRange=function(e){e=e||"";var t={min:0,max:e.length};if(e.match(/^\./))e.length>=2&&(t.min=1);else if(e.match(/\.(\w+)$/))for(var n=e.split(/\.(\w+)$/),i=n.length-1;i>=0;i--)if(n[i].length){t.max=e.length-n[i].length-1;break}return t},OSjs.Utils.btoaUrlsafe=function(e){return e&&e.length?btoa(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""):""},OSjs.Utils.atobUrlsafe=function(e){return e&&e.length?(e=(e+"===").slice(0,e.length+e.length%4),atob(e.replace(/-/g,"+").replace(/_/g,"/"))):""},OSjs.Utils.btoaUtf=function(e){return e=(window.unescape||function(e){function t(e,t){return String.fromCharCode(parseInt(t,16))}return e.replace(/%([0-9A-F]{2})/i,t)})(encodeURIComponent(e)),btoa(e)},OSjs.Utils.atobUtf=function(e){var t=window.escape||function(e){function t(e){return e=e.charCodeAt(),"%"+(e<16?"0":"")+e.toString(16).toUpperCase()}return e.replace(/[\x00-),:-?[-^`{-\xFF]/g,t)},n=t(atob(e));return decodeURIComponent(n)},OSjs.Utils.checkAcceptMime=function(e,t){if(e&&t.length)for(var n,i=0;i<t.length;i++)if(n=new RegExp(t[i]),!0===n.test(e))return!0;return!1}}(),function(e,t,n,i){"use strict";i.Helpers=i.Helpers||{};var o;i.Helpers.getWindowId=function(e){for(;e.parentNode;){var t=e.getAttribute("data-window-id");if(null!==t)return parseInt(t,10);e=e.parentNode}return null},i.Helpers.getLabel=function(e){return e.getAttribute("data-label")||""},i.Helpers.getValueLabel=function(e,n){var i=n?e.getAttribute("data-label"):null;return e.childNodes.length&&3===e.childNodes[0].nodeType&&e.childNodes[0].nodeValue&&(i=e.childNodes[0].nodeValue,t.$empty(e)),i||""},i.Helpers.getViewNodeValue=function(e){var t=e.getAttribute("data-value");if("string"==typeof t&&t.match(/^\[|\{/))try{t=JSON.parse(t)}catch(e){t=null}return t},i.Helpers.getIcon=function(t,n){var i=t.getAttribute("data-icon");if(i&&"undefined"!==i){if(i.match(/^stock:\/\//)){i=i.replace("stock://","");var o="16x16";try{var r=i.split("/"),a=r.shift(),s=a.match(/^\d+x\d+/);s&&(o=s[0],i=r.join("/")),i=e.getIcon(i,o)}catch(e){}}else i.match(/^app:\/\//)&&(i=e.getApplicationResource(n._app,i.replace("app://","")));return i}return null},i.Helpers.getProperty=function(e,t,n){n=n||e.tagName.toLowerCase();var o=n.match(/^gui\-(tree|icon|list|file)\-view$/);return"value"!==t||o?"value"!==t&&"selected"!==t||!o?e.getAttribute("data-"+t):i.Element.createFromNode(e).values():["gui-text","gui-password","gui-textarea","gui-slider","gui-select","gui-select-list"].indexOf(n)>=0?e.querySelector("input, textarea, select").value:["gui-checkbox","gui-radio","gui-switch"].indexOf(n)>=0?!!e.querySelector("input").checked:null},i.Helpers.setProperty=function(e,n,o,r){function a(t,n,i,r){i?t.setAttribute(n,n):t.removeAttribute(n),r&&e.setAttribute("aria-"+n,String(!0===o))}function s(e,t,n){if("object"==typeof n)try{n=JSON.stringify(o)}catch(e){}e.setAttribute(t,String(n))}r=r||e.tagName.toLowerCase();var u=e.children[0],c=["gui-slider","gui-text","gui-password","gui-textarea","gui-checkbox","gui-radio","gui-select","gui-select-list","gui-button"];if(function(){var u,l={readonly:function(){a(u,"readonly",o,!0)},disabled:function(){a(u,"disabled",o,!0)},value:function(){"gui-radio"!==r&&"gui-checkbox"!==r||(a(u,"checked",o),u.checked=!!o),u.value=o},label:function(){e.appendChild(u),t.$remove(e.querySelector("label")),i.Helpers.createInputLabel(e,r.replace(/^gui\-/,""),u,o)}};c.indexOf(r)>=0&&(u=e.querySelector("textarea, input, select, button"))&&(l[n]?l[n]():s(u,n,o||""))}(),c=["gui-image","gui-audio","gui-video"],["src","controls","autoplay","alt"].indexOf(n)>=0&&c.indexOf(r)>=0&&(u[n]=o),["_id","_class","_style"].indexOf(n)>=0)return void u.setAttribute(n.replace(/^_/,""),o);"value"!==n&&s(e,"data-"+n,o)},i.Helpers.createInputLabel=function(e,t,n,o){if(o=o||i.Helpers.getLabel(e)){var r=document.createElement("label"),a=document.createElement("span");a.appendChild(document.createTextNode(o)),"checkbox"===t||"radio"===t?(r.appendChild(n),r.appendChild(a)):(r.appendChild(a),r.appendChild(n)),e.appendChild(r)}else e.appendChild(n)},i.Helpers.createElement=function(e,n,i){function o(e,t){if("boolean"==typeof t)t=t?"true":"false";else if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){}return t}i=i||[];var r=document.createElement(e),a={textalign:function(e){t.$addClass(r,"gui-align-"+e)},className:function(e){t.$addClass(r,e)}};return"object"==typeof n&&Object.keys(n).forEach(function(e){if(!(i.indexOf(e)>=0)){var t=n[e];if(void 0!==t&&"function"!=typeof t){if(a[e])return void a[e](t);var s=o(e,t);r.setAttribute("data-"+e,s)}}}),r},i.Helpers.setFlexbox=function(e,n,i,o,r){r=r||e,function(){void 0!==o&&null!==o||(o=r.getAttribute("data-basis")||"auto")}(),function(){void 0!==n&&null!==n||(n=r.getAttribute("data-grow")||0)}(),function(){void 0!==i&&null!==i||(i=r.getAttribute("data-shrink")||0)}();var a=[n,i];o.length&&a.push(o);var s=a.join(" ");e.style.webkitBoxFlex=s,e.style.mozBoxFlex=s,e.style.webkitFlex=s,e.style.mozFlex=s,e.style.msFlex=s,e.style.oFlex=s,e.style.flex=s;var u=e.getAttribute("data-align");t.$removeClass(e,"gui-flex-align-start"),t.$removeClass(e,"gui-flex-align-end"),u&&t.$addClass(e,"gui-flex-align-"+u)},OSjs.GUI.Helpers.createDrag=function(e,n,i,o){function r(e,t,n){if(e.preventDefault(),f){l=t.x,d=t.y;i(e,{x:l-u,y:d-c},{x:l,y:d})}}function a(e,n,i){o(e,{x:l,y:d}),f=!1,t.$unbind(window,"mouseup:guidrag"),t.$unbind(window,"mousemove:guidrag")}function s(e,i,o){e.preventDefault(),u=i.x,c=i.y,n(e,{x:u,y:c}),f=!0,t.$bind(window,"mouseup:guidrag",a,!1),t.$bind(window,"mousemove:guidrag",r,!1)}n=n||function(){},i=i||function(){},o=o||function(){};var u,c,l,d,f=!1;t.$bind(e,"mousedown",s,!1)},i.Helpers.getNextElement=function(e,n,i){if(i){var o=function(){var e=["menu","menuitem","grid","gridcell","listitem"],n=[];return i.querySelectorAll(".gui-element").forEach(function(i){t.$hasClass(i,"gui-focus-element")||e.indexOf(i.getAttribute("role"))>=0||"true"===i.getAttribute("data-disabled")||i.offsetParent&&n.push(i)}),n}();if(o.length){var r=function(e,n){if(n){for(var i=n;i.parentNode;){if(t.$hasClass(i,"gui-element"))return i;i=i.parentNode}return null}return e[0]}(o,n),a=function(e,t){var n=-1;return t&&e.every(function(e,i){return e===t&&(n=i),-1===n}),n}(o,r);if(a>=0){var s=function(t,n,i){return i=e?i<=0?t.length-1:i-1:i>=t.length-1?0:i+1}(o,r,a);return function(e,t){var n=e[t];return n.tagName.match(/^GUI\-(BUTTON|TEXT|PASSWORD|SWITCH|CHECKBOX|RADIO|SELECT)/)&&(n=n.querySelectorAll("input, textarea, button, select")[0]),"GUI-FILE-VIEW"===n.tagName&&(n=n.children[0]),n}(o,s)}}}return null},i.Helpers.createDraggable=function(e,n){function i(e){return JSON.stringify({type:n.type,effect:n.effect,data:n.data,mime:n.mime})}function o(t){try{if(t.dataTransfer.effectAllowed=n.effect,n.dragImage&&"function"==typeof n.dragImage&&t.dataTransfer.setDragImage){var o=n.dragImage(t,e);if(o){var r=o.element,a=o.offset;document.body.appendChild(r),t.dataTransfer.setDragImage(r,a.x,a.y)}}t.dataTransfer.setData(n.mime,i(n.mime))}catch(e){e.stack}}n=OSjs.Utils.argumentDefaults(n,{type:null,effect:"move",data:null,mime:"application/json",dragImage:null,onStart:function(){return!0},onEnd:function(){return!0}}),OSjs.Utils.isIE()&&(n.mime="text"),e.setAttribute("draggable","true"),e.setAttribute("aria-grabbed","false"),t.$bind(e,"dragstart",function(e){return this.setAttribute("aria-grabbed","true"),this.style.opacity="0.4",e.dataTransfer&&o(e),n.onStart(e,this,n)},!1),t.$bind(e,"dragend",function(e){return this.setAttribute("aria-grabbed","false"),this.style.opacity="1.0",n.onEnd(e,this,n)},!1)},i.Helpers.createDroppable=function(e,n){function i(e,t){if(e===t)return!0;for(var n=10;e&&n>0;){if(e===t)return!0;e=e.parentNode,n--}return!1}function o(e,t){if(!e.dataTransfer)return!0;if(n.files){var i=e.dataTransfer.files;if(i&&i.length)return n.onFilesDropped(e,t,i,n)}try{var o=e.dataTransfer.getData(n.mime),r=JSON.parse(o);if(null===n.accept||n.accept===r.type)return n.onItemDropped(e,t,r,n)}catch(e){}return!1}function r(e,t){e.stopPropagation(),e.preventDefault();var i=o(e,t);return n.onDrop(e,t),i}n=OSjs.Utils.argumentDefaults(n,{accept:null,effect:"move",mime:"application/json",files:!0,onFilesDropped:function(){return!0},onItemDropped:function(){return!0},onEnter:function(){return!0},onOver:function(){return!0},onLeave:function(){return!0},onDrop:function(){return!0}}),OSjs.Utils.isIE()&&(n.mime="text"),e.setAttribute("aria-dropeffect",n.effect),t.$bind(e,"drop",function(e){return r(e,this)},!1),t.$bind(e,"dragenter",function(e){return n.onEnter.call(this,e,this,n)},!1),t.$bind(e,"dragover",function(t){return t.preventDefault(),!!i(t.target,e)&&(t.stopPropagation(),t.dataTransfer.dropEffect=n.effect,n.onOver.call(this,t,this,n))},!1),t.$bind(e,"dragleave",function(e){return n.onLeave.call(this,e,this,n)},!1)},OSjs.GUI.Helpers._menuSetActive=function(e){o=e},OSjs.GUI.Helpers._menuClickWrapper=function(e,n,i,o){var r=e.isTrusted?e.target:e.relatedTarget||e.target;if(r&&"LABEL"===r.tagName&&(r=r.parentNode),e.preventDefault(),r&&"GUI-MENU-ENTRY"===r.tagName){var a=r.querySelector("gui-menu"),s=!!a;(r.querySelector("input")||s)&&e.stopPropagation();try{s&&(r.parentNode.querySelectorAll("gui-menu-entry").forEach(function(e){t.$removeClass(e,"active")}),t.$addClass(r,"active"))}catch(e){}i(e,n,r,o)}},OSjs.GUI.Helpers._menuClamp=function(e){function n(e){e.querySelectorAll("gui-menu-entry").forEach(function(e){var t=e.querySelector("gui-menu");t&&(t.style.left=String(-parseInt(t.offsetWidth,10))+"px",n(t))})}var i=t.$position(e);i&&window.innerWidth-i.right<e.offsetWidth&&(t.$addClass(e,"gui-overflowing"),n(e)),t.$addClass(e,"gui-showing")},OSjs.GUI.Helpers.blurMenu=function(t){o&&o(t),o=null,e.triggerHook("onBlurMenu")},OSjs.GUI.Helpers.createMenu=function(e,n,r){function a(e,t){e.forEach(function(e){var n={label:e.title,icon:e.icon,disabled:e.disabled,labelHTML:e.titleHTML,type:e.type,checked:e.checked},o=i.Helpers.createElement("gui-menu-entry",n);if(e.menu){var r=i.Helpers.createElement("gui-menu",{});a(e.menu,r),o.appendChild(r)}if(e.onClick){var s=u.push(e.onClick);o.setAttribute("data-callback-id",String(s-1))}t.appendChild(o)})}e=e||[],OSjs.GUI.Helpers.blurMenu(n);var s=r,u=[];s||(s=i.Helpers.createElement("gui-menu",{}),a(e||[],s),i.Element.createFromNode(s,null,"gui-menu").build(!0),t.$bind(s,"mousedown",function(e,t){OSjs.GUI.Helpers._menuClickWrapper(e,t,function(e,t,n){var i=parseInt(n.getAttribute("data-callback-id"),10);u[i]&&(u[i](e,t),OSjs.GUI.Helpers.blurMenu(e))})},!0),t.$bind(s,"touchstart",function(e){e.preventDefault()},!0)),s.$element&&(s=s.$element);var c=OSjs.Core.getWindowManager(),l=c.getWindowSpace(!0),d=t.mousePosition(n);t.$addClass(s,"gui-root-menu"),s.style.left=d.x+"px",s.style.top=d.y+"px",document.body.appendChild(s),setTimeout(function(){var e=t.$position(s);if(e){if(e.right>l.width){var n=Math.round(l.width-e.width);s.style.left=Math.max(0,n)+"px"}if(e.bottom>l.height){var i=Math.round(l.height-e.height);s.style.top=Math.max(0,i)+"px"}}OSjs.GUI.Helpers._menuClamp(s)},1),o=function(){u=null,s&&(s.querySelectorAll("gui-menu-entry").forEach(function(e){t.$unbind(e)}),t.$unbind(s)),s=t.$remove(s)}}}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i){"use strict";function o(e,t,n){if(e)for(var i=e.children,o=0;i.length&&o<1e4;)n?t.parentNode.insertBefore(i[0],t):t.appendChild(i[0]),o++}function r(e,n){if(e)for(var i=!0;i;)i=function(){var i=n.querySelectorAll("gui-fragment");return!!i.length&&(i.forEach(function(n){var i=n.getAttribute("data-fragment-id");if(i){var r=e.getFragment(i,"application-fragment");r&&o(r.cloneNode(!0),n.parentNode)}t.$remove(n)}),!0)}()}function a(e){for(var t=(e||"").split("/>"),n="",i=0;i<t.length-1;i++){var o=t[i].split("<");n+=t[i]+"></"+o[o.length-1].split(" ")[0]+">"}return n+t[t.length-1]}function s(e){return t.cleanHTML(a(e))}function u(e,n,i){var r=document.createElement("div");r.innerHTML=n;var a=r.querySelectorAll("gui-fragment[data-fragment-external]");t.asyncs(a.map(function(e){return{element:e,uri:e.getAttribute("data-fragment-external")}}),function(n,i,r){var a=n.uri.replace(/^\//,"");if(a.length<3)return void r();t.ajax({url:t.pathJoin(e,a),onsuccess:function(e){var t=document.createElement("div");t.innerHTML=s(e),o(t,n.element,n.element),t=r()},onerror:function(){r()}})},function(){i(r.innerHTML),r=null,a=null})}function c(e){this.url=e,this.scheme=null,this.triggers={render:[]}}function l(e){return new c(e)}c.prototype.destroy=function(){t.$empty(this.scheme),this.scheme=null,this.triggers={}},c.prototype.on=function(e,t){this.triggers[e].push(t)},c.prototype._trigger=function(e,t){t=t||[];var n=this;this.triggers[e]&&this.triggers[e].forEach(function(e){e.apply(n,t)})},c.prototype._load=function(t,n){var o=document.createDocumentFragment(),r=document.createElement("div");r.innerHTML=t,o.appendChild(r),this.scheme=o.cloneNode(!0),e.getConfig("DebugScheme")&&this.scheme.querySelectorAll("*").forEach(function(e){var t=e.tagName.toLowerCase(),n=i.Element.getRegisteredElement(t);if(n){var o=n.metadata.allowedChildren;if(o instanceof Array&&o.length){
e.children.map(function(e){return e.tagName.toLowerCase()}).forEach(function(t,n){-1===o.indexOf(t)&&e.children[n]})}var r=n.metadata.allowedParents;if(r instanceof Array&&r.length){var a=e.parentNode.tagName.toLowerCase();-1===r.indexOf(a)&&e.parentNode}}}),r=null,o=null},c.prototype.loadString=function(e,t){this._load(s(e),"<html>"),t&&t(!1,this.scheme)},c.prototype.load=function(n,i){i=i||function(){},this.url;var o=this,r=this.url;"/"===r.substr(0,1)||r.match(/^(https?|ftp)/)||(r=e.getBrowserPath(r));var a=t.dirname(r);t.ajax({url:r,onsuccess:function(e){e=s(e),u(a,e,function(e){i(!1,e),o._load(e,r),n(!1,o.scheme)})},onerror:function(){n("Failed to fetch scheme"),i(!0)}})},c.prototype.getFragment=function(e,t){var n=null;return e&&(n=t?this.scheme.querySelector(t+'[data-id="'+e+'"]'):this.scheme.querySelector('application-window[data-id="'+e+'"]')||this.scheme.querySelector('application-fragment[data-id="'+e+'"]')),n},c.prototype.parse=function(e,t,n,o,a){var s=this.getFragment(e,t);if(!s)return console.error("UIScheme::parse()","No fragment found",e+"@"+t),null;if(t=t||s.tagName.toLowerCase(),a=a||{},s){var u=s.cloneNode(!0);return!1!==a.resolve&&r(this,u),i.Element.parseNode(n,u,t,a,o,e),u}return null},c.prototype.render=function(e,n,r,a,s,u){(r=r||e._getRoot())instanceof i.Element&&(r=r.$element),o(this.parse(n,a,e,s,u),r),r.querySelectorAll("application-fragment").forEach(function(e){t.$remove(e)}),e._restored||function(t){if(t){var n=parseInt(t.getAttribute("data-width"),10)||0,i=parseInt(t.getAttribute("data-height"),10)||0,o=t.getAttribute("data-allow_maximize"),r=t.getAttribute("data-allow_minimize"),a=t.getAttribute("data-allow_close"),s=t.getAttribute("data-allow_resize");(!isNaN(n)&&n>0||!isNaN(i)&&i>0)&&e._resize(n,i),e._setProperty("allow_maximize",o),e._setProperty("allow_minimize",r),e._setProperty("allow_close",a),e._setProperty("allow_resize",s)}}(this.getFragment(n)),this._trigger("render",[r])},c.prototype.create=function(e,t,n,o,r){return e?e._create(t,n,o,r):i.Element.createInto(t,n,o,r)},c.prototype.find=function(e,t,n){return e._find(t,n)},c.prototype.findByQuery=function(e,t,n,i){return e._findByQuery(t,n,i)},c.prototype.findDOM=function(e,t,n){return e._findDOM(t,n)},c.prototype.getHTML=function(){return this.scheme.firstChild.innerHTML};var d=function(){var t;return{get:function(){return t},destroy:function(){t&&t.destroy(),t=null},init:function(n){if(t)return void n();if(OSjs.API.isStandalone()){var o=OSjs.STANDALONE.SCHEMES["/dialogs.html"];return t=new OSjs.GUI.Scheme,t.loadString(o),void n()}var r=e.getConfig("Connection.RootURI"),a=r+"dialogs.html";t=i.createScheme(a),t.load(function(e){n()})}}}();i.Scheme=Object.seal(c),i.DialogScheme=d,i.createScheme=l}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i){"use strict";function o(e){var t={"gui-switch":"button","gui-list-view":"textarea","gui-tree-view":"textarea","gui-icon-view":"textarea","gui-input-modal":"button"};return t[e.tagName]?e.$element.querySelector(t[e.tagName]):e.$element.firstChild||e.$element}function r(t,n,o){o=o||{};var r=o._||e._;t.querySelectorAll("*[data-label]").forEach(function(e){var t=r(e.getAttribute("data-label"));e.setAttribute("data-label",t)}),t.querySelectorAll("gui-label, gui-button, gui-list-view-column, gui-select-option, gui-select-list-option").forEach(function(e){if(!e.children.length&&!e.getAttribute("data-no-translate")){var t=i.Helpers.getValueLabel(e);e.appendChild(document.createTextNode(r(t)))}}),t.querySelectorAll("gui-button").forEach(function(t){var n=i.Helpers.getValueLabel(t);n&&t.appendChild(document.createTextNode(e._(n)))}),t.querySelectorAll("*[data-icon]").forEach(function(e){var t=i.Helpers.getIcon(e,n);e.setAttribute("data-icon",t)}),t.querySelectorAll("*[data-src]").forEach(function(t){var i=t.getAttribute("data-src")||"";if(n._app&&i.match(/^app:\/\//)){var o=e.getApplicationResource(n._app,i.replace("app://",""));t.setAttribute("data-src",o)}})}function a(e,t,n,i){e=e||t.tagName.toLowerCase();var o;return u[e]&&(o=new u[e].component(t,n),i&&o.build.apply(o,i)),o}function s(e,t){this.$element=e||null,this.tagName=e?e.tagName.toLowerCase():null,this.oldDisplay=null}var u={};s.prototype.build=function(){return this},s.prototype.remove=function(){return this.$element=t.$remove(this.$element),this},s.prototype.empty=function(){return t.$empty(this.$element),this},s.prototype.blur=function(){if(this.$element){var e=o(this);e&&e.blur()}return this},s.prototype.focus=function(){if(this.$element){var e=o(this);e&&e.focus()}return this},s.prototype.show=function(){return this.$element&&!this.$element.offsetParent&&this.$element&&(this.$element.style.display=this.oldDisplay||""),this},s.prototype.hide=function(){return this.$element&&this.$element.offsetParent&&(this.oldDisplay||(this.oldDisplay=this.$element.style.display),this.$element.style.display="none"),this},s.prototype.on=function(e,t,n){return this},s.prototype.son=function(e,t,n,i){return this.on(e,function(){var e=Array.prototype.slice.call(arguments);e.unshift(this),n.apply(t,e)},i)},s.prototype.set=function(e,t,n,o){return this.$element&&i.Helpers.setProperty(this.$element,e,t,n,o),this},s.prototype.get=function(e){return this.$element?i.Helpers.getProperty(this.$element,e):null},s.prototype.append=function(e){e instanceof s?e=e.$element:"string"!=typeof e&&"number"!=typeof e||(e=document.createTextNode(String(e)));var t=document.createElement("div");return t.appendChild(e),this._append(t),t=null,this},s.prototype.appendHTML=function(e,t,n){var i=document.createElement("div");return i.innerHTML=e,this._append(i,t,n)},s.prototype._append=function(e,t,n){for(e instanceof Element&&s.parseNode(t,e,null,n);e.childNodes.length;)this.$element.appendChild(e.childNodes[0]);return e=null,this},s.prototype.querySelector=function(e,t){var n=this.$element.querySelector(e);return t?i.Element.createFromNode(n,e):n},s.prototype.querySelectorAll=function(e,t){var n=this.$element.querySelectorAll(e);return t&&(n=n.map(function(t){return i.Element.createFromNode(t,e)})),n},s.prototype.css=function(e,n){return t.$css(this.$element,e,n),this},s.prototype.position=function(){return t.$position(this.$element)},s.prototype._call=function(e,t,n){arguments.length;try{return"function"==typeof this._call?this._call(e,t):this[e](t)}catch(e){e.stack}return null},s.prototype.fn=function(e,t,n){return t=t||[],n=n||this,this.fn(e,t,n)},s.createInto=function(e,t,n,o,r){n instanceof i.Element&&(n=n.$element);var a=i.Element.create(e,t,o,r);return n.appendChild(a.$element),a},s.createFromNode=function(e,t,n){if(e){var o=a(null,e,t);if(o)return o}return new i.Element(e,t)},s.create=function(e,t,n,o){return e=e||"",n=n||{},t=t||{},a(null,i.Helpers.createElement(e,t),null,[n,o])},s.createInstance=function(e,t,n){return this.createFromNode(e,t,n)},s.parseNode=function(e,n,i,o,s,c){s=s||function(){},o=o||{},i=i||"snipplet",n.querySelectorAll("*").forEach(function(e){var n=e.tagName.toLowerCase();n.match(/^gui\-/)&&!n.match(/(\-container|\-(h|v)box|\-columns?|\-rows?|(status|tool)bar|(button|menu)\-bar|bar\-entry)$/)&&t.$addClass(e,"gui-element")}),r(n,e,o),s(n),Object.keys(u).forEach(function(e){n.querySelectorAll(e).forEach(function(n){if(!n._wasParsed&&!t.$hasClass(n,"gui-data-view")){try{a(e,n,null,[])}catch(e){e.stack}n._wasParsed=!0}})})},s.register=function(e,n){var o=e.tagName;if(u[o])throw new Error('GUI Element "'+o+'" already exists');var r=e.parent||i.Element,a=t.inherit(r,null,n);u[o]=function(){var n=t.argumentDefaults(t.cloneObject(e,!0),{type:"element",allowedChildren:[],allowedParents:[]});return n.parent&&delete n.parent,"input"===n.type?n.allowedChildren=!0:"container"!==n.type&&(n.allowedChildren=!1),{metadata:n,component:a}}()},s.getRegisteredElement=function(e){return u[e]},i.Element=Object.seal(s)}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i){"use strict";function o(e){"string"!=typeof e&&(e=e.tagName.toLowerCase());var t=d[e];return t||(t=e+"-entry"),t}function r(e,t){var n=e.isTrusted?e.target:e.relatedTarget||e.target,i=n.tagName.toLowerCase();return i.match(/(view|textarea|body)$/)?null:"gui-list-view-column"!==i||t?n:n.parentNode}function a(e,t){return(t=t||r(e))&&"GUI-LIST-VIEW-HEAD"===t.parentNode.tagName}function s(e,n,i,r,s,u,c){if(u=u||n.parentNode,a(null,n))return c?[]:null;if(-1===i)u.querySelectorAll(o(u)).forEach(function(e){t.$removeClass(e,"gui-active")}),s=[];else{c&&e.shiftKey||(u.querySelectorAll(r).forEach(function(e){t.$removeClass(e,"gui-active")}),s=[]);var l=s.indexOf(i);l>=0?(s.splice(l,1),t.$removeClass(n,"gui-active")):(s.push(i),t.$addClass(n,"gui-active"))}return s.sort(function(e,t){return e-t}),s}function u(i,r,a){function u(){var e=g[S];e&&(r._selected=s(a,e,S,p,v,h,a.shiftKey),i.scrollIntoView(e))}function c(){var e=0,t=-1;return g.forEach(function(n){return-1===t&&(t=n.offsetTop),t===n.offsetTop&&(t=n.offsetTop,e++,!0)}),e}var l={},d=a.keyCode,f=r.tagName.toLowerCase(),p=o(f),h=r.querySelector(f+"-body"),g=h.querySelectorAll(p),m=g.length;if(m){if(d===t.Keys.ENTER)return void r.dispatchEvent(new CustomEvent("_activate",{detail:{entries:i.values()}}));l[t.Keys.C]=function(t){if(t.ctrlKey){var o=i.values();if(o&&o.length){var r=[];o.forEach(function(e){e&&e.data&&r.push(new n.File(e.data.path,e.data.mime))}),e.setClipboard(r)}}};var v=r._selected.concat()||[],_=v.length?v[0]:0,y=v.length>1?v[v.length-1]:_,S=0;!function(){function e(){S=Math.min(y+1,m),u()}function n(){S=Math.max(0,_-1),u()}"gui-tree-view"===f||"gui-list-view"===f?(l[t.Keys.UP]=n,l[t.Keys.DOWN]=e):(l[t.Keys.UP]=function(){S=Math.max(0,_-c()),u()},l[t.Keys.DOWN]=function(){S=Math.max(y,y+c()),u()},l[t.Keys.LEFT]=n,l[t.Keys.RIGHT]=e),l[d]&&l[d](a)}()}}function c(e){var t=e.getAttribute("data-value");try{return JSON.parse(t)}catch(e){}return t}function l(e,t,n,i){var o=e.getAttribute("data-value");if(!(n||t!==i&&t!==o))return e;try{var r=JSON.parse(o);if("object"==typeof r[n]?r[n]===t:String(r[n])===String(t))return e}catch(e){}return!1}var d={"gui-list-view":"gui-list-view-row"},f=t.inherit(i.Element,null,{clear:function(e){var n=this.$element;return arguments.length||(e=n),n.querySelectorAll(o(n)).forEach(function(e){t.$unbind(e)}),t.$empty(e),e.scrollTop=0,n._selected=[],this},add:function(e,t){t=t||function(){},e instanceof Array||(e=[e]);var n=this;return e.forEach(function(e){t(n,e)}),this},patch:function(e,n,o,r,a){var s=this,u=!1,c=i.DataView.prototype.remove;e instanceof Array||(e=[e],u=!0);var l={};return o.querySelectorAll(n).forEach(function(e){var t=e.getAttribute("data-id");null!==t&&(l[t]=e)}),e.forEach(function(e){var i;if(void 0!==e.id&&null!==e.id){l[e.id]&&(i=l[e.id],delete l[e.id]);var u=r(s,e);u&&(i?(t.$hasClass(i,"gui-active")&&t.$addClass(u,"gui-active"),o.insertBefore(u,i),c.call(s,null,n,i,o)):o.appendChild(u),a(s,u))}}),u||Object.keys(l).forEach(function(e){c.call(s,null,n,l[e])}),l={},this.updateActiveSelection(n),this},remove:function(e,n,i,o){if(e=e||[],o=o||this.$element,i)t.$remove(i);else if(void 0===e[1]&&"number"==typeof e[0])t.$remove(o.querySelectorAll(n)[e[0]]);else{var r=e[0],a=e[1]||"id",s="data-"+a+'="'+r+'"';o.querySelectorAll(n+"["+s+"]").forEach(t.$remove)}return this.updateActiveSelection(n),this},updateActiveSelection:function(e){var n=[];this.$element.querySelectorAll(e+".gui-active").forEach(function(e){n.push(t.$index(e))}),this.$element._active=n},scrollIntoView:function(e){var n=this.$element,i=t.$position(e,n),o=0;if("gui-list-view"===n.tagName.toLowerCase()){var r=n.querySelector("gui-list-view-head");r&&(o=r.offsetHeight)}var a=n.scrollTop+n.offsetHeight-o,s=n.scrollTop+o,u=i.top-o;return null!==i&&(u>a||u<s)&&(n.scrollTop=u,!0)},bindEntryEvents:function(e,t){var n=this.$element;n.dispatchEvent(new CustomEvent("_render",{detail:{element:e,data:i.Helpers.getViewNodeValue(e)}})),"true"===n.getAttribute("data-draggable")&&function(){var t=e.getAttribute("data-value");if(null!==t)try{t=JSON.parse(t)}catch(e){}var o=e.getAttribute("data-draggable-source");null===o&&null!==(o=i.Helpers.getWindowId(n))&&(o={wid:o}),i.Helpers.createDraggable(e,{type:n.getAttribute("data-draggable-type")||e.getAttribute("data-draggable-type"),source:o,data:t});var r=e.getAttribute("data-tooltip");r&&!e.getAttribute("title")&&e.setAttribute("title",r)}()},getSelected:function(e){var n=[];return e.forEach(function(e,o){t.$hasClass(e,"gui-active")&&n.push({index:o,data:i.Helpers.getViewNodeValue(e)})}),n},getEntry:function(e,t,n,i){if(t){var o=null;return e.forEach(function(e,i){!o&&l(e,t,n,i)&&(o=e)}),i&&o?c(o):o}return i?(e||[]).map(function(e){return c(e)}):e},setSelected:function(e,n,i,o,r){function a(e,n){u.push(n),t.$addClass(e,"gui-active"),c&&s.scrollIntoView(e)}var s=this,u=[],c=!1,d=this.$element;"object"==typeof r&&(c=!0===r.scroll),n.forEach(function(e,n){t.$removeClass(e,"gui-active"),l(e,i,o,n)&&a(e,n)}),d._selected=u},build:function(n){function i(n){if(n.stopPropagation(),e.blurMenu(),p)return!1;var i=r(n);if(!i)return!1;var o=i.tagName.toLowerCase();if(a(null,i)){var u=r(n,!0);if(u){var c=u.getAttribute("data-sortby");if(c){var l=u.getAttribute("data-sortdir"),h="desc"===l;l="asc"===l?"desc":h?null:"asc",c=h?null:c,u.setAttribute("data-sortdir",l),f.setAttribute("data-sortby",c||""),f.setAttribute("data-sortdir",l||""),f.dispatchEvent(new CustomEvent("_sort",{detail:{sortDir:l,sortBy:c}}))}}return!1}if("gui-tree-view-expander"===o)return d.expand({ev:n,entry:i.parentNode}),!0;var m=t.$index(i);return f._selected=s(n,i,m,o,f._selected,f,g),f.dispatchEvent(new CustomEvent("_select",{detail:{entries:d.values()}})),!0}function o(t){if(t.stopPropagation(),e.blurMenu(),!a(t)){if(h){if(!1===i(t))return}else if(!r(t))return;f.dispatchEvent(new CustomEvent("_activate",{detail:{entries:d.values()}}))}}function c(e){a(e)||(i(e),f.dispatchEvent(new CustomEvent("_contextmenu",{detail:{entries:d.values(),x:e.clientX,y:e.clientY}})))}function l(e){var t=e.target;p=t&&"GUI-LIST-VIEW-COLUMN-RESIZER"===t.tagName}var d=this,f=this.$element;f._selected=[],f.scrollTop=0,t.$addClass(f,"gui-data-view");var p=!1,h="true"===f.getAttribute("data-single-click"),g=f.getAttribute("data-multiple");if(g=null===g||"true"===g,!f.querySelector("textarea.gui-focus-element")&&!f.getAttribute("no-selection")){var m=document.createElement("textarea");m.setAttribute("aria-label",""),m.setAttribute("aria-hidden","true"),m.setAttribute("readonly","true"),m.className="gui-focus-element",t.$bind(m,"focus",function(e){e.preventDefault(),t.$addClass(f,"gui-element-focused")}),t.$bind(m,"blur",function(e){e.preventDefault(),t.$removeClass(f,"gui-element-focused")}),t.$bind(m,"keydown",function(e){e.preventDefault(),u(d,f,e)}),t.$bind(m,"keypress",function(e){e.preventDefault()}),t.$bind(f,"mousedown",l,!0),h?t.$bind(f,"click",o,!0):(t.$bind(f,"click",i,!0),t.$bind(f,"dblclick",o,!0)),t.$bind(f,"contextmenu",function(e){return e.preventDefault(),c(e),!1},!0),this.on("select",function(e){if(!t.$hasClass(f,"gui-element-focused")){var n=f.scrollTop;m.focus(),f.scrollTop=n,setTimeout(function(){f.scrollTop=n},2)}},!0),f.appendChild(m)}},focus:function(){try{this.$element.querySelector(".gui-focus-element").focus()}catch(e){e.stack}},blur:function(){try{this.$element.querySelector(".gui-focus-element").blur()}catch(e){e.stack}},values:function(){return[]},on:function(e,n,i){return-1!==["activate","select","expand","contextmenu","render","drop","sort"].indexOf(e)&&(e="_"+e),t.$bind(this.$element,e,n.bind(this),i),this}});i.DataView=Object.seal(f)}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i){"use strict";var o={on:function(e,n,i){var o=this.$element,r=o.querySelector("div");return t.$bind(r,e,n.bind(this),i),this},set:function(e,t){return"value"===e?(this.$element.firstChild.style.backgroundColor=t,this):i.Element.prototype.set.apply(this,arguments)},build:function(){var e=document.createElement("div");return this.$element.appendChild(e),this}},r={on:function(e,n,i){var o=this.$element,r=o.querySelector("canvas");return"select"!==e&&"change"!==e||(e="_change"),t.$bind(r,e,n.bind(this),i),this},build:function(){function e(e){var n=OSjs.Utils.$position(i),r=void 0===e.offsetX?e.clientX-n.left:e.offsetX,a=void 0===e.offsetY?e.clientY-n.top:e.offsetY;if(isNaN(r)||isNaN(a))return null;var s=o.getImageData(r,a,1,1).data;return{r:s[0],g:s[1],b:s[2],hex:t.convertToHEX(s[0],s[1],s[2])}}var n=this.$element,i=document.createElement("canvas");i.width=100,i.height=100;var o=i.getContext("2d"),r=o.createLinearGradient(0,0,o.canvas.width,0);return r.addColorStop(0,"rgb(255,   0,   0)"),r.addColorStop(.15,"rgb(255,   0, 255)"),r.addColorStop(.33,"rgb(0,     0, 255)"),r.addColorStop(.49,"rgb(0,   255, 255)"),r.addColorStop(.67,"rgb(0,   255,   0)"),r.addColorStop(.84,"rgb(255, 255,   0)"),r.addColorStop(1,"rgb(255,   0,   0)"),o.fillStyle=r,o.fillRect(0,0,o.canvas.width,o.canvas.height),r=o.createLinearGradient(0,0,0,o.canvas.height),r.addColorStop(0,"rgba(255, 255, 255, 1)"),r.addColorStop(.5,"rgba(255, 255, 255, 0)"),r.addColorStop(.5,"rgba(0,     0,   0, 0)"),r.addColorStop(1,"rgba(0,     0,   0, 1)"),o.fillStyle=r,o.fillRect(0,0,o.canvas.width,o.canvas.height),t.$bind(i,"click",function(t){var n=e(t);n&&i.dispatchEvent(new CustomEvent("_change",{detail:n}))},!1),n.appendChild(i),this}},a=function(){var t="iframe";return["nw","electron","x11"].indexOf(e.getConfig("Connection.Type"))>=0&&(t="webview"),{set:function(e,n){return"src"===e?(this.$element.querySelector(t).src=n,this):i.Element.prototype.set.apply(this,arguments)},build:function(){var e=this.$element,n=e.getAttribute("data-src")||"about:blank",i=document.createElement(t);return i.src=n,i.setAttribute("border",0),e.appendChild(i),this}}}(),s={set:function(e,t){var n=this.$element;return n.setAttribute("data-"+e,t),"progress"===e||"value"===e?(t=parseInt(t,10),t=Math.max(0,Math.min(100,t)),n.setAttribute("aria-label",String(t)),n.setAttribute("aria-valuenow",String(t)),n.querySelector("div").style.width=t.toString()+"%",n.querySelector("span").innerHTML=t+"%",this):i.Element.prototype.set.apply(this,arguments)},build:function(){var e=this.$element,t=e.getAttribute("data-progress")||0;t=Math.max(0,Math.min(100,t));var n=t.toString()+"%",i=document.createElement("div");i.style.width=n;var o=document.createElement("span");return o.appendChild(document.createTextNode(n)),e.setAttribute("role","progressbar"),e.setAttribute("aria-valuemin",0),e.setAttribute("aria-valuemax",100),e.setAttribute("aria-label",0),e.setAttribute("aria-valuenow",0),e.appendChild(i),e.appendChild(o),this}},u={set:function(e,n){if("label"===e||"value"===e){var o=this.$element.getElementsByTagName("gui-statusbar-label")[0];return o&&(t.$empty(o),o.innerHTML=n),this}return i.Element.prototype.set.apply(this,arguments)},build:function(e,t){var n=this.$element,i=document.createElement("gui-statusbar-label"),o=n.getAttribute("data-label")||n.getAttribute("data-value");return o||(o=function(){for(var e,t,i=[],o=0;o<n.childNodes.length;o++)e=n.childNodes[o],e.nodeType===Node.TEXT_NODE&&(t=e.nodeValue.replace(/\s+/g,"").replace(/^\s+/g,""),t.length>0&&i.push(t),n.removeChild(e),o++);return i.join(" ")}()),i.innerHTML=o,n.setAttribute("role","log"),n.appendChild(i),this}};i.Element.register({tagName:"gui-color-box"},o),i.Element.register({tagName:"gui-color-swatch"},r),i.Element.register({tagName:"gui-iframe"},a),i.Element.register({tagName:"gui-progress-bar"},s),i.Element.register({tagName:"gui-statusbar"},u)}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i){"use strict";function o(e,n){var i=e.getAttribute("data-id"),o=t.$index(e);n||(o=parseInt(e.getAttribute("data-index"),10));var r={index:o,id:i};return Array.prototype.slice.call(e.attributes).forEach(function(e){if(e.name.match(/^data\-/)){var t=e.name.replace(/^data\-/,"");void 0===r[t]&&(r[t]=e.value)}}),r}function r(e){return-1!==["select","click"].indexOf(e)?"_select":e}!function(){function e(e,t){var n=e.getAttribute("data-type"),i="true"===e.getAttribute("data-checked"),o=null;if(n){var r=e.getAttribute("data-group");o=document.createElement("input"),o.type=n,o.name=r?r+"[]":"",i&&o.setAttribute("checked","checked"),t.setAttribute("role","menuitem"+n),t.appendChild(o)}}i.Element.register({tagName:"gui-menu-entry"},{on:function(e,n,i){e=r(e);var o=this.$element.querySelector("gui-menu-entry > label");return t.$bind(o,e,n.bind(this),i),this},build:function(n,o){var r=this.$element;if(arguments.length<2)return this;r.setAttribute("role","menuitem"+(r.getAttribute("data-type")||""));var a=i.Helpers.getLabel(r),s=i.Helpers.getIcon(r,o);r.setAttribute("aria-label",a);var u=document.createElement("label");return s&&(r.style.backgroundImage="url("+s+")",t.$addClass(u,"gui-has-image")),r.appendChild(u),e(r,u),"true"===r.getAttribute("data-labelhtml")?u.innerHTML=a:u.appendChild(document.createTextNode(a)),r.querySelector("gui-menu")?(t.$addClass(r,"gui-menu-expand"),r.setAttribute("aria-haspopup","true")):r.setAttribute("aria-haspopup","false"),this}})}(),function(){function e(e,t,n,o){t=t||0,o=o||function(){},(e.children||[]).forEach(function(e,r){e&&"gui-menu-entry"===e.tagName.toLowerCase()&&(i.Element.createFromNode(e).build(null,n),o(e,t))})}function n(e,n,i,r){if(!i.querySelector("gui-menu")){OSjs.GUI.Helpers.blurMenu(e);var a=i.querySelector("input");if(a)if(!t.isIE()&&window.MouseEvent)a.dispatchEvent(new MouseEvent("click",{clientX:n.x,clientY:n.y}));else{var s=document.createEvent("MouseEvent");s.initMouseEvent("click",!0,!0,window,0,0,0,n.x,n.y,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,e.button,a)}(r||i).querySelector("label").dispatchEvent(new CustomEvent("_select",{detail:o(i,!0)}))}}i.Element.register({tagName:"gui-menu"},{on:function(e,n,o){return e=r(e),t.$bind(this.$element,e,function(e){var t=e.isTrusted?e.target:e.relatedTarget||e.target;"LABEL"===t.tagName&&n.apply(new i.Element(t.parentNode),arguments)},!0),this},show:function(e){e.stopPropagation(),e.preventDefault();var i=this.$element.cloneNode(!0),o=this.$element;OSjs.GUI.Helpers.createMenu(null,e,i),t.$bind(i,"click",function(e,t){OSjs.GUI.Helpers._menuClickWrapper(e,t,n,o)},!0)},set:function(e,t,n){if("checked"===e){var o=this.$element.querySelector('gui-menu-entry[data-id="'+t+'"]');if(o){var r=o.querySelector("input");r&&(n?r.setAttribute("checked","checked"):r.removeAttribute("checked"))}return this}return i.Element.prototype.set.apply(this,arguments)},build:function(i,o){var r=this.$element;return r.setAttribute("role","menu"),e(r,0,o,function(t,n){if(i&&t){t.getElementsByTagName("gui-menu").forEach(function(t){t&&e(t,n+1,o)})}}),i||t.$bind(r,"click",function(e,t){OSjs.GUI.Helpers._menuClickWrapper(e,t,n)},!0),this}})}(),i.Element.register({tagName:"gui-menu-bar"},{on:function(e,n,i){e=r(e);var o=this;return this.$element.querySelectorAll("gui-menu-bar-entry").forEach(function(r){t.$bind(r,e,n.bind(o),i)}),this},build:function(){function e(t,n){if(t&&t.children)for(var i,o=t.children,r=0;r<o.length;r++)i=o[r],"GUI-MENU-ENTRY"===i.tagName&&(i.setAttribute("aria-haspopup",String(!!i.firstChild)),e(i.firstChild,n+1))}function n(e,n){OSjs.GUI.Helpers.blurMenu(e),e.preventDefault(),e.stopPropagation();var i=n.querySelector("gui-menu");"true"!==n.getAttribute("data-disabled")&&(n.querySelectorAll("gui-menu-entry").forEach(function(e){t.$removeClass(e,"gui-hover")}),i&&OSjs.GUI.Helpers._menuSetActive(function(e){e&&e.stopPropagation(),t.$removeClass(n,"gui-active")}),t.$hasClass(n,"gui-active")?i&&t.$removeClass(n,"gui-active"):(i&&t.$addClass(n,"gui-active"),n.dispatchEvent(new CustomEvent("_select",{detail:o(n)}))))}var r=this.$element;return r.setAttribute("role","menubar"),r.querySelectorAll("gui-menu-bar-entry").forEach(function(t,n){var o=i.Helpers.getLabel(t),r=document.createElement("span");r.appendChild(document.createTextNode(o)),t.setAttribute("role","menuitem"),t.insertBefore(r,t.firstChild);var a=t.querySelector("gui-menu");OSjs.GUI.Helpers._menuClamp(a),t.setAttribute("aria-haspopup",String(!!a)),t.setAttribute("data-index",String(n)),e(a,2)}),t.$bind(r,"mousedown",function(e){e.preventDefault();var t=e.isTrusted?e.target:e.relatedTarget||e.target;t&&"GUI-MENU-BAR-ENTRY"===t.tagName&&n(e,t)},!0),this}})}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i){"use strict";function o(e,n,i){t.$removeClass(e,"gui-active"),n===i&&t.$addClass(e,"gui-active")}function r(e,n,i,r,a){n.querySelectorAll("li").forEach(function(e,t){o(e,t,r)}),e.querySelectorAll("gui-tab-container").forEach(function(e,t){o(e,t,r)}),t.$addClass(a,"gui-active"),e.dispatchEvent(new CustomEvent("_change",{detail:{index:r}}))}function a(e,t,n){var i=null;return"number"==typeof n?i=n:t.querySelectorAll("li").forEach(function(e,t){null===i&&e.firstChild.textContent===n&&(i=t)}),i}function s(e,t,n){var i=a(e,t,n);null!==i&&(t.children[i].remove(),e.querySelectorAll("gui-tab-container")[i].remove())}function u(e,n,i,o){var a=document.createElement("li"),s=n.children.length;if(t.$bind(a,"click",function(t){r(e,n,t,s,a)},!1),a.setAttribute("role","tab"),a.setAttribute("aria-label",i),a.appendChild(document.createTextNode(i)),n.appendChild(a),o){var u=document.createElement("gui-tab-container");u.setAttribute("data-label",i),u.setAttribute("role","tabpanel"),e.appendChild(u)}}var c={on:function(e,n,i){return-1!==["select","activate"].indexOf(e)&&(e="change"),"change"===e&&(e="_"+e),t.$bind(this.$element,e,n.bind(this),i),this},set:function(e,t){if(-1!==["current","selected","active"].indexOf(e)){var n=this.$element,o=n.querySelector("ul"),s=a(n,o,t);return null!==s&&r(n,o,null,s,o[s]),this}return i.Element.prototype.set.apply(this,arguments)},get:function(e,n){if(-1!==["current","selected","active"].indexOf(e)){var o=this.$element.querySelector('ul > li[class="gui-active"]');return t.$index(o)}return i.Element.prototype.get.apply(this,arguments)},add:function(e){var t=this.$element,n=t.querySelector("ul");return e instanceof Array||(e=[e]),e.forEach(function(e){u(t,n,e,!0)}),this},remove:function(e){var t=this.$element,n=t.querySelector("ul");return e instanceof Array||(e=[e]),e.forEach(function(e){s(t,n,e)}),this},build:function(){var e=this.$element,t=document.createElement("ul");e.querySelectorAll("gui-tab-container").forEach(function(n,o){u(e,t,i.Helpers.getLabel(n)),n.setAttribute("role","tabpanel")}),t.setAttribute("role","tablist"),e.setAttribute("role","navigation"),e.children.length?e.insertBefore(t,e.children[0]):e.appendChild(t);var n=parseInt(e.getAttribute("data-selected-index"),10)||0;return r(e,t,null,n),this}};i.Element.register({tagName:"gui-tabs"},c)}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i){"use strict";function o(n,o){function r(){["range","slider"].indexOf(o)>=0?(f.min=n.getAttribute("data-min"),f.max=n.getAttribute("data-max"),f.step=n.getAttribute("data-step")):["radio","checkbox"].indexOf(o)>=0?"true"===n.getAttribute("data-value")&&(f.checked="checked"):["text","password","textarea"].indexOf(o)>=0&&(f.value=l||""),Object.keys(f).forEach(function(e){null!==f[e]&&("value"===e?d.value=f[e]:d.setAttribute(e,f[e]))})}function a(){"text"!==o&&"password"!==o&&"textarea"!==o||t.$bind(d,"keydown",function(n){n.keyCode===t.Keys.ENTER?d.dispatchEvent(new CustomEvent("_enter",{detail:d.value})):n.keyCode===t.Keys.C&&n.ctrlKey&&e.setClipboard(d.value),"textarea"===o&&n.keyCode===t.Keys.TAB&&(n.preventDefault(),d.value+="\t")},!1)}var s=n.getAttribute("data-group"),u=n.getAttribute("data-placeholder"),c="true"===String(n.getAttribute("data-disabled")),l=n.childNodes.length?n.childNodes[0].nodeValue:null;t.$empty(n);var d=document.createElement("textarea"===o?"textarea":"input"),f={value:null,type:o,tabindex:-1,placeholder:u,disabled:c?"disabled":null,name:s?s+"[]":null};["autocomplete","autocorrect","autocapitalize","spellcheck"].forEach(function(e){f[e]=n.getAttribute("data-"+e)||"false"}),function(){r(),a(),i.Helpers.createInputLabel(n,o,d);var e={TEXTAREA:function(){return"textbox"},INPUT:function(e){return{range:"slider",text:"textbox",password:"textbox"}[e.type]||e.type}};e[n.tagName]&&d.setAttribute("role",e[n.tagName](d)),d.setAttribute("aria-label",n.getAttribute("title")||""),n.setAttribute("role","region"),n.setAttribute("aria-disabled",String(c)),t.$bind(d,"change",function(e){var t=d.value;"radio"!==o&&"checkbox"!==o||(t=d.checked),d.dispatchEvent(new CustomEvent("_change",{detail:t}))},!1)}()}function r(e,n,i){"enter"===e?e="_enter":"change"===e&&(e="_change");var o=this.$element.querySelector("textarea, input, select");return t.$bind(o,e,n.bind(this),i),this}function a(e,t){var n=e.querySelector("select");t instanceof Array||(t=[t]),t.forEach(function(e){var t=document.createElement("option");t.setAttribute("role","option"),t.setAttribute("value",e.value),t.appendChild(document.createTextNode(e.label)),n.appendChild(t)})}function s(e,n){e.querySelector("select").querySelectorAll("option").forEach(function(e){return String(e.value)!==String(n)||(t.$remove(e),!1)})}function u(e,n){var i=null!==e.getAttribute("data-disabled"),o=e.getAttribute("data-selected"),r=document.createElement("select");n&&(r.setAttribute("size",e.getAttribute("data-size")||2),n="true"===e.getAttribute("data-multiple")),n&&r.setAttribute("multiple","multiple"),i&&r.setAttribute("disabled","disabled"),null!==o&&(r.selectedIndex=o),e.querySelectorAll("gui-select-option").forEach(function(e){var t=e.getAttribute("data-value")||"",n=e.childNodes.length?e.childNodes[0].nodeValue:"",i=document.createElement("option");i.setAttribute("role","option"),i.setAttribute("value",t),i.appendChild(document.createTextNode(n)),e.getAttribute("selected")&&i.setAttribute("selected","selected"),r.appendChild(i),e.parentNode.removeChild(e)}),t.$bind(r,"change",function(e){r.dispatchEvent(new CustomEvent("_change",{detail:r.value}))},!1),r.setAttribute("role","listbox"),r.setAttribute("aria-label",e.getAttribute("title")||""),e.setAttribute("aria-disabled",String(i)),e.setAttribute("role","region"),e.appendChild(r)}function c(e,n,i){!0!==e?(n.removeAttribute("checked"),t.$removeClass(i,"gui-active"),i.innerHTML="0"):(n.setAttribute("checked","checked"),t.$addClass(i,"gui-active"),i.innerHTML="1")}var l=0,d={set:function(e,n,o){var r=this.$element;if("value"===e||"label"===e){r.setAttribute("data-label",String(n));var a=r.querySelector("label");return t.$empty(a),o?a.innerHTML=n:a.appendChild(document.createTextNode(n)),this}return i.Element.prototype.set.apply(this,arguments)},build:function(){var e=this.$element,t=i.Helpers.getValueLabel(e,!0),n=document.createElement("label");return n.appendChild(document.createTextNode(t)),e.setAttribute("role","heading"),e.setAttribute("data-label",String(t)),e.appendChild(n),this}},f={on:r,build:function(){return o(this.$element,"textarea"),this},set:function(e,t){var n=this.$element;return n&&"scrollTop"===e?("number"!=typeof t&&(t=n.firstChild.scrollHeight),n.firstChild.scrollTop=t,this):i.Element.prototype.set.apply(this,arguments)}},p={on:r,build:function(){return o(this.$element,"text"),this}},h={on:r,build:function(){return o(this.$element,"password"),this}},g={on:r,build:function(){var e=document.createElement("input");return e.setAttribute("role","button"),e.setAttribute("type","file"),e.onchange=function(t){e.dispatchEvent(new CustomEvent("_change",{detail:e.files[0]}))},this.$element.appendChild(e),this}},m={on:r,build:function(){return o(this.$element,"radio"),this}},v={on:r,build:function(){return o(this.$element,"checkbox"),this}},_={on:r,set:function(e,t){if("value"===e){return c(t,this.$element.querySelector("input"),this.$element.querySelector("button")),this}return i.Element.prototype.set.apply(this,arguments)},build:function(){function e(e){var t=!1;void 0===e?(t=!!o.checked,t=!t):t=e,c(t,o,a)}var n=this.$element,o=document.createElement("input");o.type="checkbox",n.appendChild(o);var r=document.createElement("div"),a=document.createElement("button");return r.appendChild(a),i.Helpers.createInputLabel(n,"switch",r),
t.$bind(r,"click",function(t){t.preventDefault(),null!==n.getAttribute("data-disabled")||e()},!1),e(!1),this}},y={set:function(e,n,o){if("value"===e||"label"===e){var r=this.$element.querySelector("button");return t.$empty(r),o?r.innerHTML=n:r.appendChild(document.createTextNode(n)),r.setAttribute("aria-label",n),this}return i.Element.prototype.set.apply(this,arguments)},create:function(e){var t=e.label;e.label&&delete e.label;var n=i.Helpers.createElement("gui-button",e);return t&&n.appendChild(document.createTextNode(t)),n},on:function(e,n,i){var o=this.$element.querySelector("button");return t.$bind(o,e,n.bind(this),i),this},build:function(){var n=this.$element,o=n.getAttribute("data-icon"),r=null!==n.getAttribute("data-disabled"),a=n.getAttribute("data-group"),s=i.Helpers.getValueLabel(n),u=document.createElement("button");return r&&u.setAttribute("disabled","disabled"),function(){s&&t.$addClass(n,"gui-has-label"),u.appendChild(document.createTextNode(s)),u.setAttribute("aria-label",s)}(),function(){if(o&&"null"!==o){var i=e._(n.getAttribute("data-tooltip")||""),r=document.createElement("img");r.src=o,r.alt=i,r.title=i,u.firstChild?u.insertBefore(r,u.firstChild):u.appendChild(r),t.$addClass(n,"gui-has-image")}}(),function(e){e&&(u.setAttribute("name",e+"["+l+"]"),t.$bind(u,"click",function(){for(var i=n;i.parentNode&&"application-window-content"!==i.tagName.toLowerCase();)i=i.parentNode;t.$addClass(u,"gui-active"),i.querySelectorAll('gui-button[data-group="'+e+'"] > button').forEach(function(e){e.name!==u.name&&t.$removeClass(e,"gui-active")})}))}(a),l++,n.setAttribute("role","navigation"),n.appendChild(u),this}},S={on:r,add:function(e){return a(this.$element,e),this},remove:function(e){return s(this.$element,e),this},clear:function(){var e=this.$element.querySelector("select");return t.$empty(e),this},build:function(){var e=this.$element;return u(e,"gui-select-list"===e.tagName.toLowerCase()),this}},w=S,b={on:r,get:function(e){var t=i.Helpers.getProperty(this.$element,e);return"value"===e?parseInt(t,10):t},build:function(){return o(this.$element,"range"),this}},O={on:function(e,n,i){return"open"===e&&(e="_open"),t.$bind(this.$element,e,n.bind(this),i),this},get:function(e){if("value"===e){return this.$element.querySelector("input").value}return i.Element.prototype.get.apply(this,arguments)},set:function(e,t){if("value"===e){var n=this.$element.querySelector("input");return n.removeAttribute("disabled"),n.value=t,n.setAttribute("disabled","disabled"),n.setAttribute("aria-disabled","true"),this}return i.Element.prototype.set.apply(this,arguments)},build:function(){var e=this.$element,n=document.createElement("div"),i=document.createElement("input");i.type="text",i.setAttribute("disabled","disabled");var o=document.createElement("button");return o.innerHTML="...",t.$bind(o,"click",function(t){e.dispatchEvent(new CustomEvent("_open",{detail:i.value}))},!1),n.appendChild(i),n.appendChild(o),e.appendChild(n),this}};i.Element.register({tagName:"gui-label"},d),i.Element.register({tagName:"gui-textarea",type:"input"},f),i.Element.register({tagName:"gui-text",type:"input"},p),i.Element.register({tagName:"gui-password",type:"input"},h),i.Element.register({tagName:"gui-file-upload",type:"input"},g),i.Element.register({tagName:"gui-radio",type:"input"},m),i.Element.register({tagName:"gui-checkbox",type:"input"},v),i.Element.register({tagName:"gui-switch",type:"input"},_),i.Element.register({tagName:"gui-button",type:"input"},y),i.Element.register({tagName:"gui-select",type:"input"},S),i.Element.register({tagName:"gui-select-list",type:"input"},w),i.Element.register({tagName:"gui-slider",type:"input"},b),i.Element.register({tagName:"gui-input-modal",type:"input"},O)}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i){"use strict";function o(e,n,i){"object"!=typeof(i=i||{})&&(console.error("Derp","applyArgs was not an object ?!"),i={});var o=document.createElement(n),r=e.getAttribute("data-src");e.getAttribute("data-controls")&&o.setAttribute("controls","controls"),e.getAttribute("data-autoplay")&&o.setAttribute("autoplay","autoplay"),Object.keys(i).forEach(function(e){var r=i[e];"function"==typeof r?(e=e.replace(/^on/,""),"video"!==n&&"audio"!==n||"load"!==e||(e="loadedmetadata"),t.$bind(o,e,r.bind(o),!1)):("boolean"==typeof i[e]&&(r=r?"true":"false"),o.setAttribute(e,r))}),o.src=r||"about:blank",e.appendChild(o)}var r={on:function(e,n,i){var o=this.$element.querySelector("audio");return t.$bind(o,e,n.bind(this),i),this},build:function(e){return o(this.$element,"audio",e),this}},a={on:function(e,n,i){var o=this.$element.querySelector("video");return t.$bind(o,e,n.bind(this),i),this},build:function(e){return o(this.$element,"video",e),this}},s={on:function(e,n,i){var o=this.$element.querySelector("img");return t.$bind(o,e,n.bind(this),i),this},build:function(e){return o(this.$element,"img",e),this}},u={on:function(e,n,i){var o=this.$element.querySelector("canvas");return t.$bind(o,e,n.bind(this),i),this},build:function(){var e=document.createElement("canvas");return this.$element.appendChild(e),this}};i.Element.register({tagName:"gui-audio"},r),i.Element.register({tagName:"gui-video"},a),i.Element.register({tagName:"gui-image"},s),i.Element.register({tagName:"gui-canvas"},u)}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i){"use strict";function o(t,n){if(t.icon&&"object"==typeof t.icon)return e.getIcon(t.icon.filename,n,t.icon.application);return e.getFileIcon(t,n,"status/dialog-question.png")}function r(e){var n="";return"dir"!==e.type&&e.size>=0&&(n=t.humanFileSize(e.size)),n}function a(e){if("string"==typeof e){var t=null;try{t=new Date(e)}catch(e){}if(t)return OSjs.Helpers.Date.format(t)}return e}function s(n,i,s){s=s||{};var u={filename:{label:"LBL_FILENAME",icon:function(){return o(i)},value:function(){return d(i.filename,s)}},mime:{label:"LBL_MIME",size:"100px",icon:function(){return null},value:function(){return i.mime}},mtime:{label:"LBL_MODIFIED",size:"160px",icon:function(){return null},value:function(){return a(i.mtime)}},ctime:{label:"LBL_CREATED",size:"160px",icon:function(){return null},value:function(){return a(i.ctime)}},size:{label:"LBL_SIZE",size:"120px",icon:function(){return null},value:function(){return r(i)}}},c=["filename","mime","size"],l=c;if(!s.defaultcolumns){l=(t.cloneObject(OSjs.Core.getSettingsManager().get("VFS")||{}).scandir||{}).columns||c}var f=[],p=n.$element.getAttribute("data-sortby"),h=n.$element.getAttribute("data-sortdir");return l.forEach(function(t,n){var o=u[t];i?f.push({sortBy:t,label:o.value(),icon:o.icon(),textalign:0===n?"left":"right"}):f.push({sortBy:t,sortDir:t===p?h:null,label:e._(o.label),size:o.size||"",resizable:n>0,textalign:0===n?"left":"right"})}),f}function u(e,t,i,o){var r=new n.File(e);r.type="dir";var a={backlink:t.backlink,showDotFiles:!0===t.dotfiles,showFileExtensions:!0===t.extensions,mimeFilter:t.filter||[],typeFilter:t.filetype||null,sortBy:t.sortby,sortDir:t.sortdir};try{n.scandir(r,function(e,t){function n(e){return"."===(e.filename||"").substr(0)}if(e)return void i(e);var r=[],a={size:0,directories:0,files:0,hidden:0};(t||[]).forEach(function(e){r.push(o(e)),a.size+=e.size||0,a.directories+="dir"===e.type?1:0,a.files+="dir"!==e.type?1:0,a.hidden+=n(e)?1:0}),i(!1,r,a)},a)}catch(e){i(e)}}function c(e,n,i,a){function c(e,t,n,i){g.hasAttribute(e)?_[t]=n(g.getAttribute(e)):_[t]=(i||function(){})()}var f=e.getChildView();if(f){a=a||{};var p=t.cloneObject(OSjs.Core.getSettingsManager().get("VFS")||{}),h=p.scandir||{},g=e.$element,m=f.$element,v=m.tagName.toLowerCase();g.setAttribute("data-path",n);var _={filter:null,backlink:a.backlink};c("data-sortby","sortby",function(e){return e}),c("data-sortdir","sortdir",function(e){return e}),c("data-dotfiles","dotfiles",function(e){return"true"===e},function(){return!0===h.showHiddenFiles}),c("data-extensions","extensions",function(e){return"true"===e},function(){return!0===h.showFileExtensions}),c("data-filetype","filetype",function(e){return e}),c("data-defaultcolumns","defaultcolumns",function(e){return"true"===e});try{_.filter=JSON.parse(g.getAttribute("data-filter"))}catch(e){}u(n,_,function(t,n,o){"gui-list-view"===v&&(e.getChildView().set("zebra",!0),!1!==a.headers&&e.getChildView().set("columns",s(e,null,_))),i(t,n,o)},function(n){var i=t.format("{0}\n{1}\n{2} {3}",n.type.toUpperCase(),n.filename,r(n),n.mime||"");return"gui-list-view"!==v?function(){var e={value:n,id:n.id||d(n.filename,_),label:n.filename,tooltip:i,icon:o(n,l[v]||"16x16")};return"gui-tree-view"===v&&"dir"===n.type&&".."!==n.filename&&(e.entries=[{label:"Loading..."}]),e}():{value:n,id:n.id||n.filename,tooltip:i,columns:s(e,n,_)}})}}var l={"gui-icon-view":"32x32"},d=function(){var n;return function(i,o){if(n||(n=e.getConfig("MIME.mapping")),!1===o.extensions){var r=t.filext(i);r&&(r="."+r,n[r]&&(i=i.substr(0,i.length-r.length)))}return i}}();i.Element.register({tagName:"gui-file-view"},{on:function(e,n,i){-1!==["activate","select","contextmenu","sort"].indexOf(e)&&(e="_"+e);var o=this.$element;return"_contextmenu"===e&&o.setAttribute("data-has-contextmenu","true"),t.$bind(o,e,n.bind(this),i),this},set:function(e,t,n,o){var r=this.$element;if("type"===e){var a=r.children[0];return!(!a||a.tagName.toLowerCase()!==t)||(r.setAttribute("data-type",t),this.buildChildView(),void 0!==n&&!0!==n||this.chdir({path:r.getAttribute("data-path")}),this)}if(["filter","dotfiles","filetype","extensions","defaultcolumns","sortby","sortdir"].indexOf(e)>=0)return i.Helpers.setProperty(r,e,t),this;var s=this.getChildView();return s?s.set.apply(s,arguments):i.DataView.prototype.set.apply(this,arguments)},build:function(){if(this.childView)return this;this.buildChildView();var e=this.$element,n=this;return t.$bind(e,"_expand",function(e){var i=e.detail.element;if(!i.getAttribute("data-was-rendered")&&e.detail.expanded){var o=e.detail.entries[0].data;i.setAttribute("data-was-rendered",String(!0)),c(n,o.path,function(e,o,r){if(!e){i.querySelectorAll("gui-tree-view-entry").forEach(function(e){t.$remove(e)});var a=n.getChildView();a&&a.add({entries:o,parentNode:i})}},{backlink:!1})}}),this},values:function(){var e=this.getChildView();return e?e.values():null},contextmenu:function(t){function n(e,t){var n={scandir:{}};n.scandir[e]=t,i.set(null,n,!0)}var i=OSjs.Core.getSettingsManager().instance("VFS"),o=i.get("scandir")||{};e.createMenu([{title:e._("LBL_SHOW_HIDDENFILES"),type:"checkbox",checked:!0===o.showHiddenFiles,onClick:function(){n("showHiddenFiles",!o.showHiddenFiles)}},{title:e._("LBL_SHOW_FILEEXTENSIONS"),type:"checkbox",checked:!0===o.showFileExtensions,onClick:function(){n("showFileExtensions",!o.showFileExtensions)}}],t)},chdir:function(t){var n=this.getChildView();n||(n=this.buildChildView());var i=this,o=t.done||function(){},r=t.path||OSjs.API.getDefaultPath(),a=n,s=this.$element;clearTimeout(s._readdirTimeout),s._readdirTimeout=setTimeout(function(){c(i,r,function(t,n,i){t?e.error(e._("ERR_VFSMODULE_XHR_ERROR"),e._("ERR_VFSMODULE_SCANDIR_FMT",r),t):(a.clear(),a.add(n)),o(t,i)},t.opts)},50)},getChildViewType:function(){var e=this.$element.getAttribute("data-type")||"list-view";return e.match(/^gui\-/)||(e="gui-"+e),e},getChildView:function(){return i.Element.createFromNode(this.$element.children[0])},buildChildView:function(){var e=this,n=this.$element,o=this.getChildViewType(),r=this.getChildView();if(r&&r.$element&&r.$element.tagName.toLowerCase()===o)return null;t.$empty(n);var a=i.Element.create(o,{draggable:!0,"draggable-type":"file"});return a.build(),a.on("select",function(e){n.dispatchEvent(new CustomEvent("_select",{detail:e.detail}))}),a.on("activate",function(e){n.dispatchEvent(new CustomEvent("_activate",{detail:e.detail}))}),a.on("sort",function(t){n.setAttribute("data-sortby",String(t.detail.sortBy)),n.setAttribute("data-sortdir",String(t.detail.sortDir)),e.chdir({sopts:{headers:!1},path:n.getAttribute("data-path")}),n.dispatchEvent(new CustomEvent("_sort",{detail:t.detail}))}),a.on("contextmenu",function(t){n.hasAttribute("data-has-contextmenu")&&"false"!==n.hasAttribute("data-has-contextmenu")||e.contextmenu(t),n.dispatchEvent(new CustomEvent("_contextmenu",{detail:t.detail}))}),"gui-tree-view"===o&&a.on("expand",function(e){n.dispatchEvent(new CustomEvent("_expand",{detail:e.detail}))}),n.setAttribute("role","region"),n.appendChild(a.$element),a}})}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i){"use strict";function o(e,t){return i.Helpers.createElement("gui-tree-view-entry",t,["entries"])}function r(e,n,o,r){void 0===r&&(r=!t.$hasClass(o,"gui-expanded")),t.$removeClass(o,"gui-expanded"),r&&t.$addClass(o,"gui-expanded");for(var a=o.children,s=0;s<a.length;s++)"gui-tree-view-entry"===a[s].tagName.toLowerCase()&&(a[s].style.display=r?"block":"none");var u={index:t.$index(o),data:i.Helpers.getViewNodeValue(o)};o.setAttribute("data-expanded",String(r)),o.setAttribute("aria-expanded",String(r)),n.dispatchEvent(new CustomEvent("_expand",{detail:{entries:[u],expanded:r,element:o}}))}function a(e,n){function o(e){e.stopPropagation(),t.$addClass(n,"dnd-over")}function a(e){t.$removeClass(n,"dnd-over")}var s=e.$element;if(!n._rendered){n._rendered=!0;var u=n.getAttribute("data-icon"),c=i.Helpers.getLabel(n),l="true"===s.getAttribute("data-expanded"),d=n.querySelector("gui-tree-view-entry"),f=document.createElement("div"),p=document.createElement("span");if(u&&(p.style.backgroundImage="url("+u+")",t.$addClass(p,"gui-has-image")),p.appendChild(document.createTextNode(c)),f.appendChild(p),d){t.$addClass(n,"gui-expandable");var h=document.createElement("gui-tree-view-expander");n.insertBefore(f,d),n.insertBefore(h,f)}else n.appendChild(f);if("true"===String(n.getAttribute("data-draggable"))&&i.Helpers.createDraggable(f,function(){var e={};try{e=JSON.parse(n.getAttribute("data-value"))}catch(e){}return{data:e}}()),"true"===String(n.getAttribute("data-droppable"))){var g;i.Helpers.createDroppable(f,{onEnter:o,onOver:o,onLeave:a,onDrop:a,onItemDropped:function(e,i,o){e.stopPropagation(),e.preventDefault(),g=clearTimeout(g),g=setTimeout(function(){t.$removeClass(n,"dnd-over")},10);var r={};try{r=JSON.parse(i.parentNode.getAttribute("data-value"))}catch(e){}s.dispatchEvent(new CustomEvent("_drop",{detail:{src:o.data,dest:r}}))}})}r(null,s,n,l),e.bindEntryEvents(n,"gui-tree-view-entry")}}i.Element.register({parent:i.DataView,tagName:"gui-tree-view"},{values:function(){var e=this.$element;return this.getSelected(e.querySelectorAll("gui-tree-view-entry"))},build:function(e){var t=this.$element,n=t.querySelector("gui-tree-view-body"),o=!!n,r=this;return n||(n=document.createElement("gui-tree-view-body"),t.appendChild(n)),n.setAttribute("role","group"),t.setAttribute("role","tree"),t.setAttribute("aria-multiselectable",n.getAttribute("data-multiselect")||"false"),t.querySelectorAll("gui-tree-view-entry").forEach(function(e,t){e.setAttribute("aria-expanded","false"),o||n.appendChild(e),e.setAttribute("role","treeitem"),a(r,e)}),i.DataView.prototype.build.apply(this,arguments)},get:function(e,t,n){if("entry"===e){var o=this.$element.querySelector("gui-tree-view-body");return this.getEntry(o.querySelectorAll("gui-tree-view-entry"),t,n)}return i.DataView.prototype.get.apply(this,arguments)},set:function(e,t,n,o){var r=this.$element,a=r.querySelector("gui-tree-view-body");return"selected"===e||"value"===e?(this.setSelected(a,a.querySelectorAll("gui-tree-view-entry"),t,n,o),this):i.DataView.prototype.set.apply(this,arguments)},clear:function(){var e=this.$element.querySelector("gui-tree-view-body");return i.DataView.prototype.clear.call(this,e)},add:function(e){function t(e,n,i){s.call(u,e,function(e,r){if(r){r.parentNode&&delete r.parentNode;var s=o(u,r);n.appendChild(s),r.entries&&t(r.entries,s,i+1),a(u,s)}})}var n=this.$element.querySelector("gui-tree-view-body"),r=n,s=i.DataView.prototype.add,u=this;return"object"!=typeof e||e instanceof Array||!Object.keys(e).length||(r=e.parentNode||n,e=e.entries||[]),t(e,r,0),this},remove:function(e){return i.DataView.prototype.remove.call(this,e,"gui-tree-view-entry")},patch:function(e){var t=this.$element.querySelector("gui-tree-view-body");return i.DataView.prototype.patch.call(this,e,"gui-list-view-entry",t,o,a)},expand:function(e){return r(e.ev,this.$element,e.entry),this}})}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i){"use strict";function o(e){var n=e.querySelector("gui-list-view-fake-head gui-list-view-head");t.$empty(n);var o=e.querySelector("gui-list-view-head gui-list-view-row");o&&(n.appendChild(o.cloneNode(!0)),function(){var n=e.querySelector("gui-list-view-fake-head"),o=e.querySelector("gui-list-view-head"),r=n.querySelectorAll("gui-list-view-column"),a=o.querySelectorAll("gui-list-view-column");n.querySelectorAll("gui-list-view-column-resizer").forEach(function(e){t.$remove(e)}),a.forEach(function(n,o){if("true"===n.getAttribute("data-resizable")){var a=r[o],s=document.createElement("gui-list-view-column-resizer");a.appendChild(s);var u=0,c=0,l=16,d=null;i.Helpers.createDrag(s,function(t){u=n.offsetWidth,l=16,c=e.offsetWidth-16*e.children.length},function(e,i){var o=u-i.x;!isNaN(o)&&o>l&&o<c&&(n.style.width=String(o)+"px",a.style.width=String(o)+"px"),d=t.$remove(d)})}})}())}function r(e,n){var i=e.$element;n.querySelectorAll("gui-list-view-column").forEach(function(e,n){var o=e.getAttribute("data-icon");o&&"null"!==o&&(t.$addClass(e,"gui-has-image"),e.style.backgroundImage="url("+o+")");var r=e.firstChild;if(r&&3===r.nodeType){var a=document.createElement("span");a.appendChild(document.createTextNode(r.nodeValue)),e.insertBefore(a,r),e.removeChild(r)}i._columns[n]&&!i._columns[n].visible&&(e.style.display="none"),e.setAttribute("role","listitem")}),e.bindEntryEvents(n,"gui-list-view-row")}function a(e,t,n){var o=t.label||"";t.label&&delete t.label;var r=null;t.size&&(r=t.size,delete t.size);var a=i.Helpers.createElement("gui-list-view-column",t);if(r&&(a.style.width=r),"function"==typeof o)a.appendChild(o.call(a,a,t));else{var s=document.createElement("span");s.appendChild(document.createTextNode(o)),a.appendChild(s)}return a}function s(e,t){if(t=t||{},t.columns){var n=i.Helpers.createElement("gui-list-view-row",t,["columns"]);return t.columns.forEach(function(t){n.appendChild(a(e,t))}),n}return null}i.Element.register({parent:i.DataView,tagName:"gui-list-view"},{values:function(){var e=this.$element.querySelector("gui-list-view-body");return this.getSelected(e.querySelectorAll("gui-list-view-row"))},get:function(e,t,n,o){if("entry"===e){var r=this.$element.querySelector("gui-list-view-body"),a=r.querySelectorAll("gui-list-view-row");return this.getEntry(a,t,n,o)}return i.DataView.prototype.get.apply(this,arguments)},set:function(e,n,r,s){var u=this.$element,c=this;if("columns"===e){var l=u.querySelector("gui-list-view-head"),d=document.createElement("gui-list-view-row");return t.$empty(l),u._columns=[],n.forEach(function(e){e.visible=void 0===e.visible||!0===e.visible;var t=a(c,e,!0);u._columns.push(e),e.visible||(t.style.display="none"),d.appendChild(t)}),l.appendChild(d),o(u),this}if("selected"===e||"value"===e){var f=u.querySelector("gui-list-view-body");return this.setSelected(f,f.querySelectorAll("gui-list-view-row"),n,r,s),this}return i.DataView.prototype.set.apply(this,arguments)},add:function(e){var t=this.$element.querySelector("gui-list-view-body"),n=this;return i.DataView.prototype.add.call(this,e,function(e,i){var o=i.onCreated||function(){},a=s(n,i);a&&(t.appendChild(a),r(n,a)),o(a)})},clear:function(){var e=this.$element.querySelector("gui-list-view-body");return i.DataView.prototype.clear.call(this,e)},remove:function(e){var t=this.$element.querySelector("gui-list-view-body");return i.DataView.prototype.remove.call(this,e,"gui-list-view-row",null,t)},patch:function(e){var t=this.$element.querySelector("gui-list-view-body");return i.DataView.prototype.patch.call(this,e,"gui-list-view-row",t,s,r)},build:function(){function e(e){"GUI-LIST-VIEW-INNER"!==e.parentNode.tagName&&a.appendChild(e)}var n=this.$element;n._columns=[];var a=n.querySelector("gui-list-view-inner"),s=n.querySelector("gui-list-view-head"),u=n.querySelector("gui-list-view-body"),c=n.querySelector("gui-list-view-fake-head");if(!c){c=document.createElement("gui-list-view-fake-head");var l=document.createElement("gui-list-view-inner");l.appendChild(document.createElement("gui-list-view-head")),c.appendChild(l)}return a||(a=document.createElement("gui-list-view-inner"),n.appendChild(a)),function(){u?e(u):(u=document.createElement("gui-list-view-body"),a.appendChild(u)),u.setAttribute("role","group")}(),function(){s?e(s):(s=document.createElement("gui-list-view-head"),a.insertBefore(s,u)),s.setAttribute("role","group")}(),n.setAttribute("role","list"),n.appendChild(c),t.$bind(n,"scroll",function(e){c.style.top=n.scrollTop+"px"},!1),n.querySelectorAll("gui-list-view-head gui-list-view-column").forEach(function(e,t){var i=e.getAttribute("data-visible"),o={visible:null===i||"true"===i,size:e.getAttribute("data-size")};o.size&&(e.style.width=o.size),n._columns.push(o),o.visible||(e.style.display="none")}),o(n),n.querySelectorAll("gui-list-view-body gui-list-view-row").forEach(function(e){r(self,e)}),i.DataView.prototype.build.apply(this,arguments)}})}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i){"use strict";function o(e,t){return i.Helpers.createElement("gui-icon-view-entry",t)}function r(e,t){var n=t.getAttribute("data-icon"),o=i.Helpers.getLabel(t),r=document.createElement("div"),a=document.createElement("img");a.src=n,r.appendChild(a);var s=document.createElement("div"),u=document.createElement("span");u.appendChild(document.createTextNode(o)),s.appendChild(u),e.bindEntryEvents(t,"gui-icon-view-entry"),t.setAttribute("role","listitem"),t.appendChild(r),t.appendChild(s)}i.Element.register({parent:i.DataView,tagName:"gui-icon-view"},{values:function(){return this.getSelected(this.$element.querySelectorAll("gui-icon-view-entry"))},build:function(){var e=this.$element,t=e.querySelector("gui-icon-view-body"),n=!!t,o=this;return n||(t=document.createElement("gui-icon-view-body"),e.appendChild(t)),e.querySelectorAll("gui-icon-view-entry").forEach(function(e,i){n||t.appendChild(e),r(o,e)}),e.setAttribute("role","list"),i.DataView.prototype.build.apply(this,arguments)},get:function(e,t,n,o){if("entry"===e){var r=this.$element.querySelector("gui-icon-view-body"),a=r.querySelectorAll("gui-icon-view-entry");return this.getEntry(a,t,n,o)}return i.DataView.prototype.get.apply(this,arguments)},set:function(e,t,n){var o=this.$element.querySelector("gui-icon-view-body");return"selected"===e||"value"===e?(o&&this.setSelected(o,o.querySelectorAll("gui-icon-view-entry"),t,n),this):i.DataView.prototype.set.apply(this,arguments)},add:function(e){var t=this.$element.querySelector("gui-icon-view-body"),n=this;return i.DataView.prototype.add.call(this,e,function(e,i){var a=o(n,i);t.appendChild(a),r(n,a)})},clear:function(){var e=this.$element.querySelector("gui-icon-view-body");return i.DataView.prototype.clear.call(this,e)},remove:function(e){return i.DataView.prototype.remove.call(this,e,"gui-icon-view-entry")},patch:function(e){var t=this.$element.querySelector("gui-icon-view-body");return i.DataView.prototype.patch.call(this,e,"gui-icon-view-entry",t,o,r)}})}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i){"use strict";function o(e,t){return t=t||e.querySelector("iframe"),t.contentDocument||t.contentWindow.document}function r(e){try{return o(e).body.innerHTML}catch(e){console.error("gui-richtext","getDocumentData()",e.stack,e)}return""}function a(e){e._fixTry=0,e._fixInterval=clearInterval(e._fixInterval)}function s(e,t,n){if(e._fixTry>10)return void(e._fixTry=0);e._fixInterval=setInterval(function(){try{n&&(t.body.innerHTML=n),a(e)}catch(e){e.stack}e._fixTry++},100)}function u(e,t){function n(e){9===e.keyCode&&(!function(e){var t,n;window.getSelection?(t=window.getSelection(),t.getRangeAt&&t.rangeCount&&(n=t.getRangeAt(0),n.deleteContents(),n.insertNode(document.createTextNode(e)))):document.selection&&document.selection.createRange&&(document.selection.createRange().text=e)}(""),e.preventDefault())}a(e),t=t||"";var i=OSjs.Core.getWindowManager(),r=(i?i.getSetting("theme"):"default")||"default",u=OSjs.API.getThemeCSS(r),c=e.getAttribute("data-editable");c=null===c||"true"===c;var l=n.toString()+';window.addEventListener("keydown", onMouseDown)',d='<!DOCTYPE html><html><head><link rel="stylesheet" type="text/css" href="'+u+'" /><script>'+l+'<\/script></head><body contentEditable="true"></body></html>';c||(d=d.replace(' contentEditable="true"',""));var f=o(e);f.open(),f.write(d),f.close(),s(e,f,t)}var c={on:function(e,n,i){return-1!==["selection"].indexOf(e)&&(e="_"+e),t.$bind(this.$element,e,n.bind(this),i),this},build:function(){var e=this.$element,n=e.childNodes.length?e.childNodes[0].nodeValue:"";t.$empty(e);var i=document.createElement("iframe");return i.setAttribute("border",0),i.onload=function(){i.contentWindow.addEventListener("selectstart",function(){e.dispatchEvent(new CustomEvent("_selection",{detail:{}}))}),i.contentWindow.addEventListener("mouseup",function(){e.dispatchEvent(new CustomEvent("_selection",{detail:{}}))})},e.appendChild(i),setTimeout(function(){try{u(e,n)}catch(e){}},1),this},command:function(){try{var e=o(this.$element);if(e&&e.execCommand)return e.execCommand.apply(e,arguments)}catch(e){e.stack}return this},query:function(){try{var e=o(this.$element);if(e&&e.queryCommandValue)return e.queryCommandValue.apply(e,arguments)}catch(e){e.stack}return null},get:function(e,t){return"value"===e?r(this.$element):i.Element.prototype.get.apply(this,arguments)},set:function(e,t){return"value"===e?(u(this.$element,t),this):i.Element.prototype.set.apply(this,arguments)}};i.Element.register({tagName:"gui-richtext"},c)}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i){"use strict";var o={on:function(e,n,i){var o=this.$element;return"resize"===e&&(e="_"+e),t.$bind(o,e,n.bind(this),i),this},build:function(){function e(e,o,r){var a=e.previousElementSibling;if(a){var s=a.offsetWidth,u=a.offsetHeight,c=16,l=Number.MAX_VALUE;i.Helpers.createDrag(e,function(t){if(s=a.offsetWidth,u=a.offsetHeight,c=parseInt(r.getAttribute("data-min-size"),10)||c,!parseInt(r.getAttribute("data-max-size"),10)){var i=e.parentNode["horizontal"===n?"offsetWidth":"offsetHeight"],o=e.parentNode.querySelectorAll("gui-paned-view-container").length,d=e.parentNode.querySelectorAll("gui-paned-view-handle").length;l=i-16*o-8*d}},function(e,t){var i,o=s+t.x,r=u+t.y;"horizontal"===n?!isNaN(o)&&o>0&&o>=c&&o<=l&&(i=o.toString()+"px"):!isNaN(r)&&r>0&&r>=c&&r<=l&&(i=r.toString()+"px"),i&&(a.style.webkitFlexBasis=i,a.style.mozFflexBasis=i,a.style.msFflexBasis=i,a.style.oFlexBasis=i,a.style.flexBasis=i)},function(e){t.dispatchEvent(new CustomEvent("_resize",{detail:{index:o}}))})}}var t=this.$element,n=t.getAttribute("data-orientation")||"horizontal";return t.querySelectorAll("gui-paned-view-container").forEach(function(t,n){if(n%2){var i=document.createElement("gui-paned-view-handle");i.setAttribute("role","separator"),t.parentNode.insertBefore(i,t),e(i,n,t)}}),this}},r={build:function(){return i.Helpers.setFlexbox(this.$element),this}},a={build:function(){return this.$element.setAttribute("role","toolbar"),this}},s={build:function(){return this.$element.setAttribute("role","toolbar"),this}},u={build:function(){var e=this.$element.querySelectorAll("gui-grid-row"),t=100/e.length;return e.forEach(function(e){e.style.height=String(t)+"%"}),this}},c={},l={},d={},f={build:function(){return i.Helpers.setFlexbox(this.$element),this}},p={},h={build:function(){return i.Helpers.setFlexbox(this.$element),this}},g=function(){function e(e,t){return void 0===t&&(t="false"!==e.getAttribute("data-expanded"),t=!t),e.setAttribute("aria-expanded",String(t)),e.setAttribute("data-expanded",String(t)),t}return{set:function(t,n){return"expanded"===t?e(this.$element,!0===n):i.Element.prototype.set.apply(this,arguments)},on:function(e,n,i){return-1!==["change"].indexOf(e)&&(e="_"+e),t.$bind(this.$element,e,n.bind(this),i),this},build:function(){var n=this.$element,i=n.getAttribute("data-label")||"",o=document.createElement("gui-expander-label");return t.$bind(o,"click",function(t){n.dispatchEvent(new CustomEvent("_change",{detail:{expanded:e(n)}}))},!1),o.appendChild(document.createTextNode(i)),n.setAttribute("role","toolbar"),n.setAttribute("aria-expanded","true"),n.setAttribute("data-expanded","true"),n.children.length?n.insertBefore(o,n.children[0]):n.appendChild(o),this}}}();i.Element.register({tagName:"gui-paned-view",type:"container",allowedChildren:["gui-paned-view-container"]},o),i.Element.register({tagName:"gui-paned-view-container",type:"container",allowedParents:["gui-paned-view"]},r),i.Element.register({tagName:"gui-button-bar",type:"container"},a),i.Element.register({tagName:"gui-toolbar",type:"container"},s),i.Element.register({tagName:"gui-grid",type:"container",allowedChildren:["gui-grid-row"]},u),i.Element.register({tagName:"gui-grid-row",type:"container",allowedChildren:["gui-grid-entry"],allowedParents:["gui-grid-row"]},c),i.Element.register({tagName:"gui-grid-entry",type:"container",allowedParents:["gui-grid-row"]},l),i.Element.register({tagName:"gui-vbox",type:"container",allowedChildren:["gui-vbox-container"]},d),i.Element.register({tagName:"gui-vbox-container",type:"container",allowedParents:["gui-vbox"]},f),i.Element.register({tagName:"gui-hbox",type:"container",allowedChildren:["gui-hbox-container"]},p),i.Element.register({tagName:"gui-hbox-container",type:"container",allowedParents:["gui-hbox"]},h),i.Element.register({tagName:"gui-expander",type:"container"},g)}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n){"use strict";function i(i,o){i=t.argumentDefaults(i,{}),n.apply(this,["AlertDialog",{title:i.title||e._("DIALOG_ALERT_TITLE"),icon:"status/dialog-warning.png",width:400,height:100},i,o])}i.prototype=Object.create(n.prototype),i.constructor=n,i.prototype.init=function(){var e=n.prototype.init.apply(this,arguments);return e.setAttribute("role","alertdialog"),this._find("Message").set("value",this.args.message,!0),e},OSjs.Dialogs.Alert=Object.seal(i)}(OSjs.API,OSjs.Utils,OSjs.Core.DialogWindow),function(e,t,n){"use strict";function i(i,o){i=t.argumentDefaults(i,{}),n.apply(this,["ApplicationChooserDialog",{title:i.title||e._("DIALOG_APPCHOOSER_TITLE"),width:400,height:400},i,o])}i.prototype=Object.create(n.prototype),i.constructor=n,i.prototype.init=function(){var i=this,o=n.prototype.init.apply(this,arguments),r=[{label:e._("LBL_NAME")}],a=[],s=OSjs.Core.getPackageManager().getPackages();(this.args.list||[]).forEach(function(t){var n=s[t];if(n&&"application"===n.type){var i=[n.name];n.description&&i.push(n.description),a.push({value:n,columns:[{label:i.join(" - "),icon:e.getIcon(n.icon,null,t),value:JSON.stringify(n)}]})}}),this._find("ApplicationList").set("columns",r).add(a).on("activate",function(e){i.onClose(e,"ok")});var u="<unknown file>",c="<unknown mime>";return this.args.file&&(u=t.format("{0} ({1})",this.args.file.filename,this.args.file.mime),c=e._("DIALOG_APPCHOOSER_SET_DEFAULT",this.args.file.mime)),this._find("FileName").set("value",u),this._find("SetDefault").set("label",c),o},i.prototype.onClose=function(t,n){var i=null;if("ok"===n){var o=this._find("SetDefault").get("value"),r=this._find("ApplicationList").get("value");if(r&&r.length&&(i=r[0].data.className),!i)return void OSjs.API.createDialog("Alert",{message:e._("DIALOG_APPCHOOSER_NO_SELECTION")},null,this);i={name:i,useDefault:o}}this.closeCallback(t,n,i)},OSjs.Dialogs.ApplicationChooser=Object.seal(i)}(OSjs.API,OSjs.Utils,OSjs.Core.DialogWindow),function(e,t,n){"use strict";function i(i,o){i=t.argumentDefaults(i,{});var r=i.color,a=r;"string"==typeof r?(a=r,r=t.convertToRGB(r),r.a=null):(void 0===r.a?r.a=null:r.a>1&&(r.a/=100),r=r||{r:0,g:0,b:0,a:100},a=t.convertToHEX(r.r,r.g,r.b)),
n.apply(this,["ColorDialog",{title:i.title||e._("DIALOG_COLOR_TITLE"),icon:"apps/preferences-desktop-theme.png",width:400,height:null!==r.a?300:220},i,o]),this.color={r:r.r,g:r.g,b:r.b,a:r.a,hex:a}}i.prototype=Object.create(n.prototype),i.constructor=n,i.prototype.init=function(){function i(n){o._find("LabelRed").set("value",e._("DIALOG_COLOR_R",o.color.r)),o._find("LabelGreen").set("value",e._("DIALOG_COLOR_G",o.color.g)),o._find("LabelBlue").set("value",e._("DIALOG_COLOR_B",o.color.b)),o._find("LabelAlpha").set("value",e._("DIALOG_COLOR_A",o.color.a)),n&&(o.color.hex=t.convertToHEX(o.color.r,o.color.g,o.color.b));var i=o.color.hex;null===o.color.a||isNaN(o.color.a)||(i=t.format("rgba({0}, {1}, {2}, {3})",o.color.r,o.color.g,o.color.b,o.color.a)),o._find("ColorPreview").set("value",i)}var o=this,r=n.prototype.init.apply(this,arguments);return this._find("ColorSelect").on("change",function(e){o.color=e.detail,o._find("Red").set("value",o.color.r),o._find("Green").set("value",o.color.g),o._find("Blue").set("value",o.color.b),i(!0)}),this._find("Red").on("change",function(e){o.color.r=parseInt(e.detail,10),i(!0)}).set("value",this.color.r),this._find("Green").on("change",function(e){o.color.g=parseInt(e.detail,10),i(!0)}).set("value",this.color.g),this._find("Blue").on("change",function(e){o.color.b=parseInt(e.detail,10),i(!0)}).set("value",this.color.b),this._find("Alpha").on("change",function(e){o.color.a=parseInt(e.detail,10)/100,i(!0)}).set("value",100*this.color.a),null===this.color.a&&(this._find("AlphaContainer").hide(),this._find("AlphaLabelContainer").hide()),i(!1,this.color.a),r},i.prototype.onClose=function(e,t){this.closeCallback(e,t,"ok"===t?this.color:null)},OSjs.Dialogs.Color=Object.seal(i)}(OSjs.API,OSjs.Utils,OSjs.Core.DialogWindow),function(e,t,n){"use strict";function i(i,o){i=t.argumentDefaults(i,{buttons:["yes","no","cancel"]}),n.apply(this,["ConfirmDialog",{title:i.title||e._("DIALOG_CONFIRM_TITLE"),icon:"status/dialog-question.png",width:400,height:100},i,o])}i.prototype=Object.create(n.prototype),i.constructor=n,i.prototype.init=function(){var e=this,t=n.prototype.init.apply(this,arguments),i=n.parseMessage(this.args.message);this._find("Message").empty().append(i);var o={yes:"ButtonYes",no:"ButtonNo",cancel:"ButtonCancel"},r=[];return["yes","no","cancel"].forEach(function(t){e.args.buttons.indexOf(t)<0&&r.push(t)}),r.forEach(function(t){e._find(o[t]).hide()}),t},OSjs.Dialogs.Confirm=Object.seal(i)}(OSjs.API,OSjs.Utils,OSjs.Core.DialogWindow),function(e,t,n){"use strict";function i(i,o){i=t.argumentDefaults(i,{}),console.error("ErrorDialog::constructor()",i);var r=i.exception||{},a="";r.stack?a=r.stack:Object.keys(r).length&&(a=r.name,a+="\nFilename: "+r.fileName||"<unknown>",a+="\nLine: "+r.lineNumber,a+="\nMessage: "+r.message,r.extMessage&&(a+="\n"+r.extMessage)),n.apply(this,["ErrorDialog",{title:i.title||e._("DIALOG_ERROR_TITLE"),icon:"status/dialog-error.png",width:400,height:a?400:200},i,o]),this._sound="ERROR",this._soundVolume=1,this.traceMessage=a}i.prototype=Object.create(n.prototype),i.constructor=n,i.prototype.init=function(){var t=this,i=n.prototype.init.apply(this,arguments);i.setAttribute("role","alertdialog");var o=n.parseMessage(this.args.message);return this._find("Message").empty().append(o),this._find("Summary").set("value",this.args.error),this._find("Trace").set("value",this.traceMessage),this.traceMessage||(this._find("Trace").hide(),this._find("TraceLabel").hide()),this.args.bugreport?this._find("ButtonBugReport").on("click",function(){var n="",i=[];if(e.getConfig("BugReporting.options.issue")){var o={};["userAgent","platform","language","appVersion"].forEach(function(e){o[e]=navigator[e]}),n=e.getConfig("BugReporting.options.title"),i=["**"+e.getConfig("BugReporting.options.message").replace("%VERSION%",e.getConfig("Version"))+":**","\n","> "+t.args.message,"\n","> "+(t.args.error||"Unknown error"),"\n","## Expected behaviour","\n","## Actual behaviour","\n","## Steps to reproduce the error","\n","## (Optinal) Browser and OS information","\n","```\n"+JSON.stringify(o)+"\n```"],t.traceMessage&&i.push("\n## Stack Trace \n```\n"+t.traceMessage+"\n```\n")}var r=e.getConfig("BugReporting.url").replace("%TITLE%",encodeURIComponent(n)).replace("%BODY%",encodeURIComponent(i.join("\n")));window.open(r)}):this._find("ButtonBugReport").hide(),i},OSjs.Dialogs.Error=Object.seal(i)}(OSjs.API,OSjs.Utils,OSjs.Core.DialogWindow),function(e,t,n,i){"use strict";function o(o,r){if(o=n.argumentDefaults(o,{file:null,type:"open",path:OSjs.API.getDefaultPath(),filename:"",filetypes:[],extension:"",mime:"application/octet-stream",filter:[],mfilter:[],select:null,multiple:!1}),o.multiple="save"!==o.type&&!0===o.multiple,o.path&&o.path instanceof t.File&&(o.path=n.dirname(o.path.path)),o.file&&o.file.path&&(o.path=n.dirname(o.file.path),o.filename=o.file.filename,o.mime=o.file.mime,o.filetypes.length)){var a=o.filetypes[0];o.filename=n.replaceFileExtension(o.filename,a.extension),o.mime=a.mime}var s=o.title||e._("save"===o.type?"DIALOG_FILE_SAVE":"DIALOG_FILE_OPEN"),u="open"===o.type?"actions/document-open.png":"actions/documentsave-as.png";i.apply(this,["FileDialog",{title:s,icon:u,width:600,height:400},o,r]),this.selected=null,this.path=o.path;var c=this;this.settingsWatch=OSjs.Core.getSettingsManager().watch("VFS",function(){c.changePath()})}o.prototype=Object.create(i.prototype),o.constructor=i,o.prototype.destroy=function(){try{OSjs.Core.getSettingsManager().unwatch(this.settingsWatch)}catch(e){}return i.prototype.destroy.apply(this,arguments)},o.prototype.init=function(){function o(){var e=!1;"dir"!==r.args.select&&(e=!u.get("value").length),r._find("ButtonOK").set("disabled",e)}var r=this,a=i.prototype.init.apply(this,arguments),s=this._find("FileView");s.set("filter",this.args.filter),s.set("filetype",this.args.select||""),s.set("defaultcolumns","true");var u=this._find("Filename"),c=this._find("HomeButton"),l=this._find("ModuleSelect");if(this._toggleLoading(!0),s.set("multiple",this.args.multiple),u.set("value",this.args.filename||""),this._find("ButtonMkdir").on("click",function(){e.createDialog("Input",{message:e._("DIALOG_FILE_MKDIR_MSG",r.path),value:"New folder"},function(i,o,a){if("ok"===o&&a){var s=n.pathJoin(r.path,a);t.mkdir(t.file(s,"dir"),function(t){t?e.error(e._("DIALOG_FILE_ERROR"),e._("ERR_VFSMODULE_MKDIR"),t):r.changePath(s)})}},r)}),c.on("click",function(){var t=e.getDefaultPath();r.changePath(t)}),s.on("activate",function(e){if(r.selected=null,"save"!==r.args.type&&u.set("value",""),e&&e.detail&&e.detail.entries){var n=e.detail.entries[0];n&&(r.selected=new t.File(n.data),"dir"!==r.selected.type&&u.set("value",r.selected.filename),r.checkSelection(e,!0))}}),s.on("select",function(e){if(r.selected=null,e&&e.detail&&e.detail.entries){var n=e.detail.entries[0];n&&(r.selected=new t.File(n.data),"dir"!==r.selected.type&&u.set("value",r.selected.filename))}o()}),"save"===this.args.type){var d=[];this.args.filetypes.forEach(function(e){d.push({label:n.format("{0} (.{1} {2})",e.label,e.extension,e.mime),value:e.extension})});var f=this._find("Filetype").add(d).on("change",function(e){var t=n.replaceFileExtension(u.get("value"),e.detail);u.set("value",t)});d.length<=1&&new OSjs.GUI.Element(f.$element.parentNode).hide(),u.on("enter",function(e){r.selected=null,r.checkSelection(e)}),u.on("change",function(e){o()}),u.on("keyup",function(e){o()})}else"dir"!==this.args.select&&this._find("ButtonMkdir").hide(),this._find("FileInput").hide();var p=OSjs.Core.getMountManager(),h=p.getRootFromPath(this.path),g=p.getModules().filter(function(e){if(r.args.mfilter.length){var t=!1;return r.args.mfilter.forEach(function(n){t||(t=n(e))}),t}return!0}).map(function(t){return{label:t.name+(t.module.readOnly?n.format(" ({0})",e._("LBL_READONLY")):""),value:t.module.root}});return l.clear().add(g).set("value",h),l.on("change",function(e){r.changePath(e.detail,!0)}),this.changePath(),o(),a},o.prototype.changePath=function(e,t){function n(){var e=OSjs.Core.getMountManager(),t=e.getRootFromPath(r);try{i._find("ModuleSelect").set("value",t)}catch(e){}}var i=this,o=this._find("FileView"),r=this.path;this._toggleLoading(!0),o.chdir({path:e||this.path,done:function(o){o?t&&n():e&&(i.path=e),i.selected=null,i._toggleLoading(!1)}})},o.prototype.checkFileExtension=function(){var e=this._find("Filename"),t=this.args.mime,i=e.get("value");if(this.args.filetypes.length&&(!i&&this.args.filename&&(i=this.args.filename),i.length)){var o=i.split(".").pop(),r=!1;this.args.filetypes.forEach(function(e){return e.extension===o&&(r=e),!!r}),r=r||this.args.filetypes[0],i=n.replaceFileExtension(i,r.extension),t=r.mime}return{filename:i,mime:t}},o.prototype.checkSelection=function(i,o){var r=this;if(this.selected&&"dir"===this.selected.type&&o)return this.changePath(this.selected.path),!1;if("save"===this.args.type){var a=this.checkFileExtension();return this.path&&a.filename?(this.selected=new t.File(this.path.replace(/^\//,"")+"/"+a.filename,a.mime),this._toggleDisabled(!0),t.exists(this.selected,function(t,n){r._toggleDisabled(!1),r._destroyed||(t?e.error(e._("DIALOG_FILE_ERROR"),e._("DIALOG_FILE_MISSING_FILENAME")):n?(r._toggleDisabled(!0),r.selected&&e.createDialog("Confirm",{buttons:["yes","no"],message:e._("DIALOG_FILE_OVERWRITE",r.selected.filename)},function(e,t){r._toggleDisabled(!1),"yes"!==t&&"ok"!==t||r.closeCallback(e,"ok",r.selected)},r)):r.closeCallback(i,"ok",r.selected))}),!1):(e.error(e._("DIALOG_FILE_ERROR"),e._("DIALOG_FILE_MISSING_FILENAME")),!1)}if(!this.selected&&"dir"!==this.args.select)return e.error(e._("DIALOG_FILE_ERROR"),e._("DIALOG_FILE_MISSING_SELECTION")),!1;var s=this.selected;return s||"dir"!==this.args.select||(s=new t.File({filename:n.filename(this.path),path:this.path,type:"dir"})),this.closeCallback(i,"ok",s),!0},o.prototype.onClose=function(e,t){("ok"!==t||this.checkSelection(e))&&this.closeCallback(e,t,this.selected)},OSjs.Dialogs.File=Object.seal(o)}(OSjs.API,OSjs.VFS,OSjs.Utils,OSjs.Core.DialogWindow),function(e,t,n,i){"use strict";function o(n,o){if(n=t.argumentDefaults(n,{}),i.apply(this,["FileInfoDialog",{title:n.title||e._("DIALOG_FILEINFO_TITLE"),width:400,height:400},n,o]),!this.args.file)throw new Error("You have to select a file for FileInfo")}o.prototype=Object.create(i.prototype),o.constructor=i,o.prototype.init=function(){function t(t){t&&a.set("value",e._("DIALOG_FILEINFO_ERROR_LOOKUP_FMT",s.path))}function o(e){var t=[];Object.keys(e).forEach(function(n){"exif"===n?t.push(n+":\n\n"+e[n]):t.push(n+":\n\t"+e[n])}),a.set("value",t.join("\n\n"))}var r=i.prototype.init.apply(this,arguments),a=this._find("Info").set("value",e._("LBL_LOADING")),s=this.args.file;return n.fileinfo(s,function(e,n){if(e)return void t(e);o(n||{})}),r},OSjs.Dialogs.FileInfo=Object.seal(o)}(OSjs.API,OSjs.Utils,OSjs.VFS,OSjs.Core.DialogWindow),function(e,t,n){"use strict";function i(i,o){i=t.argumentDefaults(i,{}),n.apply(this,["FileProgressDialog",{title:i.title||e._("DIALOG_FILEPROGRESS_TITLE"),icon:"actions/document-send.png",width:400,height:100},i,o]),this.busy=!!i.filename}i.prototype=Object.create(n.prototype),i.constructor=n,i.prototype.init=function(){var e=n.prototype.init.apply(this,arguments);return this.args.message&&this._find("Message").set("value",this.args.message,!0),e},i.prototype.onClose=function(e,t){this.closeCallback(e,t,null)},i.prototype.setProgress=function(e){this._find("Progress").set("progress",e)},i.prototype._close=function(e){return!(!e&&this.busy)&&n.prototype._close.call(this)},i.prototype._onKeyEvent=function(e){this.busy||n.prototype._onKeyEvent.apply(this,arguments)},OSjs.Dialogs.FileProgress=Object.seal(i)}(OSjs.API,OSjs.Utils,OSjs.Core.DialogWindow),function(e,t,n,i){"use strict";function o(t,o){t=n.argumentDefaults(t,{progress:{},file:null}),t.destination&&(t.dest=t.destination),t.dest||(t.dest=e.getDefaultPath()),i.apply(this,["FileUploadDialog",{title:t.title||e._("DIALOG_UPLOAD_TITLE"),icon:"actions/document-new.png",width:400,height:100},t,o])}o.prototype=Object.create(i.prototype),o.constructor=i,o.prototype.init=function(){var t=this,n=i.prototype.init.apply(this,arguments),o=this._find("Message"),r=e.getConfig("VFS.MaxUploadSize");o.set("value",e._("DIALOG_UPLOAD_DESC",this.args.dest,r),!0);var a=this._find("File");return this.args.file?this.setFile(this.args.file,a):a.on("change",function(e){t.setFile(e.detail,a)}),n},o.prototype.setFile=function(t,n){function i(t,n){e.error(OSjs.API._("DIALOG_UPLOAD_FAILED"),OSjs.API._("DIALOG_UPLOAD_FAILED_MSG"),t||OSjs.API._("DIALOG_UPLOAD_FAILED_UNKNOWN")),o._close(!0),r.onClose(n,"cancel")}var o,r=this;if(t){var a=0;a=t.size>1048576?(Math.round(100*t.size/1048576)/100).toString()+"MB":(Math.round(100*t.size/1024)/100).toString()+"KB",n&&n.set("disabled",!0),this._find("ButtonCancel").set("disabled",!0);var s=OSjs.API._("DIALOG_UPLOAD_MSG_FMT",t.name,t.type,a,this.args.dest);o=e.createDialog("FileProgress",{message:s,dest:this.args.dest,filename:t.name,mime:t.type,size:a},function(e,t){},this),this._wmref&&this._wmref.createNotificationIcon(this.notificationId,{className:"BusyNotification",tooltip:s,image:!1}),OSjs.VFS.upload({files:[t],destination:this.args.dest},function(e,n,a){if(e)return void i(e,a);o._close(!0),r.onClose(a,"ok",t)},{onprogress:function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);o.setProgress(t)}}}),setTimeout(function(){o&&o._focus()},100)}},o.prototype.onClose=function(e,t,n){n=n||null,this.closeCallback(e,t,n)},OSjs.Dialogs.FileUpload=Object.seal(o)}(OSjs.API,OSjs.VFS,OSjs.Utils,OSjs.Core.DialogWindow),function(e,t,n){"use strict";function i(i,o){i=t.argumentDefaults(i,{fontName:e.getConfig("Fonts.default"),fontSize:12,fontColor:"#000000",backgroundColor:"#ffffff",fonts:e.getConfig("Fonts.list"),minSize:6,maxSize:30,text:"The quick brown fox jumps over the lazy dog",unit:"px"}),"null"!==i.unit&&"unit"!==i.unit||(i.unit=""),n.apply(this,["FontDialog",{title:i.title||e._("DIALOG_FONT_TITLE"),width:400,height:300},i,o]),this.selection={fontName:i.fontName,fontSize:i.fontSize+i.unit}}i.prototype=Object.create(n.prototype),i.constructor=n,i.prototype.init=function(){function e(){o.querySelector("textarea").style.fontFamily=i.selection.fontName,o.querySelector("textarea").style.fontSize=i.selection.fontSize}for(var t=n.prototype.init.apply(this,arguments),i=this,o=this._find("FontPreview"),r=[],a=[],s=this.args.minSize;s<this.args.maxSize;s++)r.push({value:s,label:s});for(var u=0;u<this.args.fonts.length;u++)a.push({value:this.args.fonts[u],label:this.args.fonts[u]});var c=this._find("FontName");c.add(a).set("value",this.args.fontName),c.on("change",function(t){i.selection.fontName=t.detail,e()});var l=this._find("FontSize");return l.add(r).set("value",this.args.fontSize),l.on("change",function(t){i.selection.fontSize=t.detail+i.args.unit,e()}),o.$element.style.color=this.args.fontColor,o.$element.style.backgroundColor=this.args.backgroundColor,o.set("value",this.args.text),this.args.fontSize<0&&this._find("FontSizeContainer").hide(),e(),t},i.prototype.onClose=function(e,t){var n="ok"===t?this.selection:null;this.closeCallback(e,t,n)},OSjs.Dialogs.Font=Object.seal(i)}(OSjs.API,OSjs.Utils,OSjs.Core.DialogWindow),function(e,t,n){"use strict";function i(i,o){i=t.argumentDefaults(i,{}),n.apply(this,["InputDialog",{title:i.title||e._("DIALOG_INPUT_TITLE"),icon:"status/dialog-information.png",width:400,height:120},i,o])}i.prototype=Object.create(n.prototype),i.constructor=n,i.prototype.init=function(){var e=this,t=n.prototype.init.apply(this,arguments);if(this.args.message){var i=n.parseMessage(this.args.message);this._find("Message").empty().append(i)}var o=this._find("Input");return o.set("placeholder",this.args.placeholder||""),o.set("value",this.args.value||""),o.on("enter",function(t){e.onClose(t,"ok")}),t},i.prototype._focus=function(){return!!n.prototype._focus.apply(this,arguments)&&(this._find("Input").focus(),!0)},i.prototype.onClose=function(e,t){var n=this._find("Input").get("value");this.closeCallback(e,t,"ok"===t?n:null)},i.prototype.setRange=function(e){var t=this._find("Input");t.$element&&t.$element.querySelector("input").select(e)},OSjs.Dialogs.Input=Object.seal(i)}(OSjs.API,OSjs.Utils,OSjs.Core.DialogWindow),function(e,t,n,i){"use strict";function o(e,t,n,i){n=n||"application/octet-stream";try{var o=new Blob([t],{type:n}),r=new FileReader;r.onerror=function(e){i(e)},r.onloadend=function(){i(!1,r.result)},r[e](o)}catch(e){e.stack,i(e)}}n.Helpers.filterScandir=function(t,n){function o(e){return!(u.typeFilter&&e.type!==u.typeFilter||!u.showHiddenFiles&&e.filename.match(/^\.\w/))}function r(e){return!(u.mimeFilter&&u.mimeFilter.length&&e.mime)||u.mimeFilter.some(function(t){return!!e.mime.match(t)})}var a=e.cloneObject(i.getSettingsManager().get("VFS")||{}),s=e.cloneObject(n,!0),u=e.argumentDefaults(s,a.scandir||{});u=e.argumentDefaults(u,{sortBy:null,sortDir:"asc",typeFilter:null,mimeFilter:[],showHiddenFiles:!0},!0);var c=t.filter(function(e){return!(".."===e.filename||!o(e))&&!("file"===e.type&&!r(e))}).map(function(e){return"application/vnd.google-apps.folder"===e.mime&&(e.type="dir"),e}),l=u.sortBy,d={mtime:"date",ctime:"date"};return-1!==["filename","size","mime","ctime","mtime"].indexOf(l)&&("date"===d[l]?c.sort(function(e,t){return e=new Date(e[l]),t=new Date(t[l]),e>t?1:t>e?-1:0}):"size"!==l&&String.prototype.localeCompare?c.sort(function(e,t){return String(e[l]).localeCompare(String(t[l]))}):c.sort(function(e,t){return e[l]>t[l]?1:t[l]>e[l]?-1:0}),"desc"===u.sortDir&&c.reverse()),c.filter(function(e){return"dir"===e.type}).concat(c.filter(function(e){return"dir"!==e.type}))},n.Helpers.addFormFile=function(e,t,n,i){if(i=i||{mime:"application/octet-stream",filename:"filename"},n instanceof window.File)e.append(t,n);else if(n instanceof window.ArrayBuffer){try{n=new Blob([n],{type:i.mime})}catch(e){n=null,e.stack}e.append(t,n,i.filename)}else n.data&&n.filename&&e.append(t,n.data,n.filename)},n.Helpers.dataSourceToAb=function(e,t,n){for(var i=atob(e.split(",")[1]),o=new ArrayBuffer(i.length),r=new Uint8Array(o),a=0;a<i.length;a++)r[a]=i.charCodeAt(a);n(!1,o)},n.Helpers.textToAb=function(e,t,n){o("readAsArrayBuffer",e,t,n)},n.Helpers.abToDataSource=function(e,t,n){o("readAsDataURL",e,t,n)},n.Helpers.abToText=function(e,t,n){o("readAsText",e,t,n)},n.Helpers.abToBinaryString=function(e,t,n){o("readAsBinaryString",e,t,n)},n.Helpers.abToBlob=function(e,t,n){t=t||"application/octet-stream";try{var i=new Blob([e],{type:t});n(!1,i)}catch(e){e.stack,n(e)}},n.Helpers.blobToAb=function(e,t){try{var n=new FileReader;n.onerror=function(e){t(e)},n.onloadend=function(){t(!1,n.result)},n.readAsArrayBuffer(e)}catch(e){e.stack,t(e)}},n.Helpers.createFileFromUpload=function(e,t){return new n.File({filename:t.name,path:(e+"/"+t.name).replace(/\/\/\/\/+/,"///"),mime:t.mime||"application/octet-stream",size:t.size})},n.Helpers.createUploadDialog=function(e,i,o){var r=e.destination,a=e.file;t.createDialog("FileUpload",{dest:r,file:a},function(e,t,o){if("ok"!==t&&"complete"!==t)i(!1,!1);else{var a=n.Helpers.createFileFromUpload(r,o);i(!1,a)}},o)}}(OSjs.Utils,OSjs.API,OSjs.VFS,OSjs.Core),function(e,t,n,i){"use strict";function o(e,t){e&&console.error("VFS operation without callback caused an error",e)}function r(e,n,o,r,a,s){var u=i.getMountManager(),c=u.getModuleFromPath(e,!1);if(!c)throw new Error(t._("ERR_VFSMODULE_NOT_FOUND_FMT",e));if("string"!=typeof n)throw new TypeError(t._("ERR_ARGUMENT_FMT","VFS::"+n,"method","String",typeof n));if(!(o instanceof Object))throw new TypeError(t._("ERR_ARGUMENT_FMT","VFS::"+n,"args","Object",typeof o));if(!(r instanceof Function))throw new TypeError(t._("ERR_ARGUMENT_FMT","VFS::"+n,"callback","Function",typeof r));if(a&&!(a instanceof Object))throw new TypeError(t._("ERR_ARGUMENT_FMT","VFS::"+n,"options","Object",typeof a));var l=i.getConnection();l.onVFSRequest(c,n,o,function(e,i){if(2===arguments.length)return void r(e,i);try{u.getModule(c).request(n,o,function(e,t){l.onVFSRequestCompleted(c,n,o,e,t,function(n,i){if(2===arguments.length)return void r(n,i);r(e,t)},s)},a)}catch(e){var d=t._("ERR_VFSMODULE_EXCEPTION_FMT",e.toString());r(d),e.stack}})}function a(e,n,i,o,a,s){function u(e,r){e&&(e=t._(n,e)),o&&(r=o(e,r)),i(e,r)}e.push(u),e.push(a||{}),e.push(s);try{r.apply(null,e)}catch(e){u(e)}}function s(e,t){var n=OSjs.Core.getMountManager(),i=n.getModuleFromPath(e.path,!1,!0);return!!(i&&i.options&&i.options.alias)&&(t?i:e.path.replace(i.match,i.options.alias))}function u(e){return!0===(i.getMountManager().getModuleFromPath(e.path,!1,!0)||{}).readOnly}function c(e,o,r){if("string"==typeof e?e=new n.File(e):"object"==typeof e&&e.path&&(e=new n.File(e)),!(e instanceof n.File))throw new TypeError(o||t._("ERR_VFS_EXPECT_FILE"));var a=s(e);a&&(e.path=a);var c=i.getMountManager();if(!c.getModuleFromPath(e.path,!1))throw new Error(t._("ERR_VFSMODULE_NOT_FOUND_FMT",e.path));if(r&&u(e))throw new Error(t._("ERR_VFSMODULE_READONLY_FMT",c.getModuleFromPath(e.path)));return e}function l(e,t){var n=i.getMountManager();if(n.isInternal(e.path)&&n.isInternal(t.path))return!0;var o=n.getModuleFromPath(e.path,!1,!0)||{},r=n.getModuleFromPath(t.path,!1,!0)||{};return o.transport===r.transport||o.name===r.name}function d(e,i,o){o=o||{};try{!0===o.overwrite?i():n.exists(e,function(e,n){n?i(t._("ERR_VFS_FILE_EXISTS")):i()})}catch(e){i(e)}}function f(t,i,o,r){var a=t.path.split("://")[1].replace(/\/+/g,"/").replace(/^\/?/,"/"),s="/"===a;if(o&&(s=r.path===o.root),!s){if(!i.some(function(e){return".."===e.filename}))return new n.File({filename:"..",path:e.dirname(t.path),mime:null,size:0,type:"dir"})}return!1}function p(e,t){m.forEach(function(n){function i(e){return"dir"===n.type?e.path.substr(0,o.length)===o:e.path===o}var o=n.path,r=!1;t.destination?(r=i(t.destination))||(r=i(t.source)):r=i(t),r&&n.cb(e,t)})}function h(e){var t=OSjs.Core.getMountManager(),n=null;return t.getModules().forEach(function(t){if(!n&&t.module.options&&t.module.options.alias){var i=t.module.options.alias;e.path.substr(0,i.length)===i&&(n=t.module)}}),n}function g(e,i,o){function r(n){t.message(e,n,{source:o?o.__pid:null}),p(e,i)}var a=function(){function e(e){if(e instanceof n.File){var t=new n.File(e),i=h(t);if(i)return t.path=t.path.replace(i.options.alias,i.root),t}return!1}return i instanceof n.File?e(i):i&&i.destination&&i.source?{source:e(i.source),destination:e(i.destination)}:null}();r(i);var s=a.source||a.destination;a&&(a instanceof n.File||s)&&(s&&(a.source=a.source||i.source,a.destination=a.destination||i.destination),r(a))}var m=[];n.find=function(e,n,i,r){if(r=r||{},i=i||o,arguments.length<3)return void i(t._("ERR_VFS_NUM_ARGS"));try{e=c(e)}catch(e){return void i(e)}a([e.path,"find",[e,n]],"ERR_VFSMODULE_FIND_FMT",i,null,r)},n.scandir=function(i,r,u){if(u=u||{},r=r||o,arguments.length<2)return void r(t._("ERR_VFS_NUM_ARGS"));var l=new n.File(i),d=s(l,!0);try{i=c(i)}catch(e){return void r(e)}a([i.path,"scandir",[i]],"ERR_VFSMODULE_SCANDIR_FMT",function(t,o){if(d&&o&&(o=o.map(function(t){var i=!0===t.shortcut,o=new n.File(t);if(!i){var r=t.path.replace(/\/?$/,""),a=d.options.alias.replace(/\/?$/,"");o.path=e.pathJoin(d.root,r.replace(a,""))}return o})),!t&&o instanceof Array&&!1!==u.backlink){var a=f(i,o,d,l);a&&o.unshift(a)}return r(t,o)},null,u)},n.write=function(e,i,a,s,u){function l(e,n){e&&(e=t._("ERR_VFSMODULE_WRITE_FMT",e)),a(e,n)}function d(t){try{r(e.path,"write",[e,t],l,s,u)}catch(e){l(e)}}function f(e,t){if(e)return void l(e,null);d(t)}if(s=s||{},a=a||o,arguments.length<3)return void a(t._("ERR_VFS_NUM_ARGS"));try{e=c(e,null,!0)}catch(e){return void a(e)}try{if("string"==typeof i)i.length?n.Helpers.textToAb(i,e.mime,function(e,t){f(e,t)}):f(null,i);else{if(i instanceof n.FileDataURL)return void n.Helpers.dataSourceToAb(i.toString(),e.mime,function(e,t){f(e,t)});if(window.Blob&&i instanceof window.Blob)return void n.Helpers.blobToAb(i,function(e,t){f(e,t)});d(i)}}catch(e){l(e)}},n.read=function(e,i,a){function s(o,r){if(o)return o=t._("ERR_VFSMODULE_READ_FMT",o),void i(o);if(a.type){var s={datasource:function(){n.Helpers.abToDataSource(r,e.mime,function(e,t){i(e,e?null:t)})},text:function(){n.Helpers.abToText(r,e.mime,function(e,t){i(e,e?null:t)})},blob:function(){n.Helpers.abToBlob(r,e.mime,function(e,t){i(e,e?null:t)})},json:function(){n.Helpers.abToText(r,e.mime,function(e,t){var n;if("string"==typeof t)try{n=JSON.parse(t)}catch(e){e.stack}i(e,e?null:n)})}},u=a.type.toLowerCase();if(s[u])return void s[u]()}i(o,o?null:r)}if(a=a||{},i=i||o,arguments.length<2)return void i(t._("ERR_VFS_NUM_ARGS"));try{e=c(e)}catch(e){return void i(e)}try{r(e.path,"read",[e],function(e,t){s(e,!e&&t)},a)}catch(e){s(e)}},n.copy=function(n,a,s,u,f){function p(e){u.dialog&&u.dialog.setProgress(e)}function h(){function e(e,t){s(e,t)}if(l(n,a))r(n.path,"copy",[n,a],function(n,i){p(100),n&&(n=t._("ERR_VFSMODULE_COPY_FMT",n)),e(n,i)},u,f);else{var i=g.getModuleFromPath(n.path),o=g.getModuleFromPath(a.path);if("dir"===n.type)return void e(t._("ERR_VFSMODULE_COPY_FMT","Copying folders between different transports is not yet supported!"));a.mime=n.mime,g.getModule(i).request("read",[n],function(n,i){if(p(50),n)return void e(t._("ERR_VFS_TRANSFER_FMT",n));g.getModule(o).request("write",[a,i],function(n,i){p(100),n&&(n=t._("ERR_VFSMODULE_COPY_FMT",n)),e(n,i)},u)},u)}}if(u=u||{},s=s||o,arguments.length<3)return void s(t._("ERR_VFS_NUM_ARGS"));var g=i.getMountManager();try{n=c(n,t._("ERR_VFS_EXPECT_SRC_FILE")),a=c(a,t._("ERR_VFS_EXPECT_DST_FILE"),!0)}catch(e){return void s(e)}u=e.argumentDefaults(u,{type:"binary",dialog:null}),u.arrayBuffer=!0,d(a,function(e){if(e)s(t._("ERR_VFSMODULE_COPY_FMT",e));else try{h()}catch(e){s(t._("ERR_VFSMODULE_COPY_FMT",e))}})},n.move=function(e,n,a,s,u){function f(){function i(e,t){a(e,t)}if(l(e,n))r(e.path,"move",[e,n],function(e,n){e&&(e=t._("ERR_VFSMODULE_MOVE_FMT",e)),i(e,e?null:n)},s,u);else{var o=p.getModuleFromPath(e.path);n.mime=e.mime,OSjs.VFS.copy(e,n,function(n,r){n?(n=t._("ERR_VFS_TRANSFER_FMT",n),i(n)):p.getModule(o).request("unlink",[e],function(e,n){e&&(e=t._("ERR_VFS_TRANSFER_FMT",e)),i(e,n)},s)})}}if(s=s||{},a=a||o,arguments.length<3)return void a(t._("ERR_VFS_NUM_ARGS"));var p=i.getMountManager();try{e=c(e,t._("ERR_VFS_EXPECT_SRC_FILE")),n=c(n,t._("ERR_VFS_EXPECT_DST_FILE"),!0)}catch(e){return void a(e)}d(n,function(e){if(e)a(t._("ERR_VFSMODULE_MOVE_FMT",e));else try{f()}catch(e){a(t._("ERR_VFSMODULE_MOVE_FMT",e))}})},n.rename=function(e,t,i){n.move.apply(this,arguments)},n.unlink=function(r,s,u,l){function d(){OSjs.Core.getSettingsManager().instance("PackageManager").get("PackagePaths",[]).some(function(t){var i=new n.File(t);return e.dirname(r.path)===i.path})&&i.getPackageManager().generateUserMetadata(function(){})}if(u=u||{},s=s||o,arguments.length<2)return void s(t._("ERR_VFS_NUM_ARGS"));try{r=c(r,null,!0)}catch(e){return void s(e)}a([r.path,"unlink",[r]],"ERR_VFSMODULE_UNLINK_FMT",s,function(e,t){return e||d(),t},u,l)},function(){n.delete=function(e,t){n.unlink.apply(this,arguments)}}(),n.mkdir=function(e,n,i,r){if(i=i||{},n=n||o,arguments.length<2)return void n(t._("ERR_VFS_NUM_ARGS"));try{e=c(e,null,!0)}catch(e){return void n(e)}d(e,function(o){o?n(t._("ERR_VFSMODULE_MKDIR_FMT",o)):a([e.path,"mkdir",[e]],"ERR_VFSMODULE_MKDIR_FMT",n,function(e,t){return t},i,r)})},n.exists=function(e,n){if(n=n||o,arguments.length<2)return void n(t._("ERR_VFS_NUM_ARGS"));try{e=c(e)}catch(e){return void n(e)}a([e.path,"exists",[e]],"ERR_VFSMODULE_EXISTS_FMT",n)},n.fileinfo=function(e,n){if(n=n||o,arguments.length<2)return void n(t._("ERR_VFS_NUM_ARGS"));try{e=c(e)}catch(e){return void n(e)}a([e.path,"fileinfo",[e]],"ERR_VFSMODULE_FILEINFO_FMT",n)},n.url=function(e,n,i){if(n=n||o,i=i||{},arguments.length<2)return void n(t._("ERR_VFS_NUM_ARGS"));try{e=c(e)}catch(e){return void n(e)}a([e.path,"url",[e]],"ERR_VFSMODULE_URL_FMT",n,function(e,t){return!e&&t},i)},n.upload=function(a,l,f,p){if(l=l||o,f=f||{},a=a||{},arguments.length<2)return void l(t._("ERR_VFS_NUM_ARGS"));if(!a.files)return void l(t._("ERR_VFS_UPLOAD_NO_FILES"));if(!a.destination)return void l(t._("ERR_VFS_UPLOAD_NO_DEST"));var h=i.getMountManager();return h.isInternal(a.destination)?u(n.file(a.destination))?void l(t._("ERR_VFSMODULE_READONLY_FMT",h.getModuleFromPath(a.destination))):void a.files.forEach(function(i,o){var r=i instanceof window.File?i.name:i.filename;d(new n.File(e.pathJoin(a.destination,r)),function(e){if(e)return void l(e);try{var o=new n.File(a.destination),r=s(o);r&&(o=r),n.Transports.OSjs.upload(i,o,function(e,o,r){if(e)if("canceled"===e)l(t._("ERR_VFS_UPLOAD_CANCELLED"),null,r);else{var s=r?r.toString():"Unknown reason",u=t._("ERR_VFS_UPLOAD_FAIL_FMT",s);l(u,null,r)}else{var d=n.Helpers.createFileFromUpload(a.destination,i);d=c(d),g("vfs:upload",d,a.app),l(!1,d,r)}},f)}catch(e){l(t._("ERR_VFS_UPLOAD_FAIL_FMT",e))}},f)}):void a.files.forEach(function(e,t){r(a.destination,"upload",[e,a.destination],l,f)})},n.download=function(){var r=1;return function(a,s){if(s=s||o,a=a||{},arguments.length<2)return void s(t._("ERR_VFS_NUM_ARGS"));try{a=c(a)}catch(e){return void s(e)}if(!a.path)return void s(t._("ERR_VFS_DOWNLOAD_NO_FILE"));var u="DownloadFile_"+r;r++,t.createLoading(u,{className:"BusyNotification",tooltip:t._("TOOLTIP_VFS_DOWNLOAD_NOTIFICATION")});var l=i.getMountManager(),d=l.getModuleFromPath(a.path);if(!l.isInternal(a.path)){var f=a;return f instanceof n.File||(f=new n.File(a.path),a.id&&(f.id=a.id)),void l.getModule(d).request("read",[f],function(e,n){if(t.destroyLoading(u),e)return void s(t._("ERR_VFS_DOWNLOAD_FAILED",e));s(!1,n)})}n.url(a,function(n,i){if(n)return void s(n);e.ajax({url:i,method:"GET",responseType:"arraybuffer",onsuccess:function(e){t.destroyLoading(u),s(!1,e)},onerror:function(e){t.destroyLoading(u),s(n)}})})}}(),n.trash=function(e,n){if(n=n||o,arguments.length<2)return void n(t._("ERR_VFS_NUM_ARGS"));try{e=c(e)}catch(e){return void n(e)}a([e.path,"trash",[e]],"ERR_VFSMODULE_TRASH_FMT",n)},n.untrash=function(e,n){if(n=n||o,arguments.length<2)return void n(t._("ERR_VFS_NUM_ARGS"));try{e=c(e)}catch(e){return void n(e)}a([e.path,"untrash",[e]],"ERR_VFSMODULE_UNTRASH_FMT",n)},n.emptyTrash=function(e){if(e=e||o,arguments.length<1)return void e(t._("ERR_VFS_NUM_ARGS"));a([null,"emptyTrash",[]],"ERR_VFSMODULE_EMPTYTRASH_FMT",e)},n.freeSpace=function(e,n){if(n=n||o,arguments.length<2)return void n(t._("ERR_VFS_NUM_ARGS"));try{e=c(e)}catch(e){return void n(e)}var r=i.getMountManager().getModuleFromPath(e.path,!1,!0);a([e.path,"freeSpace",[r.root]],"ERR_VFSMODULE_FREESPACE_FMT",n)},n.watch=function(e,n){if(n=n||o,arguments.length<2)return n(t._("ERR_VFS_NUM_ARGS")),-1;try{e=c(e)}catch(e){return n(e),-1}return m.push({path:e.path,type:e.type,cb:n})-1},n.unwatch=function(e){void 0!==m[e]&&delete m[e]},n.Helpers=n.Helpers||{},n.Helpers.triggerWatch=function(e,t,n){g("vfs:"+e,t,n)}}(OSjs.Utils,OSjs.API,OSjs.VFS,OSjs.Core),function(e,t,n){"use strict";function i(e){this.dataURL=e}function o(e,n){if(!e)throw new Error(t._("ERR_VFS_FILE_ARGS"));this.path=null,this.filename=null,this.type=null,this.size=null,this.mime=null,this.id=null,this.shortcut=!1,"object"==typeof e?this.setData(e):"string"==typeof e&&(this.path=e,this.setData()),"string"==typeof n&&(n.match(/\//)?this.mime=n:this.type=n),this._guessMime()}i.prototype.toBase64=function(){return this.data.split(",")[1]},i.prototype.toString=function(){return this.dataURL},o.prototype.setData=function(t){var n=this;t&&Object.keys(t).forEach(function(e){"_element"!==e&&(n[e]=t[e])}),this.filename||(this.filename=e.filename(this.path))},o.prototype.getData=function(){return{path:this.path,filename:this.filename,type:this.type,size:this.size,mime:this.mime,id:this.id}},o.prototype.copy=function(e,t,i,o){return n.copy(this,e,t,i,o)},o.prototype.download=function(e){return n.download(this,e)},o.prototype.delete=function(){return this.unlink.apply(this,arguments)},
o.prototype.unlink=function(e,t,i){return n.unlink(this,e,t,i)},o.prototype.exists=function(e){return n.exists(this,e)},o.prototype.mkdir=function(e,t,i){return n.mkdir(this,e,t,i)},o.prototype.move=function(e,t,i,o){var r=this;return n.move(this,e,function(e,n,i){!e&&i&&r.setData(i),t.apply(r,arguments)},i,o)},o.prototype.read=function(e,t){return n.read(this,e,t)},o.prototype.rename=function(){return this.move.apply(this,arguments)},o.prototype.scandir=function(e,t){return n.scandir(this,e,t)},o.prototype.trash=function(e){return n.trash(this,e)},o.prototype.untrash=function(e){return n.untrash(this,e)},o.prototype.url=function(e){return n.url(this,e)},o.prototype.write=function(e,t,i,o){return n.write(this,e,t,i,o)},o.prototype._guessMime=function(){if(!this.mime&&"dir"!==this.type&&this.path&&!this.path.match(/\/$/)){var n=e.filext(this.path);this.mime=t.getConfig("MIME.mapping")["."+n]||"application/octet-stream"}},n.file=function(e,t){return new o(e,t)},n.File=o,n.FileDataURL=i}(OSjs.Utils,OSjs.API,OSjs.VFS),function(e,t,n){"use strict";function i(e,t){return"string"==typeof e&&(e=new n.File(e)),OSjs.Core.getConnection().getVFSPath(e,t)}function o(e,n,i){t.call("FS:"+e,n,function(e,n){e||void 0!==n||(e=t._("ERR_VFS_FATAL")),i(e,n)})}function r(i,o,r,a,s){if(a=a||{},o instanceof n.File&&(o=o.path),void 0!==i.size){var u=t.getConfig("VFS.MaxUploadSize");if(u>0){if(i.size>u){return void r("error",null,t._("DIALOG_UPLOAD_TOO_BIG_FMT",e.humanFileSize(u)))}}}var c=new FormData;c.append("path",o),s&&c.append("filename",s.filename),a&&Object.keys(a).forEach(function(e){"meta"!==e&&"function"!=typeof a[e]&&c.append(e,String(a[e]))}),i instanceof window.ArrayBuffer&&c.append("size",String(i.byteLength)),n.Helpers.addFormFile(c,"upload",i,a.meta),OSjs.Core.getConnection().request("FS:upload",c,r,null,a)}function a(e,i,o,r){if(r=r||{},r.type=r.type||"binary",i=r.mime||"application/octet-stream",arguments.length<1)throw new Error(t._("ERR_VFS_NUM_ARGS"));r=r||{},t.curl({url:e,binary:!0,mime:i},function(e,a){return e?void o(e):a.body?"datasource"===r.type.toLowerCase()?void o(!1,a.body):void n.Helpers.dataSourceToAb(a.body,i,function(e,t){if("text"===r.type)return void n.Helpers.abToText(t,i,function(e,t){o(e,t)});o(e,t)}):void o(t._("ERR_VFS_REMOTEREAD_EMPTY"))})}var s={scandir:function(e,t,i){i=i||{},o("scandir",{path:e.path,options:{shortcuts:i.shortcuts}},function(e,o){var r=[];o&&(o=n.Helpers.filterScandir(o,i),o.forEach(function(e){r.push(new n.File(e))})),t(e,r)})},write:function(t,i,a,s){function u(e){o("write",{path:t.path,data:e},a,s)}if(s=s||{},s.meta=t,s.overwrite=!0,s.onprogress=s.onprogress||function(){},!1===s.upload)return void("string"!=typeof i||i.length?n.Helpers.abToDataSource(i,t.mime,function(e,t){if(e)return void a(e);u(t)}):u(i));r(i,n.file(e.dirname(t.path),t.mime),function(){a(null,!0)},s,t)},read:function(e,t,n){o("get",{path:e.path},t,n)},copy:function(e,t,n){o("copy",{src:e.path,dest:t.path},n)},move:function(e,t,n){o("move",{src:e.path,dest:t.path},n)},unlink:function(e,t){o("delete",{path:e.path},t)},mkdir:function(e,t){o("mkdir",{path:e.path},t)},exists:function(e,t){o("exists",{path:e.path},t)},fileinfo:function(e,t){o("fileinfo",{path:e.path},t)},find:function(e,t,n){o("find",{path:e.path,args:t},n)},url:function(e,t,i){t(!1,n.Transports.OSjs.path(e,i))},freeSpace:function(e,t){o("freeSpace",{root:e},t)}};n.Transports.OSjs={request:o,upload:r,fetch:a,module:s,path:i}}(OSjs.Utils,OSjs.API,OSjs.VFS),function(e,t){"use strict";var n={url:function(e,n){var i=t.getBrowserPath(),o=OSjs.Core.getMountManager(),r=o.getModuleFromPath(e.path,!1,!0);n(!1,e.path.replace(r.match,i))}},i=["write","move","unlink","mkdir","exists","fileinfo","trash","untrash","emptyTrash","freeSpace"],o=OSjs.VFS.Transports.OSjs.module;Object.keys(o).forEach(function(e){-1===i.indexOf(e)&&(n[e]=o[e])}),OSjs.VFS.Transports.Dist={module:n,defaults:function(e){e.readOnly=!0,e.searchable=!0}}}(OSjs.Utils,OSjs.API),function(e,t,n){"use strict";n.Transports.HTTP={module:{read:function(e,t,i){n.Transports.OSjs.fetch(e.path,e.mime,t,i)}}},OSjs.Core.getMountManager()._add({readOnly:!0,name:"HTTP",transport:"HTTP",description:"HTTP",visible:!1,searchable:!1,unmount:function(e){e(!1,!1)},mounted:function(){return!0},enabled:function(){return!0},root:"http:///",icon:"places/google-drive.png",match:/^https?\:\/\//})}(OSjs.Utils,OSjs.API,OSjs.VFS),function(e,t){"use strict";function n(e){var t=OSjs.Core.getMountManager(),n=t.getPathProtocol(e.path);return(t.getModuleFromPath(e.path,!1,!0).options||{}).url+n.replace(/^\/+/,"/")}function i(t,i,o){var r=n(i);"scandir"===t&&(r+="/_scandir.json");var a={method:"exists"===t?"HEAD":"GET",url:r,onerror:function(e){o(e)},onsuccess:function(e){o(!1,e)}};"read"===t&&(a.responseType="arraybuffer"),e.ajax(a)}var o={scandir:function(t,n,o){var r=OSjs.Core.getMountManager(),a=r.getRootFromPath(t.path);i("scandir",t,function(i,o){var r=null;if(!i){var s=null;try{s=JSON.parse(o)}catch(e){}if(null===s)i="Failed to parse directory JSON";else{r=s.map(function(e){return e.path=a+e.path.replace(/^\//,""),e});"/"!==e.getPathProtocol(t.path)&&r.unshift({filename:"..",path:e.dirname(t.path),type:"dir",size:0})}}n(i,r)})},read:function(e,t,n){n=n||{};var o=e.mime||"application/octet-stream";i("read",e,function(e,i){if(!e&&"text"===n.type)return void OSjs.VFS.Helpers.abToText(i,o,function(e,n){t(e,n)});t(e,i)})},exists:function(e,t){i("exists",e,function(e){t(e,!e)})},url:function(e,t,i){t(!1,n(e))}};OSjs.VFS.Transports.Web={defaults:function(e){e.readOnly=!0,e.match=/^https?\:\/\//},module:o,path:n}}(OSjs.Utils,OSjs.API),function(e,t){"use strict";function n(e){var n=OSjs.Core.getMountManager(),i=n.getModuleFromPath(e.path,!1,!0);if(!i)throw new Error(t._("ERR_VFSMODULE_INVALID_FMT",e.path));return i}function i(e){return n(e).options.ns||"DAV:"}function o(e){return!0===n(e).options.cors}function r(t){"string"==typeof t&&(t=new OSjs.VFS.File(t));var i=n(t),o=i.options;return e.parseurl(o.host,{username:o.username,password:o.password}).url}function a(t){var i=n(t);return e.parseurl(i.options.host).path}function s(e){var t=n(e);return e.path.replace(t.match,"")}function u(e,n,i,a){function u(e){return(new DOMParser).parseFromString(e,"application/xml").firstChild}function c(e,t){var n=r(e);return n+=s(t).replace(/^\//,"")}var l=n.mime||"application/octet-stream",d={},f=new OSjs.VFS.File(n.path,l),p=c(n.path,f),h=null;n.dest&&(h=c(n.dest,new OSjs.VFS.File(n.dest,l)),d.Destination=h),o(f)?OSjs.VFS.Transports.OSjs.request("get",{url:p,method:e},i):function(){var o={url:p,method:e,requestHeaders:d};a&&(o.binary=!0,o.mime=l),void 0!==n.data&&(o.query=n.data),t.call("curl",o,function(e,n){if(e)return void i(e);if(!n)return void i(t._("ERR_VFS_REMOTEREAD_EMPTY"));if([200,201,203,204,205,207].indexOf(n.httpCode)<0)return void i(t._("ERR_VFSMODULE_XHR_ERROR")+": "+n.httpCode);if(o.binary)OSjs.VFS.Helpers.dataSourceToAb(n.body,l,i);else{var r=u(n.body);i(!1,r)}})}()}function c(e){"string"==typeof e&&(e=new OSjs.VFS.File(e));var n=r(e),i=s(e).replace(/^\//,""),a=n+i;return o(e)||(a=t.getConfig("Connection.FSURI")+"/get/"+a),a}var l={scandir:function(t,n,o){function r(n){var r=i(t),u=[],l=s(t),d=c.getRootFromPath(t.path);return(n.children||[]).forEach(function(n){var i="file";try{var o=function(){var e=n.getElementsByTagNameNS(r,"href")[0].textContent;return e.substr(a(t).length-1,e.length)}();o.match(/\/$/)&&(i="dir",o=o.replace(/\/$/,"")||"/"),o!==l&&u.push({id:function(){var e=null;try{e=n.getElementsByTagNameNS(r,"getetag")[0].textContent}catch(e){}return e}(),path:d+o.replace(/^\//,""),filename:e.filename(o),size:function(){var e=0;if("file"===i)try{e=parseInt(n.getElementsByTagNameNS(r,"getcontentlength")[0].textContent,10)||0}catch(e){}return e}(),mime:function(){var e=null;if("file"===i)try{e=n.getElementsByTagNameNS(r,"getcontenttype")[0].textContent||"application/octet-stream"}catch(t){e="application/octet-stream"}return e}(),type:i})}catch(e){e.stack}}),OSjs.VFS.Helpers.filterScandir(u,o)}var c=OSjs.Core.getMountManager();u("PROPFIND",{path:t.path},function(e,t){var i=[];if(!e&&t){r(t).forEach(function(e){i.push(new OSjs.VFS.File(e))})}n(e,i)})},write:function(e,t,n,i){u("PUT",{path:e.path,mime:e.mime,data:t},n)},read:function(e,t,n){u("GET",{path:e.path,mime:e.mime},t,!0)},copy:function(e,t,n){u("COPY",{path:e.path,dest:t.path},n)},move:function(e,t,n){u("MOVE",{path:e.path,dest:t.path},n)},unlink:function(e,t){u("DELETE",{path:e.path},t)},mkdir:function(e,t){u("MKCOL",{path:e.path},t)},exists:function(e,t){u("PROPFIND",{path:e.path},function(e,n){t(!1,!e)})},url:function(e,t,n){t(!1,OSjs.VFS.Transports.WebDAV.path(e))},freeSpace:function(e,t){t(!1,-1)}};OSjs.VFS.Transports.WebDAV={module:l,path:c}}(OSjs.Utils,OSjs.API),function(e,t,n){"use strict";var i={scandir:function(e,t,n){var i=OSjs.Core.getPackageManager().getPackages(),o=[];Object.keys(i).forEach(function(e){var t=i[e];"extension"!==t.type&&o.push(new OSjs.VFS.File({filename:t.name,type:"application",path:"applications:///"+e,mime:"osjs/application"},"osjs/application"))}),t(!1,o)}};n.Transports.Applications={module:i,defaults:function(e){e.readOnly=!0,e.special=!0,e.searchable=!0}}}(OSjs.Utils,OSjs.API,OSjs.VFS),function(e,t){"use strict";function n(e,t,n){function i(t){var n={title:e.filename,mimeType:s},i=t;return r+"Content-Type: application/json\r\n\r\n"+JSON.stringify(n)+r+"Content-Type: "+s+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+i+a}var o="-------314159265358979323846",r="\r\n--"+o+"\r\n",a="\r\n--"+o+"--",s=e.mime||"text/plain",u="multipart/mixed; boundary='"+o+"'";t instanceof OSjs.VFS.FileDataURL?n(!1,{contentType:u,body:i(t.toBase64())}):OSjs.VFS.Helpers.abToBinaryString(t,s,function(e,t){n(e,!e&&{contentType:u,body:i(btoa(t))})})}function i(t,n,i){t instanceof OSjs.VFS.File&&(t=t.path);var o=new OSjs.VFS.File({filename:e.filename(t),type:"dir",path:e.dirname(t)});a(o,function(o,r,a){if(o)return void i(o);var s=null;r.forEach(function(i){if(i.title===e.filename(t))if(n){if(i.mimeType===n)return s=i,!1}else s=i;return!0}),i(!1,s)})}function o(t,n){i(e.dirname(t.path),"application/vnd.google-apps.folder",function(e,t){e?n(e):n(!1,t?t.id:null)})}function r(t,n,i,o){function r(n,i){var o=t;".."===n.title?o=e.dirname(t):(u||(o+="/"),o+=n.title);var r="application/vnd.google-apps.folder"===n.mimeType?"dir":"drive#file"===n.kind?"file":"dir";return"application/vnd.google-apps.trash"===n.mimeType&&(r="trash"),new OSjs.VFS.File({filename:n.title,path:o,id:n.id,size:n.quotaBytesUsed||0,mime:"application/vnd.google-apps.folder"===n.mimeType?null:n.mimeType,type:r})}var a=[],s=t.replace(/^google-drive\:\/+/,"/"),u="/"===s;return n&&n.forEach(function(e,t){e&&a.push(r(e,t))}),a?OSjs.VFS.Helpers.filterScandir(a,o):[]}function a(n,i){function o(e){function t(n,i){n.execute(function(o){o.error,i=i.concat(o.items);var r=o.nextPageToken;r?(n=d.client.drive.files.list({pageToken:r}),t(n,i)):(g=i,e(!1,i))})}if(l&&(clearTimeout(l),l=null),g)return void e(!1,g);var n=[];try{t(d.client.drive.files.list({}),n)}catch(t){t.stack,e(!1,n)}}function r(t,i,o){function r(o){var r=[];return d||r.push({title:"..",path:e.dirname(i),id:n.id,quotaBytesUsed:0,mimeType:"application/vnd.google-apps.folder"}),t.forEach(function(e){e&&u[e.id]&&-1!==u[e.id].indexOf(o)&&r.push(e)}),r}function a(e){var n,i=c.shift(),o=c.length<=0;d?n=l:i&&t.forEach(function(e){e&&e.title===i&&u[e.id]&&-1!==u[e.id].indexOf(l)&&(l=e.id,n=e.id)}),o?e(n):a(e)}var s={},u={};t.forEach(function(e){if(e){s[e.id]=e;var t=[];e.parents&&e.parents.forEach(function(e){e&&t.push(e.id)}),u[e.id]=t}});var c=e.getPathFromVirtual(i).replace(/^\/+/,"").split("/");c=c.filter(function(e){return""!==e});var l=h,d=!c.length;a(function(e){return e&&s[e]?void o(!1,r(e)):d?void o(!1,r(l)):void o("Could not list directory")})}function a(){o(function(e,t){var o=n.path;if(e)return void i(e,!1,o);r(t,o,function(e,t){l=setTimeout(function(){g=null},f),i(e,t,o)})})}if(h)a();else{d.client.drive.about.get().execute(function(e){if(!e||!e.rootFolderId)return void i(t._("ERR_VFSMODULE_ROOT_ID"));h=e.rootFolderId,a()})}}function s(e,t,n){function i(i,o){d.client.drive.children.insert({folderId:t,resource:{id:e.id}}).execute(function(e){n(!1,!0)})}t=t||"root",function(t){e.parents.forEach(function(n,i){d.client.drive.children.delete({folderId:n.id,childId:e.id}).execute(function(n){i>=e.parents.length-1&&t()})})}(function(){i(t,n)})}function u(e,n){if(e=e||function(){},n=n||function(){},p){var i=OSjs.Helpers.GoogleAPI.getInstance();i&&!i.authenticated&&(p=!1)}if(!p){var o=["https://www.googleapis.com/auth/drive.install","https://www.googleapis.com/auth/drive.file","openid"],r=["drive-realtime","drive-share"],a={load:r,scope:o};return void OSjs.Helpers.GoogleAPI.createInstance(a,function(i,o){if(i)return void n(i);d.client.load("drive","v2",function(){p=!0,t.message("vfs:mount","GoogleDrive",{source:null}),e(m)})})}e(m)}function c(e,t,n,i){t=t||[],n=n||function(){},u(function(o){if(!o)throw new Error("No GoogleDrive instance was created. Load error ?");if(!o[e])throw new Error("Invalid GoogleDrive API call name");var r=t;r.push(n),r.push(i),o[e].apply(o,r)},function(e){n(e)})}var l,d=window.gapi=window.gapi||{},f=7e3,p=!1,h=null,g=null,m={};m.scandir=function(e,t,n){a(e,function(i,o,a){if(i)t(i);else{var s=r(a,o,e,n);t(!1,s,o)}})},m.read=function(n,o,r){function a(){d.client.drive.files.get({fileId:n.id}).execute(function(n){if(n&&n.id){var i=d.auth.getToken().access_token;e.ajax({url:n.downloadUrl,method:"GET",responseType:"arraybuffer",requestHeaders:{Authorization:"Bearer "+i},onsuccess:function(e){o(!1,e)},onerror:function(e){o(t._("ERR_VFSMODULE_XHR_ERROR")+" - "+e)}})}else o(t._("ERR_VFSMODULE_NOSUCH"))})}n.downloadUrl?a():i(n.path,n.mime,function(e,i){return e?void o(e):i?(n=i,void a()):void o(t._("ERR_VFSMODULE_NOSUCH"))})},m.write=function(e,i,r){function a(o,a){var u="/upload/drive/v2/files",c="POST";a&&(u="/upload/drive/v2/files/"+a,c="PUT"),n(e,i,function(e,n){if(e)return void r(e);d.client.request({path:u,method:c,params:{uploadType:"multipart"},headers:{"Content-Type":n.contentType},body:n.body}).execute(function(e){g=null,e&&e.id?o?s(e,o,r):r(!1,!0):r(t._("ERR_VFSMODULE_NOSUCH"))})})}var u=this;o(e,function(t,n){if(t)return void r(t);e.id?a(n,e.id):u.exists(e,function(e,t){var i=e?null:t?t.id:null;a(n,i)})})},m.copy=function(n,i,o){d.client.drive.files.copy({fileId:e.filename(n),resource:{title:e.filename(i)}}).execute(function(e){if(e.id)return void o(!1,!0);var n=e&&e.message?e.message:t._("ERR_APP_UNKNOWN_ERROR");o(n)})},m.unlink=function(e,n){function o(){g=null,d.client.drive.files.delete({fileId:e.id}).execute(function(e){if(e&&"object"==typeof e.result)n(!1,!0);else{var i=e&&e.message?e.message:t._("ERR_APP_UNKNOWN_ERROR");n(i)}})}e.id?o():i(e.path,e.mime,function(i,r){return i?void n(i):r?(e=r,void o()):void n(t._("ERR_VFSMODULE_NOSUCH"))})},m.move=function(n,i,o){d.client.drive.files.patch({fileId:n.id,resource:{title:e.filename(i.path)}}).execute(function(e){if(e&&e.id)g=null,o(!1,!0);else{var n=e&&e.message?e.message:t._("ERR_APP_UNKNOWN_ERROR");o(n)}})},m.exists=function(e,t){var n=new OSjs.VFS.File(OSjs.Utils.dirname(e.path));this.scandir(n,function(n,i){if(n)return void t(n);var o=!1;i&&i.forEach(function(t){return t.path!==e.path||(o=new OSjs.VFS.File(e.path,t.mimeType),o.id=t.id,o.title=t.title,!1)}),t(!1,o)})},m.fileinfo=function(e,n){d.client.drive.files.get({fileId:e.id}).execute(function(e){if(e&&e.id){var i=["createdDate","id","lastModifyingUser","lastViewedByMeDate","markedViewedByMeDate","mimeType","modifiedByMeDate","modifiedDate","title","alternateLink"],o={};i.forEach(function(t){o[t]=e[t]}),n(!1,o)}else n(t._("ERR_VFSMODULE_NOSUCH"))})},m.url=function(e,n){if(!e||!e.id)throw new Error("url() expects a File ref with Id");d.client.drive.files.get({fileId:e.id}).execute(function(e){if(e&&e.webContentLink)n(!1,e.webContentLink);else{var i=e&&e.message?e.message:t._("ERR_APP_UNKNOWN_ERROR");n(i)}})},m.mkdir=function(n,i){function r(e){d.client.request({path:"/drive/v2/files",method:"POST",body:JSON.stringify({title:n.filename,parents:e,mimeType:"application/vnd.google-apps.folder"})}).execute(function(e){if(e&&e.id)g=null,i(!1,!0);else{var n=e&&e.message?e.message:t._("ERR_APP_UNKNOWN_ERROR");i(n)}})}var a=OSjs.Core.getMountManager();if(e.getPathFromVirtual(e.dirname(n.path))!==e.getPathFromVirtual(a.getModuleProperty("GoogleDrive","root")))return void o(n,function(e,n){if(e||!n)return e=e||t._("ERR_VFSMODULE_PARENT"),void i(t._("ERR_VFSMODULE_PARENT_FMT",e));r([{id:n}])});r(null)},m.upload=function(t,n,i){var o=new OSjs.VFS.File({filename:t.name,path:e.pathJoin(new OSjs.VFS.File(n).path,t.name),mime:t.type,size:t.size});this.write(o,t,i)},m.trash=function(e,n){d.client.drive.files.trash({fileId:e.id}).execute(function(e){if(e.id)return void n(!1,!0);var i=e&&e.message?e.message:t._("ERR_APP_UNKNOWN_ERROR");n(i)})},m.untrash=function(e,n){d.client.drive.files.untrash({fileId:e.id}).execute(function(e){if(e.id)return void n(!1,!0);var i=e&&e.message?e.message:t._("ERR_APP_UNKNOWN_ERROR");n(i)})},m.emptyTrash=function(e){d.client.drive.files.emptyTrash({}).execute(function(n){if(n&&n.message){var i=n&&n.message?n.message:t._("ERR_APP_UNKNOWN_ERROR");return void e(i)}e(!1,!0)})},m.freeSpace=function(e,t){t(!1,-1)},OSjs.Core.getMountManager()._add({readOnly:!1,name:"GoogleDrive",transport:"GoogleDrive",description:"Google Drive",visible:!0,searchable:!1,unmount:function(e){e=e||function(){},p=!1,t.message("vfs:unmount","GoogleDrive",{source:null}),e(!1,!0)},mounted:function(){return p},enabled:function(){try{if(t.getConfig("VFS.GoogleDrive.Enabled"))return!0}catch(e){e.stack}return!1},root:"google-drive:///",icon:"places/google-drive.png",match:/^google-drive\:\/\//,request:c})}(OSjs.Utils,OSjs.API),function(e,t){"use strict";function n(e,t){var n=OSjs.Core.getConfig();try{return t?n.VFS.Dropbox[e]:n.DropboxAPI[e]}catch(e){e.stack}return null}function i(){var e=t.getServiceNotificationIcon();e&&e.remove("Dropbox.js")}function o(){var e=t.getServiceNotificationIcon();e&&e.add("Dropbox.js",[{title:t._("DROPBOX_SIGN_OUT"),onClick:function(){s()}}])}function r(){var e=n("ClientKey");if(this.client=new window.Dropbox.Client({key:e}),this.client){var t=window.location.href;t.match(/\/$/)||(t+="/"),t+="vendor/dropboxOauthReceiver.html";var i=new window.Dropbox.AuthDriver.Popup({receiverUrl:t});this.client.authDriver(i)}}function a(e){if(!c)return c=new r,void c.init(function(n){if(n)return console.error("Failed to initialize dropbox VFS",n),void e(null,n);l=!0,o(),t.message("vfs:mount","Dropbox",{source:null}),e(c)});e(c)}function s(e,n){function o(n){n&&n.reset(),l=!1,c=null,t.message("vfs:unmount","Dropbox",{source:null}),i(),e()}e=e||function(){},n=n||null,a(function(e){if(e=e?e.client:null)try{e.signOut(n,function(){o(e)})}catch(t){o(e)}})}function u(e,t,n,i){t=t||[],n=n||function(){},a(function(o,r){if(!o)return void n("No Dropbox VFS API Instance was ever created. Possible intialization error"+(r?": "+r:""));var a=t;a.push(n),a.push(i),o[e].apply(o,a)})}var c,l=!1;r.prototype.init=function(e){var n=!1,i=setTimeout(function(){n=!0,e(t._("ERR_OPERATION_TIMEOUT_FMT","60s"))},6e4);this.client.authenticate(function(t,o){n||(i=clearTimeout(i),e(t))})},r.prototype.scandir=function(t,n){function i(e){var i=e.map(function(e){return new OSjs.VFS.File({filename:e.name,path:o.getModuleProperty("Dropbox","root").replace(/\/$/,"")+e.path,size:e.size,mime:e.isFolder?null:e.mimeType,type:e.isFolder?"dir":"file"})}),r=OSjs.VFS.Helpers.filterScandir(i,t._opts);n(!1,r)}var o=OSjs.Core.getMountManager(),r=e.getPathFromVirtual(t.path);this.client.readdir(r,{},function(e,t,o,r){if(e)return void n(e);i(r)})},r.prototype.write=function(t,n,i){var o=e.getPathFromVirtual(t.path);this.client.writeFile(o,n,function(e,t){i(e,!0)})},r.prototype.read=function(t,n,i){i=i||{},i.arrayBuffer=!0;var o=e.getPathFromVirtual(t.path);this.client.readFile(o,i,function(e,t){n(e,!e&&(t instanceof Array?t.join("\n"):t))})},r.prototype.copy=function(t,n,i){var o=e.getPathFromVirtual(t.path),r=e.getPathFromVirtual(n.path);this.client.copy(o,r,function(e){i(e,!e)})},r.prototype.move=function(t,n,i){var o=e.getPathFromVirtual(t.path),r=e.getPathFromVirtual(n.path);this.client.move(o,r,function(e){i(e,!e)})},r.prototype.unlink=function(t,n){var i=e.getPathFromVirtual(t.path);this.client.unlink(i,function(e,t){n(e,!e)})},r.prototype.mkdir=function(t,n){var i=e.getPathFromVirtual(t.path);this.client.mkdir(i,function(e,t){n(e,!e)})},r.prototype.exists=function(e,t){this.read(e,function(e,n){t(e,!e)})},r.prototype.fileinfo=function(t,n){var i=e.getPathFromVirtual(t.path);this.client.stat(i,i,function(e,t){var i=null;if(!e&&t){i={};["clientModifiedAt","humanSize","mimeType","modifiedAt","name","path","size","versionTag"].forEach(function(e){i[e]=t[e]})}n(e,i)})},r.prototype.url=function(t,n){var i="string"==typeof t?e.getPathFromVirtual(t):e.getPathFromVirtual(t.path);this.client.makeUrl(i,{downloadHack:!0},function(e,t){n(e,!!t&&t.url)})},r.prototype.upload=function(t,n,i){var o=new OSjs.VFS.File({filename:t.name,path:e.pathJoin(new OSjs.VFS.File(n).path,t.name),mime:t.type,size:t.size});this.write(o,t,i)},r.prototype.trash=function(e,n){n(t._("ERR_VFS_UNAVAILABLE"))},r.prototype.untrash=function(e,n){n(t._("ERR_VFS_UNAVAILABLE"))},r.prototype.emtpyTrash=function(e,n){n(t._("ERR_VFS_UNAVAILABLE"))},r.freeSpace=function(e,t){t(!1,-1)},OSjs.Core.getMountManager()._add({readOnly:!1,name:"Dropbox",transport:"Dropbox",description:"Dropbox",visible:!0,searchable:!1,unmount:function(e){e=e||function(){},l=!1,t.message("vfs:unmount","Dropbox",{source:null}),e(!1,!0)},mounted:function(){return l},enabled:function(){return!!window.Dropbox&&(n("Enabled",!0)||!1)},root:"dropbox:///",icon:"places/dropbox.png",match:/^dropbox\:\/\//,request:u})}(OSjs.Utils,OSjs.API),function(e,t){"use strict";function n(e,t){(window.WL||{}).api(e).then(function(e){t(!1,e)},function(n){console.error("OneDrive::*onedriveCall()","error",n,e),t(n.error.message)})}function i(e){var t="file";return"folder"!==e.type&&"album"!==e.type||(t="dir"),t}function o(e,t){var n="onedrive://"+e.replace(/^\/+/,"").replace(/\/+$/,"")+"/"+t.name;return new OSjs.VFS.File({id:t.id,filename:t.name,size:t.size||0,path:n,mime:r(t),type:i(t)})}function r(n){d||(d=t.getConfig("MIME.mapping",{}));var o=null;if("dir"!==i(n)){o="application/octet-stream";var r=e.filext(n.name);r.length&&(r="."+r,d[r]&&(o=d[r]))}return o}function a(t,n,i,r){var a=[];return"/"!==t&&a.push(new OSjs.VFS.File({id:i.id,filename:"..",path:e.dirname(i.path),size:0,type:"dir"})),n.forEach(function(e){a.push(o(t,e))}),a}function s(e,t){n({path:e+"/files",method:"GET"},function(e,n){if(e)return void t(e);t(!1,n.data||[])})}function u(n,i,o){function r(e){var t,n=u.shift(),i=u.length<=0;if(c)t=l;else if(n)return void s(l,function(t,o){o=o||[];var a;t||(o.forEach(function(e){e&&e.name===n&&(a=e.id)}),a&&(l=a)),i?e(a):r(e)});i?e(t):r(e)}if(!o&&n.id)return void i(!1,n.id);var a=e.getPathFromVirtual(n.path).replace(/\/+/,"/");if(o&&(a=e.dirname(a)),"/"===a)return void i(!1,"me/skydrive");var u=a.replace(/^\/+/,"").split("/"),c=!u.length,l="me/skydrive";r(function(e){e?i(!1,e):i(t._("ONEDRIVE_ERR_RESOLVE"))})}function c(e,n){if(e=e||function(){},n=n||function(){},f){var i=OSjs.Helpers.WindowsLiveAPI.getInstance();i&&!i.authenticated&&(f=!1)}if(!f){var o={scope:["wl.signin","wl.skydrive","wl.skydrive_update"]};return void OSjs.Helpers.WindowsLiveAPI.createInstance(o,function(i,o){i?n(i):(f=!0,t.message("vfs:mount","OneDrive",{source:null}),e(p))})}e(p)}function l(e,t,n,i){t=t||[],n=n||function(){},c(function(o){if(!o)throw new Error("No OneDrive instance was created. Load error ?");if(!o[e])throw new Error("Invalid OneDrive API call name");var r=t;r.push(n),r.push(i),o[e].apply(o,r)},function(e){n(e)})}var d,f=!1,p={};p.scandir=function(t,i,o){function r(e,t){i(e,t)}function c(e){n({path:e,method:"GET"},function(e,n){if(e)return void r(e);s(n.id,function(e,n){if(e)return void r(e);r(!1,a(l,n,t,o))})})}var l=e.getPathFromVirtual(t.path);u(t,function(e,t){if(e)return void r(e);c(t)})},p.read=function(e,t,n){n=n||{},this.url(e,function(i,o){if(i)return void t(i);var r=new OSjs.VFS.File(o,e.mime);OSjs.VFS.read(r,function(e,n){if(e)return void t(e);t(!1,n)},n)})},p.write=function(e,n,i){var o=OSjs.Helpers.WindowsLiveAPI.getInstance(),r="https://apis.live.net/v5.0/me/skydrive/files?access_token="+o.accessToken,a=new FormData;OSjs.VFS.Helpers.addFormFile(a,"file",n,e),OSjs.Utils.ajax({url:r,method:"POST",json:!0,body:a,onsuccess:function(e){if(e&&e.id)return void i(!1,e.id);i(t._("ERR_APP_UNKNOWN_ERROR"))},onerror:function(e,t){t&&t.error&&(e+=" - "+t.error.message),i(e)}})},p.copy=function(e,t,i){u(e,function(e,o){if(e)return void i(e);u(t,function(e,t){if(e)return void i(e);n({path:o,method:"COPY",body:{destination:t}},function(e,t){i(e,!e||null)})})})},p.unlink=function(e,t){u(e,function(e,i){if(e)return void t(e);n({path:i,method:"DELETE"},function(e,n){t(e,!e||null)})})},p.move=function(e,t,i){u(e,function(e,o){if(e)return void i(e);u(t,function(e,t){if(e)return void i(e);n({path:o,method:"MOVE",body:{destination:t}},function(e,t){i(e,!e||null)})})})},p.exists=function(e,t){this.fileinfo(e,function(e,n){if(e)return void t(!1,!1);t(!1,!!n)})},p.fileinfo=function(e,t){u(e,function(e,i){if(e)return void t(e);n({path:i,method:"GET"},function(e,n){if(e)return void t(e);var i=["created_time","id","link","name","type","updated_time","upload_location","description","client_updated_time"],o={};i.forEach(function(e){o[e]=n[e]}),t(!1,o)})})},p.mkdir=function(e,t){u(e,function(i,o){if(i)return void t(i);n({path:o,method:"POST",body:{name:e.filename}},function(e,n){t(e,!e||null)})},!0)},p.upload=function(t,n,i){var o=new OSjs.VFS.File({filename:t.name,path:e.pathJoin(new OSjs.VFS.File(n).path,t.name),mime:t.type,size:t.size});this.write(o,t,i)},p.url=function(e,t){u(e,function(e,i){if(e)return void t(e);n({path:i+"/content",method:"GET"},function(e,n){if(e)return void t(e);t(!1,n.location)})})},p.trash=function(e,n){n(t._("ERR_VFS_UNAVAILABLE"))},p.untrash=function(e,n){n(t._("ERR_VFS_UNAVAILABLE"))},p.emptyTrash=function(e){e(t._("ERR_VFS_UNAVAILABLE"))},p.freeSpace=function(e,t){t(!1,-1)},OSjs.Core.getMountManager()._add({readOnly:!1,name:"OneDrive",transport:"OneDrive",description:"OneDrive",visible:!0,searchable:!1,unmount:function(e){e=e||function(){},f=!1,t.message("vfs:unmount","OneDrive",{source:null}),e(!1,!0)},mounted:function(){return f},enabled:function(){try{if(t.getConfig("VFS.OneDrive.Enabled"))return!0}catch(e){e.stack}return!1},root:"onedrive:///",icon:"places/onedrive.png",match:/^onedrive\:\/\//,request:l})}(OSjs.Utils,OSjs.API),function(e,t){"use strict";function n(t,n){if("string"!=typeof t||!t)throw new TypeError("Expected p as String");t=e.getPathFromVirtual(t).replace(/\/+/g,"/");var i=n?e.dirname(t)||"/":t;return"/"!==i&&(i=i.replace(/\/$/,"")),i}function i(t,n,i){return t=e.cloneObject(t),i.match(/(\/\/)?\/$/)||(i+="/"),t.path=i+t.filename,new OSjs.VFS.File(t)}function o(){if(!p){try{h=JSON.parse(localStorage.getItem(f+"/tree"))||{}}catch(e){}try{g=JSON.parse(localStorage.getItem(f+"/data"))||{}}catch(e){}void 0===h["/"]&&(h["/"]=[]),p=!0,t.message("vfs:mount","LocalStorage",{source:null})}}function r(){try{return localStorage.setItem(f+"/tree",JSON.stringify(h)),localStorage.setItem(f+"/data",JSON.stringify(g)),!0}catch(e){}return!1}function a(i,o,r){var a=n(i.path),s=e.dirname(a),c=void 0===o||null===o?"dir":"file",l=t.getConfig("MIME.mapping"),d=function(t){if("dir"!==t){if(i.mime)return i.mime;var n=e.filext(i.filename);return l["."+n]||"application/octet-stream"}return null}(i.type),f={size:i.size||("file"===c?r.byteLength||r.length||0:0),mime:d,type:c,filename:i.filename};if(void 0===h[s]&&(h[s]=[]),function(e){!1!==e?h[s][e]=f:h[s].push(f)}(u(i)),"dir"===f.type)g[a]&&delete g[a],h[a]=[];else{var p=o.indexOf(",");g[a]=o.substr(p+1)}return!0}function s(t){function i(e){var t=n(e.path);g[t]&&delete g[t],r(e)}function o(e){var t=n(e.path);"/"!==t&&(r(e),h[t]&&delete h[t])}function r(t){var i=n(t.path),o=e.dirname(i);if(h[o]){var r=-1;h[o].forEach(function(e,n){-1===r&&e&&e.type===t.type&&t.filename===t.filename&&(r=n)}),r>=0&&h[o].splice(r,1)}}function a(e){e&&("dir"===e.type?(l(e,!1).forEach(function(e){a(e)}),o(e)):i(e))}return a(t),!0}function u(t){var i=n(t.path),o=e.dirname(i),r=!1;return h[o].forEach(function(e,n){!1===r&&e.filename===t.filename&&(r=n)}),r}function c(t){var n=e.dirname(t),o=e.filename(t),r=null,a=n.replace(/^(.*)\:\/\//,"");return(h[a]||[]).forEach(function(e){r||e.filename!==o||(r=i(e,null,n))}),r}function l(e,t){var o=n(e.path),r=h[o]||!1;return!1!==r&&r.filter(function(e){return!!e}).map(function(t){return i(t,o,e.path)})}function d(e,t,n,i){o();var r=m[e],a=(t||[]).slice(0);return a.push(n||function(){}),a.push(i||{}),r.apply(r,a)}var f="OSjs/VFS/LocalStorage",p=!1,h={},g={},m={scandir:function(e,n,i){var o=l(e,!0);n(!1===o&&t._("ERR_VFSMODULE_NOSUCH"),o)},read:function(e,i,o){o=o||{};var r=n(e.path);!1===function(e){var t=c(r);if(t){var n=g[r];if(n){var i="data:"+t.mime+","+n;return OSjs.VFS.Helpers.dataSourceToAb(i,t.mime,function(n,i){n?e(n):o.url?OSjs.VFS.Helpers.abToBlob(i,t.mime,function(t,n){e(t,URL.createObjectURL(n))}):e(n,i)}),!0}}return!1}(i)&&i(t._("ERR_VFS_FATAL"),!1)},write:function(e,n,i,o){o=o||{};var s=e.mime||"application/octet-stream";!function(e){o.isds?e(!1,n):OSjs.VFS.Helpers.abToDataSource(n,s,function(t,n){t?i(t,!1):e(!1,n)})}(function(o,s){try{a(e,s,n)&&r()?i(o,!0):i(t._("ERR_VFS_FATAL"),!1)}catch(e){i(e)}})},unlink:function(e,n){try{e=c(e.path)||e,s(e)&&r()?n(!1,!0):n(t._("ERR_VFS_FATAL"),!1)}catch(e){n(e)}},copy:function(i,o,r){function a(e,t,n){OSjs.VFS.read(e,function(e,i){e?n(e):OSjs.VFS.write(t,i,n)})}function s(t,n,r){"file"===t.type&&(n.mime=t.mime),n.size=t.size,n.type=t.type,"dir"===n.type?OSjs.VFS.mkdir(n,function(n,a){if(n)r(n);else{var u=l(t,!1);u&&u.length?e.asyncs(u,function(e,t,n){var r=e.path.substr(i.path.length);s(e,new OSjs.VFS.File(o.path+r),n)},function(){r(!1,!0)}):r(!1,!0)}}):a(t,n,r)}i=c(i.path)||i;var u=n(e.dirname(o.path));return"/"===u||c(u)?"dir"===i.type&&i.path===e.dirname(o.path)?void r("You cannot copy a directory into itself"):void s(i,o,r):void r(t._("ERR_VFS_TARGET_NOT_EXISTS"))},move:function(i,o,a){var s=n(i.path),u=n(o.path),c=e.dirname(s),l=e.dirname(u);if(g[u])return void a(t._("ERR_VFS_FILE_EXISTS"));if(c===l){if(g[s]){var d=g[s];delete g[s],g[u]=d}if(h[c]){var f=-1;h[c].forEach(function(e,t){e&&-1===f&&e.filename===i.filename&&e.type===i.type&&(f=t)}),f>=0&&(h[c][f].filename=o.filename)}a(!1,r())}else OSjs.VSF.copy(i,o,function(e){e?a(e):OSjs.VFS.unlink(i,a)})},exists:function(e,t){t(!1,!!c(n(e.path)))},fileinfo:function(e,n){var i=c(e.path);n(!i&&t._("ERR_VFSMODULE_NOSUCH"),i)},mkdir:function(e,i){var o=n(e.path);if("/"!==o&&c(o))return void i(t._("ERR_VFS_FILE_EXISTS"));e.mime=null,e.size=0,e.type="dir";try{a(e)&&r()?i(!1,!0):i(t._("ERR_VFS_FATAL"))}catch(e){i(e)}},upload:function(n,i,o){var r=new OSjs.VFS.File(e.pathJoin(new OSjs.VFS.File(i).path,n.name),n.type);r.size=n.size,r.type="file",OSjs.VFS.exists(r,function(e,i){if(e||i)o(e||t._("ERR_VFS_FILE_EXISTS"));else{var a=new FileReader;a.onerror=function(e){o(e)},a.onloadend=function(){OSjs.VFS.write(r,a.result,o,{isds:!0})},a.readAsDataURL(n)}})},url:function(e,n){OSjs.VFS.exists(e,function(i,o){i||!o?n(i||t._("ERR_VFS_FILE_EXISTS")):OSjs.VFS.read(e,n,{url:!0})})},find:function(e,n){n(t._("ERR_VFS_UNAVAILABLE"))},trash:function(e,n){n(t._("ERR_VFS_UNAVAILABLE"))},untrash:function(e,n){n(t._("ERR_VFS_UNAVAILABLE"))},emptyTrash:function(e){e(t._("ERR_VFS_UNAVAILABLE"))},freeSpace:function(e,t){t(!1,5242880-(JSON.stringify(h).length+JSON.stringify(g).length))}};OSjs.Core.getMountManager()._add({readOnly:!1,name:"LocalStorage",transport:"LocalStorage",
description:t.getConfig("VFS.LocalStorage.Options.description","LocalStorage"),visible:!0,searchable:!1,unmount:function(e){e=e||function(){},p=!1,t.message("vfs:unmount","LocalStorage",{source:null}),e(!1,!0)},mounted:function(){return p},enabled:function(){try{if(t.getConfig("VFS.LocalStorage.Enabled"))return!0}catch(e){e.stack}return!1},root:"localstorage:///",icon:t.getConfig("VFS.LocalStorage.Options.icon","apps/web-browser.png"),match:/^localstorage\:\/\//,request:d})}(OSjs.Utils,OSjs.API),function(e,t,n,i,o,r){"use strict";var a={260:417,728:418,321:419,317:421,346:422,352:425,350:426,356:427,377:428,381:430,379:431,261:433,731:434,322:435,318:437,347:438,711:439,353:441,351:442,357:443,378:444,733:445,382:446,380:447,340:448,258:451,313:453,262:454,268:456,280:458,282:460,270:463,272:464,323:465,327:466,336:469,344:472,366:473,368:475,354:478,341:480,259:483,314:485,263:486,269:488,281:490,283:492,271:495,273:496,324:497,328:498,337:501,369:507,345:504,367:505,355:510,729:511,294:673,292:678,304:681,286:683,308:684,295:689,293:694,305:697,287:699,309:700,266:709,264:710,288:725,284:728,364:733,348:734,267:741,265:742,289:757,285:760,365:765,349:766,312:930,342:931,296:933,315:934,274:938,290:939,358:940,343:947,297:949,316:950,275:954,291:955,359:956,330:957,331:959,256:960,302:967,278:972,298:975,325:977,332:978,310:979,370:985,360:989,362:990,257:992,303:999,279:1004,299:1007,326:1009,333:1010,311:1011,371:1017,361:1021,363:1022,7682:16784898,7683:16784899,7690:16784906,7808:16785024,7810:16785026,7691:16784907,7922:16785138,7710:16784926,7711:16784927,7744:16784960,7745:16784961,7766:16784982,7809:16785025,7767:16784983,7811:16785027,7776:16784992,7923:16785139,7812:16785028,7813:16785029,7777:16784993,372:16777588,7786:16785002,374:16777590,373:16777589,7787:16785003,375:16777591,338:5052,339:5053,376:5054,8254:1150,12290:1185,12300:1186,12301:1187,12289:1188,12539:1189,12530:1190,12449:1191,12451:1192,12453:1193,12455:1194,12457:1195,12515:1196,12517:1197,12519:1198,12483:1199,12540:1200,12450:1201,12452:1202,12454:1203,12456:1204,12458:1205,12459:1206,12461:1207,12463:1208,12465:1209,12467:1210,12469:1211,12471:1212,12473:1213,12475:1214,12477:1215,12479:1216,12481:1217,12484:1218,12486:1219,12488:1220,12490:1221,12491:1222,12492:1223,12493:1224,12494:1225,12495:1226,12498:1227,12501:1228,12504:1229,12507:1230,12510:1231,12511:1232,12512:1233,12513:1234,12514:1235,12516:1236,12518:1237,12520:1238,12521:1239,12522:1240,12523:1241,12524:1242,12525:1243,12527:1244,12531:1245,12443:1246,12444:1247,1776:16778992,1777:16778993,1778:16778994,1779:16778995,1780:16778996,1781:16778997,1782:16778998,1783:16778999,1784:16779e3,1785:16779001,1642:16778858,1648:16778864,1657:16778873,1662:16778878,1670:16778886,1672:16778888,1681:16778897,1548:1452,1748:16778964,1632:16778848,1633:16778849,1634:16778850,1635:16778851,1636:16778852,1637:16778853,1638:16778854,1639:16778855,1640:16778856,1641:16778857,1563:1467,1567:1471,1569:1473,1570:1474,1571:1475,1572:1476,1573:1477,1574:1478,1575:1479,1576:1480,1577:1481,1578:1482,1579:1483,1580:1484,1581:1485,1582:1486,1583:1487,1584:1488,1585:1489,1586:1490,1587:1491,1588:1492,1589:1493,1590:1494,1591:1495,1592:1496,1593:1497,1594:1498,1600:1504,1601:1505,1602:1506,1603:1507,1604:1508,1605:1509,1606:1510,1607:1511,1608:1512,1609:1513,1610:1514,1611:1515,1612:1516,1613:1517,1614:1518,1615:1519,1616:1520,1617:1521,1618:1522,1619:16778835,1620:16778836,1621:16778837,1688:16778904,1700:16778916,1705:16778921,1711:16778927,1722:16778938,1726:16778942,1740:16778956,1746:16778962,1729:16778945,1170:16778386,1171:16778387,1174:16778390,1175:16778391,1178:16778394,1179:16778395,1180:16778396,1181:16778397,1186:16778402,1187:16778403,1198:16778414,1199:16778415,1200:16778416,1201:16778417,1202:16778418,1203:16778419,1206:16778422,1207:16778423,1208:16778424,1209:16778425,1210:16778426,1211:16778427,1240:16778456,1241:16778457,1250:16778466,1251:16778467,1256:16778472,1257:16778473,1262:16778478,1263:16778479,1106:1697,1107:1698,1105:1699,1108:1700,1109:1701,1110:1702,1111:1703,1112:1704,1113:1705,1114:1706,1115:1707,1116:1708,1169:1709,1118:1710,1119:1711,8470:1712,1026:1713,1027:1714,1025:1715,1028:1716,1029:1717,1030:1718,1031:1719,1032:1720,1033:1721,1034:1722,1035:1723,1036:1724,1168:1725,1038:1726,1039:1727,1102:1728,1072:1729,1073:1730,1094:1731,1076:1732,1077:1733,1092:1734,1075:1735,1093:1736,1080:1737,1081:1738,1082:1739,1083:1740,1084:1741,1085:1742,1086:1743,1087:1744,1103:1745,1088:1746,1089:1747,1090:1748,1091:1749,1078:1750,1074:1751,1100:1752,1099:1753,1079:1754,1096:1755,1101:1756,1097:1757,1095:1758,1098:1759,1070:1760,1040:1761,1041:1762,1062:1763,1044:1764,1045:1765,1060:1766,1043:1767,1061:1768,1048:1769,1049:1770,1050:1771,1051:1772,1052:1773,1053:1774,1054:1775,1055:1776,1071:1777,1056:1778,1057:1779,1058:1780,1059:1781,1046:1782,1042:1783,1068:1784,1067:1785,1047:1786,1064:1787,1069:1788,1065:1789,1063:1790,1066:1791,902:1953,904:1954,905:1955,906:1956,938:1957,908:1959,910:1960,939:1961,911:1963,901:1966,8213:1967,940:1969,941:1970,942:1971,943:1972,970:1973,912:1974,972:1975,973:1976,971:1977,944:1978,974:1979,913:1985,914:1986,915:1987,916:1988,917:1989,918:1990,919:1991,920:1992,921:1993,922:1994,923:1995,924:1996,925:1997,926:1998,927:1999,928:2e3,929:2001,931:2002,932:2004,933:2005,934:2006,935:2007,936:2008,937:2009,945:2017,946:2018,947:2019,948:2020,949:2021,950:2022,951:2023,952:2024,953:2025,954:2026,955:2027,956:2028,957:2029,958:2030,959:2031,960:2032,961:2033,963:2034,962:2035,964:2036,965:2037,966:2038,967:2039,968:2040,969:2041,9143:2209,8992:2212,8993:2213,9121:2215,9123:2216,9124:2217,9126:2218,9115:2219,9117:2220,9118:2221,9120:2222,9128:2223,9132:2224,8804:2236,8800:2237,8805:2238,8747:2239,8756:2240,8733:2241,8734:2242,8711:2245,8764:2248,8771:2249,8660:2253,8658:2254,8801:2255,8834:2266,8835:2267,8745:2268,8746:2269,8743:2270,8744:2271,402:2294,8592:2299,8593:2300,8594:2301,8595:2302,9670:2528,9618:2529,9225:2530,9228:2531,9229:2532,9226:2533,9252:2536,9227:2537,9496:2538,9488:2539,9484:2540,9492:2541,9532:2542,9146:2543,9147:2544,9472:2545,9148:2546,9149:2547,9500:2548,9508:2549,9524:2550,9516:2551,9474:2552,8195:2721,8194:2722,8196:2723,8197:2724,8199:2725,8200:2726,8201:2727,8202:2728,8212:2729,8211:2730,8230:2734,8229:2735,8531:2736,8532:2737,8533:2738,8534:2739,8535:2740,8536:2741,8537:2742,8538:2743,8453:2744,8210:2747,8539:2755,8540:2756,8541:2757,8542:2758,8482:2761,8216:2768,8217:2769,8220:2770,8221:2771,8478:2772,8242:2774,8243:2775,10013:2777,9827:2796,9830:2797,9829:2798,10016:2800,8224:2801,8225:2802,10003:2803,10007:2804,9839:2805,9837:2806,9794:2807,9792:2808,9742:2809,8981:2810,8471:2811,8248:2812,8218:2813,8222:2814,8868:3010,8970:3012,8728:3018,9109:3020,8869:3022,9675:3023,8968:3027,8867:3036,8866:3068,8215:3295,1488:3296,1489:3297,1490:3298,1491:3299,1492:3300,1493:3301,1494:3302,1495:3303,1496:3304,1497:3305,1498:3306,1499:3307,1500:3308,1501:3309,1502:3310,1503:3311,1504:3312,1505:3313,1506:3314,1507:3315,1508:3316,1509:3317,1510:3318,1511:3319,1512:3320,1513:3321,1514:3322,3585:3489,3586:3490,3587:3491,3588:3492,3589:3493,3590:3494,3591:3495,3592:3496,3593:3497,3594:3498,3595:3499,3596:3500,3597:3501,3598:3502,3599:3503,3600:3504,3601:3505,3602:3506,3603:3507,3604:3508,3605:3509,3606:3510,3607:3511,3608:3512,3609:3513,3610:3514,3611:3515,3612:3516,3613:3517,3614:3518,3615:3519,3616:3520,3617:3521,3618:3522,3619:3523,3620:3524,3621:3525,3622:3526,3623:3527,3624:3528,3625:3529,3626:3530,3627:3531,3628:3532,3629:3533,3630:3534,3631:3535,3632:3536,3633:3537,3634:3538,3635:3539,3636:3540,3637:3541,3638:3542,3639:3543,3640:3544,3641:3545,3642:3546,3647:3551,3648:3552,3649:3553,3650:3554,3651:3555,3652:3556,3653:3557,3654:3558,3655:3559,3656:3560,3657:3561,3658:3562,3659:3563,3660:3564,3661:3565,3664:3568,3665:3569,3666:3570,3667:3571,3668:3572,3669:3573,3670:3574,3671:3575,3672:3576,3673:3577,1415:16778631,1417:16778633,1373:16778589,1418:16778634,1372:16778588,1371:16778587,1374:16778590,1329:16778545,1377:16778593,1330:16778546,1378:16778594,1331:16778547,1379:16778595,1332:16778548,1380:16778596,1333:16778549,1381:16778597,1334:16778550,1382:16778598,1335:16778551,1383:16778599,1336:16778552,1384:16778600,1337:16778553,1385:16778601,1338:16778554,1386:16778602,1339:16778555,1387:16778603,1340:16778556,1388:16778604,1341:16778557,1389:16778605,1342:16778558,1390:16778606,1343:16778559,1391:16778607,1344:16778560,1392:16778608,1345:16778561,1393:16778609,1346:16778562,1394:16778610,1347:16778563,1395:16778611,1348:16778564,1396:16778612,1349:16778565,1397:16778613,1350:16778566,1398:16778614,1351:16778567,1399:16778615,1352:16778568,1400:16778616,1353:16778569,1401:16778617,1354:16778570,1402:16778618,1355:16778571,1403:16778619,1356:16778572,1404:16778620,1357:16778573,1405:16778621,1358:16778574,1406:16778622,1359:16778575,1407:16778623,1360:16778576,1408:16778624,1361:16778577,1409:16778625,1362:16778578,1410:16778626,1363:16778579,1411:16778627,1364:16778580,1412:16778628,1365:16778581,1413:16778629,1366:16778582,1414:16778630,1370:16778586,4304:16781520,4305:16781521,4306:16781522,4307:16781523,4308:16781524,4309:16781525,4310:16781526,4311:16781527,4312:16781528,4313:16781529,4314:16781530,4315:16781531,4316:16781532,4317:16781533,4318:16781534,4319:16781535,4320:16781536,4321:16781537,4322:16781538,4323:16781539,4324:16781540,4325:16781541,4326:16781542,4327:16781543,4328:16781544,4329:16781545,4330:16781546,4331:16781547,4332:16781548,4333:16781549,4334:16781550,4335:16781551,4336:16781552,4337:16781553,4338:16781554,4339:16781555,4340:16781556,4341:16781557,4342:16781558,7818:16785034,300:16777516,437:16777653,486:16777702,415:16777631,7819:16785035,301:16777517,438:16777654,487:16777703,466:16777682,629:16777845,399:16777615,601:16777817,7734:16784950,7735:16784951,7840:16785056,7841:16785057,7842:16785058,7843:16785059,7844:16785060,7845:16785061,7846:16785062,7847:16785063,7848:16785064,7849:16785065,7850:16785066,7851:16785067,7852:16785068,7853:16785069,7854:16785070,7855:16785071,7856:16785072,7857:16785073,7858:16785074,7859:16785075,7860:16785076,7861:16785077,7862:16785078,7863:16785079,7864:16785080,7865:16785081,7866:16785082,7867:16785083,7868:16785084,7869:16785085,7870:16785086,7871:16785087,7872:16785088,7873:16785089,7874:16785090,7875:16785091,7876:16785092,7877:16785093,7878:16785094,7879:16785095,7880:16785096,7881:16785097,7882:16785098,7883:16785099,7884:16785100,7885:16785101,7886:16785102,7887:16785103,7888:16785104,7889:16785105,7890:16785106,7891:16785107,7892:16785108,7893:16785109,7894:16785110,7895:16785111,7896:16785112,7897:16785113,7898:16785114,7899:16785115,7900:16785116,7901:16785117,7902:16785118,7903:16785119,7904:16785120,7905:16785121,7906:16785122,7907:16785123,7908:16785124,7909:16785125,7910:16785126,7911:16785127,7912:16785128,7913:16785129,7914:16785130,7915:16785131,7916:16785132,7917:16785133,7918:16785134,7919:16785135,7920:16785136,7921:16785137,7924:16785140,7925:16785141,7926:16785142,7927:16785143,7928:16785144,7929:16785145,416:16777632,417:16777633,431:16777647,432:16777648,8352:16785568,8353:16785569,8354:16785570,8355:16785571,8356:16785572,8357:16785573,8358:16785574,8359:16785575,8360:16785576,8361:16785577,8362:16785578,8363:16785579,8364:8364,8304:16785520,8308:16785524,8309:16785525,8310:16785526,8311:16785527,8312:16785528,8313:16785529,8320:16785536,8321:16785537,8322:16785538,8323:16785539,8324:16785540,8325:16785541,8326:16785542,8327:16785543,8328:16785544,8329:16785545,8706:16785922,8709:16785925,8712:16785928,8713:16785929,8715:16785931,8730:16785946,8731:16785947,8732:16785948,8748:16785964,8749:16785965,8757:16785973,8773:16785992,8775:16785991,8802:16786018,8803:16786019,10240:16787456,10241:16787457,10242:16787458,10243:16787459,10244:16787460,10245:16787461,10246:16787462,10247:16787463,10248:16787464,10249:16787465,10250:16787466,10251:16787467,10252:16787468,10253:16787469,10254:16787470,10255:16787471,10256:16787472,10257:16787473,10258:16787474,10259:16787475,10260:16787476,10261:16787477,10262:16787478,10263:16787479,10264:16787480,10265:16787481,10266:16787482,10267:16787483,10268:16787484,10269:16787485,10270:16787486,10271:16787487,10272:16787488,10273:16787489,10274:16787490,10275:16787491,10276:16787492,10277:16787493,10278:16787494,10279:16787495,10280:16787496,10281:16787497,10282:16787498,10283:16787499,10284:16787500,10285:16787501,10286:16787502,10287:16787503,10288:16787504,10289:16787505,10290:16787506,10291:16787507,10292:16787508,10293:16787509,10294:16787510,10295:16787511,10296:16787512,10297:16787513,10298:16787514,10299:16787515,10300:16787516,10301:16787517,10302:16787518,10303:16787519,10304:16787520,10305:16787521,10306:16787522,10307:16787523,10308:16787524,10309:16787525,10310:16787526,10311:16787527,10312:16787528,10313:16787529,10314:16787530,10315:16787531,10316:16787532,10317:16787533,10318:16787534,10319:16787535,10320:16787536,10321:16787537,10322:16787538,10323:16787539,10324:16787540,10325:16787541,10326:16787542,10327:16787543,10328:16787544,10329:16787545,10330:16787546,10331:16787547,10332:16787548,10333:16787549,10334:16787550,10335:16787551,10336:16787552,10337:16787553,10338:16787554,10339:16787555,10340:16787556,10341:16787557,10342:16787558,10343:16787559,10344:16787560,10345:16787561,10346:16787562,10347:16787563,10348:16787564,10349:16787565,10350:16787566,10351:16787567,10352:16787568,10353:16787569,10354:16787570,10355:16787571,10356:16787572,10357:16787573,10358:16787574,10359:16787575,10360:16787576,10361:16787577,10362:16787578,10363:16787579,10364:16787580,10365:16787581,10366:16787582,10367:16787583,10368:16787584,10369:16787585,10370:16787586,10371:16787587,10372:16787588,10373:16787589,10374:16787590,10375:16787591,10376:16787592,10377:16787593,10378:16787594,10379:16787595,10380:16787596,10381:16787597,10382:16787598,10383:16787599,10384:16787600,10385:16787601,10386:16787602,10387:16787603,10388:16787604,10389:16787605,10390:16787606,10391:16787607,10392:16787608,10393:16787609,10394:16787610,10395:16787611,10396:16787612,10397:16787613,10398:16787614,10399:16787615,10400:16787616,10401:16787617,10402:16787618,10403:16787619,10404:16787620,10405:16787621,10406:16787622,10407:16787623,10408:16787624,10409:16787625,10410:16787626,10411:16787627,10412:16787628,10413:16787629,10414:16787630,10415:16787631,10416:16787632,10417:16787633,10418:16787634,10419:16787635,10420:16787636,10421:16787637,10422:16787638,10423:16787639,10424:16787640,10425:16787641,10426:16787642,10427:16787643,10428:16787644,10429:16787645,10430:16787646,10431:16787647,10432:16787648,10433:16787649,10434:16787650,10435:16787651,10436:16787652,10437:16787653,10438:16787654,10439:16787655,10440:16787656,10441:16787657,10442:16787658,10443:16787659,10444:16787660,10445:16787661,10446:16787662,10447:16787663,10448:16787664,10449:16787665,10450:16787666,10451:16787667,10452:16787668,10453:16787669,10454:16787670,10455:16787671,10456:16787672,10457:16787673,10458:16787674,10459:16787675,10460:16787676,10461:16787677,10462:16787678,10463:16787679,10464:16787680,10465:16787681,10466:16787682,10467:16787683,10468:16787684,10469:16787685,10470:16787686,10471:16787687,10472:16787688,10473:16787689,10474:16787690,10475:16787691,10476:16787692,10477:16787693,10478:16787694,10479:16787695,10480:16787696,10481:16787697,10482:16787698,10483:16787699,10484:16787700,10485:16787701,10486:16787702,10487:16787703,10488:16787704,10489:16787705,10490:16787706,10491:16787707,10492:16787708,10493:16787709,10494:16787710,10495:16787711};OSjs.Broadway.unicodeTable=a}(OSjs.Core.Application,OSjs.Core.Window,OSjs.Utils,OSjs.VFS,OSjs.GUI,OSjs.API),function(e,t,n,i,o,r){"use strict";function a(e,n,i,o,r,a){t.apply(this,["BroadwayWindow"+String(e),{width:o,height:r,title:"Broadway Window "+String(e),min_width:100,min_height:100,allow_resize:!1,allow_minimize:!1,allow_maximize:!1,allow_session:!1,key_capture:!0}]),this._broadwayId=e,this._canvas=a}a.prototype=Object.create(t.prototype),a.prototype.init=function(){function e(e){var t=OSjs.Core.getWindowManager(),n=t?t.getStyleTheme(!0):null,i=n?n.style.window.margin:26;return{x:e.pageX-o._position.x,y:e.pageY-o._position.y-i}}function i(t,n){var i=e(n);return OSjs.Broadway.GTK.inject(o._broadwayId,t,n,{wx:o._position.x,wy:o._position.y,mx:parseInt(i.x,0),my:parseInt(i.y,0)})}var o=this,r=t.prototype.init.apply(this,arguments);return this._canvas.width=this._dimension.w,this._canvas.height=this._dimension.h,n.$bind(r,"mouseover",function(e){return i("mouseover",e)}),n.$bind(r,"mouseout",function(e){return i("mouseout",e)}),n.$bind(r,"mousemove",function(e){return i("mousemove",e)}),n.$bind(r,"mousedown",function(e){return i("mousedown",e)}),n.$bind(r,"mouseup",function(e){return i("mouseup",e)}),n.$bind(r,"DOMMouseScroll",function(e){return i("mousewheel",e)}),n.$bind(r,"mousewheel",function(e){return i("mousewheel",e)}),r.appendChild(this._canvas),r},a.prototype.destroy=function(){t.prototype.destroy.apply(this,arguments),this._canvas=null},a.prototype._inited=function(){t.prototype._inited.apply(this,arguments),this._onChange("move",!0)},a.prototype._close=function(){return!!t.prototype._close.apply(this,arguments)&&(OSjs.Broadway.GTK.close(this._broadwayId),!0)},a.prototype._resize=function(e,n){return!!t.prototype._resize.apply(this,[e,n,!0])&&(this._canvas&&function(e,t,n){var i=e.ownerDocument.createElement("canvas");i.width=e.width,i.height=e.height;var o=i.getContext("2d");o.globalCompositeOperation="copy",o.drawImage(e,0,0,i.width,i.height),e.width=t,e.height=n;var r=e.getContext("2d");r.globalCompositeOperation="copy",r.drawImage(i,0,0,i.width,i.height)}(this._canvas,e,n),!0)},a.prototype._onKeyEvent=function(e,t){OSjs.Broadway.GTK.inject(this._broadwayId,t,e)},a.prototype._onChange=function(e,t){t&&("move"===e?OSjs.Broadway.GTK.move(this._broadwayId,this._position.x,this._position.y):"resize"===e&&OSjs.Broadway.GTK.resize(this._broadwayId,this._dimension.w,this._dimension.h))},OSjs.Broadway.Window=a}(OSjs.Core.Application,OSjs.Core.Window,OSjs.Utils,OSjs.VFS,OSjs.GUI,OSjs.API),function(e,t,n,i,o,r){"use strict";function a(e){this.arraybuffer=e,this.u8=new Uint8Array(e),this.length=this.u8.length,this.pos=0}function s(e,t,n){var i=e.ownerDocument.createElement("canvas");i.width=e.width,i.height=e.height;var o=i.getContext("2d");o.globalCompositeOperation="copy",o.drawImage(e,0,0,i.width,i.height),e.width=t,e.height=n;var r=e.getContext("2d");r.globalCompositeOperation="copy",r.drawImage(i,0,0,i.width,i.height)}function u(e,t,n,i,o,r,a,s){t+a>e.width&&(a=e.width-t),n+s>e.height&&(s=e.height-n),o+a>i.width&&(a=i.width-o),r+s>i.height&&(s=i.height-r);for(var u=4*e.width*n+4*t,c=4*i.width*r+4*o,l=0;l<s;l++){var d=e.data.subarray(u,u+4*a);i.data.set(d,c),u+=4*e.width,c+=4*i.width}}function c(e,t,n,i,o,r){var a,s=e.createImageData(n,i);null!==t&&u(t,0,0,s,0,0,t.width,t.height);for(var c=0,l=0;c<o.length;){var d,f=o[c++],p=o[c++],h=o[c++],g=o[c++];if(0!==g)s.data[l++]=h,s.data[l++]=p,s.data[l++]=f,s.data[l++]=g;else{var m=240&h;switch(m){case 0:s.data[l++]=0,s.data[l++]=0,s.data[l++]=0,s.data[l++]=0;break;case 16:d=(15&h)<<16|p<<8|f,l+=4*d;break;case 32:var v=(15&h)<<16|p<<8|f,_=(t.width+32-1)/32|0,y=32*(v/_|0),S=32*(v%_|0);f=o[c++],p=o[c++],h=o[c++],g=o[c++];u(t,S,y,s,g<<8|h,p<<8|f,32,32);break;case 48:for(d=(15&h)<<16|p<<8|f,f=o[c++],p=o[c++],h=o[c++],g=o[c++],a=0;a<d;a++)s.data[l++]=h,s.data[l++]=p,s.data[l++]=f,s.data[l++]=g;break;case 64:for(d=(15&h)<<16|p<<8|f,f=o[c++],p=o[c++],h=o[c++],g=o[c++],a=0;a<d;a++)s.data[l]=s.data[l]+h&255,l++,s.data[l]=s.data[l]+p&255,l++,s.data[l]=s.data[l]+f&255,l++,s.data[l]=s.data[l]+g&255,l++;break;default:console.error("Unknown buffer commend "+m)}}}return s}function l(e,t){var n=t;if(e.target){var i=e.target.getAttribute("data-surface-id");i&&(n=parseInt(i,10))}return n}function d(e,t){if(null!==W){var n=[e.charCodeAt(0),H,z].concat(t),i=new window.ArrayBuffer(4*n.length),o=new window.DataView(i);n.forEach(function(e,t){o.setInt32(4*t,e,!1)}),W.send(i)}}function f(e){x&=~(M|R|k),e.shiftKey&&(x|=M),e.ctrlKey&&(x|=R),e.altKey&&(x|=k),z=e.timeStamp}function p(e){return 1===e?D:2===e?N:3===e?L:4===e?P:5===e?$:0}function h(e){return e=e||window.event,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1,!1}function g(e){var t,n=["type","keyCode","charCode","which","altKey","ctrlKey","shiftKey","keyLocation","keyIdentifier"],i={};for(t=0;t<n.length;t++)void 0!==e[n[t]]&&(i[n[t]]=e[n[t]]);return i}function m(e){return void 0!==e.which&&e.which>0?e.which:e.keyCode}function v(e){var t=m(e),n=OSjs.Broadway.unicodeTable;return t>255&&t<65280&&void 0===(t=n[t])&&(t=0),t}function _(e){return 229===e.keyCode}function y(e){if(e.keyCode in V){var t=V[e.keyCode],n=0;if("number"!=typeof t&&(n=t[1],t=t[0]),"keydown"===e.type||n&U)return t}if(!e.ctrlKey&&!e.altKey)return null;var i=m(e);switch(i){case 186:i=59;break;case 187:i=61;break;case 188:i=44;break;case 109:case 189:i=45;break;case 190:i=46;break;case 191:i=47;break;case 192:i=96;break;case 219:i=91;break;case 220:i=92;break;case 221:i=93;break;case 222:i=39}if(e.shiftKey)switch(i){case 48:i=41;break;case 49:i=33;break;case 50:i=64;break;case 51:i=35;break;case 52:i=36;break;case 53:i=37;break;case 54:i=94;break;case 55:i=38;break;case 56:i=42;break;case 57:i=40;break;case 59:i=58;break;case 61:i=43;break;case 44:i=60;break;case 45:i=95;break;case 46:i=62;break;case 47:i=63;break;case 96:i=126;break;case 91:i=123;break;case 92:i=124;break;case 93:i=125;break;case 39:i=34}else if(i>=65&&i<=90)i+=32;else if(3===e.keyLocation)switch(i){case 96:i=48;break;case 97:i=49;break;case 98:i=50;break;case 99:i=51;break;case 100:i=52;break;case 101:i=53;break;case 102:i=54;break;case 103:i=55;break;case 104:i=56;break;case 105:i=57;break;case 109:i=45;break;case 110:i=46;break;case 111:i=47}return i}function S(e,t){var n,i=null;for(n=G.length-1;n>=0;n--)if(G[n].keyCode===e){i=void 0!==t&&t?G.splice(n,1)[0]:G[n];break}return i}function w(e,t){d("g",[])}function b(){d("u",[])}function O(e,t,n,i){var o=B[e],r=o.canvas.getContext("2d"),a=new window.Zlib.RawInflate(i),s=a.decompress(),u=c(r,o.imageData,t,n,s,!1);r.putImageData(u,0,0),o.imageData=u}function E(e){d("w",[e.id,e.x,e.y,e.width,e.height])}function j(e,t,n,i,o,r,a){var u=B[e];if(t&&(u.positioned=!0,u.x=n,u.y=i),o&&(u.width=r,u.height=a),o&&s(u.canvas,r,a),u.isTemp){if(t){var c=B[u.transientParent],l=u.x-c.x,d=u.y-c.y;u.xOff=l,u.yOff=d,u.canvas.style.left=l+"px",u.canvas.style.top=d+"px"}}else u.visible&&OSjs.Broadway.Events.onMoveSurface(e,t,o,u);E(u)}function C(e){var t=B[e];t&&(t.canvas.parentNode&&t.canvas.parentNode.removeChild(t.canvas),OSjs.Broadway.Events.onDeleteSurface(e),delete B[e])}function A(e,t){var n=B[e];if(n){if(n.transientParent===t)return;n.transientParent=t;var i=B[t];n.positioned&&i.canvas.parentNode.appendChild(n.canvas)}}function I(e){var t=B[e];t&&(t.visible=!1,t.canvas&&(t.canvas.style.display="none"),OSjs.Broadway.Events.onHideSurface(e))}function F(e){var t=B[e];t&&(t.visible=!0,t.canvas&&(t.canvas.style.display="inline"),OSjs.Broadway.Events.onShowSurface(e))}function T(e,t,n,i,o,r){var a={id:e,xOff:0,yOff:0,x:t,y:n,width:i,height:o,isTemp:r,positioned:r,transientParent:0,visible:!1,imageData:null,canvas:document.createElement("canvas")};a.canvas.width=i,a.canvas.height=o,a.canvas.setAttribute("data-surface-id",String(e)),r&&(a.canvas.style.position="absolute",a.canvas.style.left=t+"px",a.canvas.style.top=n+"px",a.canvas.style.zIndex="9999999",a.canvas.style.display="none"),OSjs.Broadway.Events.onCreateSurface(e,a),B[e]=a,E(a)}var x,M=1,R=4,k=8,D=256,N=512,L=1024,P=2048,$=4096,U=1,V={8:[65288,U],13:[65293,U],9:[65289,U],27:65307,46:65535,36:65360,35:65367,33:65365,34:65366,45:65379,37:65361,38:65362,39:65363,40:65364,16:65505,17:65507,18:65513,112:65470,113:65471,114:65472,115:65473,116:65474,117:65475,118:65476,119:65477,120:65478,121:65479,122:65480,123:65481},W=null,H=0,z=0,B={},G=[],q=[];a.prototype.get_char=function(){return String.fromCharCode(this.u8[this.pos++])},a.prototype.get_bool=function(){return 0!==this.u8[this.pos++]},a.prototype.get_flags=function(){return this.u8[this.pos++]},a.prototype.get_16=function(){var e=this.u8[this.pos]+(this.u8[this.pos+1]<<8);return this.pos=this.pos+2,e},a.prototype.get_16s=function(){var e=this.get_16();return e>32767?e-65536:e},a.prototype.get_32=function(){var e=this.u8[this.pos]+(this.u8[this.pos+1]<<8)+(this.u8[this.pos+2]<<16)+(this.u8[this.pos+3]<<24);return this.pos=this.pos+4,e},a.prototype.get_data=function(){var e=this.get_32(),t=new Uint8Array(this.arraybuffer,this.pos,e);return this.pos=this.pos+e,t};var K={D:function(){OSjs.Broadway.GTK.disconnect()},s:function(e){T(e.get_16(),e.get_16s(),e.get_16s(),e.get_16(),e.get_16(),e.get_bool())},S:function(e){F(e.get_16())},H:function(e){I(e.get_16())},p:function(e){A(e.get_16(),e.get_16())},d:function(e){C(e.get_16())},m:function(e){var t,n,i,o,r=e.get_16(),a=e.get_flags(),s=1&a;s&&(t=e.get_16s(),n=e.get_16s());var u=2&a;u&&(i=e.get_16(),o=e.get_16()),j(r,s,t,n,u,i,o)},r:function(e){e.get_16()},R:function(e){e.get_16()},b:function(e){O(e.get_16(),e.get_16(),e.get_16(),e.get_data())},g:function(e){w(e.get_16(),e.get_bool())},u:function(){b()}},Y={mousewheel:function(e,t,n,i,o,r,a){var s=n.detail?n.detail:-n.wheelDelta;d("s",[e,t,i,o,r,a,x,s>0?1:0])},mousedown:function(e,t,n,i,o,r,a){f(n);var s=n.button+1;x|=p(s),d("b",[e,t,i,o,r,a,x,s])},mouseup:function(e,t,n,i,o,r,a){f(n);var s=n.button+1;x&=~p(s),d("B",[e,t,i,o,r,a,x,s])},mouseover:function(e,t,n,i,o,r,a){f(n),0!==e&&d("e",[e,t,i,o,r,a,x,0])},mouseout:function(e,t,n,i,o,r,a){f(n),0!==e&&d("l",[e,t,i,o,r,a,x,0])},mousemove:function(e,t,n,i,o,r,a){f(n),d("m",[e,t,i,o,r,a,x])},keydown:function(e,t,n){f(n);var i=g(n||window.event),o=y(n),r=!1;i.keysym=o,o&&(_(n)||d("k",[o,x]),r=!0),_(n)||G.push(i),r&&h(n)},keypress:function(e,t,n){var i=G.length;if(void 0!==n.which&&0===n.which||y(n))return void h(n);var o=v(n);i>0&&(G[i-1].keysym=o),o>0&&d("k",[o,x]),h(n)},keyup:function(e,t,n){var i=S(n.keyCode,!0),o=i?i.keysym:0;o>0&&d("K",[o,x]),h(n)}},J={connect:function(e,t){function n(e){for(;e.pos<e.length;){var t=e.get_char();H=e.get_32(),K[t]&&K[t](e)}return!0}W&&OSjs.Broadway.Connection.disconnect(),W=new WebSocket(e,"broadway"),W.binaryType="arraybuffer",W.onopen=function(){OSjs.Broadway.Events.onSocketOpen()},W.onclose=function(){W=null,OSjs.Broadway.Events.onSocketClose()},W.onmessage=function(e){var t=e.data,i=new a(t);if(q.push(i),1===q.length)for(;q.length>0;)if(i=q.shift(),!n(i))return void q.unshift(i)}},disconnect:function(){W&&W.close(),W=null},move:function(e,t,n){if(B[e]){var i=B[e];i.x=t,i.y=n,E(i)}},close:function(e){B[e]&&d("W",[e])},send:function(e,t){d(e,t)},inject:function(e,t,n,i){if("resize"===t)return void d("d",[i.width,i.height]);if("blur"!==t){var o=B[e];if(o){var r=l(n,e),a=-1,s=-1,u=-1,c=-1;if(i){var f=B[r]||o;u=i.mx-f.xOff,c=i.my-f.yOff,a=f.x+u,s=f.y+c}Y[t]&&Y[t](e,r,n,a,s,u,c)}}}};OSjs.Broadway.GTK=J}(OSjs.Core.Application,OSjs.Core.Window,OSjs.Utils,OSjs.VFS,OSjs.GUI,OSjs.API),function(e,t,n,i,o,r){"use strict";function a(e){var t=e.protocol||window.location.protocol.replace(/^http/,"ws"),n=e.host||window.location.hostname;return"localhost"===n&&n!==window.location.hostname&&(n=window.location.hostname),t+"//"+n+":"+e.port+"/"+e.uri}function s(e,t){var n=OSjs.Core.getWindowManager();if(n){var i=n.getWindow("BroadwayWindow"+String(e));if(i)return t(i)}return null}function u(){var e=OSjs.Core.getWindowManager();e&&e.removeNotificationIcon("BroadwayService")}function c(){var e=OSjs.Core.getWindowManager();if(e){var t=e.getNotificationIcon("BroadwayService");t&&(t.$image.style.opacity=m?1:.4)}}function l(){function e(e){var t=[];m?(t.push({title:"Disconnect from Broadway server",onClick:function(){OSjs.Broadway.Connection.disconnect()}}),t.push({title:"Create new process",onClick:function(){r.createDialog("Input",{message:"Launch process",value:"/usr/bin/gtk3-demo"},function(e,t,n){"ok"===t&&n&&OSjs.Broadway.Connection.spawn(n)})}})):t.push({title:"Connect to Broadway server",onClick:function(){OSjs.Broadway.Connection.connect()}}),r.createMenu(t,e)}var t=OSjs.Core.getWindowManager(),n=r.getConfig("Broadway");u(),t&&n.enabled&&(u(),t.createNotificationIcon("BroadwayService",{image:r.getIcon("gtk.png"),onContextMenu:function(t){return e(t),!1},onClick:function(t){return e(t),!1}}),c())}function d(e,t){v=new WebSocket(e,"broadway-spawner"),v.onerror=function(){t("Failed to connect to spawner")},v.onopen=function(){t(null,v)},v.onclose=function(){OSjs.Broadway.Connection.disconnect()}}function f(){l()}function p(){m=!1,v&&v.close(),v=null;try{OSjs.Broadway.GTK.disconnect()}catch(e){}var e=OSjs.Core.getWindowManager();e&&e.getWindows().forEach(function(e){e&&e instanceof OSjs.Broadway.Window&&e.destroy()}),setTimeout(function(){c()},100)}function h(){if(!m&&!v){var e=r.getConfig("Broadway");d(a(e.defaults.spawner),function(t){if(m=!0,t)r.error("Broadway","Failed to connect",t);else try{var n=a(e.defaults.connection);OSjs.Broadway.GTK.connect(n)}catch(e){}})}}function g(e){m&&v&&v.send(JSON.stringify({method:"launch",argument:e}))}var m=!1,v=null,_=function(){var e;return function(){if(e||(e=OSjs.Core.getWindowManager()),e){var t=e.getWindowSpace(),n=e?e.getStyleTheme(!0):null,i=n?n.style.window.margin:26;OSjs.Broadway.GTK.inject(null,"resize",null,{width:t.width,height:t.height-i})}}}();OSjs.Broadway.Events={onSocketOpen:function(){window.addEventListener("resize",_),c(),_()},onSocketClose:function(){window.removeEventListener("resize",_),p()},onDeleteSurface:function(e){return s(e,function(e){return e._close()})},onShowSurface:function(e){return s(e,function(e){return e._restore()})},onHideSurface:function(e){return s(e,function(e){return e._minimize()})},onMoveSurface:function(e,t,n,i){return s(e,function(e){var o=OSjs.Core.getWindowManager(),r=o.getWindowSpace();t&&e._move(r.left+i.x,r.top+i.y),n&&e._resize(i.width,i.height)})},onCreateSurface:function(e,t){var n=OSjs.Core.getWindowManager();if(!t.isTemp){var i=new OSjs.Broadway.Window(e,t.x,t.y,t.width,t.height,t.canvas);n.addWindow(i,!0)}}},OSjs.Broadway.Connection={init:f,connect:h,disconnect:p,spawn:g}}(OSjs.Core.Application,OSjs.Core.Window,OSjs.Utils,OSjs.VFS,OSjs.GUI,OSjs.API),function(e,t,n){"use strict";function i(e,t,n,i){for(var o=[],r=n?0:i;r<e.length;r++)o.push(e[r]);return o}function o(e,t){var n;return void 0!==e&&e?"string"!=typeof e?(n=e.utc,e=e.format):n=u.config.utc:e=u.config.defaultFormat,c(t,e,n)}function r(e){return e?e instanceof u?e.date:e:new Date}function a(e,t){return void 0===e||null===e||e<0?t.getFullYear():e}function s(e,t){return void 0===e||null===e||e<0?t.getMonth():e}function u(e){e&&(e instanceof Date?this.date=e:e instanceof u?this.date=e.date:"string"==typeof e&&(this.date=new Date(e))),this.date||(this.date=new Date)}function c(e,t,n){function i(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}n=!0===n,t={default:"Y-m-d H:i:s",shortDate:"m/d/y",mediumDate:"M d, Y",longDate:"F d, Y",fullDate:"l, F d, Y",shortTime:"h:i A",mediumTime:"h:i:s A",longTime:"h:i:s A T",isoDate:"Y-m-d",isoTime:"H:i:s",isoDateTime:"Y-m-d H:i:s"}[t]||t,e instanceof u||(e=new u(e));var o={d:function(e){return i(o.j(e))},D:function(t){return u.dayNames[n?e.getUTCDay():e.getDay()]},j:function(t){return n?e.getUTCDate():e.getDate()},l:function(t){return u.dayNames[(n?e.getUTCDay():e.getDay())+7]},w:function(t){return n?e.getUTCDay():e.getDay()},z:function(t){return e.getDayOfTheYear()},S:function(t){var i=n?e.getUTCDate():e.getDate();return["th","st","nd","rd"][i%10>3?0:(i%100-i%10!=10)*i%10]},W:function(t){return e.getWeekNumber()},F:function(t){return u.monthNames[(n?e.getUTCMonth():e.getMonth())+12]},m:function(e){return i(o.n(e))},M:function(t){return u.monthNames[n?e.getUTCMonth():e.getMonth()]},n:function(t){
return(n?e.getUTCMonth():e.getMonth())+1},t:function(t){return e.getDaysInMonth()},Y:function(t){return n?e.getUTCFullYear():e.getFullYear()},y:function(e){return String(o.Y(e)).slice(2)},a:function(e){return o.G(e)<12?"am":"pm"},A:function(e){return o.a(e).toUpperCase()},g:function(e){return o.G(e)%12||12},G:function(t){return n?e.getUTCHours():e.getHours()},h:function(e){return i(o.g(e))},H:function(e){return i(o.G(e))},i:function(t){return i(n?e.getUTCMinutes():e.getMinutes())},s:function(t){return i(n?e.getUTCSeconds():e.getSeconds())},O:function(t){function n(e){var t=Math.abs(Math.floor(e));return(t<10?"0":"")+t}var i=-e.getTimezoneOffset();return(i>=0?"+":"-")+n(i/60)+":"+n(i%60)},T:function(t){if(n)return"UTC";var i=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g;return(String(e.date).match(i)||[""]).pop().replace(/(\+|\-)[0-9]+$/,"")},U:function(t){return e.getTime()}},r=[];return t.split("").forEach(function(e){r.push(o[e]?o[e]():e)}),r.join("")}u.config={defaultFormat:"isoDateTime"},u.dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],u.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],["UTC","toString","now","parse","getDate","getDay","getFullYear","getHours","getMilliseconds","getMinutes","getMonth","getSeconds","getTime","getTimezoneOffset","getUTCDate","getUTCDay","getUTCFullYear","getUTCHours","getUTCMilliseconds","getUTCMinutes","getUTCMonth","getUTCSeconds","getYear","setDate","setFullYear","setHours","setMilliseconds","setMinutes","setMonth","setSeconds","setTime","setUTCDate","setUTCFullYear","setUTCHours","setUTCMilliseconds","setUTCMinutes","setUTCMonth","setUTCSeconds","setYear","toDateString","toGMTString","toISOString","toJSON","toLocaleDateString","toLocaleFormat","toLocaleString","toLocaleTimeString","toSource","toString","toTimeString","toUTCString","valueOf"].forEach(function(e){u.prototype[e]=function(){return this.date[e].apply(this.date,arguments)}}),u.prototype.get=function(){return this.date},u.prototype.format=function(e){return u.format(this,e)},u.prototype.getFirstDayInMonth=function(e){return u.getFirstDayInMonth(e,null,null,this)},u.prototype.getLastDayInMonth=function(e){return u.getLastDayInMonth(e,null,null,this)},u.prototype.getDaysInMonth=function(){return u.getDaysInMonth(null,null,this)},u.prototype.getWeekNumber=function(){return u.getWeekNumber(this)},u.prototype.isWithinMonth=function(e,t){return u.isWithinMonth(this,e,t)},u.prototype.getDayOfTheYear=function(){return u.getDayOfTheYear()},u.format=function(e,t){return o(t,e)},u.getPreviousMonth=function(e){e=e?e instanceof u?e.date:e:new Date;var t;return t=0===e.getMonth()?new Date(e.getFullYear()-1,11,e.getDate()):new Date(e.getFullYear(),e.getMonth()-1,e.getDate()),new u(t)},u.getNextMonth=function(e){e=e?e instanceof u?e.date:e:new Date;var t;return t=11===e.getMonth()?new Date(e.getFullYear()+1,0,e.getDate()):new Date(e.getFullYear(),e.getMonth()+1,e.getDate()),new u(t)},u.getFirstDayInMonth=function(e,t,n,i){i=r(i),t=a(t,i),n=s(n,i);var c=new Date;return c.setFullYear(t,n,1),!0===e?c.getDate():e?o(e,c):new u(c)},u.getLastDayInMonth=function(e,t,n,i){i=r(i),t=a(t,i),n=s(n,i);var c=new Date;return c.setFullYear(t,n,0),!0===e?c.getDate():e?o(e,c):new u(c)},u.getDaysInMonth=function(e,t,n){n=r(n),e=a(e,n),t=s(t,n);var i=new Date;return i.setFullYear(e,t,0),parseInt(i.getDate(),10)},u.getWeekNumber=function(e){e=e?e instanceof u?e.date:e:new Date;var t=new Date(+e);return t.setHours(0,0,0),t.setDate(t.getDate()+4-(t.getDay()||7)),Math.ceil(((t-new Date(t.getFullYear(),0,1))/864e5+1)/7)},u.getDayName=function(e,t){if(e<0||null===e||void 0===e)return i(u.dayNames,e,t,7);t=t?0:1;var n=e+(t+7);return u.dayNames[n]},u.getMonthName=function(e,t){if(e<0||null===e||void 0===e)return i(u.monthNames,e,t,12);t=t?0:1;var n=e+(t+12);return u.monthNames[n]},u.isWithinMonth=function(e,t,n){return e.getFullYear()>=t.getFullYear()&&e.getMonth()>=t.getMonth()&&e.getFullYear()<=n.getFullYear()&&e.getMonth()<=n.getMonth()},u.getDayOfTheYear=function(){var e=new Date,t=new Date(e.getFullYear(),0,0),n=e-t;return Math.floor(n/864e5)},OSjs.Helpers.Date=u}(OSjs.Utils,OSjs.VFS,OSjs.API),function(e,t,n,i){"use strict";function o(e,t){this.name=e,this.events={},(t||[]).forEach(function(e){this.events[e]=[]},this),this.events}o.prototype.destroy=function(){this.events={}},o.prototype.on=function(e,t,n){function i(e){o.events[e]instanceof Array||(o.events[e]=[]),r.push(o.events[e].push(function(e){return t.apply(n,e)}))}if(n=n||this,!(t instanceof Function))throw new TypeError("EventHandler::on() expects cb to be a Function");var o=this,r=[];return e instanceof RegExp?Object.keys(this.events).forEach(function(t){e.test(t)&&i(t)}):e.replace(/\s/g,"").split(",").forEach(function(e){i(e)}),1===r.length?r[0]:r},o.prototype.off=function(e,t){if(!(this.events[e]instanceof Array))throw new TypeError("Invalid event name");arguments.length>1&&"number"==typeof t?this.events[e].splice(t,1):this.events[e]=[]},o.prototype.emit=function(e,t){return t=t||[],!(this.events[e]instanceof Array)||this.events[e].every(function(e){var n;try{n=e(t)}catch(e){e.stack}return void 0===n||!0===n})},OSjs.Helpers.EventHandler=o}(OSjs.Utils,OSjs.API,OSjs.GUI,OSjs.Core.Window),function(e,t,n,i,o){"use strict";function r(e,i,o){i=n.argumentDefaults(i,{src:"about:blank",focus:function(){},blur:function(){},icon:null,title:"IframeApplicationWindow",width:320,height:240,allow_resize:!1,allow_restore:!1,allow_maximize:!1}),t.apply(this,["IFrameApplicationWindow",i,o]),this._iwin=null,this._frame=null}function a(t,i,o,r){e.call(this,t,i,o),this.options=n.argumentDefaults(r,{icon:"",title:"IframeApplicationWindow"}),this.options.src=this._getResource(this.options.src)}var s=0;r.prototype=Object.create(t.prototype),r.prototype.destroy=function(){return this.postMessage("Window::destroy"),t.prototype.destroy.apply(this,arguments)},r.prototype.init=function(e,n){var i=this,o=t.prototype.init.apply(this,arguments);o.style.overflow="visible";var r="IframeApplicationWindow"+s.toString(),a=document.createElement("iframe");a.setAttribute("border",0),a.id=r,a.className="IframeApplicationFrame",a.addEventListener("load",function(){i._iwin=a.contentWindow,i.postMessage("Window::init")}),this.setLocation(this._opts.src,a),o.appendChild(a),this._frame=a;try{this._iwin=a.contentWindow}catch(e){}return this._iwin&&this._iwin.focus(),this._frame.focus(),this._opts.focus(this._frame,this._iwin),s++,o},r.prototype._blur=function(){return!!t.prototype._blur.apply(this,arguments)&&(this._iwin&&this._iwin.blur(),this._frame&&this._frame.blur(),this._opts.blur(this._frame,this._iwin),!0)},r.prototype._focus=function(){return!!t.prototype._focus.apply(this,arguments)&&(this._iwin&&this._iwin.focus(),this._frame&&this._frame.focus(),this._opts.focus(this._frame,this._iwin),!0)},r.prototype.postMessage=function(e){this._iwin&&this._app&&this._iwin.postMessage({message:e,pid:this._app.__pid,wid:this._wid},window.location.href)},r.prototype.onPostMessage=function(e,t){},r.prototype.setLocation=function(e,t){t=t||this._frame;var n=window.onbeforeunload;window.onbeforeunload=null,t.src=e,window.onbeforeunload=n},a.prototype=Object.create(e.prototype),a.prototype.init=function(t,n){e.prototype.init.apply(this,arguments);var i=this.__pname+"Window";this._addWindow(new r(i,this.options,this),null,!0)},a.prototype.onPostMessage=function(e,t){function i(t,i){o.postMessage({id:e.id,method:e.method,error:t,result:n.cloneObject(i)})}var o=this;"number"==typeof e.id&&e.method&&(this[e.method]?this[e.method](e.args||{},i):i("No such method"))},a.prototype.postMessage=function(e){var t=this._getMainWindow();t&&t.postMessage(e)},OSjs.Helpers.IFrameApplication=a,OSjs.Helpers.IFrameApplicationWindow=r}(OSjs.Core.Application,OSjs.Core.Window,OSjs.Utils,OSjs.VFS,OSjs.GUI),function(e,t,n,i,o,r){"use strict";function a(t,i,o,r){this.defaultOptions=n.argumentDefaults(r,{readData:!0,rawData:!1,extension:"",mime:"application/octet-stream",filetypes:[],filename:"New file"}),e.apply(this,[t,i,o])}a.prototype=Object.create(e.prototype),a.constructor=e,a.prototype.destroy=function(){e.prototype.destroy.apply(this,arguments)},a.prototype._onMessage=function(t,n,r){e.prototype._onMessage.apply(this,arguments);var a=this,s=this._getArgument("file"),u=this._getWindow(this.__mainwindow);"vfs"===t&&null!==r.source&&r.source!==this.__pid&&r.file&&u&&s&&s.path===r.file.path&&o.createDialog("Confirm",{buttons:["yes","no"],message:o._("MSG_FILE_CHANGED")},function(e,t){"ok"!==t&&"yes"!==t||a.openFile(new i.File(r.file),u)},{parent:u,modal:!0})},a.prototype.openFile=function(e,t){function r(t){return!!t&&(o.error(u.__label,o._("ERR_FILE_APP_OPEN"),o._("ERR_FILE_APP_OPEN_ALT_FMT",e.path,t)),!0)}function a(n){u._setArgument("file",e),t.showFile(e,n)}function s(e,n){t._toggleLoading(!1),r(e)||a(n)}var u=this;if(!e)return!1;var c=this.__metadata.mime||[];return n.checkAcceptMime(e.mime,c)?(t._toggleLoading(!0),this.defaultOptions.readData?i.read(e,s,{type:this.defaultOptions.rawData?"binary":"text"}):i.url(e,s),!0):(o.error(this.__label,o._("ERR_FILE_APP_OPEN"),o._("ERR_FILE_APP_OPEN_FMT",e.path,e.mime)),!1)},a.prototype.saveFile=function(e,t,n){var r=this;e&&(n._toggleLoading(!0),i.write(e,t||"",function(t,i){if(n._toggleLoading(!1),t)return void o.error(r.__label,o._("ERR_FILE_APP_SAVE"),o._("ERR_FILE_APP_SAVE_ALT_FMT",e.path,t));r._setArgument("file",e),n.updateFile(e)},{},this))},a.prototype.saveDialog=function(e,t,n,i){var r=this,a=t.getFileData();if(!n)return void this.saveFile(e,a,t);o.createDialog("File",{file:e,filename:e?e.filename:this.defaultOptions.filename,filetypes:this.defaultOptions.filetypes,filter:this.__metadata.mime,extension:this.defaultOptions.extension,mime:this.defaultOptions.mime,type:"save"},function(e,n,o){"ok"===n&&r.saveFile(o,a,t),"function"==typeof i&&i(e,n,o)},{parent:t,modal:!0})},a.prototype.openDialog=function(e,t){function n(){o.createDialog("File",{file:e,filter:r.__metadata.mime},function(e,n,o){"ok"===n&&o&&r.openFile(new i.File(o),t)},{parent:t,modal:!0})}var r=this;t.checkHasChanged(function(e){e&&n()})},a.prototype.newDialog=function(e,t){var n=this;t.checkHasChanged(function(e){e&&(n._setArgument("file",null),t.showFile(null,null))})},OSjs.Helpers.DefaultApplication=a}(OSjs.Core.Application,OSjs.Core.Window,OSjs.Utils,OSjs.VFS,OSjs.API,OSjs.GUI),function(e,t,n,i,o,r){"use strict";function a(e,n,o,r,a){t.apply(this,arguments),this.hasClosingDialog=!1,this.currentFile=a?new i.File(a):null,this.hasChanged=!1}a.prototype=Object.create(t.prototype),a.constructor=t,a.prototype.destroy=function(){t.prototype.destroy.apply(this,arguments),this.currentFile=null},a.prototype.init=function(e,n,i){return t.prototype.init.apply(this,arguments)},a.prototype._inited=function(){var e=t.prototype._inited.apply(this,arguments),n=this,i=this._app,o={MenuNew:function(){i.newDialog(n.currentFile,n)},MenuSave:function(){i.saveDialog(n.currentFile,n)},MenuSaveAs:function(){i.saveDialog(n.currentFile,n,!0)},MenuOpen:function(){i.openDialog(n.currentFile,n)},MenuClose:function(){n._close()}};return this._find("SubmenuFile").on("select",function(e){o[e.detail.id]&&o[e.detail.id]()}),this._find("MenuSave").set("disabled",!0),this.currentFile&&(this._app.openFile(this.currentFile,this)||(this.currentFile=null)),e},a.prototype._onDndEvent=function(e,n,o,r){if(t.prototype._onDndEvent.apply(this,arguments)&&"itemDrop"===n&&o){var a=o.data;a&&"file"===a.type&&a.mime&&this._app.openFile(new i.File(a),this)}},a.prototype._close=function(){var e=this;if(!this.hasClosingDialog)return this.hasChanged?(this.hasClosingDialog=!0,void this.checkHasChanged(function(t){e.hasClosingDialog=!1,t&&(e.hasChanged=!1,e._close())})):void t.prototype._close.apply(this,arguments)},a.prototype.checkHasChanged=function(e){if(this.hasChanged)return void o.createDialog("Confirm",{buttons:["yes","no"],message:o._("MSG_GENERIC_APP_DISCARD")},function(t,n){e("ok"===n||"yes"===n)},{parent:this,modal:!0});e(!0)},a.prototype.showFile=function(e,t){this.updateFile(e)},a.prototype.updateFile=function(e){this.currentFile=e||null,this.hasChanged=!1,this._scheme&&this._scheme instanceof r.Scheme&&this._find("MenuSave").set("disabled",!e),e?this._setTitle(e.filename,!0):this._setTitle()},a.prototype.getFileData=function(){return null},a.prototype._onKeyEvent=function(e,n,i){return"SAVE"===i?(this._app.saveDialog(this.currentFile,this,!this.currentFile),!1):"SAVEAS"===i?(this._app.saveDialog(this.currentFile,this,!0),!1):"OPEN"===i?(this._app.openDialog(this.currentFile,this),!1):t.prototype._onKeyEvent.apply(this,arguments)},OSjs.Helpers.DefaultApplicationWindow=a}(OSjs.Core.Application,OSjs.Core.Window,OSjs.Utils,OSjs.VFS,OSjs.API,OSjs.GUI),function(e,t){"use strict";function n(e){this.clientId=e,this.accessToken=null,this.userId=null,this.preloaded=!1,this.authenticated=!1,this.loaded=[],this.preloads=[{type:"javascript",src:"https://apis.google.com/js/api.js"}]}var i=window.gapi=window.gapi||{},o=null;n.prototype.destroy=function(){},n.prototype.init=function(t){var n=this;t=t||function(){},this.preloaded?t(!1,!0):e.preload(this.preloads,function(e,i){i.length||(n.preloaded=!0),t(i.join("\n"))})},n.prototype.load=function(e,n,r,a){function s(e){c.authenticate(n,function(n,i){if(n)e(n);else{if(!c.authenticated)return void e(t._("GAPI_AUTH_FAILURE"));e(!1,i)}})}function u(t){function n(e,t){var n=[],o=null;e instanceof Array?e.length>0&&e.length<3&&(n=n.concat(e),o=e[0]):(n.push(e),o=e),n.push(function(){c.loaded.push(o),t.apply(this,arguments)}),r?i.client.load.apply(i,n):i.load.apply(i,n)}function o(){s>=u?t():(n(a[s],function(){o()}),s++)}var a=[];e.forEach(function(e){-1===c.loaded.indexOf(e)&&a.push(e)});var s=0,u=a.length;o()}var c=this;this.init(function(e){return e?void a(e):window.gapi&&i.load?void s(function(e){if(e)return void a(e);u(function(e,t){a(e,t,o)})}):void a(t._("GAPI_LOAD_FAILURE"))})},n.prototype.signOut=function(e){if(e=e||function(){},this.authenticated){try{i.auth.signOut()}catch(e){e.stack}this.authenticated=!1;var n=t.getServiceNotificationIcon();n&&n.remove("Google API")}OSjs.Core.getMountManager().remove("GoogleDrive"),e(!1,!0)},n.prototype.revoke=function(t){if(!this.accessToken)return void t(!1);var n="https://accounts.google.com/o/oauth2/revoke?token="+this.accessToken;e.ajax({url:n,jsonp:!0,onsuccess:function(){t(!0)},onerror:function(){t(!1)}})},n.prototype.authenticate=function(e,n){function o(e){e=e||function(){},i.client.load("oauth2","v2",function(){i.client.oauth2.userinfo.get().execute(function(t){e(t.id)})})}function r(t,n){n=n||function(){},i.auth.authorize({client_id:s.clientId,scope:e,user_id:s.userId,immediate:t},n)}function a(){var e=t.getServiceNotificationIcon();e&&(e.remove("Google API"),e.add("Google API",[{title:t._("GAPI_SIGN_OUT"),onClick:function(){s.signOut()}},{title:t._("GAPI_REVOKE"),onClick:function(){s.revoke(function(){s.signOut()})}}]))}n=n||function(){};var s=this,u=function(e,i){if(e.error&&("origin_mismatch"===e.error_subtype||"access_denied"===e.error_subtype&&!i)){var c=t._("GAPI_AUTH_FAILURE_FMT",e.error,e.error_subtype);return void n(c)}e&&!e.error?o(function(t){s.userId=t,t?(a(),s.authenticated=!0,s.accessToken=e.access_token||null,n(!1,!0)):n(!1,!1)}):r(!1,function(e){u(e,!1)})};i.load("auth:client",function(e){if(e&&e.error){var i=t._("GAPI_AUTH_FAILURE_FMT",e.error,e.error_subtype);return void n(i)}r(!0,function(e){u(e,!0)})})},OSjs.Helpers.GoogleAPI=OSjs.Helpers.GoogleAPI||{},OSjs.Helpers.GoogleAPI.getInstance=function(){return o},OSjs.Helpers.GoogleAPI.createInstance=function(e,i){function r(){o.load(a,s,u,i)}var a=e.load||[],s=e.scope||[],u=!0===e.client;if(o)return void r();var c=null;try{c=t.getConfig("GoogleAPI.ClientId")}catch(e){e.stack}if(!c)return void i(t._("GAPI_DISABLED"));o=new n(c),r()}}(OSjs.Utils,OSjs.API),function(e,t){"use strict";function n(e){this.hasSession=!1,this.clientId=e,this.loaded=!1,this.inited=!1,this.accessToken=null,this.lastScope=null,this.preloads=[{type:"javascript",src:"//js.live.net/v5.0/wl.js"}]}var i=window.location.href.replace(/\/$/,"")+"/vendor/wlOauthReceiver.html",o=null;n.prototype.destroy=function(){},n.prototype.init=function(t){t=t||function(){};var n=this;this.loaded?t(!1,!0):e.preload(this.preloads,function(e,i){i.length||(n.loaded=!0),t(i.join("\n"))})},n.prototype.load=function(e,n){function o(){var t=(r.lastScope||[]).sort(),i=(e||[]).sort();if(r.hasSession&&t.toString()===i.toString())return void n(!1,!0);r.login(e,function(e,t){if(e)return void n(e);setTimeout(function(){n(!1,!0)},10)})}var r=this,a=window.WL||{};this.init(function(e){return e?void n(e):window.WL?(a=window.WL||{},void(r.inited?o():(r.inited=!0,a.Event.subscribe("auth.login",function(){r.onLogin.apply(r,arguments)}),a.Event.subscribe("auth.logout",function(){r.onLogout.apply(r,arguments)}),a.Event.subscribe("wl.log",function(){r.onLog.apply(r,arguments)}),a.Event.subscribe("auth.sessionChange",function(){r.onSessionChange.apply(r,arguments)}),a.init({client_id:r.clientId,display:"popup",redirect_uri:i}).then(function(e){e.session&&(r.accessToken=e.session.access_token||null),"connected"===e.status?n(!1,!0):"success"===e.status?o():n(t._("WLAPI_INIT_FAILED_FMT",e.status.toString()))},function(e){console.error("WindowsLiveAPI::load()","init() error",e),n(e.error_description)})))):void n(t._("WLAPI_LOAD_FAILURE"))})},n.prototype._removeRing=function(){var e=t.getServiceNotificationIcon();e&&e.remove("Windows Live API")},n.prototype.logout=function(e){e=e||function(){};var t=this,n=window.WL||{};this.hasSession&&e(!1,!1),n.Event.unsubscribe("auth.logout"),n.Event.subscribe("auth.logout",function(){t._removeRing(),n.Event.unsubscribe("auth.logout"),e(!1,!0)}),n.logout(),OSjs.Core.getMountManager().remove("OneDrive")},n.prototype.login=function(e,n){var o=window.WL||{};if(this.hasSession)return void n(!1,!0);o.login({scope:e,redirect_uri:i}).then(function(e){"connected"===e.status?n(!1,!0):n(t._("WLAPI_LOGIN_FAILED"))},function(e){n(t._("WLAPI_LOGIN_FAILED_FMT",e.error_description))})},n.prototype.onSessionChange=function(){var e=window.WL||{},t=e.getSession();this.hasSession=!!t},n.prototype.onLogin=function(){this.hasSession=!0;var e=this,n=t.getServiceNotificationIcon();n&&n.add("Windows Live API",[{title:t._("WLAPI_SIGN_OUT"),onClick:function(){e.logout()}}])},n.prototype.onLogout=function(){this.hasSession=!1,this._removeRing()},n.prototype.onLog=function(){},OSjs.Helpers.WindowsLiveAPI=OSjs.Helpers.WindowsLiveAPI||{},OSjs.Helpers.WindowsLiveAPI.getInstance=function(){return o},OSjs.Helpers.WindowsLiveAPI.createInstance=function(e,i){function r(){var t=e.scope;o.load(t,function(e){i(e||!1,o)})}if(e=e||{},o)return void r();var a=null;try{a=t.getConfig("WindowsLiveAPI.ClientId")}catch(e){e.stack}if(!a)return void i(t._("WLAPI_DISABLED"));o=new n(a),r()}}(OSjs.Utils,OSjs.API),function(e,t,n){"use strict";function i(e,t){zip.createReader(new zip.BlobReader(e),function(e){e.getEntries(function(e){t(!1,e)})},function(e){t(e)})}function o(e,t,n){var i=new zip.BlobWriter;e.getData(i,function(e){t(e),i=null},n)}function r(e,t){n.download(e,function(n,o){if(n)return void t(n);i(new Blob([o],{type:e.mime}),function(e,n){t(e,n||[])})})}function a(e,t,n,i,r){function a(s){if(!t.length||s>=t.length)return void i(!1);var u=t[s];if(r.indexOf(u.filename)>=0)return n("ignored",s,u),void a(s+1);o(u,function(t){e.add(u.filename,new zip.BlobReader(t),function(){n("added",s,u),a(s+1)},function(e,t){n("reading",s,t,e)},{directory:u.directory,lastModDate:u.lastModDate,version:u.version})})}r=r||[],a(0)}function s(e){var t=new zip.BlobWriter;zip.createWriter(t,function(t){e(!1,t)},function(t){e(t)})}function u(t,i,o){t.close(function(t){n.upload({destination:e.dirname(i.path),files:[{filename:e.filename(i.path),data:t}]},function(e,t){var n="error"===e&&t;o(n,!!n)},{overwrite:!0})})}function c(e){this.opts=e,this.inited=!1,this.preloads=[{type:"javascript",src:"/vendor/zip.js/WebContent/zip.js"}]}var l=null;c.prototype.init=function(n){if(n=n||function(){},this.inited)return void n();var i=this;e.preload(this.preloads,function(e,o){if(o.length)return void n(t._("ZIP_PRELOAD_FAIL"),o);window.zip&&(zip.workerScriptsPath="/vendor/zip.js/WebContent/",i.inited=!0),n()})},c.prototype.list=function(e,t){n.download(e,function(e,n){if(e)return alert(e),void t(e,null);i(new Blob([n],{type:"application/zip"}),function(e,n){t(e,n)})})},c.prototype.create=function(i,o,r){var a=new zip.BlobWriter;zip.createWriter(a,function(a){a.close(function(s){n.upload({destination:e.dirname(i.path),files:[{filename:e.filename(i.path),data:s}]},function(e,n){a=null,"error"!==e&&t.message("vfs:upload",i,{source:r?r.__pid:null}),o("error"===e&&n,"error"!==e)},{overwrite:!0})})})},c.prototype.add=function(t,i,o){function c(e,t){f(e,t)}function l(t,n){var o=!1,r=e.filename(i.path);t.forEach(function(e){return e.filename===r&&(!e.directory||e.directory&&"dir"===i.type)&&(o=!0),!o}),n(!!o&&"File is already in archive")}function d(e,o){function r(n){e.add(a,new zip.BlobReader(n),function(){u(e,t,o)},function(e,t){p("compressing",e)})}var a=i instanceof window.File?i.name:i.filename,s=i instanceof window.File?"file":i.type||"file";a=((h||"/").replace(/\/$/,"")+"/"+a).replace(/^\//,""),"dir"===s?function(){e.add(a,null,function(){u(e,t,o)},null,{directory:!0})}():i instanceof window.File?r(i):n.download(i,function(e,t){if(e)return void o(e);r(new Blob([t],{type:i.mime}))})}var f=o.oncomplete||function(){},p=o.onprogress||function(){},h=o.path||"/";r(t,function(e,t){if(e)return void c(e);l(t,function(e){if(e)return void c(e);s(function(e,n){if(e)return void c(e);a(n,t,p,function(e){if(e)return void c(e);d(n,function(e){c(e,!!e)})})})})})},c.prototype.remove=function(e,n,i){function o(n,o,r){if(n||!r)return void i(n||t._("ZIP_NO_RESOURCE"));u(r,e,function(e,t){i(e,t)})}if(!n)return void o(t._("ZIP_NO_PATH"));r(e,function(e,t){if(e)return void o(e);s(function(e,i){if(e)return void o(e);a(i,t,function(){},function(e){o(e,!!e,i)},[n])})})},c.prototype.extract=function(r,a,s){function u(e,n,i){e||t.message("vfs:update",a,{source:s.app?s.app.__pid:null}),s.oncomplete(e,n,i)}function c(t,i){function r(t,r){s.onprogress(t.filename,l,p);var a=i;if(t.filename.match(/\//)&&(t.directory?a+="/"+t.filename:a+="/"+e.dirname(t.filename)),t.directory)return void n.mkdir(new n.File(a),function(n,i){n?f.push(e.format('Could not create directory "{0}": {1}',t.filename,n)):d.push(t.filename),r()});o(t,function(i){n.upload({destination:a,files:[{filename:e.filename(t.filename),data:i}]},function(n,i){"error"===n?f.push(e.format('Could not extract "{0}": {1}',t.filename,i)):d.push(t.filename),r()})},function(){})}function a(){d.length,f.length,u(!1,f,!0)}function c(){if(!t.length||l>=t.length)return void a();r(t[l],function(){l++,c()})}p=t.length;var l=0;c()}function l(e,t){var i=new n.File({path:e,type:"dir"});n.mkdir(i,function(e,o){n.exists(i,function(e,n){t(n?!1:"Destination directory was not created or does not exist")})})}s=s||{},s.onprogress=s.onprogress||function(){},s.oncomplete=s.oncomplete||function(){};var d=[],f=[],p=0;n.download(r,function(e,t){if(e)return void u(e,f,!1);var n=new Blob([t],{type:"application/zip"});l(a,function(t){if(t)return void u(e,f,!1);i(n,function(e,t){if(e)return void u(e,f,!1);c(t,a)})})})},OSjs.Helpers.ZipArchiver=OSjs.Helpers.ZipArchiver||{},OSjs.Helpers.ZipArchiver.getInstance=function(){return l},OSjs.Helpers.ZipArchiver.createInstance=function(e,n){e=e||{},l||(l=new c(e)),l.init(function(e){e||window.zip||(e=t._("ZIP_VENDOR_FAIL")),n(e,!e&&l)})}}(OSjs.Utils,OSjs.API,OSjs.VFS),function(e){"use strict";function t(e,t){if(this._pool=t,e.constructor!=={}.constructor&&!(e instanceof Array))throw new Error("SettingsFragment will not work unless you give it a object to manage.");this._settings=e}t.prototype.get=function(e,t){var n=e?this._settings[e]:this._settings;return void 0===n?t:n},t.prototype.set=function(t,n,i,o){return null===t?e.mergeObject(this._settings,n):["number","string"].indexOf(typeof t)>=0&&(this._settings[t]=n),i&&OSjs.Core.getSettingsManager().save(this._pool,i),void 0!==o&&!0!==o||OSjs.Core.getSettingsManager().changed(this._pool),this},t.prototype.save=function(e){return OSjs.Core.getSettingsManager().save(this._pool,e)},t.prototype.getChained=function(){var e=this._settings;return arguments.every(function(t){return!!e[t]&&(e=e[t],!0)}),e},t.prototype.mergeDefaults=function(t){return e.mergeObject(this._settings,t,{overwrite:!1}),this},t.prototype.instance=function(e){if(void 0===this._settings[e])throw new Error("The object doesn't contain that key. SettingsFragment will not work.");return new OSjs.Helpers.SettingsFragment(this._settings[e],this._pool)},OSjs.Helpers.SettingsFragment=t}(OSjs.Utils);
//# sourceMappingURL=osjs.min.js.map