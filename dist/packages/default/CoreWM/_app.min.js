/**!
 * OS.js - JavaScript Cloud/Web Desktop Platform
 *
 * Copyright (c) 2011-2017, Anders Evenrud <andersevenrud@gmail.com>
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met: 
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author  Anders Evenrud <andersevenrud@gmail.com>
 * @licence Simplified BSD License
 */
window.OSjs=window.OSjs||{},function(t,e,i,n,o,s){"use strict";function r(t,e,i){return o.getIcon(t.icon,i,t.className)}function a(t){function e(t){return function(e){OSjs.GUI.Helpers.createDraggable(e,{type:"application",data:{launch:t.name}})}}function i(t){return function(){o.launch(t.name)}}var n=OSjs.Core.getPackageManager().getPackages(),s=OSjs.Core.getWindowManager(),a=s.getDefaultSetting("menu"),c={};Object.keys(a).forEach(function(t){c[t]=[]}),Object.keys(n).forEach(function(t){var e=n[t];if("application"===e.type&&!1!==e.visible){var i=e.category&&c[e.category]?e.category:"unknown";c[i].push({name:t,data:e})}});var l=[];return Object.keys(c).forEach(function(t){for(var n=[],s=0;s<c[t].length;s++){var p=c[t][s];n.push({title:p.data.name,icon:r(p.data,p.name),tooltip:p.data.description,onCreated:e(p),onClick:i(p)})}n.length&&l.push({title:OSjs.Applications.CoreWM._(a[t].title),icon:o.getIcon(a[t].icon,"16x16"),menu:n})}),l}function c(){function t(t,i){var s=document.createElement("gui-menu-entry"),a=document.createElement("img");a.src=r(i,t,"32x32");var c=document.createElement("div");c.appendChild(document.createTextNode(i.name)),n.$bind(s,"click",function(e){e.stopPropagation(),o.launch(t),o.blurMenu()}),s.appendChild(a),s.appendChild(c),e.appendChild(s)}var e=this.$element=document.createElement("gui-menu");this.$element.id="CoreWMApplicationMenu";var i=OSjs.Core.getPackageManager().getPackages();Object.keys(i).forEach(function(e){var n=i[e];"application"===n.type&&!1!==n.visible&&t(e,n)})}function l(t){var e=OSjs.Core.getWindowManager();if(e&&!0===e.getSetting("useTouchMenu")){var i=new c,s={x:t.clientX,y:t.clientY};if(t.target){var r=n.$position(t.target,document.body);if(r.left&&r.top&&r.width&&r.height){s.x=r.left-r.width/2,s.x<=16&&(s.x=0);var l=n.$parent(t.target,function(t){return"corewm-panel"===t.tagName.toLowerCase()});if(l){var p=n.$position(l);s.y=p.top+p.height}else s.y=r.top+r.height}}o.createMenu(null,s,i)}else{var u=a(t),h=o.createMenu(u,t);h&&h.$element&&n.$addClass(h.$element,"CoreWMDefaultApplicationMenu")}}c.prototype.destroy=function(){this.$element&&(this.$element.querySelectorAll("gui-menu-entry").forEach(function(t){n.$unbind(t,"click")}),n.$remove(this.$element)),this.$element=null},c.prototype.show=function(t){this.$element&&(this.$element.parentNode||document.body.appendChild(this.$element),n.$removeClass(this.$element,"AtBottom"),n.$removeClass(this.$element,"AtTop"),t.y>window.innerHeight/2?(n.$addClass(this.$element,"AtBottom"),this.$element.style.top="auto",this.$element.style.bottom="30px"):(n.$addClass(this.$element,"AtTop"),this.$element.style.bottom="auto",this.$element.style.top="30px"),this.$element.style.left=t.x+"px")},c.prototype.getRoot=function(){return this.$element},OSjs.Applications=OSjs.Applications||{},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.showMenu=l}(OSjs.Core.WindowManager,OSjs.Core.Window,OSjs.GUI,OSjs.Utils,OSjs.API,OSjs.VFS),function(t,e,i,n,o,s){"use strict";function r(t,e,i){o.createDialog("Input",{value:t,message:OSjs.Applications.CoreWM._("Create in {0}",e)},function(t,o,r){r&&i(new s.File(n.pathJoin(e,r)))})}function a(t,i,n){e.apply(this,["IconViewShortcutDialog",{title:"Edit Launcher",icon:"status/appointment-soon.png",width:400,height:220,allow_maximize:!1,allow_resize:!1,allow_minimize:!1},null,i]),this.values={path:t.path,filename:t.filename,args:t.args||{}},this.cb=n||function(){}}function c(t){var e=this;this.dialog=null,this.$iconview=null,this.$element=document.createElement("gui-icon-view"),this.$element.setAttribute("data-multiple","false"),this.$element.id="CoreWMDesktopIconView",this.shortcutCache=[],this.refreshTimeout=null,i.Helpers.createDroppable(this.$element,{onOver:function(e,i,n){t.onDropOver(e,i,n)},onLeave:function(){t.onDropLeave()},onDrop:function(){t.onDrop()},onItemDropped:function(e,i,n,o){t.onDropItem(e,i,n,o)},onFilesDropped:function(e,i,n,o){t.onDropFile(e,i,n,o)}}),this.$iconview=i.Element.createFromNode(this.$element),this.$iconview.build(),this.$iconview.on("select",function(){if(t){var e=t.getCurrentWindow();e&&e._blur()}}).on("activate",function(t){t&&t.detail&&t.detail.entries.forEach(function(t){var e=t.data,i=new s.File(e);o.open(i,e.args)})}).on("contextmenu",function(t){t&&t.detail&&t.detail.entries&&e.createContextMenu(t.detail.entries[0],t)}),this._refresh()}a.prototype=Object.create(e.prototype),a.constructor=e,a.prototype.init=function(t,i){var n=this,o=e.prototype.init.apply(this,arguments);return this._render(this._name),this._find("InputShortcutLaunch").set("value",this.values.path),this._find("InputShortcutLabel").set("value",this.values.filename),this._find("InputTooltipFormatString").set("value",JSON.stringify(this.values.args||{})),this._find("ButtonApply").on("click",function(){n.applySettings(),n._close("ok")}),this._find("ButtonCancel").on("click",function(){n._close()}),o},a.prototype.applySettings=function(){this.values.path=this._find("InputShortcutLaunch").get("value"),this.values.filename=this._find("InputShortcutLabel").get("value"),this.values.args=JSON.parse(this._find("InputTooltipFormatString").get("value")||{})},a.prototype._close=function(t){return this.cb(t,this.values),e.prototype._close.apply(this,arguments)},a.prototype._destroy=function(){return e.prototype._destroy.apply(this,arguments)},c.prototype.destroy=function(){n.$remove(this.$element),this.refreshTimeout=clearTimeout(this.refreshTimeout),this.$element=null,this.$iconview=null,this.dialog&&this.dialog.destroy(),this.dialog=null,this.shortcutCache=[]},c.prototype.blur=function(){i.Element.createFromNode(this.$element).set("value",null)},c.prototype.getRoot=function(){return this.$element},c.prototype.resize=function(t){var e=this.getRoot(),i=t.getWindowSpace();e&&(e.style.top=i.top+"px",e.style.left=i.left+"px",e.style.width=i.width+"px",e.style.height=i.height+"px")},c.prototype._refresh=function(t){var e=this,i=OSjs.Core.getWindowManager().getSetting("desktopPath"),r=n.pathJoin(i,".shortcuts.json");this.shortcutCache=[],this.refreshTimeout=clearTimeout(this.refreshTimeout),this.refreshTimeout=setTimeout(function(){s.scandir(i,function(t,i){e.$iconview&&!t&&e.$iconview.clear().add(i.map(function(t){if("application"===t.type||!0===t.shortcut){var i=new s.File(t);i.shortcut=!0;var n=e.shortcutCache.push(i)-1,r=new s.File(t);return r.__index=n,{_type:t.type,icon:o.getFileIcon(t,"32x32"),label:t.filename,value:r,args:t.args||{}}}return{_type:"vfs",icon:o.getFileIcon(t,"32x32"),label:t.filename,value:t}}).filter(function(t){return t.value.path!==r}))})},150)},c.prototype._save=function(t){var e=OSjs.Core.getWindowManager().getSetting("desktopPath"),i=n.pathJoin(e,".shortcuts.json"),o=this.shortcutCache,r=this;s.mkdir(n.dirname(i),function(e){s.write(i,JSON.stringify(o,null,4),function(e,i){t&&r._refresh()})})},c.prototype.updateShortcut=function(t,e){var i=this.shortcutCache[t.__index];i.path===t.path&&(Object.keys(e).forEach(function(t){i[t]=e[t]}),this._save(!0))},c.prototype.getShortcutByPath=function(t){var e=null,i=-1;return this.shortcutCache.forEach(function(n,o){e||"application"!==n.type&&n.path===t&&(e=n,i=o)}),{item:e,index:i}},c.prototype.addShortcut=function(t,e,i){["icon"].forEach(function(e){t[e]&&delete t[e]}),"application"===t.type&&(t.args=t.args||{}),t.shortcut=!0,this.shortcutCache.push(t),this._save(!0)},c.prototype.removeShortcut=function(t){var e=this.shortcutCache[t.__index];e&&e.path===t.path&&(this.shortcutCache.splice(t.__index,1),this._save(!0))},c.prototype._getContextMenu=function(t){var e=this,i=OSjs.Core.getMountManager(),n=OSjs.Core.getWindowManager().getSetting("desktopPath"),a=[{title:o._("LBL_UPLOAD"),onClick:function(){o.createDialog("FileUpload",{dest:n},function(){e._refresh()})}},{title:o._("LBL_CREATE"),menu:[{title:o._("LBL_FILE"),onClick:function(){r("New file",n,function(t){s.write(t,"",function(t){t&&o.error("CoreWM",o._("ERR_VFSMODULE_MKFILE"),t)})})}},{title:o._("LBL_DIRECTORY"),onClick:function(){r("New directory",n,function(t){s.mkdir(t,function(t){t&&o.error("CoreWM",o._("ERR_VFSMODULE_MKDIR"),t)})})}}]}];if(t&&t.data){var c=t.data;"application"===c.type&&a.push({title:OSjs.Applications.CoreWM._("Edit shortcut"),onClick:function(){e.openShortcutEdit(c)}}),i.getRootFromPath(c.path)!==n?a.push({title:OSjs.Applications.CoreWM._("Remove shortcut"),onClick:function(){e.removeShortcut(c)}}):a.push({title:o._("LBL_DELETE"),onClick:function(){s.unlink(c,function(){})}})}return a},c.prototype.createContextMenu=function(t,e){var i=OSjs.Core.getWindowManager(),n=i._getContextMenu(t);o.createMenu(n,e)},c.prototype.openShortcutEdit=function(t){this.dialog&&this.dialog._close();var e=this,i=OSjs.Core.getWindowManager();this.dialog=new a(t,i._scheme,function(i,n){"ok"===i&&e.updateShortcut(t,n),e.dialog=null}),i.addWindow(this.dialog,!0)},OSjs.Applications=OSjs.Applications||{},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.DesktopIconView=c}(OSjs.Core.WindowManager,OSjs.Core.Window,OSjs.GUI,OSjs.Utils,OSjs.API,OSjs.VFS),function(t,e,i,n,o,s){"use strict";var r=function(){this.$switcher=null,this.showing=!1,this.index=-1,this.winRef=null};r.prototype.destroy=function(){this._remove()},r.prototype._remove=function(){this.$switcher&&(this.$switcher.parentNode&&this.$switcher.parentNode.removeChild(this.$switcher),this.$switcher=null)},r.prototype.show=function(t,e,i){e=e||i.getLastWindow(),t.preventDefault();var o=0,s=[],r=0;this.$switcher?n.$empty(this.$switcher):this.$switcher=document.createElement("corewm-window-switcher");for(var a,c,l,p,u=0;u<i._windows.length;u++)(p=i._windows[u])&&(a=document.createElement("div"),c=document.createElement("img"),c.src=p._icon,l=document.createElement("span"),l.innerHTML=p._title,a.appendChild(c),a.appendChild(l),this.$switcher.appendChild(a),o+=32,e&&e._wid===p._wid&&(r=u),s.push({element:a,win:p}));this.$switcher.parentNode||document.body.appendChild(this.$switcher),this.$switcher.style.height=o+"px",this.$switcher.style.marginTop=(o?-(o/2<<0):0)+"px",this.showing?++this.index>s.length-1&&(this.index=-1):(this.index=r,this.showing=!0),this.index,s[this.index]?(s[this.index].element.className="Active",this.winRef=s[this.index].win):this.winRef=null},r.prototype.hide=function(t,e,i){this.showing&&(t.preventDefault(),this._remove(),e=this.winRef||e,e&&e._focus(),this.winRef=null,this.index=-1,this.showing=!1)},OSjs.Applications=OSjs.Applications||{},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.WindowSwitcher=r}(OSjs.Core.WindowManager,OSjs.Core.Window,OSjs.GUI,OSjs.Utils,OSjs.API,OSjs.VFS),function(t,e,i,n,o,s){"use strict";function r(t,i,n,o,s){this._closeCallback=s||function(){},this._settings=n,this.scheme=o,e.apply(this,[t,i,null,o])}function a(t,e,i){e=e||{},this._name=t,this._$element=null,this._$container=null,this._items=[],this._outtimeout=null,this._intimeout=null,this._options=e.mergeDefaults({position:"top"}),this._name,this._options.get()}r.prototype=Object.create(e.prototype),r.constructor=e,r.prototype.init=function(t,i){var n=this,o=e.prototype.init.apply(this,arguments);return this._render(this._name),this._find("ButtonApply").on("click",function(){n.applySettings(),n._close("ok")}),this._find("ButtonCancel").on("click",function(){n._close()}),o},r.prototype.applySettings=function(){},r.prototype._close=function(t){return this._closeCallback(t),e.prototype._close.apply(this,arguments)},r.prototype._destroy=function(){return this._settings=null,e.prototype._destroy.apply(this,arguments)};a.prototype.init=function(t){function e(t){var e=[{title:OSjs.Applications.CoreWM._("Open Panel Settings"),onClick:function(t){s.showSettings("panel")}}];!0===s.getSetting("useTouchMenu")?e.push({title:OSjs.Applications.CoreWM._("Turn off TouchMenu"),onClick:function(t){s.applySettings({useTouchMenu:!1},!1,!0)}}):e.push({title:OSjs.Applications.CoreWM._("Turn on TouchMenu"),onClick:function(t){s.applySettings({useTouchMenu:!0},!1,!0)}}),o.createMenu(e,t)}var i=this,s=OSjs.Core.getWindowManager();this._$container=document.createElement("corewm-panel-container"),this._$element=document.createElement("corewm-panel"),this._$element.setAttribute("data-orientation","horizontal"),this._$element.setAttribute("role","toolbar"),n.$bind(this._$element,"mouseover",function(t){i.onMouseOver(t)}),n.$bind(this._$element,"mouseout",function(t){i.onMouseOut(t)}),n.$bind(this._$element,"click",function(t){OSjs.API.blurMenu()}),n.$bind(this._$element,"contextmenu",function(t){e(t)}),n.$bind(document,"mouseout:panelmouseleave",function(t){i.onMouseLeave(t)},!1),this._$element.appendChild(this._$container),t.appendChild(this._$element),setTimeout(function(){i.update()},0)},a.prototype.destroy=function(){this._clearTimeouts(),n.$unbind(document,"mouseout:panelmouseleave"),n.$unbind(this._$element),this._items.forEach(function(t){t.destroy()}),this._items=[],this._$element=n.$remove(this._$element),this._$container=null},a.prototype.update=function(t){t=t||this._options.get();var e=this,i={ontop:!!t.ontop,position:t.position||"bottom"};t.autohide&&this.onMouseOut(),this._$element&&Object.keys(i).forEach(function(t){e._$element.setAttribute("data-"+t,"boolean"==typeof i[t]?i[t]?"true":"false":i[t])}),this._options.set(null,t)},a.prototype.autohide=function(t){this._options.get("autohide")&&this._$element&&(t?this._$element.setAttribute("data-autohide","true"):this._$element.setAttribute("data-autohide","false"))},a.prototype._clearTimeouts=function(){this._outtimeout&&(clearTimeout(this._outtimeout),this._outtimeout=null),this._intimeout&&(clearTimeout(this._intimeout),this._intimeout=null)},a.prototype.onMouseLeave=function(t){var e=t.relatedTarget||t.toElement;e&&"HTML"!==e.nodeName||this.onMouseOut(t)},a.prototype.onMouseOver=function(){var t=this;this._clearTimeouts(),this._intimeout=setTimeout(function(){t.autohide(!1)},150)},a.prototype.onMouseOut=function(){var t=this;this._clearTimeouts(),this._outtimeout=setTimeout(function(){t.autohide(!0)},600)},a.prototype.addItem=function(t){if(!(t instanceof OSjs.Applications.CoreWM.PanelItem))throw"Expected a PanelItem in Panel::addItem()";this._items.push(t),this._$container.appendChild(t.init())},a.prototype.isAutoHidden=function(){return!!this._$element&&"true"===this._$element.getAttribute("data-autohide")},a.prototype.getItemByType=function(t){return this.getItem(t)},a.prototype.getItemsByType=function(t){return this.getItem(t,!0)},a.prototype.getItem=function(t,e){var i=e?[]:null;return this._items.forEach(function(n,o){if(n instanceof t){if(!e)return i=n,!1;i.push(n)}return!0}),i},a.prototype.getOntop=function(){return this._options.get("ontop")},a.prototype.getPosition=function(t){return t?this._options.get("position")===t:this._options.get("position")},a.prototype.getAutohide=function(){return this._options.get("autohide")},a.prototype.getRoot=function(){return this._$element},a.prototype.getHeight=function(){return this._$element?this._$element.offsetHeight:0};var c=function(t,e,i,n){this._$root=null,this._$container=null,this._className=t||"Unknown",this._itemName=e||t.split(" ")[0],this._settings=null,this._settingsDialog=null,i&&i instanceof OSjs.Helpers.SettingsFragment&&n&&(this._settings=i.mergeDefaults(n))};c.Name="PanelItem",c.Description="PanelItem Description",c.Icon="actions/stock_about.png",c.HasOptions=!1,c.prototype.init=function(){var t=this,e=OSjs.Applications.CoreWM._;if(this._$root=document.createElement("corewm-panel-item"),this._$root.className=this._className,this._$container=document.createElement("ul"),this._$container.setAttribute("role","toolbar"),this._$container.className="corewm-panel-buttons",this._settings){var i=e("Open {0} Settings",e(this._itemName));n.$bind(this._$root,"contextmenu",function(e){e.stopPropagation(),e.preventDefault(),o.createMenu([{title:i,onClick:function(){t.openSettings()}}],e)})}return this._$root.appendChild(this._$container),this._$root},c.prototype.destroy=function(){this._settingsDialog&&this._settingsDialog.destroy(),n.$unbind(this._$root,"contextmenu"),this._settingsDialog=null,this._$root=n.$remove(this._$root),this._$container=n.$remove(this._$container)},c.prototype.applySettings=function(){},c.prototype.openSettings=function(t,e){if(this._settingsDialog)return this._settingsDialog._restore(),!1;var i=this,n=OSjs.Core.getWindowManager();return t&&(this._settingsDialog=new t(this,n._scheme,function(t){"ok"===t&&i.applySettings(),i._settingsDialog=null}),OSjs.Core.getWindowManager().addWindow(this._settingsDialog,!0)),!0},c.prototype.getRoot=function(){return this._$root},OSjs.Applications=OSjs.Applications||{},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.Panel=a,OSjs.Applications.CoreWM.PanelItem=c,OSjs.Applications.CoreWM.PanelItemDialog=r}(OSjs.Core.WindowManager,OSjs.Core.Window,OSjs.GUI,OSjs.Utils,OSjs.API,OSjs.VFS),function(t,e,i,n,o){"use strict";function s(t){function e(e,i){if(!0===t._options.aspect){var n=r.width+e;return{width:n,height:n/t._aspect}}return{width:r.width+e,height:r.height+i}}function n(n,c,l){n.preventDefault(),t._locked||(o=clearTimeout(o),a=c,s=t._getNormalizedPosition(),r=t._getDimension(),i.$bind(window,"mousemove:modifywidget",function(i,n){var o=n.x-a.x,r=n.y-a.y,c="move"===l?{left:s.left+o,top:s.top+r}:e(o,r);t._onMouseMove(i,c,l)}),i.$bind(window,"mouseup:modifywidget",function(e,n){i.$unbind(window,"mousemove:modifywidget"),i.$unbind(window,"mouseup:modifywidget"),t._onMouseUp(e,n,l)}),t._windowWidth=window.innerWidth,t._windowHeight=window.innerHeight,t._onMouseDown(n,c,l))}var o=null,s=t._getNormalizedPosition(),r=t._getDimension(),a={x:0,y:0};i.$bind(t._$element,"mousedown:movewidget",function(t,e){n(t,e,"move")}),i.$bind(t._$resize,"mousedown:resizewidget",function(t,e){t.stopPropagation(),n(t,e,"resize")}),i.$bind(t._$element,"click:showenvelope",function(e){o=clearTimeout(o),t._showEnvelope()}),i.$bind(t._$element,"mouseover:showenvelope",function(){o=clearTimeout(o),o=setTimeout(function(){t._showEnvelope()},c)}),i.$bind(t._$element,"mouseout:hideenvelope",function(e){o=clearTimeout(o),o=setTimeout(function(){t._hideEnvelope()},l)}),i.$bind(t._$element,"contextmenu:widgetcontext",function(e){t._onContextMenu(e)})}function r(t){return void 0!==t&&null!==t&&!isNaN(t)}function a(t,e,n){e=i.mergeObject(i.cloneObject(p),e||{}),this._aspect=!0===e.aspect?e.width/e.height:"number"==typeof e.aspect?e.aspect:1,!1!==e.aspect&&(e.minHeight=e.width/this._aspect,e.maxHeight=e.maxWidth/this._aspect),e.viewBox&&(e.resizable=!0,!0===e.viewBox&&(e.viewBox="0 0 "+e.width+" "+e.height)),this._position={left:n.get("left",e.left),top:n.get("top",e.top),right:n.get("right",e.right),bottom:n.get("bottom",e.bottom)},this._dimension={height:n.get("height",e.height),width:n.get("width",e.width)},this._name=t,this._settings=n,this._options=e,this._isManipulating=!1,this._windowWidth=window.innerWidth,this._windowHeight=window.innerHeight,this._requestId=null,this._saveTimeout=null,this._settingsWindow=null,this._locked=n.get("locked",!1),this._$element=null,this._$resize=null,this._$canvas=null,this._$context=null,i.mergeObject(this._options.settings,n.get("settings",{})),this._name,this._settings.get()}var c=3e3,l=1e3,p={aspect:!1,width:100,height:100,minWidth:64,minHeight:64,maxHeight:500,maxWidth:500,left:0,right:null,top:0,bottom:null,locked:!1,canvas:!1,resizable:!1,viewBox:!1,frequency:2,custom:{},settings:{enabled:!1,name:"CoreWMWidgetSettingsWindow",title:n._("LBL_SETTINGS"),width:300,height:300}};a.prototype.init=function(t){return this._windowWidth=window.innerWidth,this._windowHeight=window.innerHeight,this._$element=document.createElement("corewm-widget"),this._$resize=document.createElement("corewm-widget-resize"),this._options.canvas&&(this._$canvas=document.createElement("canvas"),this._options.viewBox&&this._$canvas.setAttribute("viewBox",this._options.viewBox),this._$context=this._$canvas.getContext("2d"),this._$element.appendChild(this._$canvas)),s(this),this._updatePosition(),this._updateDimension(),this._setLock(this._locked),i.$addClass(this._$element,"Widget"+this._name),this._$element.appendChild(this._$resize),t.appendChild(this._$element),this._$element},a.prototype._inited=function(){function t(){window.requestAnimationFrame(t),n=Date.now(),(s=n-o)>i&&(o=n-s%i,e.onRender())}var e=this;this.onInited(),this.onResize(this._dimension);var i,n,o,s;if(this._$canvas){var r=Math.min(this._options.frequency,1);this._requestId=window.requestAnimationFrame(function(){i=1e3/r,o=Date.now(),t()})}},a.prototype.destroy=function(){i.$unbind(window,"mousemove:modifywidget"),i.$unbind(window,"mouseup:modifywidget"),i.$unbind(this._$resize,"mousedown:resizewidget"),i.$unbind(this._$element,"mousedown:movewidget"),i.$unbind(this._$element,"click:showenvelope"),i.$unbind(this._$element,"mouseover:showenvelope"),i.$unbind(this._$element,"mouseout:hideenvelope"),i.$unbind(this._$element,"contextmenu:widgetcontext"),this._saveTimeout=clearTimeout(this._saveTimeout),this._requestId&&window.cancelAnimationFrame(this._requestId),this._requestId=null,this._settingsWindow&&this._settingsWindow.destroy(),this._settingsWindow=null,this._$canvas=i.$remove(this._$canvas),this._$resize=i.$remove(this._$resize),this._$element=i.$remove(this._$element),this._$context=null},a.prototype.blur=function(){},a.prototype._onMouseDown=function(t,e,n){if(this._saveTimeout=clearTimeout(this._saveTimeout),i.$addClass(this._$element,"corewm-widget-active"),"resize"===n){var o=this._getNormalizedPosition();this._setPosition(o)}},a.prototype._onMouseMove=function(t,e,i){this._isManipulating=!0,"move"===i?(this._setPosition(e,!0),this.onMove(this._position)):(this._setDimension(e),this.onResize(this._dimension))},a.prototype._onMouseUp=function(t,e,n){var o=this;this._isManipulating=!1,this._resizeTimeout=clearTimeout(this._resizeTimeout),i.$removeClass(this._$element,"corewm-widget-active"),this._hideEnvelope(),"resize"===n&&this._setPosition(null,!0),this._saveTimeout=clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(function(){o._saveOptions()},500)},a.prototype._onContextMenu=function(t){var e=OSjs.Applications.CoreWM._,i=this,o=this.onContextMenu(t),s=[{title:e(this._locked?"LBL_UNLOCK":"LBL_LOCK"),onClick:function(){i._setLock(),i._saveOptions()}}];!0!==o&&(o instanceof Array&&(s=o.concat(s)),this._options.settings.enabled&&s.push({title:e("Open {0} Settings",e(this._name)),onClick:function(t){i._openSettings(t)}})),n.createMenu(s,t)},a.prototype._saveOptions=function(t){void 0!==t&&(this._options.settings.tree=t);var e={width:this._dimension.width,height:this._dimension.height,right:this._position.right,left:r(this._position.right)?null:this._position.left,bottom:this._position.bottom,top:r(this._position.bottom)?null:this._position.top,locked:this._locked,settings:{tree:this._options.settings.tree}};this._settings.set(null,e,!0)},a.prototype._openSettings=function(e){if(this._settingsWindow)return void this._settingsWindow._focus();var i=this,n=OSjs.Core.getWindowManager(),o=new t(this._options.settings.name,{title:this._options.settings.title,width:this._options.settings.width,height:this._options.settings.height},null,n._scheme);o._on("init",function(t,n){var s=i.onOpenSettings(t,n,e);o._render(s.id),o._find("ButtonOK").on("click",function(){var o=s.save(t,n,e);i._saveOptions(o)}),s.render(t,n,e)}),o._on("close",function(){i._settingsWindow=null}),this._settingsWindow=n.addWindow(o,!0)},a.prototype._showEnvelope=function(){this._$element&&i.$addClass(this._$element,"corewm-widget-envelope")},a.prototype._hideEnvelope=function(){this._$element&&!this._isManipulating&&i.$removeClass(this._$element,"corewm-widget-envelope")},a.prototype._setPosition=function(t,e){t=t||i.cloneObject(this._position),this._position.top=t.top,this._position.left=t.left,this._position.bottom=null,this._position.right=null,e&&(this._isPastHalf("vertical",t)&&(this._position.top=null,this._position.bottom=this._windowHeight-this._dimension.height-t.top),this._isPastHalf("horizontal",t)&&(this._position.left=null,this._position.right=this._windowWidth-this._dimension.width-t.left)),this._updatePosition()},a.prototype._setDimension=function(t){var e=this._options,i=Math.min(Math.max(t.width,e.minWidth),e.maxWidth),n=Math.min(Math.max(t.height,e.minHeight),e.maxHeight);!0===this._options.aspect&&(n=i/this._aspect),this._dimension.width=i,this._dimension.height=n,this._updateDimension()},a.prototype._setLock=function(t){"boolean"!=typeof t&&(t=!this._locked),this._locked=t,this._$element&&this._$element.setAttribute("data-locked",String(this._locked))},a.prototype._updatePosition=function(){this._$element&&(r(this._position.right)?(this._$element.style.left="auto",this._$element.style.right=String(this._position.right)+"px"):(this._$element.style.left=String(this._position.left)+"px",this._$element.style.right="auto"),r(this._position.bottom)?(this._$element.style.top="auto",this._$element.style.bottom=String(this._position.bottom)+"px"):(this._$element.style.top=String(this._position.top)+"px",this._$element.style.bottom="auto"))},a.prototype._updateDimension=function(){this._$element&&(this._$element.style.width=String(this._dimension.width)+"px",this._$element.style.height=String(this._dimension.height)+"px"),this._$canvas&&(this._$canvas.width=this._dimension.width||64,this._$canvas.height=this._dimension.height||64)},a.prototype._getNormalizedPosition=function(){var t=this._position.left;r(this._position.right)&&(t=this._windowWidth-this._position.right-this._dimension.width);var e=this._position.top;return r(this._position.bottom)&&(e=this._windowHeight-this._position.bottom-this._dimension.height),{left:t,top:e}},a.prototype._getDimension=function(){return{width:this._dimension.width,height:this._dimension.height}},a.prototype._getPosition=function(){return{left:this._position.left,top:this._position.top,right:this._position.right,bottom:this._position.bottom}},a.prototype._setSetting=function(t,e,i){this._options.settings.tree[t]=e,i&&this._saveOptions()},a.prototype._getSetting=function(t,e){if(void 0===this._options.settings||void 0===this._options.settings.tree)return e;var i=this._options.settings.tree[t];return void 0===i?e:i},a.prototype._isPastHalf=function(t,e){e=e||this._position;var i=this._windowWidth/2,n=e.left+this._dimension.width/2;if("horizontal"===t)return n>=i;var o=this._windowHeight/2;return e.top+this._dimension.height/2>=o},a.prototype.onMove=function(){},a.prototype.onResize=function(){},a.prototype.onRender=function(){},a.prototype.onInited=function(){},a.prototype.onContextMenu=function(t){},a.prototype.onOpenSettings=function(t,e,i){return{id:null,save:function(){return{}},render:function(){}}},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.Widget=Object.freeze(a)}(OSjs.Core.Window,OSjs.GUI,OSjs.Utils,OSjs.API,OSjs.VFS),function(t,e,i,n,o,s,r){"use strict";function a(t){i.apply(this,["PanelItemButtons","Buttons",t,{buttons:[{title:o._("LBL_SETTINGS"),icon:"categories/applications-system.png",launch:"ApplicationSettings"}]}])}a.prototype=Object.create(i.prototype),a.constructor=i,a.prototype.init=function(){function t(t){a=n.$remove(a),t||(c=null)}function e(e){var i="UL"===e.tagName;if(e&&c!==e&&!i){var n=e.parentNode;c=e,t(!0),a=document.createElement("li"),a.className="Ghost",n.insertBefore(a,e)}}var o=this,r=i.prototype.init.apply(this,arguments);this.renderButtons();var a,c,l=0;return s.Helpers.createDroppable(this._$container,{onOver:function(t,i,n){t.target&&e(t.target)},onEnter:function(t){t.preventDefault(),l++},onLeave:function(e){l<=0&&t()},onDrop:function(){l=0,t()},onItemDropped:function(t,e,i,s){if(i&&i.data){var r=0;if(n.$hasClass(t.target,"Ghost")&&(r=n.$index(t.target)),void 0!==i.data.position)o.moveButton(i.data.position,r-1);else if("osjs/application"===i.data.mime){var a=i.data.path.split("applications:///")[1];o.createButton(a,r)}}}}),r},a.prototype.clearButtons=function(){n.$empty(this._$container)},a.prototype.renderButtons=function(){var t=this,e={applications:function(t){OSjs.Applications.CoreWM.showMenu(t)},settings:function(t){var e=OSjs.Core.getWindowManager();e&&e.showSettings()},exit:function(t){OSjs.API.signOut()}};this.clearButtons(),(this._settings.get("buttons")||[]).forEach(function(i,n){var s=[{title:"Remove button",onClick:function(){t.removeButton(n)}}],r=function(){o.launch(i.launch)};i.system&&(s=null,r=function(t){t.stopPropagation(),e[i.system](t)}),t.addButton(i.title,i.icon,s,r,n)})},a.prototype.removeButton=function(t){this._settings.get("buttons").splice(t,1),this.renderButtons(),this._settings.save()},a.prototype.moveButton=function(t,e){var i=this,n=this._settings.get("buttons");if(!(t===e||n.length<=1)){if(e>=n.length)for(var o=e-n.length;1+o--;)n.push(window.undefined);n.splice(e,0,n.splice(t,1)[0]),this._settings.save(function(){i.renderButtons()})}},a.prototype.createButton=function(t,e){var i=OSjs.Core.getPackageManager().getPackage(t),n=this._settings.get("buttons"),o={title:t,icon:i.icon,launch:t};n.length?n.splice(e,0,o):n.push(o),this.renderButtons(),this._settings.save()},a.prototype.addButton=function(t,e,i,r,a){var c=document.createElement("img");c.alt="",c.src=o.getIcon(e);var l=document.createElement("li");l.title=t,l.setAttribute("role","button"),l.setAttribute("aria-label",t),l.appendChild(c),n.$bind(l,"mousedown",function(t){t.stopPropagation()}),n.$bind(l,"click",r,!0),n.$bind(l,"contextmenu",function(t){t.preventDefault(),t.stopPropagation(),i&&o.createMenu(i,t)}),s.Helpers.createDraggable(l,{data:{position:a},onStart:function(t,e){setTimeout(function(){n.$addClass(e,"Ghosting")},1)},onEnd:function(t,e){n.$removeClass(e,"Ghosting")}}),this._$container.appendChild(l)},OSjs.Applications=OSjs.Applications||{},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.PanelItems=OSjs.Applications.CoreWM.PanelItems||{},OSjs.Applications.CoreWM.PanelItems.Buttons=a}(OSjs.Applications.CoreWM.Class,OSjs.Applications.CoreWM.Panel,OSjs.Applications.CoreWM.PanelItem,OSjs.Utils,OSjs.API,OSjs.GUI,OSjs.VFS),function(t,e,i,n,o,s,r,a,c){"use strict";function l(t,e,i){n.apply(this,["ClockSettingsDialog",{title:"Clock Settings",icon:"status/appointment-soon.png",width:400,height:280},t._settings,e,i])}function p(t){i.apply(this,["PanelItemClock corewm-panel-right","Clock",t,{utc:!1,interval:1e3,format:"H:i:s",tooltip:"l, j F Y"}]),this.clockInterval=null,this.$clock=null}l.prototype=Object.create(n.prototype),l.constructor=n,l.prototype.init=function(t,e){var i=n.prototype.init.apply(this,arguments);return this._find("InputUseUTC").set("value",this._settings.get("utc")),this._find("InputInterval").set("value",String(this._settings.get("interval"))),this._find("InputTimeFormatString").set("value",this._settings.get("format")),this._find("InputTooltipFormatString").set("value",this._settings.get("tooltip")),i},l.prototype.applySettings=function(){this._settings.set("utc",this._find("InputUseUTC").get("value")),this._settings.set("interval",parseInt(this._find("InputInterval").get("value"),10)),this._settings.set("format",this._find("InputTimeFormatString").get("value")),this._settings.set("tooltip",this._find("InputTooltipFormatString").get("value"),!0)},p.prototype=Object.create(i.prototype),p.constructor=i,p.prototype.createInterval=function(){function t(){var t=e.$clock;if(t){var s=new Date,r=OSjs.Helpers.Date.format(s,i),a=OSjs.Helpers.Date.format(s,n);o.$empty(t),t.appendChild(document.createTextNode(r)),t.setAttribute("aria-label",String(r)),t.title=a}t=null}var e=this,i=this._settings.get("format"),n=this._settings.get("tooltip");!function(i){clearInterval(e.clockInterval),e.clockInterval=clearInterval(e.clockInterval),e.clockInterval=setInterval(function(){t()},i)}(this._settings.get("interval")),t()},p.prototype.init=function(){
var t=i.prototype.init.apply(this,arguments);this.$clock=document.createElement("span"),this.$clock.innerHTML="00:00:00",this.$clock.setAttribute("role","button");var e=document.createElement("li");return e.appendChild(this.$clock),this._$container.appendChild(e),this.createInterval(),t},p.prototype.applySettings=function(){this.createInterval()},p.prototype.openSettings=function(){i.prototype.openSettings.call(this,l,{})},p.prototype.destroy=function(){this.clockInterval=clearInterval(this.clockInterval),this.$clock=o.$remove(this.$clock),i.prototype.destroy.apply(this,arguments)},OSjs.Applications=OSjs.Applications||{},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.PanelItems=OSjs.Applications.CoreWM.PanelItems||{},OSjs.Applications.CoreWM.PanelItems.Clock=p}(OSjs.Applications.CoreWM.Class,OSjs.Applications.CoreWM.Panel,OSjs.Applications.CoreWM.PanelItem,OSjs.Applications.CoreWM.PanelItemDialog,OSjs.Utils,OSjs.API,OSjs.VFS,OSjs.GUI,OSjs.Core.Window),function(t,e,i,n,o,s){"use strict";function r(t,e){e=e||{},this.name=t,this.opts=e,this.$container=document.createElement("li"),this.$image=e.image||e.icon?document.createElement("img"):null,this.onCreated=e.onCreated||function(){},this.onInited=e.onInited||function(){},this.onDestroy=e.onDestroy||function(){},this.onClick=e.onClick||function(){},this.onContextMenu=e.onContextMenu||function(){},this._build(t),this.onCreated()}function a(){i.apply(this,["PanelItemNotificationArea corewm-panel-right"]),this.notifications={}}r.prototype._build=function(t){var e=this,i=["NotificationArea","NotificationArea_"+t];this.opts.className&&i.push(this.opts.className),this.$container.className=i.join(" "),this.$container.setAttribute("role","button"),this.$container.setAttribute("aria-label",this.opts.title),this.opts.tooltip&&(this.$container.title=this.opts.tooltip),n.$bind(this.$container,"mousedown",function(t){t.preventDefault(),t.stopPropagation()}),n.$bind(this.$container,"click",function(t){return t.stopPropagation(),t.preventDefault(),OSjs.API.blurMenu(),e.onClick.apply(e,arguments),!1}),n.$bind(this.$container,"contextmenu",function(t){return t.stopPropagation(),t.preventDefault(),OSjs.API.blurMenu(),e.onContextMenu.apply(e,arguments),!1}),this.$image&&(this.$image.title=this.opts.title||"",this.$image.src=this.opts.image||this.opts.icon||"about:blank",this.$container.appendChild(this.$image));var o=document.createElement("div");o.appendChild(document.createElement("div")),this.$container.appendChild(o)},r.prototype.init=function(t){t.appendChild(this.$container);try{this.onInited(this.$container,this.$image)}catch(t){t.stack}},r.prototype.setIcon=function(t){return this.setImage(t)},r.prototype.setImage=function(t){this.$image&&(this.$image.src=t),this.opts.image=t},r.prototype.setTitle=function(t){this.$image&&(this.$image.title=t),this.opts.title=t},r.prototype.destroy=function(){this.$container&&(n.$unbind(this.$container,"click"),n.$unbind(this.$container,"mousedown"),n.$unbind(this.$container,"contextmenu")),this.onDestroy(),this.$image=n.$remove(this.$image),this.$container=n.$remove(this.$container)};var c={};a.prototype=Object.create(i.prototype),a.constructor=i,a.prototype.init=function(){var t=this,e=i.prototype.init.apply(this,arguments);e.setAttribute("role","toolbar");var n=Object.keys(c);return n.length&&n.forEach(function(e){t.createNotification(e,c[e])}),e},a.prototype.createNotification=function(t,e){if(this._$root&&!this.notifications[t]){var i=new r(t,e);return i.init(this._$container),this.notifications[t]=i,c[t]=e,i}return null},a.prototype.removeNotification=function(t){return!(!this._$root||!this.notifications[t])&&(this.notifications[t].destroy(),delete this.notifications[t],c[t]&&delete c[t],!0)},a.prototype.getNotification=function(t){return!(!this._$root||!this.notifications[t])&&this.notifications[t]},a.prototype.destroy=function(){for(var t in this.notifications)this.notifications.hasOwnProperty(t)&&(this.notifications[t]&&this.notifications[t].destroy(),delete this.notifications[t]);i.prototype.destroy.apply(this,arguments)},OSjs.Applications=OSjs.Applications||{},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.PanelItems=OSjs.Applications.CoreWM.PanelItems||{},OSjs.Applications.CoreWM.PanelItems.NotificationArea=a}(OSjs.Applications.CoreWM.Class,OSjs.Applications.CoreWM.Panel,OSjs.Applications.CoreWM.PanelItem,OSjs.Utils,OSjs.API,OSjs.VFS),function(t,e,i,n,o,s,r){"use strict";function a(t,e){var i=document.createElement("li");i.className=e,i.title=t._title,i.setAttribute("role","button"),i.setAttribute("aria-label",t._title);var o=document.createElement("img");o.alt=t._title,o.src=t._icon;var s=document.createElement("span");s.appendChild(document.createTextNode(t._title)),i.appendChild(o),i.appendChild(s),n.$bind(i,"click",function(){t._restore(!1,!0)}),n.$bind(i,"contextmenu",function(e){return e.preventDefault(),e.stopPropagation(),t&&t._onWindowIconClick(e,this),!1});var r=!1;OSjs.GUI.Helpers.createDroppable(i,{onDrop:function(e,i){t&&t._focus()},onLeave:function(){r&&(r=!1)},onEnter:function(e,i,n){r||(t&&t._focus(),r=!0)},onItemDropped:function(e,i,n,o){return!!t&&t._onDndEvent(e,"itemDrop",n,o)},onFilesDropped:function(e,i,n,o){return!!t&&t._onDndEvent(e,"filesDrop",n,o)}}),t._state.focused&&(i.className+=" Focused"),this.$element=i,this.id=t._wid}function c(){i.apply(this,["PanelItemWindowList corewm-panel-expand"]),this.entries=[]}a.prototype.destroy=function(){this.$element&&(n.$unbind(this.$element,"click"),n.$unbind(this.$element,"contextmenu"),this.$element=n.$remove(this.$element))},a.prototype.event=function(t,e,i){function o(t,e){var n=i.getElementsByClassName(t);if(n.length)for(var o=0,s=n.length;o<s;o++)n[o]&&n[o].parentNode&&e(n[o])}var s="WindowList_Window_"+e._wid;if("focus"===t)o(s,function(t){t.className+=" Focused"});else if("blur"===t)o(s,function(t){t.className=t.className.replace(/\s?Focused/,"")});else if("title"===t)o(s,function(t){t.setAttribute("aria-label",e._title);var i=t.getElementsByTagName("span")[0];i&&(n.$empty(i),i.appendChild(document.createTextNode(e._title)));var o=t.getElementsByTagName("img")[0];o&&(o.alt=e._title)});else if("icon"===t)o(s,function(t){t.getElementsByTagName("img")[0].src=e._icon});else if("attention_on"===t)o(s,function(t){t.className.match(/Attention/)||(t.className+=" Attention")});else if("attention_off"===t)o(s,function(t){t.className.match(/Attention/)||(t.className=t.className.replace(/\s?Attention/,""))});else if("close"===t)return!1;return!0},c.prototype=Object.create(i.prototype),c.constructor=i,c.prototype.init=function(){var t=i.prototype.init.apply(this,arguments),e=OSjs.Core.getWindowManager();if(e)for(var n=e.getWindows(),o=0;o<n.length;o++)n[o]&&this.update("create",n[o]);return t},c.prototype.destroy=function(){this.entries.forEach(function(t){try{t.destroy()}catch(t){}t=null}),this.entries=[],i.prototype.destroy.apply(this,arguments)},c.prototype.update=function(t,e){if(this._$container&&(!e||!1!==e._properties.allow_windowlist)){var i=null;if("create"===t){var n="corewm-panel-ellipsis WindowList_Window_"+e._wid;if(this._$container.getElementsByClassName(n).length)return;i=new a(e,n),this.entries.push(i),this._$container.appendChild(i.$element)}else{var o=-1;this.entries.forEach(function(t,i){return t.id===e._wid&&(o=i),-1!==o}),i=this.entries[o],i&&!1===i.event(t,e,this._$container)&&(i.destroy(),this.entries.splice(o,1))}}},OSjs.Applications=OSjs.Applications||{},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.PanelItems=OSjs.Applications.CoreWM.PanelItems||{},OSjs.Applications.CoreWM.PanelItems.WindowList=c}(OSjs.Applications.CoreWM.Class,OSjs.Applications.CoreWM.Panel,OSjs.Applications.CoreWM.PanelItem,OSjs.Utils,OSjs.API,OSjs.GUI,OSjs.VFS),function(t,e,i,n,o,s){"use strict";function r(){var t=this;i.apply(this,["PanelItemWeather corewm-panel-right corewm-panel-dummy"]),this.clockInterval=null,this.position=null,this.interval=null,this.$element=null,this.$image=null,navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){t.position=e,setTimeout(function(){t.updateWeather()},100)})}r.prototype=Object.create(i.prototype),r.constructor=i,r.prototype.init=function(){var t=i.prototype.init.apply(this,arguments);return this.$element=document.createElement("li"),this.$image=document.createElement("img"),this.$element.appendChild(this.$image),this._$container.appendChild(this.$element),this.updateWeather(),t},r.prototype.destroy=function(){n.$unbind(this._$root,"click"),this.interval=clearInterval(this.interval),this.$image=n.$remove(this.$image),this.$element=n.$remove(this.$element),i.prototype.destroy.apply(this,arguments)},r.prototype.updateWeather=function(){function t(t){s.$image&&(s.$image.src=t)}function e(e,i,r){if(s.$image){e=e||"<unknown location>",i=i||{},r=r||{};var a=i.description||"<unknown weather>",c=r.temp||"<unknown temp>";r.temp&&(c+="C");var l="sunny.png";switch(a){case"clear sky":l="01n"===i.icon?"weather-clear-night.png":"weather-clear.png";break;case"few clouds":l="02n"===i.icon?"weather-few-clouds-night.png":"weather-few-clouds.png";break;case"scattered clouds":case"broken clouds":l="weather-overcast.png";break;case"shower rain":l="weather-showers.png";break;case"rain":l="weather-showers-scattered.png";break;case"thunderstorm":l="stock_weather-storm.png";break;case"snow":l="stock_weather-snow.png";break;case"mist":l="stock_weather-fog.png";break;default:a.match(/rain$/)&&(l="weather-showers-scattered.png")}var p=o.getIcon("status/"+l);s.$image.title=n.format("{0} - {1} - {2}",e,a,c),t(p)}}function i(){if(!r&&s.position){r=!0;var t=s.position.coords.latitude,i=s.position.coords.longitude,a=n.format("http://api.openweathermap.org/data/2.5/weather?lat={0}&lon={1}&units={2}&APPID={3}",t,i,"metric","4ea33327bcfa4ea0293b2d02b6fda385");o.curl({url:a},function(t,i){if(!t&&i){var n=null;try{n=JSON.parse(i.body)}catch(t){}n&&e(n.name,n.weather?n.weather[0]:null,n.main)}r=!1})}}var s=this;if(this.$image){this.$image.title="Not allowed or unavailable";var r=!1;t(o.getIcon("status/weather-severe-alert.png")),this.interval=setInterval(function(){i()},36e5),n.$bind(this._$root,"click",function(){i()}),setTimeout(function(){i()},1e3)}},OSjs.Applications=OSjs.Applications||{},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.PanelItems=OSjs.Applications.CoreWM.PanelItems||{},OSjs.Applications.CoreWM.PanelItems.Weather=r}(OSjs.Applications.CoreWM.Class,OSjs.Applications.CoreWM.Panel,OSjs.Applications.CoreWM.PanelItem,OSjs.Utils,OSjs.API,OSjs.VFS),function(t,e,i,n,o,s){"use strict";function r(t){i.apply(this,["PanelItemAppMenu","AppMenu",t,{}])}r.prototype=Object.create(i.prototype),r.constructor=i,r.prototype.init=function(){var t=i.prototype.init.apply(this,arguments),e=OSjs.Core.getWindowManager(),s=document.createElement("img");s.alt="",s.src=o.getIcon(e.getSetting("icon")||"osjs-white.png");var r=document.createElement("li");return r.title=o._("LBL_APPLICATIONS"),r.className="corewm-panel-button-centered",r.setAttribute("role","button"),r.setAttribute("data-label","OS.js Application Menu"),r.appendChild(s),n.$bind(r,"mousedown",function(t){t.preventDefault(),t.stopPropagation()}),n.$bind(r,"click",function(t){t.stopPropagation(),t.preventDefault(),OSjs.Applications.CoreWM.showMenu(t)}),this._$container.appendChild(r),t},r.prototype.destroy=function(){this._$container&&n.$unbind(this._$container.querySelector("li"),"click"),i.prototype.destroy.apply(this,arguments)},OSjs.Applications=OSjs.Applications||{},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.PanelItems=OSjs.Applications.CoreWM.PanelItems||{},OSjs.Applications.CoreWM.PanelItems.AppMenu=r}(OSjs.Applications.CoreWM.Class,OSjs.Applications.CoreWM.Panel,OSjs.Applications.CoreWM.PanelItem,OSjs.Utils,OSjs.API,OSjs.VFS),function(t,e,i,n,o,s,r,a,c){"use strict";function l(t){i.apply(this,["PanelItemSearch corewm-panel-right","Search",t,{}]),this.$ul=null,this.$box=null,this.$input=null,this.$message=null,this.visible=!1,this.hookId=-1,this.currentIndex=-1,this.currentCount=0}l.prototype=Object.create(i.prototype),l.constructor=i,l.prototype.init=function(){var t=this,e=i.prototype.init.apply(this,arguments),n=document.createElement("img");n.src=s.getIcon("actions/system-search.png");var r=document.createElement("input");r.setAttribute("type","text");var a=document.createElement("gui-text");a.appendChild(r);var c=document.createElement("ul");this.$message=document.createElement("div"),this.$message.appendChild(document.createTextNode(s._("SEARCH_LOADING"))),this.$box=document.createElement("corewm-search"),this.$box.className="custom-notification",this.$box.appendChild(a),this.$box.appendChild(this.$message),this.$box.appendChild(c);var l={};l[o.Keys.DOWN]=function(e){t.navigateDown()},l[o.Keys.UP]=function(e){t.navigateUp()},l[o.Keys.ESC]=function(e){t.hide()},l[o.Keys.ENTER]=function(e){this.value.length?(t.search(this.value),this.value=""):t.navigateOpen()},s.addHook("onBlurMenu",function(){t.hide()}),o.$bind(e,"click",function(e){e.stopPropagation(),t.visible?t.hide():t.show()}),o.$bind(r,"mousedown",function(t){t.stopPropagation()}),o.$bind(r,"keydown",function(t){l[t.keyCode]&&(t.preventDefault(),t.stopPropagation(),l[t.keyCode].call(this,t))}),o.$bind(c,"mousedown",function(t){t.stopPropagation()}),o.$bind(c,"click",function(e){var i=e.target;"LI"===i.tagName&&t.launch(i)}),o.$bind(this.$box,"mousedown",function(){r&&r.focus()});var p=document.createElement("li");return p.appendChild(n),this.$ul=c,this.$input=r,this._$container.appendChild(p),document.body.appendChild(this.$box),e},l.prototype.applySettings=function(){},l.prototype.openSettings=function(){s.launch("ApplicationSettings",{category:"search"})},l.prototype.destroy=function(){this.hookId>=0&&s.removeHook(this.hookId),o.$unbind(this._$root,"click"),o.$unbind(this.$input,"mousedown"),o.$unbind(this.$input,"keydown"),o.$unbind(this.$ul,"mousedown"),o.$unbind(this.$ul,"click"),o.$unbind(this.$box,"mousedown"),this.$message=o.$remove(this.$message),this.$input=o.$remove(this.$input),this.$box=o.$remove(this.$box),this.$ul=o.$remove(this.$ul),i.prototype.destroy.apply(this,arguments)},l.prototype.launch=function(t){var e=t.getAttribute("data-launch"),i=JSON.parse(t.getAttribute("data-args")),n=t.getAttribute("data-file"),o=t.getAttribute("data-mime"),a=t.getAttribute("data-type");n?"dir"===a?s.launch("ApplicationFileManager",{path:n}):s.open(new r.File(n,o)):s.launch(e,i),this.hide()},l.prototype.show=function(){if(this.$box&&!this.visible){var t=OSjs.Core.getWindowManager(),e=t.getWindowSpace(!0);o.$empty(this.$box.querySelector("ul")),this.$box.style.marginTop=String(e.top)+"px",this.$box.querySelector("input").value="",this.$box.setAttribute("data-visible",String(!0)),this.$box.querySelector("input").focus(),this.visible=!0,this.$message.style.display="none"}},l.prototype.hide=function(){this.$box&&this.visible&&(this.$box.setAttribute("data-visible",String(!1)),this.visible=!1)},l.prototype.search=function(t){if(this.$box){this.currentIndex=-1,this.currentCount=0,o.$empty(this.$message),this.$message.appendChild(document.createTextNode(s._("SEARCH_LOADING"))),this.$message.style.display="block";var e=this;OSjs.Core.getSearchEngine().search(t,{limit:10,recursive:!0},function(t,i){t.length?console.error("PanelItemSearch::search()","errors",t):e.renderResult(i)})}},l.prototype.renderResult=function(t){if(this.$box){var e=this.$box.querySelector("ul");o.$empty(e),this.currentCount=t.length,this.currentCount?this.$message.style.display="none":(o.$empty(this.$message),this.$message.appendChild(document.createTextNode(s._("SEARCH_NO_RESULTS"))),this.$message.style.display="block"),t.forEach(function(t){var i=document.createElement("img");i.src=t.icon;var n=document.createElement("div");n.className="Title",n.appendChild(document.createTextNode(t.title));var o=document.createElement("div");o.className="Message",o.appendChild(document.createTextNode(t.description));var s=document.createElement("li");s.setAttribute("data-launch",t.launch.application),s.setAttribute("data-args",JSON.stringify(t.launch.args)),t.launch.file&&(s.setAttribute("data-file",t.launch.file.path),s.setAttribute("data-mime",t.launch.file.mime),s.setAttribute("data-type",t.launch.file.type)),s.appendChild(i),s.appendChild(n),s.appendChild(o),e.appendChild(s)})}},l.prototype.updateSelection=function(){var t=this.$box.querySelector("ul"),e=t.children[this.currentIndex];t.querySelectorAll("li").forEach(function(t){o.$removeClass(t,"active")}),o.$addClass(e,"active")},l.prototype.navigateUp=function(){this.currentCount&&(this.currentIndex>0?this.currentIndex--:this.currentIndex=this.currentCount-1,this.updateSelection())},l.prototype.navigateDown=function(){this.currentCount&&(this.currentIndex<0||this.currentIndex>=this.currentCount-1?this.currentIndex=0:this.currentIndex++,this.updateSelection())},l.prototype.navigateOpen=function(){if(-1!==this.currentIndex&&this.currentCount){var t=this.$box.querySelector("ul"),e=t.children[this.currentIndex];e&&this.launch(e)}},OSjs.Applications=OSjs.Applications||{},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.PanelItems=OSjs.Applications.CoreWM.PanelItems||{},OSjs.Applications.CoreWM.PanelItems.Search=l}(OSjs.Applications.CoreWM.Class,OSjs.Applications.CoreWM.Panel,OSjs.Applications.CoreWM.PanelItem,OSjs.Applications.CoreWM.PanelItemDialog,OSjs.Utils,OSjs.API,OSjs.VFS,OSjs.GUI,OSjs.Core.Window),function(t,e,i,n,o,s){"use strict";function r(e){t.call(this,"AnalogClock",{width:300,height:300,aspect:!0,top:100,right:20,canvas:!0,frequency:1,resizable:!0,viewBox:!0},e),this.radius=150}r.prototype=Object.create(t.prototype),r.constructor=t,r.prototype.init=function(e){return t.prototype.init.apply(this,arguments)},r.prototype.destroy=function(e){return t.prototype.destroy.apply(this,arguments)},r.prototype.onRender=function(){function t(t,e,i,n){t.beginPath(),t.lineWidth=n,t.lineCap="round",t.moveTo(0,0),t.rotate(e),t.lineTo(0,-i),t.stroke(),t.rotate(-e)}if(this._$canvas){var e=this._$context,i=Math.round(.95*this.radius);e.clearRect(0,0,2*this.radius,2*this.radius),e.beginPath(),e.arc(0,0,i,0,2*Math.PI),e.fillStyle="white",e.fill(),e.lineWidth=.04*i,e.stroke(),e.beginPath(),e.arc(0,0,.1*i,0,2*Math.PI),e.fillStyle="#000",e.fill(),e.font=.15*i+"px arial",e.textBaseline="middle",e.textAlign="center";for(var n=1;n<13;n++){var o=n*Math.PI/6;e.rotate(o),e.translate(0,.85*-i),e.rotate(-o),e.fillText(n.toString(),0,0),e.rotate(o),e.translate(0,.85*i),e.rotate(-o)}var s=new Date,r=s.getHours(),a=s.getMinutes(),c=s.getSeconds();r%=12,r=r*Math.PI/6+a*Math.PI/360+c*Math.PI/21600,a=a*Math.PI/30+c*Math.PI/1800,c=c*Math.PI/30,t(e,r,.5*i,.07*i),t(e,a,.8*i,.07*i),t(e,c,.9*i,.02*i)}},r.prototype.onResize=function(t){this._$canvas&&this._$context&&(this.radius=t.height/2,this._$context.translate(this.radius,this.radius))},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.Widgets=OSjs.Applications.CoreWM.Widgets||{},OSjs.Applications.CoreWM.Widgets.AnalogClock=r}(OSjs.Applications.CoreWM.Widget,OSjs.Utils,OSjs.API,OSjs.VFS,OSjs.GUI,OSjs.Core.Window),function(t,e,i,n,o,s){"use strict";function r(e){t.call(this,"DigitalClock",{width:300,height:100,aspect:!0,top:100,right:20,canvas:!0,frequency:1,resizable:!0,viewBox:!0,settings:{enabled:!1,tree:{color:"#ffffff"}}},e)}r.prototype=Object.create(t.prototype),r.constructor=t,r.prototype.onRender=function(){if(this._$canvas){var t=this._$context,e=new Date,i=[e.getHours(),e.getMinutes(),e.getSeconds()].map(function(t){return t<10?"0"+String(t):String(t)}).join(":"),n=Math.round(.55*this._dimension.height);t.font=String(n)+"px Digital-7Mono",t.textBaseline="middle",t.fillStyle=this._getSetting("color");var o=Math.round(this._dimension.width/2),s=Math.round(this._dimension.height/2),r=t.measureText(i).width;t.clearRect(0,0,this._dimension.width,this._dimension.height),t.fillText(i,o-r/2-10,s)}},r.prototype.onContextMenu=function(t){var e=this._getSetting("color")||"#ffffff",n=this;return[{title:i._("LBL_COLOR"),onClick:function(){i.createDialog("Color",{color:e},function(t,e,i){"ok"===e&&n._setSetting("color",i.hex,!0)})}}]},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.Widgets=OSjs.Applications.CoreWM.Widgets||{},OSjs.Applications.CoreWM.Widgets.DigitalClock=r}(OSjs.Applications.CoreWM.Widget,OSjs.Utils,OSjs.API,OSjs.VFS,OSjs.GUI,OSjs.Core.Window),function(t,e,i,n,o){"use strict";function s(t){var e=i.getCompability(),n={animations:e.css.animation,useTouchMenu:e.touch};return t&&(n=i.mergeObject(n,t)),n}function r(){var t=OSjs.Applications.CoreWM._;return"function"!=typeof t&&(t=n._),t.apply(t,arguments)}var a=function(e,o){function r(t,e,i,n){e&&e._onKeyEvent(t,"keydown",n)}var a=e.defaults||{};t.apply(this,["CoreWM",this,e,o,s(a)]),this.panels=[],this.widgets=[],this.switcher=null,this.iconView=null,this.$themeLink=null,this.$themeScript=null,this.$animationLink=null,this.importedSettings=i.mergeObject(n.getConfig("SettingsManager.CoreWM"),a),this.generatedHotkeyMap={},this.hotkeyMap={SEARCH:function(t,e,i){if(i){var n=i.getPanel();if(n){var o=n.getItemByType(OSjs.Applications.CoreWM.PanelItems.Search);o&&(t.preventDefault(),o.show())}}},SWITCHER:function(t,e,i){i.getSetting("enableSwitcher")&&i.switcher&&i.switcher.show(t,e,i)},WINDOW_MINIMIZE:function(t,e){e&&e._minimize()},WINDOW_MAXIMIZE:function(t,e){e&&e._maximize()},WINDOW_RESTORE:function(t,e){e&&e._restore()},WINDOW_MOVE_LEFT:function(t,e){e&&e._moveTo("left")},WINDOW_MOVE_RIGHT:function(t,e){e&&e._moveTo("right")},WINDOW_MOVE_UP:function(t,e){e&&e._moveTo("top")},WINDOW_MOVE_DOWN:function(t,e){e&&e._moveTo("bottom")},SAVE:r,SAVEAS:r,OPEN:r},this._$notifications=document.createElement("corewm-notifications"),this._$notifications.setAttribute("role","log"),document.body.appendChild(this._$notifications)};a.prototype=Object.create(t.prototype),a.constructor=t,a.prototype.init=function(){var e=(OSjs.Core.getConfig().Connection.RootURI||"/")+"blank.css";this.setThemeLink(e),this.setAnimationLink(e),t.prototype.init.apply(this,arguments)},a.prototype.setup=function(t){var e=this;this.applySettings(this._settings.get());try{o.watch(o.file(this.getSetting("desktopPath"),"dir"),function(t,i){i&&!t.match(/^vfs:(un)?mount/)&&e.iconView&&e.iconView._refresh()})}catch(t){t.stack}this.initSwitcher(),this.initDesktop(),this.initPanels(),this.initWidgets(),this.initIconView(),function(){function t(t){return OSjs.API.createMenu([{title:n._("TITLE_SIGN_OUT"),onClick:function(){OSjs.API.signOut()}}],t),!1}function o(){var t=document.documentElement,i=e.getNotificationIcon("_FullscreenNotification");i&&n.toggleFullscreen(i.opts._isFullscreen?document:t,!i.opts._isFullscreen)}function s(t){var e=i.$hasClass(document.body,"debug"),o=n.getProcesses().filter(function(t){return null!==t&&t instanceof OSjs.Core.Application}).map(function(t){return{title:t.__label+" (pid:"+t.__pid+")",onClick:function(){n.relaunch(t.__pid)}}}),s=[{title:e?"Turn off debug overlay":"Turn on debug overlay",onClick:function(){e?i.$removeClass(document.body,"debug"):i.$addClass(document.body,"debug")}},{title:"Reload manifest",onClick:function(){OSjs.Core.getPackageManager().load(function(){})}},{title:"Reload running application",menu:o}];OSjs.API.createMenu(s,t)}var r=OSjs.Core.getAuthenticator().getUser();n.getConfig("Debug")&&e.createNotificationIcon("_DeveloperNotification",{image:n.getIcon("categories/applications-development.png","16x16"),title:"Developer Tools",onContextMenu:s,onClick:s}),e.getSetting("fullscreen")&&e.createNotificationIcon("_FullscreenNotification",{image:OSjs.API.getIcon("actions/view-fullscreen.png","16x16"),title:"Enter fullscreen",onClick:o,_isFullscreen:!1}),e.createNotificationIcon("_HandlerUserNotification",{image:n.getIcon("status/avatar-default.png","16x16"),title:n._("TITLE_SIGNED_IN_AS_FMT",r.username),onContextMenu:t,onClick:t})}(),t()},a.prototype.destroy=function(e){if(!e&&!window.confirm(r("Killing this process will stop things from working!")))return!1;i.$unbind(document.body,"dragenter, dragleave, dragover, drop"),this.removeNotificationIcon("_HandlerUserNotification"),this.iconView&&this.iconView.destroy(),this.switcher&&this.switcher.destroy(),this.destroyPanels(),this.destroyWidgets();var n=this.importedSettings;try{n.background="color"}catch(t){}return this.applySettings(s(n),!0),this._$notifications=i.$remove(this._$notifications),this.$themeLink=i.$remove(this.$themeLink),this.$themeScript=i.$remove(this.$themeScript),this.$animationLink=i.$remove(this.$animationLink),this.switcher=null,this.iconView=null,t.prototype.destroy.apply(this,[])},a.prototype.destroyPanels=function(){this.panels.forEach(function(t){t.destroy()}),this.panels=[]},a.prototype.destroyWidgets=function(){this.widgets.forEach(function(t){t.destroy()}),this.widgets=[]},a.prototype._createDialog=function(t,e,i){if(OSjs.Dialogs[t]){var n=Object.create(OSjs.Dialogs[t].prototype);return OSjs.Dialogs[t].apply(n,e),i&&i instanceof OSjs.Core.Window&&i._addChild(n),this.addWindow(n),n}return!1},a.prototype.initSwitcher=function(){this.switcher=new OSjs.Applications.CoreWM.WindowSwitcher},a.prototype.initDesktop=function(){var t=this;e.Helpers.createDroppable(document.body,{onOver:function(e,i,n){t.onDropOver(e,i,n)},onLeave:function(){t.onDropLeave()},onDrop:function(){t.onDrop()},onItemDropped:function(e,i,n,o){t.onDropItem(e,i,n,o)},onFilesDropped:function(e,i,n,o){t.onDropFile(e,i,n,o)}})},a.prototype.initPanels=function(t){var e=this.getSetting("panels"),i=!1,n=this;if(!1===e?i=!0:(this.destroyPanels(),(e||[]).forEach(function(t){t.options||(t.options={});var e=new OSjs.Helpers.SettingsFragment(t.options,"CoreWM"),o=new OSjs.Applications.CoreWM.Panel("Default",e,n);o.init(document.body),(t.items||[]).forEach(function(t){try{void 0!==t.settings&&null!==t.settings||(t.settings={});var e={};try{e=new OSjs.Helpers.SettingsFragment(t.settings,"CoreWM")}catch(t){t.stack}o.addItem(new OSjs.Applications.CoreWM.PanelItems[t.name](e)),i=!0}catch(t){t.stack,n.notification({icon:"status/dialog-warning.png",title:"CoreWM",message:r("An error occured while creating PanelItem: {0}",t)})}}),n.panels.push(o)})),i||this.notification({timeout:0,icon:"status/dialog-warning.png",title:"CoreWM",message:r("Your panel has no items. Go to settings to reset default or modify manually\n(This error may occur after upgrades of OS.js)")}),t){var o=this.panels[0];o&&o.getOntop()&&o.getPosition("top")&&setTimeout(function(){var t=n.getWindowSpace();n._windows.forEach(function(e){e&&e._position.y<t.top&&e._move(e._position.x,t.top)})},800),this.iconView&&this.iconView.resize(this)}setTimeout(function(){n.setStyles(n._settings.get())},250)},a.prototype.initWidgets=function(t){var e=this;this.destroyWidgets(),(this.getSetting("widgets")||[]).forEach(function(t){t.settings||(t.settings={});var i=new OSjs.Helpers.SettingsFragment(t.settings,"CoreWM");try{var n=new OSjs.Applications.CoreWM.Widgets[t.name](i);n.init(document.body),e.widgets.push(n),n._inited()}catch(t){t.stack}})},a.prototype.initIconView=function(){var t=this,e=this.getSetting("enableIconView");if(!e&&this.iconView)return this.iconView.destroy(),void(this.iconView=null);e&&!this.iconView&&(this.iconView=new OSjs.Applications.CoreWM.DesktopIconView(this),document.body.appendChild(this.iconView.getRoot())),setTimeout(function(){t.iconView&&t.iconView.resize(t)},280)},a.prototype.resize=function(e,i,n){t.prototype.resize.apply(this,arguments);var o=this.getWindowSpace(),s=this.getSetting("desktopMargin"),r=this._windows;this._isResponsive||this.getSetting("moveOnResize")&&function(){var t,e,a,c,l,p=0,u=r.length;for(p;p<u;p++)(t=r[p])&&(null===(e=t._getViewRect())||t._state.mimimized||(a=t._position.x,c=t._position.y,l=!1,e.left+s>i.width&&(a=o.width-t._dimension.w,l=!0),e.top+s>i.height&&(c=o.height-t._dimension.h,l=!0),l&&(a<o.left&&(a=o.left),c<o.top&&(c=o.top),t._move(a,c)),!t._state.maximized||n&&!t._restored||t._restore(!0,!1)))}()},a.prototype.onDropLeave=function(){document.body.setAttribute("data-attention","false")},a.prototype.onDropOver=function(){document.body.setAttribute("data-attention","true")},a.prototype.onDrop=function(){document.body.setAttribute("data-attention","false")},a.prototype.onDropItem=function(t,e,n,s){document.body.setAttribute("data-attention","false");var a=this,c=function(t){a.applySettings({wallpaper:t.path},!1,!0)},l=function(t){a.iconView&&a.iconView.addShortcut(t,a,!0)};if(n){var p=n.data;"file"===n.type?p&&p.mime&&(p.mime.match(/^image/)?this.iconView?function(e){OSjs.API.createMenu([{title:r("LBL_COPY"),onClick:function(){var t=i.pathJoin(OSjs.Core.getWindowManager().getSetting("desktopPath"),e.filename);o.copy(e,t,function(){})}},{title:r("Set as wallpaper"),onClick:function(){c(e)}}],t)}(p):c(p):l(p)):"application"===n.type&&l(p)}},a.prototype.onDropFile=function(t,e,i,n){o.upload({destination:"desktop:///",files:i},function(t,e){})},a.prototype.onGlobalClick=function(t){return this.themeAction("event",[t]),!0},a.prototype.onContextMenu=function(t){return t.target!==document.body||(t.preventDefault(),t.stopPropagation(),this.openDesktopMenu(t),!1)},a.prototype.onKeyUp=function(t,e){t&&(t.altKey||this.switcher&&this.switcher.hide(t,e,this))},a.prototype.onKeyDown=function(t,e){var n=!1,o=this;if(t){var s=this.generatedHotkeyMap;Object.keys(s).some(function(r){return!!i.keyCombination(t,r)&&(s[r](t,e,o),n=r,!0)})}return n},a.prototype.showSettings=function(t){OSjs.API.launch("ApplicationSettings",{category:t})},a.prototype.eventWindow=function(t,e){this.panels.forEach(function(i){if(i){var n=i.getItem(OSjs.Applications.CoreWM.PanelItems.WindowList);n&&n.update(t,e)}}),"focus"===t&&this.iconView&&(this.iconView.blur(),this.widgets.forEach(function(t){t.blur()}))},a.prototype.notification=function(){var t=0;return function(e){function o(){function e(){i.$unbind(r),r.parentNode&&r.parentNode.removeChild(r),--t<=0&&(c._$notifications.style.display="none")}l&&(clearTimeout(l),l=null),r.onclick=null,!!p&&p.getSetting("animations")?(r.setAttribute("data-hint","closing"),u=function(){e()}):(r.style.display="none",e())}function s(t){"function"==typeof u&&(clearTimeout(f),f=setTimeout(function(){u(t),u=!1},10))}e=e||{},e.icon=e.icon||null,e.title=e.title||null,e.message=e.message||"",e.onClick=e.onClick||function(){},void 0===e.timeout&&(e.timeout=5e3);var r=document.createElement("corewm-notification"),a=[""],c=this,l=null,p=OSjs.Core.getWindowManager(),u=null;if(e.icon){var h=document.createElement("img");h.alt="",h.src=n.getIcon(e.icon,"32x32"),a.push("HasIcon"),r.appendChild(h)}if(e.title){var d=document.createElement("div");d.className="Title",d.appendChild(document.createTextNode(e.title)),a.push("HasTitle"),r.appendChild(d)}if(e.message){var m=document.createElement("div");m.className="Message";var g=e.message.split("\n");g.forEach(function(t,e){m.appendChild(document.createTextNode(t)),e<g.length-1&&m.appendChild(document.createElement("br"))}),a.push("HasMessage"),r.appendChild(m)}t++,t>0&&(this._$notifications.style.display="block"),r.setAttribute("aria-label",String(e.title)),r.setAttribute("role","alert"),r.className=a.join(" "),r.onclick=function(t){o(),e.onClick(t)};var f;i.$bind(r,"transitionend",s),i.$bind(r,"animationend",s);var y=this.getWindowSpace(!0);this._$notifications.style.marginTop=String(y.top)+"px",this._$notifications.appendChild(r),e.timeout&&(l=setTimeout(function(){o()},e.timeout))}}(),a.prototype._getNotificationArea=function(t){t=t||0;var e=this.panels[t];return!!e&&e.getItem(OSjs.Applications.CoreWM.PanelItems.NotificationArea,!1)},a.prototype.createNotificationIcon=function(t,e,i){if(e=e||{},!t)return!1;var n=this._getNotificationArea(i);return n?n.createNotification(t,e):null},
a.prototype.removeNotificationIcon=function(t,e){if(!t)return!1;var i=this._getNotificationArea(e);return!!i&&(i.removeNotification(t),!0)},a.prototype.getNotificationIcon=function(t,e){if(!t)return!1;var i=this._getNotificationArea(e);return!!i&&i.getNotification(t)},a.prototype._getContextMenu=function(t){var e=this,i=[];return this.iconView&&(i=this.iconView._getContextMenu(t)),i.push({title:r("Open settings"),onClick:function(t){e.showSettings()}}),!0===this.getSetting("enableIconView")?i.push({title:r("Hide Icons"),onClick:function(t){e.applySettings({enableIconView:!1},!1,!0)}}):i.push({title:r("Show Icons"),onClick:function(t){e.applySettings({enableIconView:!0},!1,!0)}}),i},a.prototype.openDesktopMenu=function(t){if(!1!==this._emit("wm:contextmenu",[t,this])){var e=this._getContextMenu();n.createMenu(e,t)}},a.prototype.applySettings=function(t,e,o,s){var r=this;t=e?t:i.mergeObject(this._settings.get(),t),this.setBackground(t),this.setTheme(t),this.setIconView(t),this.setStyles(t),o&&(this.initPanels(!0),this.initWidgets(!0),t&&!0===o&&(t.language&&(OSjs.Core.getSettingsManager().set("Core","Locale",t.language,s),n.setLocale(t.language)),this._settings.set(null,t,o,s))),this.generatedHotkeyMap={};var a=this._settings.get("hotkeys");return Object.keys(a).forEach(function(t){r.generatedHotkeyMap[a[t]]=function(){var e=Array.prototype.slice.call(arguments);return e.push(t),r.hotkeyMap[t].apply(this,e)}}),!0},a.prototype.themeAction=function(t,e){if(e=e||[],OSjs.Applications.CoreWM.CurrentTheme)try{OSjs.Applications.CoreWM.CurrentTheme[t].apply(null,e)}catch(t){t.stack}},a.prototype.setBackground=function(t){t.backgroundColor&&(document.body.style.backgroundColor=t.backgroundColor),t.fontFamily&&(document.body.style.fontFamily=t.fontFamily);var e=t.wallpaper,i=t.background,n="color",s="none";if(e&&i.match(/^image/))switch(s=e,i){case"image":n="normal";break;case"image-center":n="center";break;case"image-fill":n="fill";break;case"image-strech":n="strech";break;default:n="default"}document.body.setAttribute("data-background-style",n);var r=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;if(document.body.style.backgroundAttachment=r?"fixed":"scroll","none"!==s)try{o.url(s,function(t,e){t||(s="url('"+e+"')",document.body.style.backgroundImage=s)})}catch(t){t.stack}else document.body.style.backgroundImage=s},a.prototype.setTheme=function(t){this.$themeLink&&t.styleTheme&&this.setThemeLink(n.getThemeCSS(t.styleTheme)),this.$themeLink&&this.themeAction("destroy"),this.setThemeScript(n.getThemeResource("theme.js")),this.$animationLink&&(t.animations?this.setAnimationLink(this._getResource("animations.css")):this.setAnimationLink(n.getThemeCSS(null)))},a.prototype.setIconView=function(t){t.enableIconView?this.initIconView():this.iconView&&(this.iconView.destroy(),this.iconView=null)},a.prototype.setStyles=function(t){var e={},n="";t.panels&&t.panels.forEach(function(t,i){e["corewm-panel"]={},e["corewm-notification"]={},e["corewm-notification:before"]={opacity:t.options.opacity/100},e["corewm-panel:before"]={opacity:t.options.opacity/100},e[".custom-notification"]={},e[".custom-notification:before"]={opacity:t.options.opacity/100},t.options.background&&(e["corewm-panel:before"]["background-color"]=t.options.background,e["corewm-notification:before"]["background-color"]=t.options.background,e[".custom-notification:before"]["background-color"]=t.options.background),t.options.foreground&&(e["corewm-panel"].color=t.options.foreground,e["corewm-notification"].color=t.options.foreground,e[".custom-notification"].color=t.options.foreground)});var o=this.getDefaultSetting("fullscreenTrigger")||800;n+="@media all and (max-width: "+String(o)+"px) {\n",n+="application-window {\n";var s=0,r=this.getWindowSpace(!0),a=this.getStyleTheme(!0);a&&a.style&&a.style.window&&(s=a.style.window.border),n+="top: calc("+String(r.top)+"px + "+s+") !important;\n",n+="left: calc("+String(r.left)+"px + "+s+") !important;\n",n+="right: calc("+String(s)+") !important;\n",n+="bottom: calc("+(r.bottom?String(r.bottom)+"px + ":"")+s+") !important;\n",n+="\n}",n+="\n}",e["#CoreWMDesktopIconView"]={},t.invertIconViewColor&&t.backgroundColor&&(e["#CoreWMDesktopIconView"].color=i.invertHEX(t.backgroundColor)),Object.keys(e).length&&this.createStylesheet(e,n)},a.prototype.setAnimationLink=function(t){this.$animationLink&&(this.$animationLink=i.$remove(this.$animationLink)),this.$animationLink=i.$createCSS(t)},a.prototype.setThemeLink=function(t){this.$themeLink&&(this.$themeLink=i.$remove(this.$themeLink)),this.$themeLink=i.$createCSS(t)},a.prototype.setThemeScript=function(t){this.$themeScript&&(this.$themeScript=i.$remove(this.$themeScript));var e=this;t&&(this.$themeScript=i.$createJS(t,null,function(){e.themeAction("init")}))},a.prototype.getWindowSpace=function(e){var i=t.prototype.getWindowSpace.apply(this,arguments),n=this.getSetting("desktopMargin");return i.bottom=0,this.panels.forEach(function(t){if(t&&t.getOntop()){var e=t.getHeight();t.getAutohide()&&t.isAutoHidden()?(i.top+=10,i.height-=10):t.getPosition("top")?(i.top+=e,i.height-=e):i.height-=e,"bottom"===t._options.get("position")&&(i.bottom+=e)}}),e||n>0&&(i.top+=n,i.left+=n,i.width-=2*n,i.height-=2*n),i},a.prototype.getWindowPosition=function(e){e=void 0===e||!0===e;var i=t.prototype.getWindowPosition.apply(this,arguments),n=e?this.getSetting("desktopMargin"):0;return i.x+=n||0,i.y+=n||0,this.panels.forEach(function(t){t&&t.getOntop()&&t.getPosition("top")&&(t.getAutohide()?i.y+=10:i.y+=t.getHeight())}),i},a.prototype.getSetting=function(e){var i=t.prototype.getSetting.apply(this,arguments);return void 0===i||null===i?s(this.importedSettings)[e]:i},a.prototype.getDefaultSetting=function(t){var e=s(this.importedSettings);return void 0!==t?e[t]:e},a.prototype.getPanels=function(){return this.panels},a.prototype.getPanel=function(t){return this.panels[t||0]},a.prototype.getStyleTheme=function(t,e){var i=this.getSetting("styleTheme")||null;if(t){var n=null;if(i&&this.getStyleThemes().forEach(function(t){t&&t.name===i&&(n=t)}),n&&!0===e){var o=document.createElement("div");o.style.visibility="hidden",o.style.position="fixed",o.style.top="-10000px",o.style.left="-10000px",o.style.width="1em",o.style.height="1em",document.body.appendChild(o);var s=o.offsetWidth;if(o.parentNode.removeChild(o),"string"==typeof n.style.window.margin&&n.style.window.margin.match(/em$/)){var r=parseFloat(n.style.window.margin);n.style.window.margin=r*s}if("string"==typeof n.style.window.border&&n.style.window.border.match(/em$/)){var a=parseFloat(n.style.window.border);n.style.window.border=a*s}}return n}return i},a.prototype.getSoundTheme=function(){return this.getSetting("soundTheme")||"default"},a.prototype.getIconTheme=function(){return this.getSetting("iconTheme")||"default"},a.prototype.getSoundFilename=function(t){return(this.getSetting("sounds")||{})[t]||null},OSjs.Applications=OSjs.Applications||{},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM.Class=Object.seal(a),OSjs.Applications.CoreWM.PanelItems=OSjs.Applications.CoreWM.PanelItems||{},OSjs.Applications.CoreWM.Widgets=OSjs.Applications.CoreWM.Widgets||{},OSjs.Applications.CoreWM.CurrentTheme=OSjs.Applications.CoreWM.CurrentTheme||null}(OSjs.Core.WindowManager,OSjs.GUI,OSjs.Utils,OSjs.API,OSjs.VFS),function(t,e,i,n,o){"use strict";function s(){var t=Array.prototype.slice.call(arguments,0);return t.unshift(r),n.__.apply(this,t)}var r={bg_BG:{"Killing this process will stop things from working!":"       !","Open settings":" ","Your panel has no items. Go to settings to reset default or modify manually\n(This error may occur after upgrades of OS.js)":"   .            \n(         OS.js)","Create shortcut":"  ","Set as wallpaper":"   ","An error occured while creating PanelItem: {0}":"       : {0}",Development:"",Education:"",Games:"",Graphics:"",Network:"",Multimedia:"",Office:"",System:"",Utilities:"",Other:""},de_DE:{"Killing this process will stop things from working!":"Das Beenden dieses Prozesses wird Konsequenzen haben!","Open settings":"Einstellungen ffnen","Your panel has no items. Go to settings to reset default or modify manually\n(This error may occur after upgrades of OS.js)":"Ihr Panel enthlt keine Items. ffnen Sie die Einstellungen um die Panel-Einstellungen zurckzusetzen oder manuell zu ndern (Dieser Fehler kann nach einem Upgrade von OS.js entstehen)","Create shortcut":"Verknpfung erstellen","Set as wallpaper":"Als Hintergrund verwenden","An error occured while creating PanelItem: {0}":"Whrend des Erstellens eines Panel-Items ist folgender Fehler aufgetreten: {0}",Development:"Entwicklung",Education:"Bildung",Games:"Spiele",Graphics:"Grafik",Network:"Netzwerk",Multimedia:"Multimedia",Office:"Bro",System:"System",Utilities:"Zubehr",Other:"Andere"},es_ES:{"Killing this process will stop things from working!":"Forzar la terminacin de este proceso har que las cosas dejen de funcionar!","Open settings":"Abrir preferencias","Your panel has no items. Go to settings to reset default or modify manually\n(This error may occur after upgrades of OS.js)":"Tu panel no tiene elementos. Restablece los valores por defecto en las preferencias, o modifcalo manualmente\n(Este error puede aparecer tras una actualizacin de OS.js)","Create shortcut":"Crear acceso directo","Set as wallpaper":"Seleccionar como fondo de pantalla","An error occured while creating PanelItem: {0}":"Se produjo un error al crear el PanelItem: {0}",Development:"Desarrollo",Education:"Educacin",Games:"Juegos",Graphics:"Grficos",Network:"Red",Multimedia:"Multimedia",Office:"Ofimtica",System:"Sistema",Utilities:"Herramientas",Other:"Otros"},fr_FR:{"Killing this process will stop things from working!":"Tuer ce processus va arrter d'autres lments de fonctionner !","Open settings":"Ouvrir les paramtres","Your panel has no items. Go to settings to reset default or modify manually\n(This error may occur after upgrades of OS.js)":"Votre panneau n'a aucun objet. Rendez-vous dans les paramtres pour remettre  zro ou modifier manuellement\n(Cette erreur peut survenir aprs avori mis  jour OS.js)","Create shortcut":"Crer un raccourci","Set as wallpaper":"Dfinir un fond d'cran","An error occured while creating PanelItem: {0}":"Une erreur est survenue pendant la cration du PanelItem: {0}","Show Icons":"Afficher les icnes","Hide Icons":"Cacher les icnes",Development:"Dveloppement",Education:"ducation",Games:"Jeux",Graphics:"Graphique",Network:"Rseau",Multimedia:"Multimdia",Office:"Bureautique",System:"Systme",Utilities:"Utilitaires",Other:"Autre"},ar_DZ:{"Killing this process will stop things from working!":"      ","Open settings":" ","Your panel has no items. Go to settings to reset default or modify manually\n(This error may occur after upgrades of OS.js)":"                 (      OS.js)","Create shortcut":" ","Set as wallpaper":"   ","An error occured while creating PanelItem: {0}":"       : {0}","Show Icons":" ","Hide Icons":" ",Development:"",Education:"",Games:"",Graphics:"",Network:"",Multimedia:" ",Office:"",System:"",Utilities:"",Other:""},it_IT:{"Killing this process will stop things from working!":"Terminare questo processo bloccher altre funzionalit!","Open settings":"Apri settaggi","Your panel has no items. Go to settings to reset default or modify manually\n(This error may occur after upgrades of OS.js)":"Il tuo pannello non ha elementi. Vai nei settaggi per resettare ai valori predefiniti o modificarli manualmente\n(Questo errore pu accadere dopo un aggiornamento di OS.js)","Create shortcut":"Crea colelgamento","Set as wallpaper":"Imposta come sfondo desktop","An error occured while creating PanelItem: {0}":"Si  verificato un errore nella creazione del PanelItem: {0}","Show Icons":"Mostra icone","Hide Icons":"Nascondi icone",Development:"Sviluppo",Education:"Educazione",Games:"Giochi",Graphics:"Grafica",Network:"Reti",Multimedia:"Multimedia",Office:"Ufficio",System:"Sistema",Utilities:"Utilit",Other:"Altro"},ko_KR:{"Killing this process will stop things from working!":"        !","Open settings":" ","Your panel has no items. Go to settings to reset default or modify manually\n(This error may occur after upgrades of OS.js)":"  .     .\n(  OS.js      )","Create shortcut":" ","Set as wallpaper":" ","An error occured while creating PanelItem: {0}":"       : {0}",Development:"",Education:"",Games:"",Graphics:"",Network:"",Multimedia:"",Office:"",System:"",Utilities:"",Other:""},nl_NL:{"Killing this process will stop things from working!":"Het stoppen van dit proces zal er voor zorgen dat dingen niet meer werken!","Open settings":"Instellingen openen","Your panel has no items. Go to settings to reset default or modify manually\n(This error may occur after upgrades of OS.js)":"Het paneel bevat geen items. Ga naar instellingen om te herstellen naar de standaard of om handmatig te wijzigen\n(Deze fout kan het gevolg zijn van een update van OS.js)","Create shortcut":"Maak een link","Set as wallpaper":"Als achtergrond gebruiken","An error occured while creating PanelItem: {0}":"Er is een fout opgetreden tijdens het maken van paneel item: {0}",Development:"Ontwikkeling",Education:"Educatie",Games:"Spellen",Graphics:"Grafisch",Network:"Netwerk",Multimedia:"Multimedia",Office:"Kantoor",System:"Systeem",Utilities:"Toebehoren",Other:"Overig"},no_NO:{"Killing this process will stop things from working!":"Dreping av denne prosessen vil f konsekvenser!","Open settings":"pne instillinger","Your panel has no items. Go to settings to reset default or modify manually\n(This error may occur after upgrades of OS.js)":"Ditt panel har ingen objekter. G til instillinger for  nullstille eller modifisere manuelt\n(Denne feilen kan oppst etter en oppdatering av OS.js)","Create shortcut":"Lag snarvei","Set as wallpaper":"Sett som bakgrunn","An error occured while creating PanelItem: {0}":"En feil oppstod under lasting av PanelItem: {0}","Show Icons":"Vis Ikoner","Hide Icons":"Skjul Ikoner","Create in {0}":"Opprett i {0}",Development:"Utvikling",Education:"Utdanning",Games:"Spill",Graphics:"Grafikk",Network:"Nettverk",Multimedia:"Multimedia",Office:"Kontor",System:"System",Utilities:"Verkty",Other:"Andre"},pl_PL:{"Killing this process will stop things from working!":"Zabicie tego procesu zatrzyma wykonywanie dziaa!","Open settings":"Otwrz ustawienia","Your panel has no items. Go to settings to reset default or modify manually\n(This error may occur after upgrades of OS.js)":"Twj panel nie ma elementw. Id do ustawie aby przywrci domylne lub zmie rcznie\n(Ten bd moe wystpi po aktualizacji OS.js)","Create shortcut":"Utwrz skrt","Set as wallpaper":"Ustaw jako tapet","An error occured while creating PanelItem: {0}":"Wystpi bd podczas tworzenia PanelItem: {0}","Show Icons":"Poka Ikony","Hide Icons":"Ukryj Ikony",Development:"Development",Education:"Edukacja",Games:"Gry",Graphics:"Graficzne",Network:"Sie",Multimedia:"Multimedia",Office:"Biuro",System:"System",Utilities:"Uytkowe",Other:"Inne"},ru_RU:{"Killing this process will stop things from working!":"     !","Open settings":" ","Your panel has no items. Go to settings to reset default or modify manually\n(This error may occur after upgrades of OS.js)":"    .           \n(      OS.js)","Create shortcut":" ","Set as wallpaper":"  ","An error occured while creating PanelItem: {0}":"    PanelItem: {0}",Development:"",Education:"",Games:"",Graphics:"",Network:"",Multimedia:"",Office:"",System:"",Utilities:"",Other:""},sk_SK:{"Open settings":"Otvor nastavenia","Create shortcut":"Vytvor linku","Set as wallpaper":"Nastav ako tapetu","An error occured while creating PanelItem: {0}":"Chyba pri vytvran poloky: {0}",Development:"Vvoj",Education:"Vzdelvanie",Games:"Hry",Graphics:"Grafika",Network:"Sie",Multimedia:"Multimdi",Office:"Kancelria",System:"Systm",Utilities:"Pomcky",Other:"Ostatn"},tr_TR:{"Open settings":"Ayarlar A","Create shortcut":"Ksayol Olutur","Set as wallpaper":"Arkaplan olarak ayarla","An error occured while creating PanelItem: {0}":"{0} oluturulurken bir hata meydana geldi",Development:"Gelitirici",Education:"Eitim",Games:"Oyunlar",Graphics:"Grafikler",Network:"A",Multimedia:"Multimedia",Office:"Ofis",System:"Sistem",Utilities:"Yan Gereksinimler",Other:"Dier"},vi_VN:{"Killing this process will stop things from working!":"ng qu trnh ny s lm mi th b tt!","Open settings":"M ci t","Your panel has no items. Go to settings to reset default or modify manually\n(This error may occur after upgrades of OS.js)":"Bng iu khin ca bn khng c mc no. Vo ci t  thit lp li mc nh hoc sa i bng tay\n(Li ny c th xy ra sau khi nng cp OS.js)","Create shortcut":"To li tt","Set as wallpaper":"t lm hnh nn","An error occured while creating PanelItem: {0}":"C li xy ra trong khi to PanelItem: {0}","Show Icons":"Hin cc biu tng","Hide Icons":"n cc biu tng","Create in {0}":"To trong {0}",Development:"Pht trin",Education:"Gio dc",Games:"Tr chi",Graphics:" ha",Network:"Mng",Multimedia:"a phng tin",Office:"Vn phng",System:"H thng",Utilities:"Tin ch",Other:"Khc"}};OSjs.Applications=OSjs.Applications||{},OSjs.Applications.CoreWM=OSjs.Applications.CoreWM||{},OSjs.Applications.CoreWM._=s}(OSjs.Core.WindowManager,OSjs.GUI,OSjs.Utils,OSjs.API,OSjs.VFS);
//# sourceMappingURL=_app.min.js.map