<!doctype html>
<html>
<head>
<script src="https://rawgit.com/imaya/zlib.js/master/bin/inflate_stream.min.js"></script>
<script>
  var ZlibCurrent = Zlib;
  Zlib = void 0;
</script>
<script src="../closure-primitives/base.js"></script>
<script src="../define/typedarray/hybrid.js"></script>
<script>
  goog.require('Zlib.InflateStream');
</script>
<script>

function decodeB64(b64buf) {
  var decoded = new Array();
  var tmp, t1, t2, t3, t4;
  var pos = 0;
  var i, il;
  var table = decodeB64.DecodeTable;

  for (i = 0, il = b64buf.length; i < il; i += 4, pos += 3) {
    t1 = table[b64buf.charCodeAt(i)];
    t2 = table[b64buf.charCodeAt(i+1)];
    t3 = table[b64buf.charCodeAt(i+2)];
    t4 = table[b64buf.charCodeAt(i+3)];
    tmp = (t1 << 18) | (t2 << 12) | (t3 << 6) | t4;

    decoded[pos] = tmp >>> 16;
    if (t3 === 255) break;
    decoded[pos+1] = tmp >>> 8 & 0xff;
    if (t4 === 255) break;
    decoded[pos+2] = tmp & 0xff;
  }

  return decoded;
}
decodeB64.DecodeTable = (function(chars) {
  var table = new Uint8Array(256);

  for (var i = 0, il = chars.length; i < il; ++i) {
    table[chars.charCodeAt(i)] = i;
  }
  table['='.charCodeAt(0)] = 255;

  return table;
})('ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/');

//-----------------------------------------------------------------------------
// array assertion
//-----------------------------------------------------------------------------
function arrayEquals(expected, actuals) {
  var i, il;

  if (expected.length !== actuals.length) {
    return false;
  }

  for (i = 0, il = expected.length; i < il; ++i) {
    if (expected[i] !== actuals[i]) {
      return false;
    }
  }

  return true;
}

var size = 123456;
var plain = new Uint8Array(size);
var i, il;
var b64Data =
'eJztzydhGAAAALDd/v////////////////////////////////9no6BxkF+///z99x8A'+
'EAgYBBQMHAISChoGFg4eAREJGQUVDR0DEwsbBxcPn4CQiJiElIycgpKKmoaWjp6BkYmZ'+
'hZWNnYOTi5uHl49fQFBIWERUTFxCUkpaRlZOXkFRSVlFVU1dQ1NLW0dXT9/A0MjYxNTM'+
'3MLSytrG1s7ewdHJ2cXVzd3D08vbx9fPPyAwKDgkNCw8IjIqOiY2Lj4hMSk5JTUtPSMz'+
'KzsnNy+/oLCouKS0rLyisqq6prauvqGxqbmlta29o7Oru6e3r39gcGh4ZHRsfGJyanpm'+
'dm5+YXFpeWV1bX1jc2t7Z3dv/+Dw6Pjk9Oz84vLq+ub27v7h8en55fXt/ePz5//z//n/'+
'/H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f'+
'/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z'+
'//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+'+
'P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//'+
'5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n/'+
'/H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f'+
'/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z'+
'//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+'+
'P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//'+
'5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n/'+
'/H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f'+
'/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z'+
'//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+'+
'P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//'+
'5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n/'+
'/H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f'+
'/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z//n//H/+P/+f/8//5//z'+
'//n//H/+P/+f/8//5//z//n//H/+3+P/Ba1OJPE=';

// make plain data
for (i = 0, il = size; i < il; ++i) {
  plain[i] = i & 0xff;
}

var testData = new Uint8Array(decodeB64(b64Data));
var inflator1 = new ZlibCurrent.InflateStream();
var inflator2 = new Zlib.InflateStream();

var decompressedBuffer1;
var decompressedBuffer2;

for (i = 0, il = testData.length; i < il; ++i) {
  decompressedBuffer1 = inflator1.decompress(testData.subarray(i, i+1));
  decompressedBuffer2 = inflator2.decompress(testData.subarray(i, i+1));
  if (!arrayEquals(decompressedBuffer1, decompressedBuffer2)) {
    console.log(i, decompressedBuffer1, decompressedBuffer2);
    break;
  }
}

console.log("inflated", inflator1.getBytes());
</script>
</head>
<body>
</body>
</html>
